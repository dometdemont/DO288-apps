<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>CMS5G Core Stack</title>
<style>{font-family: arial; font-size: small}body {font: 12px arial, sans-serif; color: #C6C9CA; background-color: black;}th, table { font: 12px arial, sans-serif; color: #C6C9CA; background-color: black;}h1, {color: #FF8300;}h2, h3, h4, h5 {color: #C6C9CA;}input, select {border: none; font: 12px arial, sans-serif; color: #01a982; background-color: black;}.buildButton { background-color: #FF8300; border: none; color: black; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}.buildButton:hover { background-color: #4CAF50; color: white;}.helpButton { background-color: #32DAC8; border: none; color: black; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}.helpButton:hover { background-color: blue; color: white;}.delButton { background-color: #0D5265; border: none; color: white; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}.delButton:hover { background-color: #FF8300; color: black;}a:link, a:visited { text-decoration: none; color: #80746E;}</style><link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAAAAAAAAAAAAAAAAAAAAAAAD///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////AYe0AP+ItAD/h7QA/4e0AP+ItAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4i0AP+HtAD/h7QA/4e0AP+ItAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+HtAD/h7QA/4e0AP////8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wGHtAD/h7QA/4e0AP+HtAD/////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8Bh7QA/4i0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4i0AP+HtAD/iLQA/4i0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+ItAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+HtAD/h7QA/4e0AP+HtAD/iLQA/////wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8BAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//w==" rel="icon" type="image/x-icon"></head>
<body>
<input id="_uniqueInputId" value="6" type="hidden" placeholder="Hidden input recording the html id for dynamic delete buttons">
<table border="0" width="100%">
<tbody><tr><td valign="top" align="left">
<h1>CMS5G Core Stack</h1>
<p><a id="vnfDescriptorWizardVersion" href="#endOfUserArea" title="Click to view version history" style="color: #01a982; text-decoration: underline;" onclick="versionHistory()">2021-03-04 Version 0.91</a></p>
<p>
<label for="quickDescription">Description :</label>
<input id="quickDescription" size="150" name="quickDescription" placeholder="One line CMS5G Core Stack instance description" value="Deploy an automated deployer as a custom app with a jenkins pipeline running autotests">
</p>
</td>
<td valign="top" align="right">
<img id="HPElogo" alt="logo.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAU0AAACBCAYAAABErei/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABo/SURBVHhe7Z0JuFVV+YcXIgpqqDjhVGZqZWamleX0hAaBlg2PkuY8JIQpfzUnxKkcM6KQHMqhIjON1JzIoUwrMzKVnCg0ckYlJUVEAfd/veusb7POZp97z773XOVyf+/zfPfss9bae6+99tm/++019vJkTgghRFMsFz+FEEI0gURTCCEqINEUQogKSDSFEKICEk0hhKiARFMIISog0RRCiApINIUQogISTSGEqIBEUwghKiDRFEKICkg0hRCiAhJNIYSogERTCCEqINEUQogKSDSFEKICEk0hhKiARFMIISog0RRCiApINIUQogISTSGEqIBEUwghKiDRFEKICkg0hRCiAhJNIYSogERTCCEqINEUQogK9PJkcVt0lqyHFGWvXnFDiJ6HRLNVIJgr9nFuhRWce+utGLiM0du/mMx9vXZ9Ek7RQ5FotoJQgv7PAUNddtSeXljmh+BljlVXdr0OOde5qY9KNEWPRaLZCkw0hw9y2YjdnXttGRbN0ROce+AxiabosUg0W4GJ5p5eNEcmornSis4t183b2hYtcu71N2vbiOb/ne/c/TMkmqLHItFsBdYAtM9glx20q3PzvGhS/3fZzc694QWnVzcVTgRz4IDwz8AtWFgTzVHjnXt4pkRT9Fgkmq2g6GnOe8O5Pr1dr2HHLRbU7sq6a7ps0pjaNcnTFEL9NFtKUUf6rVD7RGC6o0HfeA1GT+lWJUQDJJpCCFEBiaYQQlRAoimEEBWQaAohRAUkmkIIUQGJZlcyP3YKp8W5OxrQz1QIkaN+mq0glKD/kw6jpHP7xGtqwtldRwXRuX2dNZw7aKhzb8bO7RpGKXo4Es1WUCaasHLf7iuYBsJJx3aQaAoh0WwJjURzWUOiKYREsyWYaO5vU8O9HoKXORDNQ5kabrpEU/RYJJqtwERz5X4u67/SMjwJcW/Xa/acWv2mRFP0UCSarcKEsycgwRQ9GImmEEJUQP00hRCiAhJNIYSogERTCCEqINEUQogKSDSFEKICEk0hhKiAuhy1kMxmBkrw5Ru3FtNsureLYn7eybwUKSurIm9nfpe2e1dGozJb2vLZXfHlKNFsBfxQ+/Xr51ZaaSX31ltvueWWW87997//DXHpj5V0q6yyiltxxRXDNmnnzJkT4t6JHzV56N+/v1t++eXD90WLFrn//e9/S8UDZg//Rz7yEffmm/VT1JG/xx57rDS8q7D8bLLJJm6FFVYI93j27Nlu1qxZS0V5geVxs802C/eUPL7wwgvBYGnJZ7fGF2Im65z5Ygw2fvx4/5tdzIABA0J4Me3kyZNjiizzopl5oV0i3dtlnHfq1KkxN1nmhb7TeWH/1NqKM0vTpGn5bI8ZM2ZkW2+9dZvHaoXZ8b1QxjNn2VVXXdXl561i5KNv376Z/2cSc5hlEyZMWKry2N1NdZot5JVXXolbNRYuXBi36jHPEp5//vng3b2TvPTSS3HLuRdffDFudQz/jLqJEye6G264wd10003u5JNPzr0fPv2Pzl1xxRXuN7/5jbvlllvcV77ylTyujEbhKXh+f//7393YsWPD92b26Qz2BgHFe740wO8pvY9z586NW6IVSDRFy/n85z/vPve5z7ldd93VDRo0KIbWQND23HNPt/vuu7shQ4a4LbfcMsY0x7x584JopUJvfPvb33bbbbdd/CZE1yDRXApBWNqyRmmMZsMtzj4BT7BIcZ+iGbadejavvvpq+EzTvfbaa3FrcTykaRoxatQot+aaa7o11lgj5PXYY4+NMTXGjBkTPi1vbVmRsjSptUfZPs1aSll80Rqlg3f6zWVZx//uQj2I6AT2Y8XTsVdEWHXVVcPrWypEpL388svdgQceGL4/99xzbqONNgoNGqSzY332s591++67b4i777773D333OOuvPLKEAcf+9jHgsf2xhtvBO9r/PjxYRve9773uREjRoTqgbvvvtvdeOONIRz233//vJFgypQp7s4773S33nqrGzx4cIh/9NFH3eabb57n2fJD49Vhhx3mhg0bFs5DfngFnzZtWogHvMctttjCHXXUUUHYgMaaH/3oR27llVcOjV4c98QTTwwNYfCHP/whnL9v377uzDPPzMsB7Nz2CaNHj3YTJkyoK6u//vWv7hOf+ETYfuaZZ9wGG2wQ4rlOXv+5HsqRuIceeiiU4/Tp00P64rkADxiPdfvttw+i/sADD7gLL7wwf+X95z//GY4NXBtlDVzD0UcfHa6td+/e4d6PGzcuiNj6668fvO9PfepTYV+O+/DDD7vrrrvO3XXXXWF/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">
</td>
</tr></tbody></table>

<h3>Summary: <a id="summary" href="#endOfUserArea">Outputs and Result<a href="#Networks" onclick="Networks.display(true);"> / Networks</a><a href="#Misc" onclick="Misc.display(true);"> / Misc</a><a href="#Flavors" onclick="Flavors.display(true);"> / Flavors</a><a href="#Nodes" onclick="Nodes.display(true);"> / Nodes</a><a href="#OpenShiftNodes" onclick="OpenShiftNodes.display(true);"> / OpenShiftNodes</a><a href="#CinderVolumes" onclick="CinderVolumes.display(true);"> / CinderVolumes</a><a href="#PersistentVolumes" onclick="PersistentVolumes.display(true);"> / PersistentVolumes</a><a href="#Clusters" onclick="Clusters.display(true);"> / Clusters</a><a href="#Builds" onclick="Builds.display(true);"> / Builds</a><a href="#CustomApps" onclick="CustomApps.display(true);"> / CustomApps</a><a href="#NetworkFunctions" onclick="NetworkFunctions.display(true);"> / NetworkFunctions</a><a href="#DirectServices" onclick="DirectServices.display(true);"> / DirectServices</a><a href="#IndirectServices" onclick="IndirectServices.display(true);"> / IndirectServices</a><a href="#OperatorSources" onclick="OperatorSources.display(true);"> / OperatorSources</a><a href="#Operators" onclick="Operators.display(true);"> / Operators</a><a href="#HelmCharts" onclick="HelmCharts.display(true);"> / HelmCharts</a></a></h3>

<form>
<div id="tableInsertionPoint"><div id="NetworksSection" style="display: none;"><a name="Networks"><h2>Networks</h2></a><table border="1" id="Networks"><tbody><tr><th><input type="button" value="Add" onclick="Networks.add();"></th><th class="Networksnetwork" style="width: 80px;">network</th><th class="Networksinterface" style="width: 80px;">interface</th><th class="Networksmask" style="width: 120px;">mask</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Networks.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Networks.help());"></div><div id="MiscSection" style="display: none;"><a name="Misc"><h2>Misc</h2></a><table border="1" id="Misc"><tbody><tr><th><input type="button" value="Add" onclick="Misc.add();"></th><th class="MiscProperty" style="width: 200px;">Property</th><th class="MiscValue" style="width: 400px;">Value</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Misc.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Misc.help());"></div><div id="FlavorsSection" style="display: none;"><a name="Flavors"><h2>Flavors</h2></a><table border="1" id="Flavors"><tbody><tr><th><input type="button" value="Add" onclick="Flavors.add();"></th><th class="FlavorsInfrastructure" style="width: 100px;">Infrastructure</th><th class="FlavorsFlavor" style="width: 120px;">Flavor</th><th class="Flavorsname" style="width: 200px;">name</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Flavors.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Flavors.help());"></div><div id="NodesSection" style="display: none;"><a name="Nodes"><h2>Nodes</h2></a><table border="1" id="Nodes"><tbody><tr><th><input type="button" value="Add" onclick="Nodes.add();"></th><th class="NodesMGMT fqdn" style="width: 120px;">MGMT fqdn</th><th class="NodesMGMT IP addr" style="width: 120px;">MGMT IP addr</th><th class="NodesPUBLIC IP addr" style="width: 120px;">PUBLIC IP addr</th><th class="NodesDATA1 fqdn" style="width: 85px;">DATA1 fqdn</th><th class="NodesDATA1 IP addr" style="width: 85px;">DATA1 IP addr</th><th class="NodesDATA2 fqdn" style="width: 85px;">DATA2 fqdn</th><th class="NodesDATA2 IP addr" style="width: 85px;">DATA2 IP addr</th><th class="NodesDATA3 fqdn" style="width: 85px;">DATA3 fqdn</th><th class="NodesDATA3 IP addr" style="width: 85px;">DATA3 IP addr</th><th class="NodesDATA4 fqdn" style="width: 85px;">DATA4 fqdn</th><th class="NodesDATA4 IP addr" style="width: 85px;">DATA4 IP addr</th><th class="NodesUPF" style="width: 15px;">UPF</th><th class="NodesUPFrouter" style="width: 15px;">UPFrouter</th><th class="NodesMaster" style="width: 15px;">Master</th><th class="NodesEtcd" style="width: 15px;">Etcd</th><th class="NodesWorker" style="width: 15px;">Worker</th><th class="NodesTester" style="width: 15px;">Tester</th><th class="NodesFlavor" style="width: 120px;">Flavor</th><th class="NodesImage" style="width: 200px;">Image</th><th class="NodesVolume" style="width: 15px;">Volume</th><th class="NodesPython3" style="width: 15px;">Python3</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Nodes.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Nodes.help());"></div><div id="OpenShiftNodesSection" style="display: none;"><a name="OpenShiftNodes"><h2>OpenShiftNodes</h2></a><table border="1" id="OpenShiftNodes"><tbody><tr><th><input type="button" value="Add" onclick="OpenShiftNodes.add();"></th><th class="OpenShiftNodesName" style="width: 80px;">Name</th><th class="OpenShiftNodesDomain" style="width: 80px;">Domain</th><th class="OpenShiftNodesOSenv" style="width: 100px;">OSenv</th><th class="OpenShiftNodesext-net" style="width: 120px;">ext-net</th><th class="OpenShiftNodesext-dns" style="width: 120px;">ext-dns</th><th class="OpenShiftNodesFIPAPI" style="width: 120px;">FIPAPI</th><th class="OpenShiftNodesFIPAPP" style="width: 120px;">FIPAPP</th><th class="OpenShiftNodesMasters" style="width: 60px;">Masters</th><th class="OpenShiftNodesWorkers" style="width: 60px;">Workers</th><th class="OpenShiftNodesetc-hosts" style="width: 60px;">etc-hosts</th><th class="OpenShiftNodesFlavor" style="width: 120px;">Flavor</th><th class="OpenShiftNodesWorker flavor" style="width: 120px;">Worker flavor</th><th class="OpenShiftNodes#Volumes" style="width: 60px;">#Volumes</th><th class="OpenShiftNodesUPF" style="width: 120px;">UPF</th><th class="OpenShiftNodesUPF router" style="width: 120px;">UPF router</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(OpenShiftNodes.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(OpenShiftNodes.help());"></div><div id="CinderVolumesSection" style="display: none;"><a name="CinderVolumes"><h2>CinderVolumes</h2></a><table border="1" id="CinderVolumes"><tbody><tr><th><input type="button" value="Add" onclick="CinderVolumes.add();"></th><th class="CinderVolumesName" style="width: 120px;">Name</th><th class="CinderVolumesSize" style="width: 80px;">Size</th><th class="CinderVolumesDescription" style="width: 300px;">Description</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(CinderVolumes.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(CinderVolumes.help());"></div><div id="PersistentVolumesSection" style="display: none;"><a name="PersistentVolumes"><h2>PersistentVolumes</h2></a><table border="1" id="PersistentVolumes"><tbody><tr><th><input type="button" value="Add" onclick="PersistentVolumes.add();"></th><th class="PersistentVolumesName" style="width: 120px;">Name</th><th class="PersistentVolumesSize" style="width: 80px;">Size</th><th class="PersistentVolumesType" style="width: 80px;">Type</th><th class="PersistentVolumesAccess" style="width: 120px;">Access</th><th class="PersistentVolumesReclaim" style="width: 120px;">Reclaim</th><th class="PersistentVolumesCinderVolume" style="width: 120px;">CinderVolume</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(PersistentVolumes.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(PersistentVolumes.help());"></div><div id="ClustersSection" style="display: none;"><a name="Clusters"><h2>Clusters</h2></a><table border="1" id="Clusters"><tbody><tr><th><input type="button" value="Add" onclick="Clusters.add();"></th><th class="ClustersName" style="width: 80px;">Name</th><th class="ClustersEndpoint" style="width: 300px;">Endpoint</th><th class="ClustersToken" style="width: 300px;">Token</th><th class="ClustersTargeted" style="width: 15px;">Targeted</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Clusters.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Clusters.help());"></div><div id="BuildsSection" style=""><a name="Builds"><h2>Builds</h2></a><table border="1" id="Builds"><tbody><tr><th><input type="button" value="Add" onclick="Builds.add();"></th><th class="BuildsType" style="width: 100px;">Type</th><th class="BuildsName" style="width: 100px;">Name</th><th class="BuildsGIT URL" style="width: 400px;">GIT URL</th><th class="Buildsdirectory" style="width: 200px;">directory</th><th class="Buildsbranch" style="width: 120px;">branch</th><th class="BuildssshKey" style="width: 120px;">sshKey</th></tr><tr><td><input type="button" value="Del" class="delButton" id="delButton1" onclick="Builds.delete('delButton1');"></td><td class="BuildsType" style="width: 100px;"><select class="BuildsType" style="width: 100px;"><option value="pipeline">pipeline</option><option value="custom-app" selected="selected">custom-app</option></select></td><td class="BuildsName" style="width: 100px;"><input class="BuildsName" type="text" value="mad" style="width: 100px;"></td><td class="BuildsGIT URL" style="width: 400px;"><input class="BuildsGIT URL" type="text" value="git@github.hpe.com:CMS-5GCS/automated-deployer.git" style="width: 400px;"></td><td class="Buildsdirectory" style="width: 200px;"><input class="Buildsdirectory" type="text" value="" style="width: 200px;"></td><td class="Buildsbranch" style="width: 120px;"><input class="Buildsbranch" type="text" value="" style="width: 120px;"></td><td class="BuildssshKey"><table class="BuildssshKey userLoadedFile" id="Builds_sshKey_delButton1"><tr><td valign="top"><input type="file" id="Builds_sshKey_delButton1_inputId" class="buildButton" onchange="Builds_sshKey_delButton1.load(event)"></td><td valign="top"><input type="button" class="helpButton" value="Review" onclick="Builds_sshKey_delButton1.view(event)"></td><td valign="top"><input type="button" class="delButton" value="Clear" onclick="Builds_sshKey_delButton1.clear(event)"></td></tr></table></td></tr><tr><td><input type="button" value="Del" class="delButton" id="delButton2" onclick="Builds.delete('delButton2');"></td><td class="BuildsType" style="width: 100px;"><select class="BuildsType" style="width: 100px;"><option value="pipeline" selected="selected">pipeline</option><option value="custom-app">custom-app</option></select></td><td class="BuildsName" style="width: 100px;"><input class="BuildsName" type="text" value="autotest" style="width: 100px;"></td><td class="BuildsGIT URL" style="width: 400px;"><input class="BuildsGIT URL" type="text" value="git@github.hpe.com:CMS-5GCS/automated-deployer.git" style="width: 400px;"></td><td class="Buildsdirectory" style="width: 200px;"><input class="Buildsdirectory" type="text" value="pipelines/autotest" style="width: 200px;"></td><td class="Buildsbranch" style="width: 120px;"><input class="Buildsbranch" type="text" value="" style="width: 120px;"></td><td class="BuildssshKey"><table class="BuildssshKey userLoadedFile" id="Builds_sshKey_delButton2"><tr><td valign="top"><input type="file" id="Builds_sshKey_delButton2_inputId" class="buildButton" onchange="Builds_sshKey_delButton2.load(event)"></td><td valign="top"><input type="button" class="helpButton" value="Review" onclick="Builds_sshKey_delButton2.view(event)"></td><td valign="top"><input type="button" class="delButton" value="Clear" onclick="Builds_sshKey_delButton2.clear(event)"></td></tr></table></td></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Builds.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Builds.help());"></div><div id="CustomAppsSection" style=""><a name="CustomApps"><h2>CustomApps</h2></a><table border="1" id="CustomApps"><tbody><tr><th><input type="button" value="Add" onclick="CustomApps.add();"></th><th class="CustomAppsType" style="width: 140px;">Type</th><th class="CustomAppsName" style="width: 100px;">Name</th><th class="CustomAppsProject" style="width: 60px;">Project</th><th class="CustomAppsPipeline" style="width: 100px;">Pipeline</th></tr><tr><td><input type="button" value="Del" class="delButton" id="delButton3" onclick="CustomApps.delete('delButton3');"></td><td class="CustomAppsType" style="width: 140px;"><select class="CustomAppsType" style="width: 140px;"><option value="mad" selected="selected">mad</option></select></td><td class="CustomAppsName" style="width: 100px;"><input class="CustomAppsName" type="text" value="assistant" style="width: 100px;"></td><td class="CustomAppsProject" style="width: 60px;"><input class="CustomAppsProject" type="text" value="automated-deployer" style="width: 60px;"></td><td class="CustomAppsPipeline" style="width: 100px;"><input class="CustomAppsPipeline" type="text" value="autotest" style="width: 100px;"></td></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(CustomApps.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(CustomApps.help());"></div><div id="NetworkFunctionsSection" style="display: none;"><a name="NetworkFunctions"><h2>NetworkFunctions</h2></a><table border="1" id="NetworkFunctions"><tbody><tr><th><input type="button" value="Add" onclick="NetworkFunctions.add();"></th><th class="NetworkFunctionsType" style="width: 100px;">Type</th><th class="NetworkFunctionsName" style="width: 80px;">Name</th><th class="NetworkFunctionsProject" style="width: 60px;">Project</th><th class="NetworkFunctionsURL" style="width: 200px;">URL</th><th class="NetworkFunctionsinsecure" style="width: 15px;">insecure</th><th class="NetworkFunctionsImage" style="width: 120px;">Image</th><th class="NetworkFunctionsTag" style="width: 120px;">Tag</th><th class="NetworkFunctionsStorage" style="width: 60px;">Storage</th><th class="NetworkFunctionsVolume" style="width: 60px;">Volume</th><th class="NetworkFunctionsReplicas" style="width: 40px;">Replicas</th><th class="NetworkFunctionsDependencies" style="width: 100px;">Dependencies</th><th class="NetworkFunctionsPipeline" style="width: 100px;">Pipeline</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(NetworkFunctions.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(NetworkFunctions.help());"></div><div id="DirectServicesSection" style="display: none;"><a name="DirectServices"><h2>DirectServices</h2></a><table border="1" id="DirectServices"><tbody><tr><th><input type="button" value="Add" onclick="DirectServices.add();"></th><th class="DirectServicesType" style="width: 100px;">Type</th><th class="DirectServicesName" style="width: 80px;">Name</th><th class="DirectServicesProject" style="width: 60px;">Project</th><th class="DirectServicesURL" style="width: 200px;">URL</th><th class="DirectServicesinsecure" style="width: 15px;">insecure</th><th class="DirectServicesImage" style="width: 120px;">Image</th><th class="DirectServicesTag" style="width: 120px;">Tag</th><th class="DirectServicesStorage" style="width: 60px;">Storage</th><th class="DirectServicesVolume" style="width: 60px;">Volume</th><th class="DirectServicesReplicas" style="width: 40px;">Replicas</th><th class="DirectServicesDependencies" style="width: 100px;">Dependencies</th><th class="DirectServicesPipeline" style="width: 100px;">Pipeline</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(DirectServices.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(DirectServices.help());"></div><div id="IndirectServicesSection" style=""><a name="IndirectServices"><h2>IndirectServices</h2></a><table border="1" id="IndirectServices"><tbody><tr><th><input type="button" value="Add" onclick="IndirectServices.add();"></th><th class="IndirectServicesType" style="width: 100px;">Type</th><th class="IndirectServicesName" style="width: 80px;">Name</th><th class="IndirectServicesProject" style="width: 60px;">Project</th><th class="IndirectServicesURL" style="width: 200px;">URL</th><th class="IndirectServicesinsecure" style="width: 15px;">insecure</th><th class="IndirectServicesImage" style="width: 120px;">Image</th><th class="IndirectServicesTag" style="width: 120px;">Tag</th><th class="IndirectServicesStorage" style="width: 60px;">Storage</th><th class="IndirectServicesVolume" style="width: 60px;">Volume</th><th class="IndirectServicesReplicas" style="width: 40px;">Replicas</th><th class="IndirectServicesDependencies" style="width: 100px;">Dependencies</th><th class="IndirectServicesPipeline" style="width: 100px;">Pipeline</th></tr><tr><td><input type="button" value="Del" class="delButton" id="delButton4" onclick="IndirectServices.delete('delButton4');"></td><td class="IndirectServicesType" style="width: 100px;"><select class="IndirectServicesType" style="width: 100px;"><option value="jenkins" selected="selected">jenkins</option><option value="elasticsearch">elasticsearch</option><option value="telegraf">telegraf</option><option value="prometheus-alertmanager">prometheus-alertmanager</option><option value="prometheus">prometheus</option><option value="kube-state-metrics">kube-state-metrics</option><option value="pushgateway">pushgateway</option><option value="grafana">grafana</option></select></td><td class="IndirectServicesName" style="width: 80px;"><input class="IndirectServicesName" type="text" value="pipelines" style="width: 80px;"></td><td class="IndirectServicesProject" style="width: 60px;"><input class="IndirectServicesProject" type="text" value="automated-deployer" style="width: 60px;"></td><td class="IndirectServicesURL" style="width: 200px;"><input class="IndirectServicesURL" type="text" value="quay.io/openshift" style="width: 200px;"></td><td class="IndirectServicesinsecure" style="width: 15px;"><input class="IndirectServicesinsecure" type="checkbox" style="width: 15px;"></td><td class="IndirectServicesImage" style="width: 120px;"><input class="IndirectServicesImage" type="text" value="origin-jenkins" style="width: 120px;"></td><td class="IndirectServicesTag" style="width: 120px;"><input class="IndirectServicesTag" type="text" value="latest" style="width: 120px;"></td><td class="IndirectServicesStorage" style="width: 60px;"><input class="IndirectServicesStorage" type="text" value="" style="width: 60px;"></td><td class="IndirectServicesVolume" style="width: 60px;"><input class="IndirectServicesVolume" type="text" value="" style="width: 60px;"></td><td class="IndirectServicesReplicas" style="width: 40px;"><input class="IndirectServicesReplicas" type="text" value="" style="width: 40px;"></td><td class="IndirectServicesDependencies" style="width: 100px;"><input class="IndirectServicesDependencies" type="text" value="" style="width: 100px;"></td><td class="IndirectServicesPipeline" style="width: 100px;"><input class="IndirectServicesPipeline" type="text" value="" style="width: 100px;"></td></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(IndirectServices.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(IndirectServices.help());"></div><div id="OperatorSourcesSection" style=""><a name="OperatorSources"><h2>OperatorSources</h2></a><table border="1" id="OperatorSources"><tbody><tr><th><input type="button" value="Add" onclick="OperatorSources.add();"></th><th class="OperatorSourcesType" style="width: 140px;">Type</th><th class="OperatorSourcesName" style="width: 100px;">Name</th><th class="OperatorSourcesProject" style="width: 200px;">Project</th><th class="OperatorSourcesURL" style="width: 200px;">URL</th></tr><tr><td><input type="button" value="Del" class="delButton" id="delButton5" onclick="OperatorSources.delete('delButton5');"></td><td class="OperatorSourcesType" style="width: 140px;"><select class="OperatorSourcesType" style="width: 140px;"><option value="operator-source" selected="selected">operator-source</option></select></td><td class="OperatorSourcesName" style="width: 100px;"><input class="OperatorSourcesName" type="text" value="dometdemont" style="width: 100px;"></td><td class="OperatorSourcesProject" style="width: 200px;"><input class="OperatorSourcesProject" type="text" value="openshift-marketplace" style="width: 200px;"></td><td class="OperatorSourcesURL" style="width: 200px;"><input class="OperatorSourcesURL" type="text" value="https://quay.io/cnr" style="width: 200px;"></td></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(OperatorSources.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(OperatorSources.help());"></div><div id="OperatorsSection" style="display: none;"><a name="Operators"><h2>Operators</h2></a><table border="1" id="Operators"><tbody><tr><th><input type="button" value="Add" onclick="Operators.add();"></th><th class="OperatorsType" style="width: 140px;">Type</th><th class="OperatorsName" style="width: 100px;">Name</th><th class="OperatorsProject" style="width: 60px;">Project</th><th class="OperatorsReplicas" style="width: 40px;">Replicas</th><th class="OperatorsPipeline" style="width: 100px;">Pipeline</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(Operators.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(Operators.help());"></div><div id="HelmChartsSection" style="display: none;"><a name="HelmCharts"><h2>HelmCharts</h2></a><table border="1" id="HelmCharts"><tbody><tr><th><input type="button" value="Add" onclick="HelmCharts.add();"></th><th class="HelmChartsType" style="width: 140px;">Type</th><th class="HelmChartsName" style="width: 100px;">Name</th><th class="HelmChartsProject" style="width: 60px;">Project</th><th class="HelmChartsChart" style="width: 200px;">Chart</th><th class="HelmChartsValues" style="width: 200px;">Values</th><th class="HelmChartsVersion" style="width: 60px;">Version</th><th class="HelmChartsOptions" style="width: 120px;">Options</th><th class="HelmChartsPipeline" style="width: 100px;">Pipeline</th></tr></tbody></table><table></table><input type="button" value="Apply" class="buildButton" onclick="userOutput(HelmCharts.build());"><input type="button" value="Help" class="helpButton" onclick="userOutput(HelmCharts.help());"></div></div>
</form>

<hr>

<table>
<tbody><tr><td valign="top"><fieldset>
    <legend>Build</legend>
<table>
<tbody><tr><td valign="top">Get help on the environment setup and topology definition</td><td valign="top"><input class="helpButton" type="button" value="Help" onclick="deploymentHelp()"></td>
</tr><tr><td valign="top">Build the installer</td><td valign="top"><input class="buildButton" type="button" value="Installer" onclick="outputInstallerShell()"></td></tr>
<tr><td valign="top">Build the application for HPE5gApp operator</td><td valign="top"><input class="buildButton" type="button" value="hpe5gApp" onclick="outputAppHpe5g()"></td></tr>
<tr><td valign="top">Build the OpenStack Heat template</td><td valign="top"><input class="buildButton" type="button" value="Stack" onclick="outputHeatTemplate()"></td></tr>
<tr><td valign="top">OpenShift target version</td><td valign="top"><select id="oc_version" onchange="Nodes.hideUnused()">
<option name="4" selected="">4.x</option>
<option name="3.11">3.11</option>
<option name="3.9">3.9</option></select> 
</td></tr>
<tr><td valign="top">Build the markdown documentation</td><td valign="top"><input class="helpButton" type="button" value="Doc" onclick="deploymentDoc()"></td></tr>
</tbody></table>
</fieldset></td>
<td valign="top"><fieldset>
    <legend>Session</legend>
<table id="controlArea">
<tbody><tr><td valign="top" colspan="2">Get help</td><td valign="top"><input class="helpButton" type="button" value="Help" onclick="sessionHelp()"></td></tr>
<tr><td valign="top" colspan="2"><label>Save as html</label></td><td><input class="helpButton" type="button" value="Save" onclick="saveSession()"></td></tr>
<tr><td valign="top" colspan="2">View and save as Json</td><td valign="top"><input class="buildButton" type="button" value="Dump" onclick="jsonSession()"></td></tr>
</tbody><tr><td valign="top">Import...</td><td valign="top"><input type="file" id="importedSession_inputId" class="buildButton" onchange="importedSession.load(event)"></td><td valign="top"><input type="button" class="helpButton" value="Review" onclick="importedSession.view(event)"></td><td valign="top"><input type="button" class="delButton" value="Clear" onclick="importedSession.clear(event)"></td></tr></table>
</fieldset></td>
<td valign="top"><fieldset>
    <legend>Catalog</legend>
<table id="catalogArea">
<tbody><tr><td valign="top" colspan="2">Get help</td><td valign="top"><input class="helpButton" type="button" value="Help" onclick="catalogHelp()"></td></tr>
<tr>
<td valign="top" colspan="2">Display depth
<select id="catalog_display_depth">
<option>1</option>
<option>2</option>
<option selected="">all</option>
</select>ellipsis<select id="catalog_display_ellipse">
<option>50</option>
<option>200</option>
<option>1000</option>
<option selected="">none</option>
</select></td><td valign="top"><input class="helpButton" type="button" value="Display" onclick="displayCatalog()"></td>
</tr><tr><td valign="top" colspan="2">Export Json catalog</td><td valign="top"><input class="buildButton" type="button" value="Export" onclick="exportCatalog()"></td></tr>
</tbody><tr><td valign="top">Import Yaml template...</td><td valign="top"><input type="file" id="yamlImport_inputId" class="buildButton" onchange="yamlImport.load(event)"></td><td valign="top"><input type="button" class="helpButton" value="Review" onclick="yamlImport.view(event)"></td><td valign="top"><input type="button" class="delButton" value="Clear" onclick="yamlImport.clear(event)"></td></tr><tr><td valign="top">Import Json catalog...</td><td valign="top"><input type="file" id="catalogImport_inputId" class="buildButton" onchange="catalogImport.load(event)"></td><td valign="top"><input type="button" class="helpButton" value="Review" onclick="catalogImport.view(event)"></td><td valign="top"><input type="button" class="delButton" value="Clear" onclick="catalogImport.clear(event)"></td></tr></table>
</fieldset></td>
</tr></tbody></table>

<!-- Link to the end of the user area, useful to focus the user on the result on long pages -->
<p>Quick links: <a id="endOfUserArea" href="#endOfUserArea">Outputs and Result<a href="#Networks" onclick="Networks.display(true);"> / Networks</a><a href="#Misc" onclick="Misc.display(true);"> / Misc</a><a href="#Flavors" onclick="Flavors.display(true);"> / Flavors</a><a href="#Nodes" onclick="Nodes.display(true);"> / Nodes</a><a href="#OpenShiftNodes" onclick="OpenShiftNodes.display(true);"> / OpenShiftNodes</a><a href="#CinderVolumes" onclick="CinderVolumes.display(true);"> / CinderVolumes</a><a href="#PersistentVolumes" onclick="PersistentVolumes.display(true);"> / PersistentVolumes</a><a href="#Clusters" onclick="Clusters.display(true);"> / Clusters</a><a href="#Builds" onclick="Builds.display(true);"> / Builds</a><a href="#CustomApps" onclick="CustomApps.display(true);"> / CustomApps</a><a href="#NetworkFunctions" onclick="NetworkFunctions.display(true);"> / NetworkFunctions</a><a href="#DirectServices" onclick="DirectServices.display(true);"> / DirectServices</a><a href="#IndirectServices" onclick="IndirectServices.display(true);"> / IndirectServices</a><a href="#OperatorSources" onclick="OperatorSources.display(true);"> / OperatorSources</a><a href="#Operators" onclick="Operators.display(true);"> / Operators</a><a href="#HelmCharts" onclick="HelmCharts.display(true);"> / HelmCharts</a></a></p>
<p>
<textarea readonly="" rows="20" cols="200" id="userArea">#! /bin/bash
_usage() {
    echo "
HPE 5G resources automated deployer: 2021-03-04 Version 0.91
This client deploys and undeploys 
- OpenShift clusters hosted on OpenStack 
- Individual OpenStack resources as a stack
- HPE 5g resources 
 
Usage: $0 
    -d|--deploy &lt;name&gt; : name of the OpenShift instance and OpenStack stack to deploy; default: hpe5g
    -o|--domain &lt;domain name&gt; : domain name of the OpenShift instance to deploy; default: localdomain
    -n|--OSnetwork &lt;network root&gt;: default OpenStack network root as 3 unique digits like 192.168.199
    -e|--OSenv &lt;OpenStackEnvironmentFile&gt; : name of the file providing the OpenStack environment. Retrieved from the OpenStack GUI: Project/API access
      By default, this file prompts the user for his password; to make the deployment unattended, replace the prompt with the actual password in the variable OS_PASSWORD
      Mandatory additional variables:
      - OS_CACERT: path to a file providing a specific cacert in case the SSL cert is signed by an unknown CA
      - OS_SSH_KEY_PAIR: name of the ssh key pair defined in the OpenStack project, pushed to the OpenShift nodes for remote access
      - CLOUD_SSH_KEY: (ansible deployments only) ssh private key used to reach the deployed nodes, matching the public OS_SSH_KEY_PAIR
      - CLOUD_DEFAULT_USER: (ansible deployments only) user name used to log in the deployed nodes

      Extensions supported as additional variables: 
      - Proxy URLs for OpenShift cluster
      OPENSHIFT_HTTP_PROXY
      OPENSHIFT_HTTPS_PROXY
      OPENSHIFT_NO_PROXY
    -x|--ext-net &lt;external network&gt; : name of the external network in the OpenStack infrastructure to connect this instance to; default: ext-net
    -s|--dns &lt;external DNS&gt; : external domain name server; default 8.8.8.8
    -f|--flavor &lt;OpenStack flavor&gt; : name of the OpenStack flavor used for master instances. Minimum 4vCPUs, 25Gb disk, 16Gb RAM; default: v4.m16.d25
    -fw|--flavorWorker &lt;OpenStack flavor&gt; : name of the OpenStack flavor used for worker instances. Minimum 4vCPUs, 25Gb disk, 16Gb RAM; default: master flavor
    --fipapi preallocated OpenShift API floating IPs
    --fipapp preallocated OpenShift APP floating IPs
    -m|--masters &lt;number of masters&gt; : default 3
    -w|--workers &lt;number of workers&gt; : default 3
    -v|--volumes &lt;mininimum quota of OpenStack volumes&gt;
    -t|--etc-hosts [true|false] : boolean enabling /etc/hosts update (requires sudo privilege) ; default: true
    -p|--pull-secret &lt;file&gt; : name of the file delivering the RedHat pull secret
    -l|--log logfile 
    -u|--undeploy|--destroy &lt;name&gt;: name of the OpenShift instance to undeploy; default: hpe5g
    --preview: no openshift installer invocation, display only 
    --headless: no log on stdout, only logfile is populated
    
Example: 
$0 -d hpe5g -o localdomain -s 8.8.8.8 -x ext-net -f v4.m16.d25 -m 3 -w 3 -t true -c openstack

To deploy several OpenShift clusters, all parameters are lists of space separated values. 
For example, to deploy two clusters ocp1 and ocp2 with specific flavors and a common external network:
$0 -n \"ocp1 ocp2\" -f \"flavor1 flavor2\" -x ext-net
"
}

# Default parameters
default_stack=hpe5g
oc_stack=$default_stack
oc_network=192.168.199
OS_env=RHOS12.env
_deploy=$([[ "deploy" != "undeploy" ]] &amp;&amp; echo true || echo false)
_displayedAction=$($_deploy &amp;&amp; echo Deploying || echo Undeploying)
state=$($_deploy &amp;&amp; echo present || echo absent)
_headless=
_preview=

_defaultName=$default_stack
unset OCP FIPAPI FIPAPP
ETCHOSTS=true
EXTNET=ext-net
DOMAIN=localdomain
WORKERS=3
MASTERS=3
FLAVOR=v4.m16.d25
FLAVORWORKER=$FLAVOR
EXTDNS=8.8.8.8
NBVOLUMES=10

RHELSECRET='{"auths":{"cloud.openshift.com":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2RvbWV0ZGVtb250MXhjMXp2N3VhbjNhbTloamNrb2h1Y2tscTBjOlM2QVc3WUlCSDFMRFhSRkhBNU1WM1dOWUFNQjRSTDk4MU1JRE1PQzFYQUVBMDRLWlRKNVk3SzQwUFFVODlOOUo=","email":"dominique.domet-de-mont@hpe.com"},"quay.io":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2RvbWV0ZGVtb250MXhjMXp2N3VhbjNhbTloamNrb2h1Y2tscTBjOlM2QVc3WUlCSDFMRFhSRkhBNU1WM1dOWUFNQjRSTDk4MU1JRE1PQzFYQUVBMDRLWlRKNVk3SzQwUFFVODlOOUo=","email":"dominique.domet-de-mont@hpe.com"},"registry.connect.redhat.com":{"auth":"NDM4MTY3MHx1aGMtMVhjMVp2N1VhTjNBbTloSmNrb2h1Y0tMcTBjOmV5SmhiR2NpT2lKU1V6VXhNaUo5LmV5SnpkV0lpT2lJMk4yUmpOMlZtWTJNMU5qSTBPVEZsT1RneVpXTTBOVGM1TUdGa1pUQTNaQ0o5Lkp2dWsybEo2Q3dLLTY5WnBkbDg1enk0RFUtdzV3aTVPWE5aZ0hDUDBlbXNCVmZDXzkzN3Fhdk5OZDZqdjRBU0NSRllPb3ZCTmxYTEhJbjA5amhIaTJiZDRfQ2xwMVhBaTdPYWVwN21qc0x5NVdrSEZHU3lHcU02RU43Y1N3bmFRWm00Q3lDNmNHaFItbVhtYnVDUTdYdWl0MVJCNEh5X0laZHV6dUhOa3hmam5aX2ZmWHNRb1ZVTmoxdW44bFlZMjQzLXpOMkpvN0p2M3MwZkZYYnBnbzBtMUNia284MzIzRWhGc3h5SFM5UXNYWUk3VDRJX21JRnBHMTZSVGotUGUyalluNjVJTnBxVFF4Y0FQaHpuQkxLYUNwd01Yb2F2V0hPMXpRWEs1QTF2dGR3Z1VUZEh0VWplX3FYUm13ZUQwYkVOeDRiVHgySGx2X0RlcnZuMEVfc3ZuRU4zVlpkNEc0VFNHZlo2d1c1LVlvSjJxZkdxeGVqeVZWdThqeDFyazFWRk52NERXaDd4amlTZ2I5d3dNTWVWVW9pSXFMZUN2NTZzUW4ycTRUdUpmdDNIVGR2UXhBSldHQWtGbDBFVUJKT0R2aGZrWGtSTWtjbmk5RVdiZVU0NWYwUThhQ1NmeG84anBzNE80endUMUxSQlVTVE5ZekN3bjhrTFdYR2FkaGo1aHdDNW9XNjlzUW5wYmpEY2JWR0dCSkdhNUtRREJpNmRVNzFoUTY3cThncUZ1UHhOaXJCcFNleTg0VWxtMS1PVjBzVXN4dnRwaVYxWFFvUVJrcHRVNnNBMFJaMTE2c25JT0gxR2piWm9paTB6M2hJbUltcmRPeG1ReHhYcC1nTWhsc2txcDZRVGtSWFdPZ0lyYWJ0UkNvV2pRc3JZb1EyZFNiRzBBODNB","email":"dominique.domet-de-mont@hpe.com"},"registry.redhat.io":{"auth":"NDM4MTY3MHx1aGMtMVhjMVp2N1VhTjNBbTloSmNrb2h1Y0tMcTBjOmV5SmhiR2NpT2lKU1V6VXhNaUo5LmV5SnpkV0lpT2lJMk4yUmpOMlZtWTJNMU5qSTBPVEZsT1RneVpXTTBOVGM1TUdGa1pUQTNaQ0o5Lkp2dWsybEo2Q3dLLTY5WnBkbDg1enk0RFUtdzV3aTVPWE5aZ0hDUDBlbXNCVmZDXzkzN3Fhdk5OZDZqdjRBU0NSRllPb3ZCTmxYTEhJbjA5amhIaTJiZDRfQ2xwMVhBaTdPYWVwN21qc0x5NVdrSEZHU3lHcU02RU43Y1N3bmFRWm00Q3lDNmNHaFItbVhtYnVDUTdYdWl0MVJCNEh5X0laZHV6dUhOa3hmam5aX2ZmWHNRb1ZVTmoxdW44bFlZMjQzLXpOMkpvN0p2M3MwZkZYYnBnbzBtMUNia284MzIzRWhGc3h5SFM5UXNYWUk3VDRJX21JRnBHMTZSVGotUGUyalluNjVJTnBxVFF4Y0FQaHpuQkxLYUNwd01Yb2F2V0hPMXpRWEs1QTF2dGR3Z1VUZEh0VWplX3FYUm13ZUQwYkVOeDRiVHgySGx2X0RlcnZuMEVfc3ZuRU4zVlpkNEc0VFNHZlo2d1c1LVlvSjJxZkdxeGVqeVZWdThqeDFyazFWRk52NERXaDd4amlTZ2I5d3dNTWVWVW9pSXFMZUN2NTZzUW4ycTRUdUpmdDNIVGR2UXhBSldHQWtGbDBFVUJKT0R2aGZrWGtSTWtjbmk5RVdiZVU0NWYwUThhQ1NmeG84anBzNE80endUMUxSQlVTVE5ZekN3bjhrTFdYR2FkaGo1aHdDNW9XNjlzUW5wYmpEY2JWR0dCSkdhNUtRREJpNmRVNzFoUTY3cThncUZ1UHhOaXJCcFNleTg0VWxtMS1PVjBzVXN4dnRwaVYxWFFvUVJrcHRVNnNBMFJaMTE2c25JT0gxR2piWm9paTB6M2hJbUltcmRPeG1ReHhYcC1nTWhsc2txcDZRVGtSWFdPZ0lyYWJ0UkNvV2pRc3JZb1EyZFNiRzBBODNB","email":"dominique.domet-de-mont@hpe.com"}}}'

while [[ "$#" -gt 0 ]]; do case $1 in
  -d|--deploy) _deploy=true; _displayedAction="Deploying"; state=present ; OCP=(${2:-${OCP[@]:-$_defaultName}}) ; shift;;
  -u|--undeploy|--destroy) _deploy=false ; _displayedAction="Undeploying"; state=absent ; OCP=(${2:-${OCP[@]:-$_defaultName}}); shift;;
  -e|--OSenv) OS_env=($2); shift;;
  -n|--OSnetwork) oc_network="$2"; shift;;
  -o|--domain) DOMAIN=($2); shift;;
  -x|--ext-net) EXTNET=($2); shift;;
  -f|--flavor) FLAVOR=($2); shift;;
  -fw|--flavorWorker) FLAVORWORKER=($2); shift;;
  --fipapi) FIPAPI=($2); shift;;
  --fipapp) FIPAPP=($2); shift;;
  -m|--masters) MASTERS=($2); shift;;
  -w|--workers) WORKERS=($2); shift;;
  -v|--volumes) NBVOLUMES=($2); shift;;
  -t|--etc-hosts) ETCHOSTS=($2); shift;;
  -l|--log) logfile=($2); shift;;
  -s|--dns) EXTDNS=($2); shift;;
  -p|--pull-secret) test -f $2 &amp;&amp; RHELSECRET=$(cat $2) || exit 1; shift;;
  -h|--help) _usage; exit 0 ;;
  --headless) _headless=true;;
  --preview) _preview="_log_ Preview: ";;
  *) echo "Unknown parameter passed: $1." ; exit 1;;
esac; shift; done

# Force a log file in headless mode named as the stack, otherwise keep stdout
if ! test -n "$logfile" ; then test -n "$_headless" &amp;&amp; logfile=$oc_stack.log || logfile="/dev/stdout" ; fi

# Cosmetic: ellipsize too long strings to keep cute logs: keep _max characters
_cutTooLong() {
  local _cut="$*"
  local _max=150
  if (( ${#_cut} &gt; $_max )) ; then
    _cut=$(echo $* | cut -c1-$_max)
    _cut+="..."
  fi
  echo $_cut
}

_log_() {
    # echo a cute time stamped log on stdout except in headless mode, and append the full log to the logfile
    test -n "$_headless" || echo -e $(date) $(_cutTooLong $*)
    if [ "$logfile" != "/dev/stdout" ] ; then echo -e $(date) $* &amp;&gt;&gt; $logfile ; fi
    return 0
}

_warn_() {
  local RED='\033[0;31m'
  local NC='\033[0m' # No Color
  _log_ "${RED}WARNING${NC}: $*"
}

_fail_() {
  _log_ "FATAL ERROR: $*.  Now exiting... Check $logfile"
  test -f $logfile &amp;&amp; echo Last lines of $logfile &gt;&amp;2 &amp;&amp; tail $logfile &gt;&amp;2
  exit 1
}

# Clean log file
&gt; $logfile

# Prerequisites:
# - OpenShift command line interface installed (oc)
if ! which oc  &gt; /dev/null ; then  echo Please install oc utility to submit OpenShift requests ; exit 1 ; fi
# - current user logged in the target OpenShift cluster: oc login -u &lt;user&gt; -p &lt;password&gt;

_getTemplateInstanceStatus() {
	local TOKEN=$1 ENDPOINT=$2 NAMESPACE=$3 TEMPLATEINSTANCE=$4
	curl -s -k -H "Authorization: Bearer $TOKEN" -H "Accept: application/json" https://$ENDPOINT/apis/template.openshift.io/v1/namespaces/$NAMESPACE/templateinstances/$TEMPLATEINSTANCE | jq -e '.status.conditions[] | select(.status == "True") | .type'
	return $?
}
_getTemplateInstanceMessage() {
	local TOKEN=$1 ENDPOINT=$2 NAMESPACE=$3 TEMPLATEINSTANCE=$4
	local status=$(curl -s -k -H "Authorization: Bearer $TOKEN" -H "Accept: application/json" https://$ENDPOINT/apis/template.openshift.io/v1/namespaces/$NAMESPACE/templateinstances/$TEMPLATEINSTANCE )
	echo $status &gt;&gt; $logfile
	echo $status | jq -e '.status.conditions[] | select(.status == "True") | .message'
}

# Submit a command until success or timeout, log a current status after each retry
# Parameters:
# $1: the command
# $2: (optional) the command description, displayed at each retried iteration, appended to the command output, defaults to the command
# $3: (optional) the timeout in seconds
# $4: (optional) the retry period in seconds
_cmd_with_retry() {
	local _cmd="$1"
	local _cmdDescription="${2:-$_cmd}"
	local _timeout=${3:-60}
	local _retryPeriod=${4:-10}
	
	[ "$_cmd" = "" ] &amp;&amp; echo "_cmd_with_retry &lt;command&gt; &lt;description&gt; &lt;timeout[$_timeout]&gt; &lt;retry period[$_retryPeriod]&gt;" &amp;&amp; return 1
	 
	local _countMax=$(( $_timeout/$_retryPeriod + 1 ))
	local _count=0
    until _cmdOutput=$(eval "$_cmd" 2&gt;&gt; $logfile) || (( $_count &gt;= $_countMax )) ; do
    	((_count++))
    	_log_ "$_cmdDescription: attempt $_count of $_countMax, retrying in $_retryPeriod seconds"
        sleep $_retryPeriod
    done
   if (( $_count &gt;= $_countMax )) ; then
   	return 1
   else
   	test -n "$_cmdOutput" &amp;&amp; echo $_cmdOutput &gt;&gt; $logfile
   fi
   return 0
}

cat &gt; openshift_project_automated-deployer.yaml &lt;&lt; 'EOFILE'
apiVersion: v1
kind: Template
metadata:
  name: automated-deployer
  annotations:
    description: network functions and backing services for project automated-deployer
objects:
  - kind: Secret
    apiVersion: v1
    metadata:
      name: assistant-autotest
      namespace: automated-deployer
    type: Opaque
    data:
      ssh-privatekey: LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJGd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFRRUF6eG5CdlJRdUZoRnFzMjZqbHdMUlJUK0IveEJmMm1MOXlYMXdmSU43cTRFaVB1d3dKSk5CCnlkWnFQeC9hdGxmeGRkeXU0SHlqRXJySjBKV2NOczRFL1dTY2dkQSsxVnVTWlE2ZDY4ZHhYRkJrTGJkUlhjOWtuVUdPWkMKNVhycGt3QytZQnZHZ0poaWlZeW54SlN5YStGeW9XbDdqQWxwRmtTOFMrYWtlb1Y2TnIvc2NXM0EvY21rdlRVKzBYZkdzRApJcGIrSENYSmZUMU1seTI3cDJjdjJyN1FpeWhncEx6MEtYdHZrTTJEeWswZ1BaYzNxLzM2Y1c2REZqenlVT1FNRjBGaS8wCmdMWkI1aEc5QVBRbHZzcVZ2b292R0RGZHlkejQ0V0hseDVOOXFGeFJCZjZRenZsSzVQSGRtSmFDVlpLdytYMmtRNzZOQlgKdU9iSjBvREVYUUFBQTlnbXJaM2VKcTJkM2dBQUFBZHpjMmd0Y25OaEFBQUJBUURQR2NHOUZDNFdFV3F6YnFPWEF0RkZQNApIL0VGL2FZdjNKZlhCOGczdXJnU0krN0RBa2swSEoxbW8vSDlxMlYvRjEzSzdnZktNU3VzblFsWncyemdUOVpKeUIwRDdWClc1SmxEcDNyeDNGY1VHUXR0MUZkejJTZFFZNWtMbGV1bVRBTDVnRzhhQW1HS0pqS2ZFbExKcjRYS2hhWHVNQ1drV1JMeEwKNXFSNmhYbzJ2K3h4YmNEOXlhUzlOVDdSZDhhd01pbHY0Y0pjbDlQVXlYTGJ1blp5L2F2dENMS0dDa3ZQUXBlMitRellQSwpUU0E5bHplci9mcHhib01XUFBKUTVBd1hRV0wvU0F0a0htRWIwQTlDVyt5cFcraWk4WU1WM0ozUGpoWWVYSGszMm9YRkVGCi9wRE8rVXJrOGQyWWxvSlZrckQ1ZmFSRHZvMEZlNDVzblNnTVJkQUFBQUF3RUFBUUFBQVFFQW5rY2FHVTZkOWtHellaVHkKTTh4MGNjOGFvL3c0dGFnb08rREJvbmUrZ1pHOHdZZ3pOeERRRzlqaDlJSjgzaFVTTmpqRjhrMXZPRFpIWFVHcVZQeFpOZQp1NTdVQmhkU0I2SHYvdjA2M214bDJ1WW40VEVuWVplRklNNkNXKzMzSzJGTEhocThON1crd1U4ZFBSRkQxMDFERlhlUGM3ClFSZTNKbTBqOWdmejhaMVZTYTNDSmE2SGtYamhzdjc1VEcvSzFRc0xNVTlYSDd5TmVrRWhDVWYyeWNkUmtCbkRUcFlTQWwKNVp1d25GZW1TNzRDSGdCTWxwNmNLL3lhbUs0RFZwbi9kSzNzUkd2OHRsU2NGVFdHdEdsYko1czh3RjlndjBkdXdyM2RqUwpDU2EwZGpVVUpndmcxcXRWVzhnMDI2S2lsUDVNMnZvSTdwekNmYWQ1N0g5NmhRQUFBSUVBcEVMcXV5czNydWtnRUFQYnJ5CjV3Y20wMVp2L1JtcU5tYVR0SFRIN1JIRTRRV1N6Lzg1aFNraHFwN3NJVUlEVGoxL0EyQWJ6UmFRbmduMUd0S2dVbVlpODQKazUwZjBraWRDRmNXVVBSL0hKUmlOZ3J1SVQzWjBFako4dGRKek14WTRDSFQ2NzBOdjM4RkU0YXlEeVBQWUw1OStxb0kyagpEMU9VdmM4OEQvZTk4QUFBQ0JBT2c5TC8rdk95c2NhQzl3dG9VMTFiNU9lMzFzU3VpU2RWL0VHRDBINEtxY1Q0MkNJTGJkCmJNKzFxVThOVmZEY1VvMk1BMEFXdzFqS0ZUUVhyRjdCYXJySW10NTF3ekdXTXlFWS9yaTMwazZNaCthWFc2QmxSSmxxNlkKVk8yMXJtQ2poZCtFY0JHczF3QlJaMnNHSm5iaU1qNlRvZTR1aitibFNKWHJCTDM4UEhBQUFBZ1FEa1NpUzF3QVJidFBsMApHVzJvU3RIWmRJdXpVM0xWclduZWtoYUpLazZ1YVBsTHQ0Yk14Y1Ivc1pPVHA1SEN0N1UrbmR4UnRYUE0vQnBiZlN1WDhTCktzeTBwVERSZnFSdkJobEhuY1p3Q0J6clJma1IveFhsbjNPUEhhRHNnT1c1VVRxd2lHN0FZOFpybnZPZW0rN1JkenV5bmsKd1hraHc0dU9FKy9iZWlrdXV3QUFBQ0ZrYjIxcGJtbHhkV1ZBWjJodmMzUXlNQzVuY21VdWFIQmxZMjl5Y0M1dVpYUT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCg==
  - kind: BuildConfig
    apiVersion: build.openshift.io/v1
    metadata:
      name: "assistant-autotest"
    spec:
      source:
        contextDir: pipelines/autotest
        sourceSecret:
          name: assistant-autotest
        git:
          uri: git@github.hpe.com:CMS-5GCS/automated-deployer.git
      strategy:
        jenkinsPipelineStrategy:
          type: JenkinsPipeline
          env:
            - name: "_NAME"
              value: assistant
  - kind: ImageStream
    apiVersion: v1
    metadata:
      name: pipelines
      namespace: automated-deployer
    spec:
      lookupPolicy:
        local: false
      tags:
      - annotations:
        from:
          kind: DockerImage
          name: quay.io/openshift/origin-jenkins:latest
        generation: 1
        importPolicy: {}
        name: ""
        referencePolicy:
          type: Source
  - kind: Route
    apiVersion: v1
    metadata:
      annotations:
        haproxy.router.openshift.io/timeout: 4m
        template.openshift.io/expose-uri: http://{.spec.host}{.spec.path}
      name: pipelines
    spec:
      tls:
        insecureEdgeTerminationPolicy: Redirect
        termination: edge
      to:
        kind: Service
        name: pipelines
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      annotations:
        template.alpha.openshift.io/wait-for-ready: "true"
      name: pipelines
    spec:
      replicas: 1
      selector:
        name: pipelines
      strategy:
        type: Recreate
      template:
        metadata:
          labels:
            name: pipelines
        spec:
          containers:
          - capabilities: {}
            env:
            - name: OPENSHIFT_ENABLE_OAUTH
              value: "true"
            - name: OPENSHIFT_ENABLE_REDIRECT_PROMPT
              value: "true"
            - name: KUBERNETES_MASTER
              value: https://kubernetes.default:443
            - name: KUBERNETES_TRUST_CERTIFICATES
              value: "true"
            - name: JENKINS_SERVICE_NAME
              value: pipelines
            - name: JNLP_SERVICE_NAME
              value: pipelines-jnlp
            image: quay.io/openshift/origin-jenkins:latest
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 2
              httpGet:
                path: /login
                port: 8080
              initialDelaySeconds: 420
              periodSeconds: 360
              timeoutSeconds: 240
            name: jenkins
            readinessProbe:
              httpGet:
                path: /login
                port: 8080
              initialDelaySeconds: 3
              timeoutSeconds: 240
            resources:
              limits:
                memory: 2048Mi
            securityContext:
              capabilities: {}
              privileged: false
            terminationMessagePath: /dev/termination-log
            volumeMounts:
            - mountPath: /var/lib/jenkins
              name: pipelines-data
          dnsPolicy: ClusterFirst
          restartPolicy: Always
          serviceAccountName: pipelines
          volumes:
          - emptyDir:
              medium: ""
            name: pipelines-data
  - kind: ServiceAccount
    apiVersion: v1
    metadata:
      annotations:
        serviceaccounts.openshift.io/oauth-redirectreference.jenkins: '{"kind":"OAuthRedirectReference","apiVersion":"v1","reference":{"kind":"Route","name":"pipelines"}}'
      name: pipelines
  - apiVersion: v1
    groupNames: null
    kind: RoleBinding
    metadata:
      name: pipelines_edit
    roleRef:
      name: edit
    subjects:
    - kind: ServiceAccount
      name: pipelines
  - kind: Service
    apiVersion: v1
    metadata:
      name: pipelines-jnlp
    spec:
      ports:
      - name: agent
        nodePort: 0
        port: 50000
        protocol: TCP
        targetPort: 50000
      selector:
        name: pipelines
      sessionAffinity: None
      type: ClusterIP
  - kind: Service
    apiVersion: v1
    metadata:
      annotations:
        service.alpha.openshift.io/dependencies: '[{"name": "pipelines-jnlp", "namespace": "", "kind": "Service"}]'
        service.openshift.io/infrastructure: "true"
      name: pipelines
    spec:
      ports:
      - name: web
        nodePort: 0
        port: 80
        protocol: TCP
        targetPort: 8080
      selector:
        name: pipelines
      sessionAffinity: None
      type: ClusterIP
  
EOFILE
# CustomApps deployment scripts
cat &gt; openshift_project_automated-deployer.sh &lt;&lt; 'EOFautomated-deployer'
#!/bin/bash
( [[ "$1" == "delete" ]] &amp;&amp; oc delete all --selector app=assistant ) || ( [[ "$1" == "apply" ]] &amp;&amp; oc create secret generic assistant-mad --type=kubernetes.io/ssh-auth --from-literal=ssh-privatekey='-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAzxnBvRQuFhFqs26jlwLRRT+B/xBf2mL9yX1wfIN7q4EiPuwwJJNB
ydZqPx/atlfxddyu4HyjErrJ0JWcNs4E/WScgdA+1VuSZQ6d68dxXFBkLbdRXc9knUGOZC
5XrpkwC+YBvGgJhiiYynxJSya+FyoWl7jAlpFkS8S+akeoV6Nr/scW3A/cmkvTU+0XfGsD
Ipb+HCXJfT1Mly27p2cv2r7QiyhgpLz0KXtvkM2Dyk0gPZc3q/36cW6DFjzyUOQMF0Fi/0
gLZB5hG9APQlvsqVvoovGDFdydz44WHlx5N9qFxRBf6QzvlK5PHdmJaCVZKw+X2kQ76NBX
uObJ0oDEXQAAA9gmrZ3eJq2d3gAAAAdzc2gtcnNhAAABAQDPGcG9FC4WEWqzbqOXAtFFP4
H/EF/aYv3JfXB8g3urgSI+7DAkk0HJ1mo/H9q2V/F13K7gfKMSusnQlZw2zgT9ZJyB0D7V
W5JlDp3rx3FcUGQtt1Fdz2SdQY5kLleumTAL5gG8aAmGKJjKfElLJr4XKhaXuMCWkWRLxL
5qR6hXo2v+xxbcD9yaS9NT7Rd8awMilv4cJcl9PUyXLbunZy/avtCLKGCkvPQpe2+QzYPK
TSA9lzer/fpxboMWPPJQ5AwXQWL/SAtkHmEb0A9CW+ypW+ii8YMV3J3PjhYeXHk32oXFEF
/pDO+Urk8d2YloJVkrD5faRDvo0Fe45snSgMRdAAAAAwEAAQAAAQEAnkcaGU6d9kGzYZTy
M8x0cc8ao/w4tagoO+DBone+gZG8wYgzNxDQG9jh9IJ83hUSNjjF8k1vODZHXUGqVPxZNe
u57UBhdSB6Hv/v063mxl2uYn4TEnYZeFIM6CW+33K2FLHhq8N7W+wU8dPRFD101DFXePc7
QRe3Jm0j9gfz8Z1VSa3CJa6HkXjhsv75TG/K1QsLMU9XH7yNekEhCUf2ycdRkBnDTpYSAl
5ZuwnFemS74CHgBMlp6cK/yamK4DVpn/dK3sRGv8tlScFTWGtGlbJ5s8wF9gv0duwr3djS
CSa0djUUJgvg1qtVW8g026KilP5M2voI7pzCfad57H96hQAAAIEApELquys3rukgEAPbry
5wcm01Zv/RmqNmaTtHTH7RHE4QWSz/85hSkhqp7sIUIDTj1/A2AbzRaQngn1GtKgUmYi84
k50f0kidCFcWUPR/HJRiNgruIT3Z0EjJ8tdJzMxY4CHT670Nv38FE4ayDyPPYL59+qoI2j
D1OUvc88D/e98AAACBAOg9L/+vOyscaC9wtoU11b5Oe31sSuiSdV/EGD0H4KqcT42CILbd
bM+1qU8NVfDcUo2MA0AWw1jKFTQXrF7BarrImt51wzGWMyEY/ri30k6Mh+aXW6BlRJlq6Y
VO21rmCjhd+EcBGs1wBRZ2sGJnbiMj6Toe4uj+blSJXrBL38PHAAAAgQDkSiS1wARbtPl0
GW2oStHZdIuzU3LVrWnekhaJKk6uaPlLt4bMxcR/sZOTp5HCt7U+ndxRtXPM/BpbfSuX8S
Ksy0pTDRfqRvBhlHncZwCBzrRfkR/xXln3OPHaDsgOW5UTqwiG7AY8ZrnvOem+7Rdzuynk
wXkhw4uOE+/beikuuwAAACFkb21pbmlxdWVAZ2hvc3QyMC5ncmUuaHBlY29ycC5uZXQ=
-----END OPENSSH PRIVATE KEY-----
' &amp;&amp; oc new-app --name assistant --source-secret=assistant-mad git@github.hpe.com:CMS-5GCS/automated-deployer.git &amp;&amp; oc expose svc/assistant ) || exit 1
exit 0
EOFautomated-deployer
chmod a+x openshift_project_automated-deployer.sh

cat &gt; openshift_project_openshift-marketplace.sh &lt;&lt; 'EOFopenshift-marketplace'
#!/bin/bash
oc $1 -f - &lt;&lt; EOFdometdemont
apiVersion: operators.coreos.com/v1
kind: OperatorSource
metadata:
  name: dometdemont-operators
  namespace: openshift-marketplace
spec:
  type: appregistry
  endpoint: https://quay.io/cnr
  registryNamespace: dometdemont
EOFdometdemont
[ $? = 0 ] || exit 1
exit 0
EOFopenshift-marketplace
chmod a+x openshift_project_openshift-marketplace.sh

if $_deploy ; then 
	_ocAction="apply"
	_helmAction() { helm upgrade --install $_HPE5G_name $_HPE5G_template --values _tmp_$_helmValues $_HPE5G_options; }
else
	_helmAction() { helm delete $_HPE5G_name ; }
	_ocAction="delete"
fi

# checking user logged in
oc_user=$(oc whoami)
test -n "$oc_user" &amp;&amp; [ "$oc_user" != "system:admin" ] || _fail_ "Current user is ${oc_user:-unknown}: please log as user: oc login -u user"
_log_ "$_displayedAction CMS5G Core Stack as user $oc_user"
_log_ "Checking projects"
oc_projects="automated-deployer openshift-marketplace"
for _project in $oc_projects ; do oc project $_project &amp;&gt;&gt; $logfile || oc new-project $_project --display-name="Project $_project" --description='From HPE5g automated deployer 2021-03-04 Version 0.91 on: Thu Mar 04 2021 14:07:29 GMT+0100 (Central European Standard Time) Deploy an automated deployer as a custom app with a jenkins pipeline running autotests' &amp;&gt;&gt; $logfile || _fail_ "Cannot find or create project $_project missing" ; done
if echo guess | oc login -u system:admin &amp;&gt;&gt; $logfile ; then
_log_ "Listing nodes as system:admin"
oc get nodes -o wide &amp;&gt;&gt; $logfile
oc login -u $oc_user &amp;&gt;&gt; $logfile
else
 _warn_ "Resource(s) requiring special privileges might jeopardize the deployment:"
 _warn_ "- dometdemont:	section: OperatorSources	project: openshift-marketplace	type: operator-source"
fi
_log_ "Listing pods as $oc_user"
oc get pods -o wide  -n default  &amp;&gt;&gt; $logfile
oc_image_projects=( )
oc_image_urls=( )
oc_images=( )
[[ ${#oc_images[@]} != 0 ]] &amp;&amp; _log_ "Populating the docker registry with services images: pull, tag and push"
  for _iImage in ${!oc_images[@]} ; do
    sudo docker login -u $(oc whoami) -p $(oc whoami -t) docker-registry.default.svc:5000 &amp;&gt;&gt; $logfile || _fail_ "Cannot connect to the internal docker registry as user $oc_user"
    sudo docker pull ${oc_image_urls[$_iImage]}/${oc_images[$_iImage]} || _fail_ "Cannot pull ${oc_image_urls[$_iImage]}/${oc_images[$_iImage]}"
    sudo docker tag ${oc_image_urls[$_iImage]}/${oc_images[$_iImage]} docker-registry.default.svc:5000/${oc_image_projects[$_iImage]}/${oc_images[$_iImage]} || _fail_ "Cannot tag ${oc_image_urls[$_iImage]}/${oc_images[$_iImage]}"
	sudo docker push docker-registry.default.svc:5000/${oc_image_projects[$_iImage]}/${oc_images[$_iImage]} || _fail_ "Cannot push docker-registry.default.svc:5000/${oc_image_projects[$_iImage]}/${oc_images[$_iImage]}"
  done
if false &amp;&amp; echo guess | oc login -u system:admin &amp;&gt;&gt; $logfile ; then
_log_ "Relaxing security policy to match network functions requirements, approving pending certificates"
oc adm policy add-scc-to-user anyuid system:serviceaccount  &amp;&gt;&gt; $logfile &amp;&amp;
oc adm policy add-scc-to-user privileged system:serviceaccount  &amp;&gt;&gt; $logfile &amp;&amp;
oc adm policy add-scc-to-group anyuid system:authenticated  &amp;&gt;&gt; $logfile &amp;&amp;
oc adm policy add-role-to-group view system:serviceaccounts &amp;&gt;&gt; $logfile &amp;&amp;
oc policy add-role-to-user view system:serviceaccount &amp;&gt;&gt; $logfile || _fail_ "Cannot relax security settings"
if test -n "$(oc get csr -o name)" ; then oc get csr -o name | xargs oc adm certificate approve &amp;&gt;&gt; $logfile || _fail_ "Cannot approve pending certificates" ; fi
if test -f openshift_volumes.yaml ; then _log_ "$_displayedAction the persistent volumes with idempotence" &amp;&amp; oc process -f openshift_volumes.yaml | oc $_ocAction -f - &amp;&gt;&gt; $logfile &amp;&amp; oc get persistentvolumes -o wide || _fail_ "Cannot create persistent volumes" ; fi
fi
_log_ "$_displayedAction the network functions and Helm instances"
for _project in $oc_projects; do 
	oc project $_project &amp;&gt;&gt; $logfile || _fail_ "Cannot switch to project $_project"
	# Deploy custom apps if any
	if test -f openshift_project_$_project.sh ; then _log_ "$_displayedAction openshift_project_$_project.sh on project $_project" &amp;&amp; ./openshift_project_$_project.sh $_ocAction &amp;&gt;&gt; $logfile &amp;&amp; rm -f openshift_project_$_project.sh &amp;&gt;&gt; $logfile || _fail_ "$_displayedAction openshift_project_$_project.sh "; fi
	# File naming convention for Network functions: openshift_project_&lt;project&gt;.yaml
	# File naming convention for Helm instances: openshift_helm_&lt;project&gt;_&lt;name&gt;.yaml and a first line setting the context as bash variables: _HPE5G_name= _HPE5G_template= _HPE5G_options=
	if test -f openshift_project_$_project.yaml ; then _log_ "$_displayedAction openshift_project_$_project.yaml on project $_project" &amp;&amp; _cmd_with_retry "oc process -f openshift_project_$_project.yaml | oc $_ocAction -f -" "Processing" &amp;&amp; rm -f openshift_project_$_project.yaml &amp;&gt;&gt; $logfile || _fail_ "$_displayedAction openshift_project_$_project.yaml "; fi
	for _helmValues in $(ls openshift_helm_${_project}_*.yaml 2&gt; /dev/null) ; do eval $(head -1 $_helmValues) &amp;&amp; _log_ "$_displayedAction $_HPE5G_name with chart $_HPE5G_template $_HPE5G_options on project $_project" &amp;&amp; tail -n +2 $_helmValues &gt; _tmp_$_helmValues &amp;&amp; _helmAction &amp;&gt;&gt; $logfile &amp;&amp; rm -f $_helmValues _tmp_$_helmValues &amp;&gt;&gt; $logfile || _fail_ "$_displayedAction Helm instance on project $_project" ; done
	# Undeployment: wait for pods termination  
	while [[ "$_ocAction" == "delete" ]] &amp;&amp; _log_ "Waiting 30s for terminating pods on project $_project" &amp;&amp; sleep 30 &amp;&amp; oc get pods 2&gt; /dev/null | grep -e Terminating &amp;&gt;&gt; $logfile ; do : ; done
	# If undeployment, indulge 5 seconds to stabilize, then delete the project if no pods, otherwise log a status
	[[ "$_ocAction" == "delete" ]] &amp;&amp; sleep 5s &amp;&amp; test -n "$(oc get pods --namespace $_project 2&gt;&amp;1 &gt;/dev/null)" &amp;&amp; _log_ "No remaining pods in project $_project: deleting" &amp;&amp; oc delete project $_project &amp;&gt;&gt; $logfile || oc get all --namespace $_project &amp;&gt;&gt; $logfile 
done
oc login -u $oc_user &amp;&gt;&gt; $logfile || _fail_ "Cannot log as $oc_user"
_log_ "$_displayedAction completed: check $logfile"

exit 0</textarea>
<a name="endOfUserArea"></a>
</p>
<iframe width="1500" height="200" name="importedDocument" style="display:none"></iframe>
<p class="copyright"> 2020 Hewlett Packard Enterprise Development LP</p>
<script>
// Gratitude to https://github.com/jeremyfa/yaml.js/blob/develop/dist/yaml.min.js for this minified YAML parser 
// Usage: YAML.parse(YAML string)
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){var Dumper,Inline,Utils;Utils=require("./Utils");Inline=require("./Inline");Dumper=function(){function Dumper(){}Dumper.indentation=4;Dumper.prototype.dump=function(input,inline,indent,exceptionOnInvalidType,objectEncoder){var i,key,len,output,prefix,value,willBeInlined;if(inline==null){inline=0}if(indent==null){indent=0}if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectEncoder==null){objectEncoder=null}output="";if(typeof input==="function"){return output}prefix=indent?Utils.strRepeat(" ",indent):"";if(inline<=0||typeof input!=="object"||input instanceof Date||Utils.isEmpty(input)){output+=prefix+Inline.dump(input,exceptionOnInvalidType,objectEncoder)}else{if(input instanceof Array){for(i=0,len=input.length;i<len;i++){value=input[i];willBeInlined=inline-1<=0||typeof value!=="object"||Utils.isEmpty(value);output+=prefix+"-"+(willBeInlined?" ":"\n")+this.dump(value,inline-1,willBeInlined?0:indent+this.indentation,exceptionOnInvalidType,objectEncoder)+(willBeInlined?"\n":"")}}else{for(key in input){value=input[key];willBeInlined=inline-1<=0||typeof value!=="object"||Utils.isEmpty(value);output+=prefix+Inline.dump(key,exceptionOnInvalidType,objectEncoder)+":"+(willBeInlined?" ":"\n")+this.dump(value,inline-1,willBeInlined?0:indent+this.indentation,exceptionOnInvalidType,objectEncoder)+(willBeInlined?"\n":"")}}}return output};return Dumper}();module.exports=Dumper},{"./Inline":6,"./Utils":10}],2:[function(require,module,exports){var Escaper,Pattern;Pattern=require("./Pattern");Escaper=function(){var ch;function Escaper(){}Escaper.LIST_ESCAPEES=["\\","\\\\",'\\"','"',"\0","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","","","","","","","","","","","","","",(ch=String.fromCharCode)(133),ch(160),ch(8232),ch(8233)];Escaper.LIST_ESCAPED=["\\\\",'\\"','\\"','\\"',"\\0","\\x01","\\x02","\\x03","\\x04","\\x05","\\x06","\\a","\\b","\\t","\\n","\\v","\\f","\\r","\\x0e","\\x0f","\\x10","\\x11","\\x12","\\x13","\\x14","\\x15","\\x16","\\x17","\\x18","\\x19","\\x1a","\\e","\\x1c","\\x1d","\\x1e","\\x1f","\\N","\\_","\\L","\\P"];Escaper.MAPPING_ESCAPEES_TO_ESCAPED=function(){var i,j,mapping,ref;mapping={};for(i=j=0,ref=Escaper.LIST_ESCAPEES.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){mapping[Escaper.LIST_ESCAPEES[i]]=Escaper.LIST_ESCAPED[i]}return mapping}();Escaper.PATTERN_CHARACTERS_TO_ESCAPE=new Pattern("[\\x00-\\x1f]|| ||");Escaper.PATTERN_MAPPING_ESCAPEES=new Pattern(Escaper.LIST_ESCAPEES.join("|").split("\\").join("\\\\"));Escaper.PATTERN_SINGLE_QUOTING=new Pattern("[\\s'\":{}[\\],&*#?]|^[-?|<>=!%@`]");Escaper.requiresDoubleQuoting=function(value){return this.PATTERN_CHARACTERS_TO_ESCAPE.test(value)};Escaper.escapeWithDoubleQuotes=function(value){var result;result=this.PATTERN_MAPPING_ESCAPEES.replace(value,function(_this){return function(str){return _this.MAPPING_ESCAPEES_TO_ESCAPED[str]}}(this));return'"'+result+'"'};Escaper.requiresSingleQuoting=function(value){return this.PATTERN_SINGLE_QUOTING.test(value)};Escaper.escapeWithSingleQuotes=function(value){return"'"+value.replace(/'/g,"''")+"'"};return Escaper}();module.exports=Escaper},{"./Pattern":8}],3:[function(require,module,exports){var DumpException,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;DumpException=function(superClass){extend(DumpException,superClass);function DumpException(message,parsedLine,snippet){DumpException.__super__.constructor.call(this,message);this.message=message;this.parsedLine=parsedLine;this.snippet=snippet}DumpException.prototype.toString=function(){if(this.parsedLine!=null&&this.snippet!=null){return"<DumpException> "+this.message+" (line "+this.parsedLine+": '"+this.snippet+"')"}else{return"<DumpException> "+this.message}};return DumpException}(Error);module.exports=DumpException},{}],4:[function(require,module,exports){var ParseException,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;ParseException=function(superClass){extend(ParseException,superClass);function ParseException(message,parsedLine,snippet){ParseException.__super__.constructor.call(this,message);this.message=message;this.parsedLine=parsedLine;this.snippet=snippet}ParseException.prototype.toString=function(){if(this.parsedLine!=null&&this.snippet!=null){return"<ParseException> "+this.message+" (line "+this.parsedLine+": '"+this.snippet+"')"}else{return"<ParseException> "+this.message}};return ParseException}(Error);module.exports=ParseException},{}],5:[function(require,module,exports){var ParseMore,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;ParseMore=function(superClass){extend(ParseMore,superClass);function ParseMore(message,parsedLine,snippet){ParseMore.__super__.constructor.call(this,message);this.message=message;this.parsedLine=parsedLine;this.snippet=snippet}ParseMore.prototype.toString=function(){if(this.parsedLine!=null&&this.snippet!=null){return"<ParseMore> "+this.message+" (line "+this.parsedLine+": '"+this.snippet+"')"}else{return"<ParseMore> "+this.message}};return ParseMore}(Error);module.exports=ParseMore},{}],6:[function(require,module,exports){var DumpException,Escaper,Inline,ParseException,ParseMore,Pattern,Unescaper,Utils,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};Pattern=require("./Pattern");Unescaper=require("./Unescaper");Escaper=require("./Escaper");Utils=require("./Utils");ParseException=require("./Exception/ParseException");ParseMore=require("./Exception/ParseMore");DumpException=require("./Exception/DumpException");Inline=function(){function Inline(){}Inline.REGEX_QUOTED_STRING="(?:\"(?:[^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\"|'(?:[^']*(?:''[^']*)*)')";Inline.PATTERN_TRAILING_COMMENTS=new Pattern("^\\s*#.*$");Inline.PATTERN_QUOTED_SCALAR=new Pattern("^"+Inline.REGEX_QUOTED_STRING);Inline.PATTERN_THOUSAND_NUMERIC_SCALAR=new Pattern("^(-|\\+)?[0-9,]+(\\.[0-9]+)?$");Inline.PATTERN_SCALAR_BY_DELIMITERS={};Inline.settings={};Inline.configure=function(exceptionOnInvalidType,objectDecoder){if(exceptionOnInvalidType==null){exceptionOnInvalidType=null}if(objectDecoder==null){objectDecoder=null}this.settings.exceptionOnInvalidType=exceptionOnInvalidType;this.settings.objectDecoder=objectDecoder};Inline.parse=function(value,exceptionOnInvalidType,objectDecoder){var context,result;if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectDecoder==null){objectDecoder=null}this.settings.exceptionOnInvalidType=exceptionOnInvalidType;this.settings.objectDecoder=objectDecoder;if(value==null){return""}value=Utils.trim(value);if(0===value.length){return""}context={exceptionOnInvalidType:exceptionOnInvalidType,objectDecoder:objectDecoder,i:0};switch(value.charAt(0)){case"[":result=this.parseSequence(value,context);++context.i;break;case"{":result=this.parseMapping(value,context);++context.i;break;default:result=this.parseScalar(value,null,['"',"'"],context)}if(this.PATTERN_TRAILING_COMMENTS.replace(value.slice(context.i),"")!==""){throw new ParseException('Unexpected characters near "'+value.slice(context.i)+'".')}return result};Inline.dump=function(value,exceptionOnInvalidType,objectEncoder){var ref,result,type;if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectEncoder==null){objectEncoder=null}if(value==null){return"null"}type=typeof value;if(type==="object"){if(value instanceof Date){return value.toISOString()}else if(objectEncoder!=null){result=objectEncoder(value);if(typeof result==="string"||result!=null){return result}}return this.dumpObject(value)}if(type==="boolean"){return value?"true":"false"}if(Utils.isDigits(value)){return type==="string"?"'"+value+"'":String(parseInt(value))}if(Utils.isNumeric(value)){return type==="string"?"'"+value+"'":String(parseFloat(value))}if(type==="number"){return value===Infinity?".Inf":value===-Infinity?"-.Inf":isNaN(value)?".NaN":value}if(Escaper.requiresDoubleQuoting(value)){return Escaper.escapeWithDoubleQuotes(value)}if(Escaper.requiresSingleQuoting(value)){return Escaper.escapeWithSingleQuotes(value)}if(""===value){return'""'}if(Utils.PATTERN_DATE.test(value)){return"'"+value+"'"}if((ref=value.toLowerCase())==="null"||ref==="~"||ref==="true"||ref==="false"){return"'"+value+"'"}return value};Inline.dumpObject=function(value,exceptionOnInvalidType,objectSupport){var j,key,len1,output,val;if(objectSupport==null){objectSupport=null}if(value instanceof Array){output=[];for(j=0,len1=value.length;j<len1;j++){val=value[j];output.push(this.dump(val))}return"["+output.join(", ")+"]"}else{output=[];for(key in value){val=value[key];output.push(this.dump(key)+": "+this.dump(val))}return"{"+output.join(", ")+"}"}};Inline.parseScalar=function(scalar,delimiters,stringDelimiters,context,evaluate){var i,joinedDelimiters,match,output,pattern,ref,ref1,strpos,tmp;if(delimiters==null){delimiters=null}if(stringDelimiters==null){stringDelimiters=['"',"'"]}if(context==null){context=null}if(evaluate==null){evaluate=true}if(context==null){context={exceptionOnInvalidType:this.settings.exceptionOnInvalidType,objectDecoder:this.settings.objectDecoder,i:0}}i=context.i;if(ref=scalar.charAt(i),indexOf.call(stringDelimiters,ref)>=0){output=this.parseQuotedScalar(scalar,context);i=context.i;if(delimiters!=null){tmp=Utils.ltrim(scalar.slice(i)," ");if(!(ref1=tmp.charAt(0),indexOf.call(delimiters,ref1)>=0)){throw new ParseException("Unexpected characters ("+scalar.slice(i)+").")}}}else{if(!delimiters){output=scalar.slice(i);i+=output.length;strpos=output.indexOf(" #");if(strpos!==-1){output=Utils.rtrim(output.slice(0,strpos))}}else{joinedDelimiters=delimiters.join("|");pattern=this.PATTERN_SCALAR_BY_DELIMITERS[joinedDelimiters];if(pattern==null){pattern=new Pattern("^(.+?)("+joinedDelimiters+")");this.PATTERN_SCALAR_BY_DELIMITERS[joinedDelimiters]=pattern}if(match=pattern.exec(scalar.slice(i))){output=match[1];i+=output.length}else{throw new ParseException("Malformed inline YAML string ("+scalar+").")}}if(evaluate){output=this.evaluateScalar(output,context)}}context.i=i;return output};Inline.parseQuotedScalar=function(scalar,context){var i,match,output;i=context.i;if(!(match=this.PATTERN_QUOTED_SCALAR.exec(scalar.slice(i)))){throw new ParseMore("Malformed inline YAML string ("+scalar.slice(i)+").")}output=match[0].substr(1,match[0].length-2);if('"'===scalar.charAt(i)){output=Unescaper.unescapeDoubleQuotedString(output)}else{output=Unescaper.unescapeSingleQuotedString(output)}i+=match[0].length;context.i=i;return output};Inline.parseSequence=function(sequence,context){var e,error,i,isQuoted,len,output,ref,value;output=[];len=sequence.length;i=context.i;i+=1;while(i<len){context.i=i;switch(sequence.charAt(i)){case"[":output.push(this.parseSequence(sequence,context));i=context.i;break;case"{":output.push(this.parseMapping(sequence,context));i=context.i;break;case"]":return output;case",":case" ":case"\n":break;default:isQuoted=(ref=sequence.charAt(i))==='"'||ref==="'";value=this.parseScalar(sequence,[",","]"],['"',"'"],context);i=context.i;if(!isQuoted&&typeof value==="string"&&(value.indexOf(": ")!==-1||value.indexOf(":\n")!==-1)){try{value=this.parseMapping("{"+value+"}")}catch(error){e=error}}output.push(value);--i}++i}throw new ParseMore("Malformed inline YAML string "+sequence)};Inline.parseMapping=function(mapping,context){var done,i,key,len,output,shouldContinueWhileLoop,value;output={};len=mapping.length;i=context.i;i+=1;shouldContinueWhileLoop=false;while(i<len){context.i=i;switch(mapping.charAt(i)){case" ":case",":case"\n":++i;context.i=i;shouldContinueWhileLoop=true;break;case"}":return output}if(shouldContinueWhileLoop){shouldContinueWhileLoop=false;continue}key=this.parseScalar(mapping,[":"," ","\n"],['"',"'"],context,false);i=context.i;done=false;while(i<len){context.i=i;switch(mapping.charAt(i)){case"[":value=this.parseSequence(mapping,context);i=context.i;if(output[key]===void 0){output[key]=value}done=true;break;case"{":value=this.parseMapping(mapping,context);i=context.i;if(output[key]===void 0){output[key]=value}done=true;break;case":":case" ":case"\n":break;default:value=this.parseScalar(mapping,[",","}"],['"',"'"],context);i=context.i;if(output[key]===void 0){output[key]=value}done=true;--i}++i;if(done){break}}}throw new ParseMore("Malformed inline YAML string "+mapping)};Inline.evaluateScalar=function(scalar,context){var cast,date,exceptionOnInvalidType,firstChar,firstSpace,firstWord,objectDecoder,raw,scalarLower,subValue,trimmedScalar;scalar=Utils.trim(scalar);scalarLower=scalar.toLowerCase();switch(scalarLower){case"null":case"":case"~":return null;case"true":return true;case"false":return false;case".inf":return Infinity;case".nan":return NaN;case"-.inf":return Infinity;default:firstChar=scalarLower.charAt(0);switch(firstChar){case"!":firstSpace=scalar.indexOf(" ");if(firstSpace===-1){firstWord=scalarLower}else{firstWord=scalarLower.slice(0,firstSpace)}switch(firstWord){case"!":if(firstSpace!==-1){return parseInt(this.parseScalar(scalar.slice(2)))}return null;case"!str":return Utils.ltrim(scalar.slice(4));case"!!str":return Utils.ltrim(scalar.slice(5));case"!!int":return parseInt(this.parseScalar(scalar.slice(5)));case"!!bool":return Utils.parseBoolean(this.parseScalar(scalar.slice(6)),false);case"!!float":return parseFloat(this.parseScalar(scalar.slice(7)));case"!!timestamp":return Utils.stringToDate(Utils.ltrim(scalar.slice(11)));default:if(context==null){context={exceptionOnInvalidType:this.settings.exceptionOnInvalidType,objectDecoder:this.settings.objectDecoder,i:0}}objectDecoder=context.objectDecoder,exceptionOnInvalidType=context.exceptionOnInvalidType;if(objectDecoder){trimmedScalar=Utils.rtrim(scalar);firstSpace=trimmedScalar.indexOf(" ");if(firstSpace===-1){return objectDecoder(trimmedScalar,null)}else{subValue=Utils.ltrim(trimmedScalar.slice(firstSpace+1));if(!(subValue.length>0)){subValue=null}return objectDecoder(trimmedScalar.slice(0,firstSpace),subValue)}}if(exceptionOnInvalidType){throw new ParseException("Custom object support when parsing a YAML file has been disabled.")}return null}break;case"0":if("0x"===scalar.slice(0,2)){return Utils.hexDec(scalar)}else if(Utils.isDigits(scalar)){return Utils.octDec(scalar)}else if(Utils.isNumeric(scalar)){return parseFloat(scalar)}else{return scalar}break;case"+":if(Utils.isDigits(scalar)){raw=scalar;cast=parseInt(raw);if(raw===String(cast)){return cast}else{return raw}}else if(Utils.isNumeric(scalar)){return parseFloat(scalar)}else if(this.PATTERN_THOUSAND_NUMERIC_SCALAR.test(scalar)){return parseFloat(scalar.replace(",",""))}return scalar;case"-":if(Utils.isDigits(scalar.slice(1))){if("0"===scalar.charAt(1)){return-Utils.octDec(scalar.slice(1))}else{raw=scalar.slice(1);cast=parseInt(raw);if(raw===String(cast)){return-cast}else{return-raw}}}else if(Utils.isNumeric(scalar)){return parseFloat(scalar)}else if(this.PATTERN_THOUSAND_NUMERIC_SCALAR.test(scalar)){return parseFloat(scalar.replace(",",""))}return scalar;default:if(date=Utils.stringToDate(scalar)){return date}else if(Utils.isNumeric(scalar)){return parseFloat(scalar)}else if(this.PATTERN_THOUSAND_NUMERIC_SCALAR.test(scalar)){return parseFloat(scalar.replace(",",""))}return scalar}}};return Inline}();module.exports=Inline},{"./Escaper":2,"./Exception/DumpException":3,"./Exception/ParseException":4,"./Exception/ParseMore":5,"./Pattern":8,"./Unescaper":9,"./Utils":10}],7:[function(require,module,exports){var Inline,ParseException,ParseMore,Parser,Pattern,Utils;Inline=require("./Inline");Pattern=require("./Pattern");Utils=require("./Utils");ParseException=require("./Exception/ParseException");ParseMore=require("./Exception/ParseMore");Parser=function(){Parser.prototype.PATTERN_FOLDED_SCALAR_ALL=new Pattern("^(?:(?<type>![^\\|>]*)\\s+)?(?<separator>\\||>)(?<modifiers>\\+|\\-|\\d+|\\+\\d+|\\-\\d+|\\d+\\+|\\d+\\-)?(?<comments> +#.*)?$");Parser.prototype.PATTERN_FOLDED_SCALAR_END=new Pattern("(?<separator>\\||>)(?<modifiers>\\+|\\-|\\d+|\\+\\d+|\\-\\d+|\\d+\\+|\\d+\\-)?(?<comments> +#.*)?$");Parser.prototype.PATTERN_SEQUENCE_ITEM=new Pattern("^\\-((?<leadspaces>\\s+)(?<value>.+?))?\\s*$");Parser.prototype.PATTERN_ANCHOR_VALUE=new Pattern("^&(?<ref>[^ ]+) *(?<value>.*)");Parser.prototype.PATTERN_COMPACT_NOTATION=new Pattern("^(?<key>"+Inline.REGEX_QUOTED_STRING+"|[^ '\"\\{\\[].*?) *\\:(\\s+(?<value>.+?))?\\s*$");Parser.prototype.PATTERN_MAPPING_ITEM=new Pattern("^(?<key>"+Inline.REGEX_QUOTED_STRING+"|[^ '\"\\[\\{].*?) *\\:(\\s+(?<value>.+?))?\\s*$");Parser.prototype.PATTERN_DECIMAL=new Pattern("\\d+");Parser.prototype.PATTERN_INDENT_SPACES=new Pattern("^ +");Parser.prototype.PATTERN_TRAILING_LINES=new Pattern("(\n*)$");Parser.prototype.PATTERN_YAML_HEADER=new Pattern("^\\%YAML[: ][\\d\\.]+.*\n","m");Parser.prototype.PATTERN_LEADING_COMMENTS=new Pattern("^(\\#.*?\n)+","m");Parser.prototype.PATTERN_DOCUMENT_MARKER_START=new Pattern("^\\-\\-\\-.*?\n","m");Parser.prototype.PATTERN_DOCUMENT_MARKER_END=new Pattern("^\\.\\.\\.\\s*$","m");Parser.prototype.PATTERN_FOLDED_SCALAR_BY_INDENTATION={};Parser.prototype.CONTEXT_NONE=0;Parser.prototype.CONTEXT_SEQUENCE=1;Parser.prototype.CONTEXT_MAPPING=2;function Parser(offset){this.offset=offset!=null?offset:0;this.lines=[];this.currentLineNb=-1;this.currentLine="";this.refs={}}Parser.prototype.parse=function(value,exceptionOnInvalidType,objectDecoder){var alias,allowOverwrite,block,c,context,data,e,error,error1,error2,first,i,indent,isRef,j,k,key,l,lastKey,len,len1,len2,len3,lineCount,m,matches,mergeNode,n,name,parsed,parsedItem,parser,ref,ref1,ref2,refName,refValue,val,values;if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectDecoder==null){objectDecoder=null}this.currentLineNb=-1;this.currentLine="";this.lines=this.cleanup(value).split("\n");data=null;context=this.CONTEXT_NONE;allowOverwrite=false;while(this.moveToNextLine()){if(this.isCurrentLineEmpty()){continue}if("\t"===this.currentLine[0]){throw new ParseException("A YAML file cannot contain tabs as indentation.",this.getRealCurrentLineNb()+1,this.currentLine)}isRef=mergeNode=false;if(values=this.PATTERN_SEQUENCE_ITEM.exec(this.currentLine)){if(this.CONTEXT_MAPPING===context){throw new ParseException("You cannot define a sequence item when in a mapping")}context=this.CONTEXT_SEQUENCE;if(data==null){data=[]}if(values.value!=null&&(matches=this.PATTERN_ANCHOR_VALUE.exec(values.value))){isRef=matches.ref;values.value=matches.value}if(!(values.value!=null)||""===Utils.trim(values.value," ")||Utils.ltrim(values.value," ").indexOf("#")===0){if(this.currentLineNb<this.lines.length-1&&!this.isNextLineUnIndentedCollection()){c=this.getRealCurrentLineNb()+1;parser=new Parser(c);parser.refs=this.refs;data.push(parser.parse(this.getNextEmbedBlock(null,true),exceptionOnInvalidType,objectDecoder))}else{data.push(null)}}else{if(((ref=values.leadspaces)!=null?ref.length:void 0)&&(matches=this.PATTERN_COMPACT_NOTATION.exec(values.value))){c=this.getRealCurrentLineNb();parser=new Parser(c);parser.refs=this.refs;block=values.value;indent=this.getCurrentLineIndentation();if(this.isNextLineIndented(false)){block+="\n"+this.getNextEmbedBlock(indent+values.leadspaces.length+1,true)}data.push(parser.parse(block,exceptionOnInvalidType,objectDecoder))}else{data.push(this.parseValue(values.value,exceptionOnInvalidType,objectDecoder))}}}else if((values=this.PATTERN_MAPPING_ITEM.exec(this.currentLine))&&values.key.indexOf(" #")===-1){if(this.CONTEXT_SEQUENCE===context){throw new ParseException("You cannot define a mapping item when in a sequence")}context=this.CONTEXT_MAPPING;if(data==null){data={}}Inline.configure(exceptionOnInvalidType,objectDecoder);try{key=Inline.parseScalar(values.key)}catch(error){e=error;e.parsedLine=this.getRealCurrentLineNb()+1;e.snippet=this.currentLine;throw e}if("<<"===key){mergeNode=true;allowOverwrite=true;if(((ref1=values.value)!=null?ref1.indexOf("*"):void 0)===0){refName=values.value.slice(1);if(this.refs[refName]==null){throw new ParseException('Reference "'+refName+'" does not exist.',this.getRealCurrentLineNb()+1,this.currentLine)}refValue=this.refs[refName];if(typeof refValue!=="object"){throw new ParseException("YAML merge keys used with a scalar value instead of an object.",this.getRealCurrentLineNb()+1,this.currentLine)}if(refValue instanceof Array){for(i=j=0,len=refValue.length;j<len;i=++j){value=refValue[i];if(data[name=String(i)]==null){data[name]=value}}}else{for(key in refValue){value=refValue[key];if(data[key]==null){data[key]=value}}}}else{if(values.value!=null&&values.value!==""){value=values.value}else{value=this.getNextEmbedBlock()}c=this.getRealCurrentLineNb()+1;parser=new Parser(c);parser.refs=this.refs;parsed=parser.parse(value,exceptionOnInvalidType);if(typeof parsed!=="object"){throw new ParseException("YAML merge keys used with a scalar value instead of an object.",this.getRealCurrentLineNb()+1,this.currentLine)}if(parsed instanceof Array){for(l=0,len1=parsed.length;l<len1;l++){parsedItem=parsed[l];if(typeof parsedItem!=="object"){throw new ParseException("Merge items must be objects.",this.getRealCurrentLineNb()+1,parsedItem)}if(parsedItem instanceof Array){for(i=m=0,len2=parsedItem.length;m<len2;i=++m){value=parsedItem[i];k=String(i);if(!data.hasOwnProperty(k)){data[k]=value}}}else{for(key in parsedItem){value=parsedItem[key];if(!data.hasOwnProperty(key)){data[key]=value}}}}}else{for(key in parsed){value=parsed[key];if(!data.hasOwnProperty(key)){data[key]=value}}}}}else if(values.value!=null&&(matches=this.PATTERN_ANCHOR_VALUE.exec(values.value))){isRef=matches.ref;values.value=matches.value}if(mergeNode){}else if(!(values.value!=null)||""===Utils.trim(values.value," ")||Utils.ltrim(values.value," ").indexOf("#")===0){if(!this.isNextLineIndented()&&!this.isNextLineUnIndentedCollection()){if(allowOverwrite||data[key]===void 0){data[key]=null}}else{c=this.getRealCurrentLineNb()+1;parser=new Parser(c);parser.refs=this.refs;val=parser.parse(this.getNextEmbedBlock(),exceptionOnInvalidType,objectDecoder);if(allowOverwrite||data[key]===void 0){data[key]=val}}}else{val=this.parseValue(values.value,exceptionOnInvalidType,objectDecoder);if(allowOverwrite||data[key]===void 0){data[key]=val}}}else{lineCount=this.lines.length;if(1===lineCount||2===lineCount&&Utils.isEmpty(this.lines[1])){try{value=Inline.parse(this.lines[0],exceptionOnInvalidType,objectDecoder)}catch(error1){e=error1;e.parsedLine=this.getRealCurrentLineNb()+1;e.snippet=this.currentLine;throw e}if(typeof value==="object"){if(value instanceof Array){first=value[0]}else{for(key in value){first=value[key];break}}if(typeof first==="string"&&first.indexOf("*")===0){data=[];for(n=0,len3=value.length;n<len3;n++){alias=value[n];data.push(this.refs[alias.slice(1)])}value=data}}return value}else if((ref2=Utils.ltrim(value).charAt(0))==="["||ref2==="{"){try{return Inline.parse(value,exceptionOnInvalidType,objectDecoder)}catch(error2){e=error2;e.parsedLine=this.getRealCurrentLineNb()+1;e.snippet=this.currentLine;throw e}}throw new ParseException("Unable to parse.",this.getRealCurrentLineNb()+1,this.currentLine)}if(isRef){if(data instanceof Array){this.refs[isRef]=data[data.length-1]}else{lastKey=null;for(key in data){lastKey=key}this.refs[isRef]=data[lastKey]}}}if(Utils.isEmpty(data)){return null}else{return data}};Parser.prototype.getRealCurrentLineNb=function(){return this.currentLineNb+this.offset};Parser.prototype.getCurrentLineIndentation=function(){return this.currentLine.length-Utils.ltrim(this.currentLine," ").length};Parser.prototype.getNextEmbedBlock=function(indentation,includeUnindentedCollection){var data,indent,isItUnindentedCollection,newIndent,removeComments,removeCommentsPattern,unindentedEmbedBlock;if(indentation==null){indentation=null}if(includeUnindentedCollection==null){includeUnindentedCollection=false}this.moveToNextLine();if(indentation==null){newIndent=this.getCurrentLineIndentation();unindentedEmbedBlock=this.isStringUnIndentedCollectionItem(this.currentLine);if(!this.isCurrentLineEmpty()&&0===newIndent&&!unindentedEmbedBlock){throw new ParseException("Indentation problem.",this.getRealCurrentLineNb()+1,this.currentLine)}}else{newIndent=indentation}data=[this.currentLine.slice(newIndent)];if(!includeUnindentedCollection){isItUnindentedCollection=this.isStringUnIndentedCollectionItem(this.currentLine)}removeCommentsPattern=this.PATTERN_FOLDED_SCALAR_END;removeComments=!removeCommentsPattern.test(this.currentLine);while(this.moveToNextLine()){indent=this.getCurrentLineIndentation();if(indent===newIndent){removeComments=!removeCommentsPattern.test(this.currentLine)}if(removeComments&&this.isCurrentLineComment()){continue}if(this.isCurrentLineBlank()){data.push(this.currentLine.slice(newIndent));continue}if(isItUnindentedCollection&&!this.isStringUnIndentedCollectionItem(this.currentLine)&&indent===newIndent){this.moveToPreviousLine();break}if(indent>=newIndent){data.push(this.currentLine.slice(newIndent))}else if(Utils.ltrim(this.currentLine).charAt(0)==="#"){}else if(0===indent){this.moveToPreviousLine();break}else{throw new ParseException("Indentation problem.",this.getRealCurrentLineNb()+1,this.currentLine)}}return data.join("\n")};Parser.prototype.moveToNextLine=function(){if(this.currentLineNb>=this.lines.length-1){return false}this.currentLine=this.lines[++this.currentLineNb];return true};Parser.prototype.moveToPreviousLine=function(){this.currentLine=this.lines[--this.currentLineNb]};Parser.prototype.parseValue=function(value,exceptionOnInvalidType,objectDecoder){var e,error,foldedIndent,matches,modifiers,pos,ref,ref1,val;if(0===value.indexOf("*")){pos=value.indexOf("#");if(pos!==-1){value=value.substr(1,pos-2)}else{value=value.slice(1)}if(this.refs[value]===void 0){throw new ParseException('Reference "'+value+'" does not exist.',this.currentLine)}return this.refs[value]}if(matches=this.PATTERN_FOLDED_SCALAR_ALL.exec(value)){modifiers=(ref=matches.modifiers)!=null?ref:"";foldedIndent=Math.abs(parseInt(modifiers));if(isNaN(foldedIndent)){foldedIndent=0}val=this.parseFoldedScalar(matches.separator,this.PATTERN_DECIMAL.replace(modifiers,""),foldedIndent);if(matches.type!=null){Inline.configure(exceptionOnInvalidType,objectDecoder);return Inline.parseScalar(matches.type+" "+val)}else{return val}}if((ref1=value.charAt(0))==="["||ref1==="{"||ref1==='"'||ref1==="'"){while(true){try{return Inline.parse(value,exceptionOnInvalidType,objectDecoder)}catch(error){e=error;if(e instanceof ParseMore&&this.moveToNextLine()){value+="\n"+Utils.trim(this.currentLine," ")}else{e.parsedLine=this.getRealCurrentLineNb()+1;e.snippet=this.currentLine;throw e}}}}else{if(this.isNextLineIndented()){value+="\n"+this.getNextEmbedBlock()}return Inline.parse(value,exceptionOnInvalidType,objectDecoder)}};Parser.prototype.parseFoldedScalar=function(separator,indicator,indentation){var isCurrentLineBlank,j,len,line,matches,newText,notEOF,pattern,ref,text;if(indicator==null){indicator=""}if(indentation==null){indentation=0}notEOF=this.moveToNextLine();if(!notEOF){return""}isCurrentLineBlank=this.isCurrentLineBlank();text="";while(notEOF&&isCurrentLineBlank){if(notEOF=this.moveToNextLine()){text+="\n";isCurrentLineBlank=this.isCurrentLineBlank()}}if(0===indentation){if(matches=this.PATTERN_INDENT_SPACES.exec(this.currentLine)){indentation=matches[0].length}}if(indentation>0){pattern=this.PATTERN_FOLDED_SCALAR_BY_INDENTATION[indentation];if(pattern==null){pattern=new Pattern("^ {"+indentation+"}(.*)$");Parser.prototype.PATTERN_FOLDED_SCALAR_BY_INDENTATION[indentation]=pattern}while(notEOF&&(isCurrentLineBlank||(matches=pattern.exec(this.currentLine)))){if(isCurrentLineBlank){text+=this.currentLine.slice(indentation)}else{text+=matches[1]}if(notEOF=this.moveToNextLine()){text+="\n";isCurrentLineBlank=this.isCurrentLineBlank()}}}else if(notEOF){text+="\n"}if(notEOF){this.moveToPreviousLine()}if(">"===separator){newText="";ref=text.split("\n");for(j=0,len=ref.length;j<len;j++){line=ref[j];if(line.length===0||line.charAt(0)===" "){newText=Utils.rtrim(newText," ")+line+"\n"}else{newText+=line+" "}}text=newText}if("+"!==indicator){text=Utils.rtrim(text)}if(""===indicator){text=this.PATTERN_TRAILING_LINES.replace(text,"\n")}else if("-"===indicator){text=this.PATTERN_TRAILING_LINES.replace(text,"")}return text};Parser.prototype.isNextLineIndented=function(ignoreComments){var EOF,currentIndentation,ret;if(ignoreComments==null){ignoreComments=true}currentIndentation=this.getCurrentLineIndentation();EOF=!this.moveToNextLine();if(ignoreComments){while(!EOF&&this.isCurrentLineEmpty()){EOF=!this.moveToNextLine()}}else{while(!EOF&&this.isCurrentLineBlank()){EOF=!this.moveToNextLine()}}if(EOF){return false}ret=false;if(this.getCurrentLineIndentation()>currentIndentation){ret=true}this.moveToPreviousLine();return ret};Parser.prototype.isCurrentLineEmpty=function(){var trimmedLine;trimmedLine=Utils.trim(this.currentLine," ");return trimmedLine.length===0||trimmedLine.charAt(0)==="#"};Parser.prototype.isCurrentLineBlank=function(){return""===Utils.trim(this.currentLine," ")};Parser.prototype.isCurrentLineComment=function(){var ltrimmedLine;ltrimmedLine=Utils.ltrim(this.currentLine," ");return ltrimmedLine.charAt(0)==="#"};Parser.prototype.cleanup=function(value){var count,i,indent,j,l,len,len1,line,lines,ref,ref1,ref2,smallestIndent,trimmedValue;if(value.indexOf("\r")!==-1){value=value.split("\r\n").join("\n").split("\r").join("\n")}count=0;ref=this.PATTERN_YAML_HEADER.replaceAll(value,""),value=ref[0],count=ref[1];this.offset+=count;ref1=this.PATTERN_LEADING_COMMENTS.replaceAll(value,"",1),trimmedValue=ref1[0],count=ref1[1];if(count===1){this.offset+=Utils.subStrCount(value,"\n")-Utils.subStrCount(trimmedValue,"\n");value=trimmedValue}ref2=this.PATTERN_DOCUMENT_MARKER_START.replaceAll(value,"",1),trimmedValue=ref2[0],count=ref2[1];if(count===1){this.offset+=Utils.subStrCount(value,"\n")-Utils.subStrCount(trimmedValue,"\n");value=trimmedValue;value=this.PATTERN_DOCUMENT_MARKER_END.replace(value,"")}lines=value.split("\n");smallestIndent=-1;for(j=0,len=lines.length;j<len;j++){line=lines[j];if(Utils.trim(line," ").length===0){continue}indent=line.length-Utils.ltrim(line).length;if(smallestIndent===-1||indent<smallestIndent){smallestIndent=indent}}if(smallestIndent>0){for(i=l=0,len1=lines.length;l<len1;i=++l){line=lines[i];lines[i]=line.slice(smallestIndent)}value=lines.join("\n")}return value};Parser.prototype.isNextLineUnIndentedCollection=function(currentIndentation){var notEOF,ret;if(currentIndentation==null){currentIndentation=null}if(currentIndentation==null){currentIndentation=this.getCurrentLineIndentation()}notEOF=this.moveToNextLine();while(notEOF&&this.isCurrentLineEmpty()){notEOF=this.moveToNextLine()}if(false===notEOF){return false}ret=false;if(this.getCurrentLineIndentation()===currentIndentation&&this.isStringUnIndentedCollectionItem(this.currentLine)){ret=true}this.moveToPreviousLine();return ret};Parser.prototype.isStringUnIndentedCollectionItem=function(){return this.currentLine==="-"||this.currentLine.slice(0,2)==="- "};return Parser}();module.exports=Parser},{"./Exception/ParseException":4,"./Exception/ParseMore":5,"./Inline":6,"./Pattern":8,"./Utils":10}],8:[function(require,module,exports){var Pattern;Pattern=function(){Pattern.prototype.regex=null;Pattern.prototype.rawRegex=null;Pattern.prototype.cleanedRegex=null;Pattern.prototype.mapping=null;function Pattern(rawRegex,modifiers){var _char,capturingBracketNumber,cleanedRegex,i,len,mapping,name,part,subChar;if(modifiers==null){modifiers=""}cleanedRegex="";len=rawRegex.length;mapping=null;capturingBracketNumber=0;i=0;while(i<len){_char=rawRegex.charAt(i);if(_char==="\\"){cleanedRegex+=rawRegex.slice(i,+(i+1)+1||9e9);i++}else if(_char==="("){if(i<len-2){part=rawRegex.slice(i,+(i+2)+1||9e9);if(part==="(?:"){i+=2;cleanedRegex+=part}else if(part==="(?<"){capturingBracketNumber++;i+=2;name="";while(i+1<len){subChar=rawRegex.charAt(i+1);if(subChar===">"){cleanedRegex+="(";i++;if(name.length>0){if(mapping==null){mapping={}}mapping[name]=capturingBracketNumber}break}else{name+=subChar}i++}}else{cleanedRegex+=_char;capturingBracketNumber++}}else{cleanedRegex+=_char}}else{cleanedRegex+=_char}i++}this.rawRegex=rawRegex;this.cleanedRegex=cleanedRegex;this.regex=new RegExp(this.cleanedRegex,"g"+modifiers.replace("g",""));this.mapping=mapping}Pattern.prototype.exec=function(str){var index,matches,name,ref;this.regex.lastIndex=0;matches=this.regex.exec(str);if(matches==null){return null}if(this.mapping!=null){ref=this.mapping;for(name in ref){index=ref[name];matches[name]=matches[index]}}return matches};Pattern.prototype.test=function(str){this.regex.lastIndex=0;return this.regex.test(str)};Pattern.prototype.replace=function(str,replacement){this.regex.lastIndex=0;return str.replace(this.regex,replacement)};Pattern.prototype.replaceAll=function(str,replacement,limit){var count;if(limit==null){limit=0}this.regex.lastIndex=0;count=0;while(this.regex.test(str)&&(limit===0||count<limit)){this.regex.lastIndex=0;str=str.replace(this.regex,replacement);count++}return[str,count]};return Pattern}();module.exports=Pattern},{}],9:[function(require,module,exports){var Pattern,Unescaper,Utils;Utils=require("./Utils");Pattern=require("./Pattern");Unescaper=function(){function Unescaper(){}Unescaper.PATTERN_ESCAPED_CHARACTER=new Pattern('\\\\([0abt\tnvfre "\\/\\\\N_LP]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|U[0-9a-fA-F]{8})');Unescaper.unescapeSingleQuotedString=function(value){return value.replace(/\'\'/g,"'")};Unescaper.unescapeDoubleQuotedString=function(value){if(this._unescapeCallback==null){this._unescapeCallback=function(_this){return function(str){return _this.unescapeCharacter(str)}}(this)}return this.PATTERN_ESCAPED_CHARACTER.replace(value,this._unescapeCallback)};Unescaper.unescapeCharacter=function(value){var ch;ch=String.fromCharCode;switch(value.charAt(1)){case"0":return ch(0);case"a":return ch(7);case"b":return ch(8);case"t":return"\t";case"\t":return"\t";case"n":return"\n";case"v":return ch(11);case"f":return ch(12);case"r":return ch(13);case"e":return ch(27);case" ":return" ";case'"':return'"';case"/":return"/";case"\\":return"\\";case"N":return ch(133);case"_":return ch(160);case"L":return ch(8232);case"P":return ch(8233);case"x":return Utils.utf8chr(Utils.hexDec(value.substr(2,2)));case"u":return Utils.utf8chr(Utils.hexDec(value.substr(2,4)));case"U":return Utils.utf8chr(Utils.hexDec(value.substr(2,8)));default:return""}};return Unescaper}();module.exports=Unescaper},{"./Pattern":8,"./Utils":10}],10:[function(require,module,exports){var Pattern,Utils,hasProp={}.hasOwnProperty;Pattern=require("./Pattern");Utils=function(){function Utils(){}Utils.REGEX_LEFT_TRIM_BY_CHAR={};Utils.REGEX_RIGHT_TRIM_BY_CHAR={};Utils.REGEX_SPACES=/\s+/g;Utils.REGEX_DIGITS=/^\d+$/;Utils.REGEX_OCTAL=/[^0-7]/gi;Utils.REGEX_HEXADECIMAL=/[^a-f0-9]/gi;Utils.PATTERN_DATE=new Pattern("^"+"(?<year>[0-9][0-9][0-9][0-9])"+"-(?<month>[0-9][0-9]?)"+"-(?<day>[0-9][0-9]?)"+"(?:(?:[Tt]|[ \t]+)"+"(?<hour>[0-9][0-9]?)"+":(?<minute>[0-9][0-9])"+":(?<second>[0-9][0-9])"+"(?:.(?<fraction>[0-9]*))?"+"(?:[ \t]*(?<tz>Z|(?<tz_sign>[-+])(?<tz_hour>[0-9][0-9]?)"+"(?::(?<tz_minute>[0-9][0-9]))?))?)?"+"$","i");Utils.LOCAL_TIMEZONE_OFFSET=(new Date).getTimezoneOffset()*60*1e3;Utils.trim=function(str,_char){var regexLeft,regexRight;if(_char==null){_char="\\s"}regexLeft=this.REGEX_LEFT_TRIM_BY_CHAR[_char];if(regexLeft==null){this.REGEX_LEFT_TRIM_BY_CHAR[_char]=regexLeft=new RegExp("^"+_char+""+_char+"*")}regexLeft.lastIndex=0;regexRight=this.REGEX_RIGHT_TRIM_BY_CHAR[_char];if(regexRight==null){this.REGEX_RIGHT_TRIM_BY_CHAR[_char]=regexRight=new RegExp(_char+""+_char+"*$")}regexRight.lastIndex=0;return str.replace(regexLeft,"").replace(regexRight,"")};Utils.ltrim=function(str,_char){var regexLeft;if(_char==null){_char="\\s"}regexLeft=this.REGEX_LEFT_TRIM_BY_CHAR[_char];if(regexLeft==null){this.REGEX_LEFT_TRIM_BY_CHAR[_char]=regexLeft=new RegExp("^"+_char+""+_char+"*")}regexLeft.lastIndex=0;return str.replace(regexLeft,"")};Utils.rtrim=function(str,_char){var regexRight;if(_char==null){_char="\\s"}regexRight=this.REGEX_RIGHT_TRIM_BY_CHAR[_char];if(regexRight==null){this.REGEX_RIGHT_TRIM_BY_CHAR[_char]=regexRight=new RegExp(_char+""+_char+"*$")}regexRight.lastIndex=0;return str.replace(regexRight,"")};Utils.isEmpty=function(value){return!value||value===""||value==="0"||value instanceof Array&&value.length===0||this.isEmptyObject(value)};Utils.isEmptyObject=function(value){var k;return value instanceof Object&&function(){var results;results=[];for(k in value){if(!hasProp.call(value,k))continue;results.push(k)}return results}().length===0};Utils.subStrCount=function(string,subString,start,length){var c,i,j,len,ref,sublen;c=0;string=""+string;subString=""+subString;if(start!=null){string=string.slice(start)}if(length!=null){string=string.slice(0,length)}len=string.length;sublen=subString.length;for(i=j=0,ref=len;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){if(subString===string.slice(i,sublen)){c++;i+=sublen-1}}return c};Utils.isDigits=function(input){this.REGEX_DIGITS.lastIndex=0;return this.REGEX_DIGITS.test(input)};Utils.octDec=function(input){this.REGEX_OCTAL.lastIndex=0;return parseInt((input+"").replace(this.REGEX_OCTAL,""),8)};Utils.hexDec=function(input){this.REGEX_HEXADECIMAL.lastIndex=0;input=this.trim(input);if((input+"").slice(0,2)==="0x"){input=(input+"").slice(2)}return parseInt((input+"").replace(this.REGEX_HEXADECIMAL,""),16)};Utils.utf8chr=function(c){var ch;ch=String.fromCharCode;if(128>(c%=2097152)){return ch(c)}if(2048>c){return ch(192|c>>6)+ch(128|c&63)}if(65536>c){return ch(224|c>>12)+ch(128|c>>6&63)+ch(128|c&63)}return ch(240|c>>18)+ch(128|c>>12&63)+ch(128|c>>6&63)+ch(128|c&63)};Utils.parseBoolean=function(input,strict){var lowerInput;if(strict==null){strict=true}if(typeof input==="string"){lowerInput=input.toLowerCase();if(!strict){if(lowerInput==="no"){return false}}if(lowerInput==="0"){return false}if(lowerInput==="false"){return false}if(lowerInput===""){return false}return true}return!!input};Utils.isNumeric=function(input){this.REGEX_SPACES.lastIndex=0;return typeof input==="number"||typeof input==="string"&&!isNaN(input)&&input.replace(this.REGEX_SPACES,"")!==""};Utils.stringToDate=function(str){var date,day,fraction,hour,info,minute,month,second,tz_hour,tz_minute,tz_offset,year;if(!(str!=null?str.length:void 0)){return null}info=this.PATTERN_DATE.exec(str);if(!info){return null}year=parseInt(info.year,10);month=parseInt(info.month,10)-1;day=parseInt(info.day,10);if(info.hour==null){date=new Date(Date.UTC(year,month,day));return date}hour=parseInt(info.hour,10);minute=parseInt(info.minute,10);second=parseInt(info.second,10);if(info.fraction!=null){fraction=info.fraction.slice(0,3);while(fraction.length<3){fraction+="0"}fraction=parseInt(fraction,10)}else{fraction=0}if(info.tz!=null){tz_hour=parseInt(info.tz_hour,10);if(info.tz_minute!=null){tz_minute=parseInt(info.tz_minute,10)}else{tz_minute=0}tz_offset=(tz_hour*60+tz_minute)*6e4;if("-"===info.tz_sign){tz_offset*=-1}}date=new Date(Date.UTC(year,month,day,hour,minute,second,fraction));if(tz_offset){date.setTime(date.getTime()-tz_offset)}return date};Utils.strRepeat=function(str,number){var i,res;res="";i=0;while(i<number){res+=str;i++}return res};Utils.getStringFromFile=function(path,callback){var data,fs,j,len1,name,ref,req,xhr;if(callback==null){callback=null}xhr=null;if(typeof window!=="undefined"&&window!==null){if(window.XMLHttpRequest){xhr=new XMLHttpRequest}else if(window.ActiveXObject){ref=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(j=0,len1=ref.length;j<len1;j++){name=ref[j];try{xhr=new ActiveXObject(name)}catch(undefined){}}}}if(xhr!=null){if(callback!=null){xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200||xhr.status===0){return callback(xhr.responseText)}else{return callback(null)}}};xhr.open("GET",path,true);return xhr.send(null)}else{xhr.open("GET",path,false);xhr.send(null);if(xhr.status===200||xhr.status===0){return xhr.responseText}return null}}else{req=require;fs=req("fs");if(callback!=null){return fs.readFile(path,function(err,data){if(err){return callback(null)}else{return callback(String(data))}})}else{data=fs.readFileSync(path);if(data!=null){return String(data)}return null}}};return Utils}();module.exports=Utils},{"./Pattern":8}],11:[function(require,module,exports){var Dumper,Parser,Utils,Yaml;Parser=require("./Parser");Dumper=require("./Dumper");Utils=require("./Utils");Yaml=function(){function Yaml(){}Yaml.parse=function(input,exceptionOnInvalidType,objectDecoder){if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectDecoder==null){objectDecoder=null}return(new Parser).parse(input,exceptionOnInvalidType,objectDecoder)};Yaml.parseFile=function(path,callback,exceptionOnInvalidType,objectDecoder){var input;if(callback==null){callback=null}if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectDecoder==null){objectDecoder=null}if(callback!=null){return Utils.getStringFromFile(path,function(_this){return function(input){var result;result=null;if(input!=null){result=_this.parse(input,exceptionOnInvalidType,objectDecoder)}callback(result)}}(this))}else{input=Utils.getStringFromFile(path);if(input!=null){return this.parse(input,exceptionOnInvalidType,objectDecoder)}return null}};Yaml.dump=function(input,inline,indent,exceptionOnInvalidType,objectEncoder){var yaml;if(inline==null){inline=2}if(indent==null){indent=4}if(exceptionOnInvalidType==null){exceptionOnInvalidType=false}if(objectEncoder==null){objectEncoder=null}yaml=new Dumper;yaml.indentation=indent;return yaml.dump(input,inline,0,exceptionOnInvalidType,objectEncoder)};Yaml.stringify=function(input,inline,indent,exceptionOnInvalidType,objectEncoder){return this.dump(input,inline,indent,exceptionOnInvalidType,objectEncoder)};Yaml.load=function(path,callback,exceptionOnInvalidType,objectDecoder){return this.parseFile(path,callback,exceptionOnInvalidType,objectDecoder)};return Yaml}();if(typeof window!=="undefined"&&window!==null){window.YAML=Yaml}if(typeof window==="undefined"||window===null){this.YAML=Yaml}module.exports=Yaml},{"./Dumper":1,"./Parser":7,"./Utils":10}]},{},[11]);

// Define an HPE standard style
var HPEStyle = "{font-family: arial; font-size: small}"+
	"body {font: 12px arial, sans-serif; color: #C6C9CA; background-color: black;}"+
	"th, table { font: 12px arial, sans-serif; color: #C6C9CA; background-color: black;}"+
	"h1, {color: #FF8300;}"+
	"h2, h3, h4, h5 {color: #C6C9CA;}"+
	"input, select {border: none; font: 12px arial, sans-serif; color: #01a982; background-color: black;}"+
	".buildButton { background-color: #FF8300; border: none; color: black; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}"+
	".buildButton:hover { background-color: #4CAF50; color: white;}"+
	".helpButton { background-color: #32DAC8; border: none; color: black; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}"+
	".helpButton:hover { background-color: blue; color: white;}"+
	".delButton { background-color: #0D5265; border: none; color: white; text-align: center; text-decoration: none; display: inline-block; border-radius: 2px;}"+
	".delButton:hover { background-color: #FF8300; color: black;}"+
	"a:link, a:visited { text-decoration: none; color: #80746E;}";
// Base 64 encoded logo and icon
var HPEicon="AAABAAEAEBAAAAAAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAAAAAAAAAAAAAAAAAAAAAAAD///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////AYe0AP+ItAD/h7QA/4e0AP+ItAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4i0AP+HtAD/h7QA/4e0AP+ItAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+HtAD/h7QA/4e0AP////8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wGHtAD/h7QA/4e0AP+HtAD/////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8Bh7QA/4i0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4i0AP+HtAD/iLQA/4i0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+ItAD/h7QA/4e0AP+HtAD/iLQA/4e0AP+HtAD/h7QA/4e0AP+HtAD/iLQA/////wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8B////Af///wH///8BAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//w==";
var HPElogo="iVBORw0KGgoAAAANSUhEUgAAAU0AAACBCAYAAABErei/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABo/SURBVHhe7Z0JuFVV+YcXIgpqqDjhVGZqZWamleX0hAaBlg2PkuY8JIQpfzUnxKkcM6KQHMqhIjON1JzIoUwrMzKVnCg0ckYlJUVEAfd/veusb7POZp97z773XOVyf+/zfPfss9bae6+99tm/++019vJkTgghRFMsFz+FEEI0gURTCCEqINEUQogKSDSFEKICEk0hhKiARFMIISog0RRCiApINIUQogISTSGEqIBEUwghKiDRFEKICkg0hRCiAhJNIYSogERTCCEqINEUQogKSDSFEKICEk0hhKiARFMIISog0RRCiApINIUQogISTSGEqIBEUwghKiDRFEKICkg0hRCiAhJNIYSogERTCCEqINEUQogK9PJkcVt0lqyHFGWvXnFDiJ6HRLNVIJgr9nFuhRWce+utGLiM0du/mMx9vXZ9Ek7RQ5FotoJQgv7PAUNddtSeXljmh+BljlVXdr0OOde5qY9KNEWPRaLZCkw0hw9y2YjdnXttGRbN0ROce+AxiabosUg0W4GJ5p5eNEcmornSis4t183b2hYtcu71N2vbiOb/ne/c/TMkmqLHItFsBdYAtM9glx20q3PzvGhS/3fZzc694QWnVzcVTgRz4IDwz8AtWFgTzVHjnXt4pkRT9Fgkmq2g6GnOe8O5Pr1dr2HHLRbU7sq6a7ps0pjaNcnTFEL9NFtKUUf6rVD7RGC6o0HfeA1GT+lWJUQDJJpCCFEBiaYQQlRAoimEEBWQaAohRAUkmkIIUQGJZlcyP3YKp8W5OxrQz1QIkaN+mq0glKD/kw6jpHP7xGtqwtldRwXRuX2dNZw7aKhzb8bO7RpGKXo4Es1WUCaasHLf7iuYBsJJx3aQaAoh0WwJjURzWUOiKYREsyWYaO5vU8O9HoKXORDNQ5kabrpEU/RYJJqtwERz5X4u67/SMjwJcW/Xa/acWv2mRFP0UCSarcKEsycgwRQ9GImmEEJUQP00hRCiAhJNIYSogERTCCEqINEUQogKSDSFEKICEk0hhKiAuhy1kMxmBkrw5Ru3FtNsureLYn7eybwUKSurIm9nfpe2e1dGozJb2vLZXfHlKNFsBfxQ+/Xr51ZaaSX31ltvueWWW87997//DXHpj5V0q6yyiltxxRXDNmnnzJkT4t6JHzV56N+/v1t++eXD90WLFrn//e9/S8UDZg//Rz7yEffmm/VT1JG/xx57rDS8q7D8bLLJJm6FFVYI93j27Nlu1qxZS0V5geVxs802C/eUPL7wwgvBYGnJZ7fGF2Im65z5Ygw2fvx4/5tdzIABA0J4Me3kyZNjiizzopl5oV0i3dtlnHfq1KkxN1nmhb7TeWH/1NqKM0vTpGn5bI8ZM2ZkW2+9dZvHaoXZ8b1QxjNn2VVXXdXl561i5KNv376Z/2cSc5hlEyZMWKry2N1NdZot5JVXXolbNRYuXBi36jHPEp5//vng3b2TvPTSS3HLuRdffDFudQz/jLqJEye6G264wd10003u5JNPzr0fPv2Pzl1xxRXuN7/5jbvlllvcV77ylTyujEbhKXh+f//7393YsWPD92b26Qz2BgHFe740wO8pvY9z586NW6IVSDRFy/n85z/vPve5z7ldd93VDRo0KIbWQND23HNPt/vuu7shQ4a4LbfcMsY0x7x584JopUJvfPvb33bbbbdd/CZE1yDRXApBWNqyRmmMZsMtzj4BT7BIcZ+iGbadejavvvpq+EzTvfbaa3FrcTykaRoxatQot+aaa7o11lgj5PXYY4+NMTXGjBkTPi1vbVmRsjSptUfZPs1aSll80Rqlg3f6zWVZx//uQj2I6AT2Y8XTsVdEWHXVVcPrWypEpL388svdgQceGL4/99xzbqONNgoNGqSzY332s591++67b4i777773D333OOuvPLKEAcf+9jHgsf2xhtvBO9r/PjxYRve9773uREjRoTqgbvvvtvdeOONIRz233//vJFgypQp7s4773S33nqrGzx4cIh/9NFH3eabb57n2fJD49Vhhx3mhg0bFs5DfngFnzZtWogHvMctttjCHXXUUUHYgMaaH/3oR27llVcOjV4c98QTTwwNYfCHP/whnL9v377uzDPPzMsB7Nz2CaNHj3YTJkyoK6u//vWv7hOf+ETYfuaZZ9wGG2wQ4rlOXv+5HsqRuIceeiiU4/Tp00P64rkADxiPdfvttw+i/sADD7gLL7wwf+X95z//GY4NXBtlDVzD0UcfHa6td+/e4d6PGzcuiNj6668fvO9PfepTYV+O+/DDD7vrrrvO3XXXXWF/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";

var localStyle = document.createElement('style');
localStyle.innerHTML = HPEStyle;
document.head.appendChild(localStyle)
var localIcon = document.createElement('link');
localIcon.href = "data:image/x-icon;base64,"+HPEicon;
localIcon.rel="icon";
localIcon.type="image/x-icon";
document.head.appendChild(localIcon)
document.getElementById("HPElogo").src="data:image/png;base64,"+HPElogo;

// Display version history in the user output area
function versionHistory(){userOutput(`Version history:
2021-03-04 0.91 UPF router support; automatic link between UPF and the OCP hosting the NRF if any; more UPF attributes in Misc section; network interfaces naming more flexible to address ubuntu targets 
2021-02-12 0.90 OpenShift 4.x deployment: support preallocated floating IPs for API and APP endpoints
2021-02-03 0.89 OpenShift 4.x deployment: export APP and API floating IPs for UPF automatic link; UPF: make mcc and mnc variables in Misc section
  up to 5 distinct flavors; headless mode in logging.
2021-01-26 0.88 OpenShift 4.x deployment: support specific flavor for Worker nodes, deploy resources on all OCP instances, not just the last one; logs management cleanup. 
2021-01-12 0.87 OpenShift 3.x deployment: retrieve kubeconfig from /etc/origin/master/admin.kubeconfig and deploy resources directly (except if images are to be retrieved from insecure registries) 
2021-01-06 0.86 UPF configuration by injecting /fdsk/startup-config network configuration; OpenShift 4 deployment: #volumes and security group attributes, flavor hw attributes checking 
2020-12-14 0.85 OpenStack deployments: support up to 5 private networks, enrich the Heat output section with a ports attribute listing all IP addresses;
  New section OperatorSources to define additional operators catalog sources.
2020-12-04 0.84 OpenShiftNodes section: deploy OpenShift 4.x clusters on OpenStack
2020-11-13 0.83 Build option: hpe5gApp kubernetes native application for deployment with the hpe5gApp operator; ignite-operator built from the operator-sdk in helm adapter mode. 
2020-09-29 0.82	OpenStack deployments: disable root certificate authority checking, not available everywhere; support storage on volumes using Misc.openstack_volume_size
  Support etcd operator from the default catalog
2020-09-25 0.81	OpenShift 3.11 deployment: define the ansible extra variable openshift_epel_rpm_url=epel-release defining the epel package, to override the default failing value
	Include OpenShift templates in the OpenStack template only if useful  
2020-09-16 0.80	new section Builds defining both Jenking pipelines and custom application builds; new section CustomApps to instantiate such applications from git repositories.
2020-08-13 0.78	Move to UDSF 1.8 in the default catalog; include the deployer version in the OpenShift project description; 
	default flavor to standard, not small; save flavor in Nodes section; restrict insecure registries to full stack deployment. 
2020-08-10 0.77	Support template import in the catalog as yaml files; remove dependency on logger not supported in basic docker containers; robustness on missing sections in imported catalog. 
2020-08-03 0.76	Adding redis-nopwd and cert-manager in default catalog; robustness on admin and dependencies sections free catalog and error reporting on REST API
2020-07-28 0.75	Support OpenStack instances deployment alone without OpenShift, with specific image and flavor; support tester git clone with deploy key; 
	build installer for OpenStack resources as well; support subsequent REST deployments on the same OpenShift project  	
2020-07-10 0.74	Dependencies management: support aliases, eg influxdb can be implemented either as influxdb or telegraf or telegraf-chart; revert dependency to telegraf towards influxdb
	Catalog: support import of incremental catalog to extend the current catalog (GUI only)
	Robustness and diagnostic improvments
	Default catalog: namespaced operators grafana-operator and prometheus-operator with self subscription and installation 
2020-06-24 0.73	Helm based deployments: optional version and extra options attributes; Operators deployment: optional replicas attribute; 
	Add telegraf in the default catalog as IndirectService and HelmChart; use it as influxdb resource for all Network Functions  
2020-06-18 0.72	nudsf and nudr OpenShift templates refresh. Markdown doc cosmetic fixes.
2020-06-12 0.71	Json session format: move to a list of attribute:value {a:x, b:y, ...} instead of a table of the same [{a:x},{b:y},...]
	Add a Build Doc button compiling the Help text of a selection of sections in a markdown document 
2020-06-11 0.70	Allow multiple instances of the same type in one project: add a new optional attribute in resources, Dependencies, to resolve ambiguity in dependencies
	More nudm stuff in the default catalog: nudm-li-tf, nudm-ueau, nudm-uecm
2020-06-09 0.69	Undeploy feature for interactive and headless modes; improve idempotence for udsf, udr, udm
2020-06-04 0.68	Remove admin privilege requirements when possible (nudsf-dr sde-udr-nudr-dr sde-udr-nudr-prov hpe-nnrf-reg-agent udm prometheus influxdb ignite)
2020-06-02 0.67	headless mode for RESTful invocation, including json dump and import; file type: init properly during import
	Misc section: headless and default project variables, with override capability from a headless invocation
	Manage admin privileges requirement for some types by warning the user at build and deployment time; make this information part of the catalog
	In the built installer: cleanup tempoary files if successful, and skip security relaxation if system:admin is not loggable
2020-05-07 0.65	Disable shell parameters expansion in templates deployed over REST API to support pods configuration files using shell parameters
2020-05-06 0.64	Full stack deployment: update the ansible controller setup procedure to CenOS8/Python3
	New section 'Clusters' defining on which OpenShift clusters the resources are to be deployed over REST API
	Default catalog cleanup of privileged resources like ClusterRole and ClusterRoleBinding, demoted as RoleBinding to 'view' default role for REST API deployment
2020-04-22 0.63	support optional persistent storage for ignite
2020-04-21 0.62	5G catalog management: offer display/import/export catalog of deployable resources in a dedicated fieldset.
	Offer nudm-sdm and nudm-notify deployment from native OpenShift templates.
2020-04-15 0.61	Welcome message cleanup; new section for Helm charts deployments; elasticSearch operator added
	deployment script logs cleanup; colors update for HPE compliance; group common actions in fieldsets.
2020-04-07 0.60	redis and influxdb deployment; nudm network function preview; start with an empty set of resources but welcome and help display
2020-03-31 0.59	add Operators section to deploy services from available operators.
2020-03-30 0.58	split the NetworkFunctions section in three categories: NetworkFunctions, DirectServices, IndirectServices
2020-03-25 0.57	add fluentd and grafana services.
2020-03-23 0.56	add prometheus services; move labels from app to name for service exposure
2020-03-18 0.55	define storage size per network function with target volume; ElasticSearch with storage; ImageStreams target directly secure registries; fix cinder volume Id resolution.
2020-03-12 0.54	udr and udr-prov deployment with traffic from tester. Jenkins pipelines deployment. ElasticSearch preview. Default images updated.
2020-03-06 0.53	In addition to full stack deployment, support network functions only deployment, with idempotence. More nudr stuff (still preview)
2020-03-06 0.52	CMS5G Core Stack automated deployer moved to https://github.hpe.com/CMS-5GCS/automated-deployer.git; manage multiple openshift versions (3.9, 3.11)
	nudr preview (missing dependencies)
2020-02-25 0.5	CMS5G Core Stack automated deployer hosted on github.hpe.com:cms5g/Carrier-Stack; Switch to OpenShift v3.11 with automated git clone
	CMS5G Core Stack tester automated deployment; OpenShift internal registry population and projects creation automated. 
2020-01-28 0.4	Add the NetworkFunctions section to deploy ignite and nudsf-dr, supporting multiple OpenShift projects
2020-01-10 0.3	Fix the generated ansible inventory by removing labels on non master nodes; Help button beside the Build button delivering the user guide.
2020-01-09 0.2	Cinder and OpenShift volumes management, output in a dedicated section ready for OpenShift template creation
2020-01-06 0.1	Very first draft`
	);
}

// Display information to the user in the userArea frame
// Keep a copy of the last displayed data in a global variable, accessible to an headless application, free of any HTML rendering
// (typically special characters escaping)
var rawUserOutput;
function userOutput(aText){
	document.getElementById("userArea").innerHTML=aText;
	document.getElementById("endOfUserArea").click();
	rawUserOutput=aText;
}

// Class implementing a unique role
var uniqueRole = function(aName){
	this.v = false;
	this.name = aName;
}
uniqueRole.prototype.init = function(){this.v = false;}
uniqueRole.prototype.v = this.v;
// Set if y, unless already true; in that case, return a duplication alert for role
uniqueRole.prototype.setIfNotOrAlert = function(y){
	if(y){
		if(this.v)return "\nNodes section: role " + this.name + " is duplicated."
		this.v = true;
	}
	return "";
}

// Class implementing a file which content is loaded from the user file system (content)
// to be dropped on the VNF at a specified path (path)
// Interface:
// - a constructor 
// - methods to load, display and clear the content.
// - public members: content, contentType and path
// - public methods: 
//   . isDefined to check if the element already exists in the DOM
//   . getDomElement to retrieve the HTML code exposing and controling the element
// Constructor: 
// - name of the variable instantiated: required to link the user's events to the object's methods
// - label describing the purpose of this file, displayed besides the 'browse' button
// - (optional) function to call upon loading, defaults to displaying the loaded content
// Usage example from a section
// - instantiate the object; parameter: the name of the HTML input button Id to allow clearance  
// 	var uspmAuxDescInput = new userLoadedFile("uspmAuxDescInput", "Import USPM auxiliary descriptor..."); 
// - pass this variable while constructing a section to get the file controls browse/view/clear
// new vnfResource("Misc", [...], [uspmAuxDescInput, ...]);
// - use the content: 
//	if(aUserFile.isDefined()){result += aUserFile.content;}else{ manage error...} 
// Usage example out of a section, directly in the DOM: controls to import a session
// - instantiate the object: parameters: name of the object, label, associated action: importSession
//   var importedSession = new userLoadedFile("importedSession", "Import...", importSession);
// - insert the HTML behind the 'controlArea' element unless it exists already
//   if(!importedSession.isDefined())document.getElementById("controlArea").appendChild(importedSession.getDomElement());
	
var userLoadedFile = function(aVarName, aLabel, anAction){
	this.label = aLabel;
	this.var = aVarName;
	this.inputId = aVarName+"_inputId";
	this.content = undefined;
	this.contentType = undefined;
	this.path = undefined;
	this.action = this.view;
	if(anAction != undefined)this.action = anAction;
	this.isDefined = function(){return document.getElementById(this.inputId) != undefined;};
	
	this.getDomElement = function(){
		var trFile = document.createElement('TR');
		var tdLabel = document.createElement('TD');
		tdLabel.setAttribute("valign", "top");
		tdLabel.appendChild(document.createTextNode(this.label));
		if(this.label!=undefined)trFile.appendChild(tdLabel);
		
		var tdBrowse = document.createElement('TD');
		tdBrowse.setAttribute("valign", "top");
		var browseButton = document.createElement('INPUT');
		browseButton.type="file";
		browseButton.id=this.inputId;
		browseButton.className="buildButton";
		//browseButton.value="Import...";
		browseButton.setAttribute("onchange", this.var + ".load(event)");
		tdBrowse.appendChild(browseButton);
		trFile.appendChild(tdBrowse);
		
		var tdView = document.createElement('TD');
		tdView.setAttribute("valign", "top");
		var viewButton = document.createElement('INPUT');
		viewButton.type="button";
		viewButton.className="helpButton";
		viewButton.value="Review";
		viewButton.setAttribute("onClick", this.var + ".view(event)");
		tdView.appendChild(viewButton);
		trFile.appendChild(tdView);
		
		var tdClear = document.createElement('TD');
		tdClear.setAttribute("valign", "top");
		var clearButton = document.createElement('INPUT');
		clearButton.type="button";
		clearButton.className="delButton";
		clearButton.value="Clear";
		clearButton.setAttribute("onClick", this.var + ".clear(event)");
		tdClear.appendChild(clearButton);
		trFile.appendChild(tdClear);
		return trFile; 
	}
}
userLoadedFile.prototype.load = function(event){
	// Gratitude to https://stackoverflow.com/questions/27254735/filereader-onload-with-result-and-parameter
	var file = event.target.files[0];
	this.contentType = file.name.split('.').pop();
	var reader = new FileReader();
    reader.onload = ( function(target){ return function(e){
    	// Store the file content in the original object
    	target.content = this.result;
    	// Action 
    	target.action();
    	}
    })(this);
    reader.readAsText(file);
}
userLoadedFile.prototype.clear = function(){
	this.content=undefined; 
	userOutput(''); 
	if(this.inputId != undefined)document.getElementById(this.inputId).value= null;
}
userLoadedFile.prototype.view = function(){
	userOutput(this.content);
}
// Ensure that both the content and the path are defined
userLoadedFile.prototype.isDefined = function(){
	return this.content != undefined && this.content != '' && this.path != undefined && this.path != '';
}
// Ensure that neither the content nor the path are defined
userLoadedFile.prototype.isUndefined = function(){
	return (this.content == undefined || this.content == '') && (this.path == undefined || this.path == '');
}
// Check that both path and content are either defined or undefined
userLoadedFile.prototype.isConsistent = function(){
	return this.isDefined() || this.isUndefined();
}

// Class implementing a Heat node: a short name, and a flavor, plus a boolean identifying a EMS role receiving OpenShift templates defining the network functions
// Plus a list of network interfaces identified by the integer behind the 'eth' prefix, -1 for the external network used to connect floating IPs
// Plus 2 booleans: isVIP if this node is a VIP and hasVIP if this node hosts VIP(s)
// And a table holding all IP addresses for this node, for infrastructure not allocating dynamically IP addresses (vmware, static)
var heatPublicInterface = -1;   
var cloudNode = function(aName, aFQDN){
	this.flavor = 'flavorStandard';
	this.name = aName;
	this.fqdn = aFQDN;
	this.interfaces = new Array();
	this.isEms = false;
	this.isVIP = false;
	this.hasVIP = false;
	this.ipAddresses = undefined;
	this.domain = aFQDN.substr(aFQDN.indexOf('.')+1);
}

// Class implementing a Heat volume: name, size and description
var cloudVolume = function(aName, aSize, aDescription){
	this.name=aName;
	this.size=aSize;
	this.description=aDescription;
}

// Class implementing a openshift volume: name, size, type, access and cinder volume
var openshiftVolume = function(aName, aSize, aType, anAccess, aReclaim, aCinder){
	this.name=aName;
	this.size=aSize;
	this.type=aType;
	this.access=anAccess;
	this.reclaim=aReclaim;
	this.cinder=aCinder;
}

// Class implementing a port opened as a value, a protocol and a description
var vnfPort = function(aPort, aProtocol, aDescription){
	this.port = aPort;
	this.protocol = 'UDP';
	if(aProtocol != "")this.protocol = aProtocol;
	this.description = aDescription;
}
// List of exposed ports in the whole VNF
var vnfPorts = new Array();

var consistency = new Object;

consistency.initSingle = function (){

}
consistency.init = function (){
	consistency.initSingle();
}

consistency.check = function (){
	// Cross sections consistency checks, cannot be executed locally to the sections
	var warnings = "";
	if(!Networks.search('network','MGMT'))warnings+="\nNetworks section: management interface is mandatory";
	return warnings;
}

// Class defining a VNF resource named 'title' as an extensible table with a set of 'columns'
// Each column needs to define a 
// - name
// - type (optional)
//		. bool to define a check box
//		. choice to define a drop down menu
//			for that type, a 'choices' attribute is expected to define the list of choices
//		. text (default)
// - value (optional: the default value)
// Two methods linked to buttons at the bottom of the table are to be provided for each VNF resource:
// - build: returns the Descriptor section for this resource as a string; if any issue prevents this build, the check variable should return the error messages 
// - help: provides hints for this resource as a text string
// Convenient methods are offered for a resource:
// search(column, value): to search for a text value in a given column
// display(column, value): set the display style attribute for a given column, where 'value' typically is 'none' to hide a column, and id one by default
// count(column, value): count the number of occurrences of a specific value in a specific column
// isEmpty(): check if the table is empty
// A optional parameter user file list, allowing the resource to load a set of user file, as a list of objects instantiated from userLoadedFile class
 
// Cell width control
var cellWidth="85px";
var boolCellWidth="15px";
var choiceCellWidth="200px";

// Ensure unicity of ids for all the dynamic delete buttons by incrementing an integer at each button creation
// This value has to be recorded in the DOM so that when starting from an existing document, the new ids will not clash with the existing ones
// Default to 1 if nothing valid is recorded in the DOM
var _uniqueInputId=1;
var _uniqueInputIdDOM=document.getElementById("_uniqueInputId");
if(_uniqueInputIdDOM != undefined){
	var candidate = Number(_uniqueInputIdDOM.value);
	if(!isNaN(candidate))_uniqueInputId=candidate;
}

// List of VNF resources for applying actions to multiples resources
vnfResources = new Array();

var vnfResource = function(title, columns, userFiles){
	this.result = "\nWARNING: " + title + " section is not defined yet: please apply and rebuild\n";
	var self = this;
	
	var table = document.createElement('TABLE');
	table.border='1';
	table.id=title;
	
	var tableCaption = document.createElement('CAPTION');
	tableCaption.appendChild(document.createTextNode(title));

	var tableBody = document.createElement('TBODY');
	table.appendChild(tableBody);
	
	var tr = document.createElement('TR');
	tableBody.appendChild(tr);
	var td = document.createElement('TH');
	var addButton = document.createElement('INPUT');
	addButton.type="button";
	addButton.value="Add";
	addButton.setAttribute("onClick", title + ".add();");
	td.appendChild(addButton);
	tr.appendChild(td);

	// Create all columns in this table; set a class concatenating the table and column names for further search
	// Build an array of the names for easy search with name key  when calling the build function
	// The first cell is used for the delete button, skip it
	var iName = new Array(columns.length + 1);
	for (i=0; i<columns.length; i++){
		var td = document.createElement('TH');
		td.className = title + columns[i].name;
		td.appendChild(document.createTextNode(columns[i].name));
		iName[i+1] = columns[i].name;
		var localWidth = cellWidth;
		switch(columns[i].type){
			case 'bool':
				localWidth = boolCellWidth;
				break;
			case 'choice':
				localWidth = choiceCellWidth;
				break;
		}
		if(columns[i].width != undefined)localWidth = columns[i].width;
		td.style.width = localWidth;
		tr.appendChild(td);
	}

	// Attach useful variables to this current object for further asynchronous reference
	self.title = title;
	self.nameIndexes = iName;
	self.columns = columns;
	self.check = "";
	
	// For each user file, add a set of buttons to load, view and clear the associated text. 
	var tableFiles = document.createElement('TABLE');
	if(userFiles != undefined)userFiles.forEach(function(aFile){
		tableFiles.appendChild(aFile.getDomElement());
	});
	
	// Add a button to trigger the Descriptor build for this section
	var buildButton = document.createElement('INPUT');
	buildButton.type="button";
	buildButton.value="Apply";
	buildButton.className="buildButton";
	buildButton.setAttribute("onClick", "userOutput(" + title + ".build());");
	
	// Add a button to show help 
	var helpButton = document.createElement('INPUT');
	helpButton.type="button";
	helpButton.value="Help";
	helpButton.padding="5px";
	helpButton.className = "helpButton";
	helpButton.setAttribute("onClick", "userOutput(" + title + ".help());");
	
	// Append the new elements to the DOM behind the insertion point, if they dot not exist already
	if(document.getElementById(title) == undefined){
		var myTableDiv = document.getElementById("tableInsertionPoint");
		// Create an anchor for quick reference to this table
		var anchorTable = document.createElement('A');
		anchorTable.setAttribute("name", title);
		// Add a link to this table just before the user result area: a click on this link displays the related section 
		var linkToTable = document.createElement('A');
		linkToTable.setAttribute("href", "#"+title);
		linkToTable.innerHTML=" / "+title;
		linkToTable.setAttribute("onClick", this.title + ".display(true);");
		var userArea = document.getElementById("endOfUserArea");
		userArea.appendChild(linkToTable);
		var linkToTableSummary = linkToTable.cloneNode(true);
		var summary = document.getElementById("summary");
		summary.appendChild(linkToTableSummary);
		var headerTable = document.createElement('H2');
		headerTable.innerHTML=title;

		anchorTable.appendChild(headerTable);
		// Create a specific div for this section, easing management, hide, show, etc.
		var thisTableDiv = document.createElement('div');
		thisTableDiv.id = title+'Section';
		thisTableDiv.appendChild(anchorTable);
		thisTableDiv.appendChild(table);
		thisTableDiv.appendChild(tableFiles);
		thisTableDiv.appendChild(buildButton);
		thisTableDiv.appendChild(helpButton);
		myTableDiv.appendChild(thisTableDiv);
	}
	
	// update the list of VNF resources for actions applying to all elements, like build, import...
	vnfResources.push(this);
};
// Default help 
vnfResource.prototype.help = function(){
	return "No help available";
}
// Default build
vnfResource.prototype.build = function(){
	return "No build instructions defined";
}
// Delete the current line in the table
vnfResource.prototype.delete = function(inputId){
	var table = document.getElementById(this.title);
	var theInput = document.getElementById(inputId);
	var index = theInput.parentNode.parentNode.rowIndex;
	table.deleteRow(index);	
}
// Add a new line in the table
// Optional values can be provided as a table of dictionaries of column / value like [{column:"columnA", value:"a"}, {column:"columnB", value:"b"}, {column:"columnD", value:"d"}, ...]
// For 'choice' types, the init value is checked against the valide set: if not valid, an error message is returned.
// Otherwise, undefined is returned
vnfResource.prototype.add = function(values){
	var table = document.getElementById(this.title);
	var columns = this.columns;
	var result="";
	
	if(values){
		// Check for unknown columns
		var section=this.title;
		var validColumns=columns.map(function(c){return c.name;})
		values.forEach(function(v){if(validColumns.indexOf(v.column) < 0)result+="Unknown attribute "+v.column+" in section "+section+" ignored.\n\tExpecting one of: "+validColumns.join()+"\n"});
	}
 
	var rowCount = table.rows.length;
	var row = table.insertRow(rowCount);
	var delButton = document.createElement('INPUT');
	delButton.type="button";
	delButton.value="Del";
	delButton.className="delButton";
	delButton.id="delButton"+(_uniqueInputId++);
	_uniqueInputIdDOM.setAttribute("value", _uniqueInputId);
	delButton.setAttribute("onClick", this.title + ".delete('"+delButton.id+"');");
	var cell = row.insertCell(0);
	cell.appendChild(delButton);
	for (i=0; i<columns.length; i++){
		var cell = row.insertCell(i+1);
		cell.className = this.title + columns[i].name;
		// Initial value: first element of values with a matching column name
		var init=undefined;
		if(values){
			var initValues = values.filter(function(e){return e.column == columns[i].name;});
			if(initValues.length > 0)init=initValues[0].value;
		}
		switch(columns[i].type){
			case 'bool':
				var checkCell = document.createElement('INPUT');
				checkCell.className = this.title + columns[i].name;
				checkCell.type = "checkbox";
				cell.style.width = checkCell.style.width = boolCellWidth;
				if(init)checkCell.setAttribute("checked", "checked");
				cell.appendChild(checkCell);
				break;
			case 'choice':
				var _choices=columns[i].choices;
				// if the list of choices is not a function, assume an array and return this array through a function
				if(typeof _choices != "function")_choices=function(){return columns[i].choices;};
				var selectCell = document.createElement('SELECT');
				selectCell.className = this.title + columns[i].name;
				var localWidth = choiceCellWidth;
				if(columns[i].width != undefined)localWidth = columns[i].width;
				cell.style.width = selectCell.style.width = localWidth;
				for (j=0; j<_choices().length; j++){
					var option = document.createElement('OPTION');
					option.value = _choices()[j];
					option.innerHTML = option.value;
					selectCell.appendChild(option);
				}
				// if the default value is not a null string, avoid adding always the same selection:
				// set a default value according to the row in the table, instead of the first choice
				if(_choices()[0] != "")selectCell.value = _choices()[rowCount-1];
				if(init != undefined){
					// Make sure the init value is a valid choice
					if(_choices().indexOf(init) < 0)result+="Unknown selection "+init+" for attribute "+columns[i].name+" in section "+this.title+"\n\tExpecting one of: "+_choices().join()+"\n";
					selectCell.value = init;
				}
				cell.appendChild(selectCell);
				break;
			case 'file':
				// userLoadedFile needs a javascript variable: build it dynamically as the section name, the column name and the delete button id which is unique
				var dynJSvar=this.title + "_" + columns[i].name + "_" + delButton.id;
				var tableFiles = document.createElement('TABLE');
				tableFiles.className=this.title + columns[i].name+" userLoadedFile";
				tableFiles.id=dynJSvar;
				window[dynJSvar] = new userLoadedFile(dynJSvar);
				tableFiles.appendChild(window[dynJSvar].getDomElement());
				window[dynJSvar].content=init;
				cell.appendChild(tableFiles);
				break;
			default:
				var inputCell = document.createElement('INPUT');
				inputCell.className = this.title + columns[i].name;
				var localWidth = cellWidth;
				if(columns[i].width != undefined)localWidth = columns[i].width;
				cell.style.width = inputCell.style.width = localWidth;
				inputCell.type = "text";
				if(columns[i].value != undefined)inputCell.value = columns[i].value;
				if(init != undefined)inputCell.value = init;
				cell.appendChild(inputCell);
				break;
		}
	}
	// hide unused columns if the method is available
	if(this['hideUnused'] != undefined)this.hideUnused();
	return result;
}

// Import from a provided document
// Returns a text string summarizing the import
vnfResource.prototype.import = function(importedDocument){
	var summary = "";
	var table = document.getElementById(this.title);
	var importedTable = importedDocument.getElementById(this.title);
	if(importedTable == null)return summary;
	
	var rowCount = table.rows.length;
	var importedRowCount = importedTable.rows.length;
	var columns = this.columns;
	
	for(var i=1; i < importedRowCount; i++, rowCount++){
		if(summary == "")summary = "\n" + this.title;
		summary += "\n";
		
		// one more line
		this.add();
		
		for (j=0; j<columns.length; j++){
			// Source: 2 cells expected: one for the td element, the second for the input element
			var source = Array.prototype.slice.call(importedTable.rows[i].getElementsByClassName(this.title + columns[j].name));
			// Otherwise, this column is missing in the source document, continue
			if(source.length < 2)continue;
			
			// Destination: j+1 as the first cell is dedicated to the delete button
			var destination=table.rows[rowCount].cells[j+1].childNodes[0];
			switch(columns[j].type){
				case 'bool':
					destination.removeAttribute("checked");
					if(source[1].checked){
						destination.setAttribute("checked", "checked");
					}
					break;
				case 'choice':
					var selectedOption = source[1].selectedIndex;
					var selectedValue = source[1].options[selectedOption].value;
					if(selectedOption != -1){
						// looping over the destination options to select the selected value
						for (selectedOption=destination.options.length;selectedOption--;) { 
						  if(destination.options[selectedOption].value == selectedValue)
						  	break;
						}
						destination.options.selectedIndex=selectedOption;
						if(selectedOption != -1){
							destination.options[selectedOption].setAttribute("selected", "selected");
							if(destination.options[selectedOption].value != "")summary += "\t" + destination.options[selectedOption].value;
						}
					}
					break;
				case 'file':
					// userLoadedFile has a javascript variable associated, which name is the id, built as the section name, the column name and the delete button id which is unique: 
					var dynJSvar=source[1].id;
					window[dynJSvar] = new userLoadedFile(dynJSvar);
					summary += "\tPlease load a file to populate "+columns[j].name+" at line "+i+" in section "+this.title;
					break;
				default:
					destination.value = source[1].value;
					destination.removeAttribute("value");
					destination.setAttribute("value", source[1].value);
					if(destination.value != "")summary += "\t" + destination.value;
					break;
			}	 
		}
	}
	return summary;
}

// Returns the current object as a table of rows, each row being a table of attribute:value
vnfResource.prototype.dump = function(){
	var result = new Array();
	var table = document.getElementById(this.title);
	
	var rowCount = table.rows.length;
	var columns = this.columns;
	
	for(var i=1; i < rowCount; i++){
		// one more line
		var line = new Object;
		
		for (j=0; j<columns.length; j++){
			var val;
			// Source: 2 cells expected: one for the td element, the second for the input element
			var source = Array.prototype.slice.call(table.rows[i].getElementsByClassName(this.title + columns[j].name));
			// Otherwise, this column is missing in the source document, continue
			if(source.length < 2)continue;
			
			switch(columns[j].type){
				case 'bool': val = source[1].checked; break;
				case 'choice':
					var selectedOption = source[1].selectedIndex;
					val = source[1].options[selectedOption].value;
					break;
				case 'file':
					var delButton=table.rows[i].getElementsByClassName("delButton")[0];
					var dynJSvar=this.title + "_" + columns[j].name + "_" + delButton.id;
					val=window[dynJSvar].content;
					break;
				default:
					val = source[1].value;
					break;
			}
			if(val)line[columns[j].name]=val;
		}
		result.push(line);
	}
	return result;
}

// Search for a specific value in a specific column
vnfResource.prototype.search = function(column, value){
	var table = document.getElementById(this.title);

	// Search for the column by class name
	var cells = Array.prototype.slice.call( table.getElementsByClassName(this.title + column) );
	return cells.some(function(e,i){
		var boolValue = "___this_should_never_match___";
		var textValue = "___this_should_never_match___";
		if(e.value != undefined)textValue=e.value.valueOf();
		// check box case
		if(e.checked != undefined)boolValue=e.checked.toString();
		var refValue = this.valueOf();
		return boolValue === refValue || textValue === refValue;
		}, 
		value);	// this parameter is passed as this to the function
}

// Count the number of occurrences of a specific value in a specific column
//  If the value is undefined or an empty string, return the count of unique values in this column
vnfResource.prototype.count = function(column, value){
	var table = document.getElementById(this.title);
	if(value == undefined)value = new String("");

	// Search for the column by class name
	var cells = Array.prototype.slice.call( table.getElementsByClassName(this.title + column));
	// Retain values
	var values = cells.map(function(e,i){
		if(e.value != undefined){
			return String(e.value.valueOf());
		} else if(e.checked != undefined) {
			// check box case
			return String(e.checked.toString());
		}
		return String("");
	});
	var filtered = values.filter(function(e,i,t){
		// where e: element in the table, i: index in the table, t: table
		var b = this.valueOf();
		if(b == ""){
			// counting the number of unique occurrences
			// ignore empty items
			if(e == "")return false;
			// Gratitude to https://stackoverflow.com/questions/9229645/remove-duplicates-from-javascript-array
			var firstOccurence = t.indexOf(e);
			return  firstOccurence === i;
		}
		else
			return e === b;
		}, 
		value);	// this parameter is passed as this to the function
		
	return filtered.length;
}
// Hide or show a specific column, or the full section if no column specified
vnfResource.prototype.display = function(column, display){
	var table = document.getElementById(this.title);
	var section = document.getElementById(this.title+'Section');
	if(display == undefined){
		// The first parameter drives the visibility of the section as a boolean
		section.style.display = column ? '' : 'none';
	}else{
		// Search for the column by class name
		var cells = Array.prototype.slice.call( table.getElementsByClassName(this.title + column) );
		cells.forEach(function(e,i){e.style.display = display ? '' : 'none';});
	}
}

// Check if the table is empty, ie with no cell
vnfResource.prototype.isEmpty = function(){
	var table = document.getElementById(this.title);

	// Search for any cell in the table
	var cells = Array.prototype.slice.call( table.getElementsByTagName('td') );
	
	return cells.length == 0;
}

// Retrieve from the 'row' the value of an input field named 'column' in the list of columns'names 'nameIndexes' 
// Set the attribute of this element accordingly so that the DOM contains it for further saving
vnfResource.prototype.getAndSetValue = function(row, nameIndexes, column, defaultValue, promptText){
	if(nameIndexes.indexOf(column) < 0)return '';
	var elem=row.cells[nameIndexes.indexOf(column)].childNodes[0];
	var x=elem.value;
	if(x == "" && defaultValue != undefined && defaultValue != ""){
		if(promptText == undefined)promptText = this.title + " section: " + column + " cannot be blank.";
		elem.value = x = Misc.getValue('headless') ? defaultValue : prompt(promptText, defaultValue);
	}
	elem.removeAttribute("value");
	elem.setAttribute("value", x);
	return x;
}
vnfResource.prototype.getAndSetChecked = function(row, nameIndexes, column){
	if(nameIndexes.indexOf(column) < 0)return '';
	var elem=row.cells[nameIndexes.indexOf(column)].childNodes[0];
	var x=elem.checked;
	elem.removeAttribute("checked");
	if(x){
		elem.setAttribute("checked", "checked");
	}
	return x;
}
vnfResource.prototype.getAndSetSelection = function(row, nameIndexes, column, defaultSelection){
	if(nameIndexes.indexOf(column) < 0)return '';
	var elem=row.cells[nameIndexes.indexOf(column)].childNodes[0];
	var selectedOption=elem.options.selectedIndex;
	if(selectedOption == -1 && defaultSelection != undefined){
		elem.options.selectedIndex=selectedOption=defaultSelection;
	}
	// Remove all existing selected attributes
	for (var i=elem.options.length;i--;) { // looping over the options
	  elem.options[i].removeAttribute("selected");
	}
	var s = elem.options[selectedOption];
	if(s != undefined)s.setAttribute("selected", "selected");
	var x=elem.value;
	return x;
}

// ==================
// Network interfaces
// ==================
var Networks = new vnfResource("Networks", [
	{name:'network', type:'choice', width: '80px', choices:['MGMT', 'PUBLIC', 'DATA1','DATA2','DATA3','DATA4']}, 
	{name:'interface', type:'text', width: '80px'}, 
	{name:'mask', type:'text', width: '120px', value:'255.255.255.224'}
  ]
	);
	
Networks.help = function(){
	return `Network interfaces names and associated masks and resources 
- network:
    - MGMT is mandatory: all nodes should be connected to the MGMT interface
    - PUBLIC: optional external IP address of nodes visible through an address translation (mandatory for OpenStack nodes)
    - DATA1-4: optional private networks
- interface: name of the network interface on the target, consisting in a common root text and a positif integer, typically eth1, eth2, etc. or ens3, ens4, ens5...
  All interfaces must have a common root name, typically mixing eth and ens is not supported.
- mask: Netmasks should be consistent across networks    
  The first netmask in the table sets the network width for all networks.     
  This width defines the maximum number of nodes and networks; it should be in the range 0 to 8, ie:    
    - from mask 255.255.255.0: width: 8, 1 network, 256 nodes
    - to mask 255.255.255.255: width: 1, 256 networks, 1 node
    - recommended: 255.255.255.224: width: 5, 8 networks, 32 nodes
`
}
// Implementation notes:
// Networks are stored in the Networks.heatNetworks table indexed by the network name, as a list of integers which is the numeric part of the interface name
// This integer is used to order the networks instanciation in the infrastructure to ensure that the user naming matches the actual naming on the targets
// Typically, networks are to be created as eth0, eth1, eth2, eth3 order to make sure that the interfaces are named accordingly on the targets.
// Conversely, if eth3 is created first, it will be assigned the name eth0 on the target.  
// The min and max interface number are available in heatMinNetwork and heatMaxNetwork respectively.
// Networks are associated with a nick name in the getNickName function: this nick name is used to name the networks and ports in the infrastructure.
// The associated interface names are stored in the Networks.devices table indexed by the network name
// The PUBLIC interface is a placeholder for setting FIPs on OpenStack; its associated interface number is -1 (heatPublicInterface)
// Example:
// MGMT on eth0, DATA1 on eth1
// Networks.heatNetworks['MGMT']=0  Networks.heatNetworks['DATA1']=1 Networks.heatNetworks['PUBLIC']=-1
// Networks.devices['MGMT']='eth0'  Networks.devices['DATA1']='eth1'
Networks.getNickname = function(iNetwork){
  var nickname='';
  if(Networks.heatNetworks['MGMT'] == iNetwork) nickname="mgmt";
  if(Networks.heatNetworks['DATA1'] == iNetwork) nickname="data1";
  if(Networks.heatNetworks['DATA2'] == iNetwork) nickname="data2";
  if(Networks.heatNetworks['DATA3'] == iNetwork) nickname="data3";
  if(Networks.heatNetworks['DATA4'] == iNetwork) nickname="data4";
  return nickname;  
}
        
Networks.build = function(target, engine){
	var nameIndexes = Networks.nameIndexes;
	var result = '\n';
	Networks.check = "";
	var table = document.getElementById('Networks');
	var rowCount = table.rows.length;
	Networks.heatNetworks = new Array();
	Networks.devices = new Array();
	Networks.heatMaxNetwork = 0;
  Networks.heatMinNetwork = 256;
	var networkCount = Number(Networks.count('interface'));
	if(target == 'openstack')networkCount--; // For openstack target, do not count the public interface in the quota, it is a 'pseudo interface', not actually instantiated
	Networks.heatWidth = undefined;
  Networks.prefix=undefined;
	
	if(Networks.count('network', 'MGMT') != 1)Networks.check += "\nNetworks: one and only one MGMT is required";
	Networks.check += checkDependency(target == 'openstack', [Networks.count('network', 'PUBLIC') > 0 ],  "Networks: missing PUBLIC pseudo interface; ", "required for OpenStack Heat target");
	['DATA1', 'DATA2', 'DATA3', 'DATA4'].forEach(function(name){
		if(Networks.count('network', name) > 1)Networks.check += "\nNetworks: concurrent definitions of "+name+" detected";
	});

	result += '\n# ------------------------------- #';
	result += '\n# Network interfaces definition   #';
	result += '\n# ------------------------------- #';
  var ethN=0;
  var defaultPrefix='eth';
	for(var i=1; i < rowCount; i++){
    var networkName=Networks.getAndSetSelection(table.rows[i], nameIndexes, 'network');
		var networkDevice=Networks.getAndSetValue(table.rows[i], nameIndexes, 'interface',networkName!='PUBLIC'?defaultPrefix+ethN++:'');
		var networkMask=Networks.getAndSetValue(table.rows[i], nameIndexes, 'mask');
		
		if(networkName == ""){
			Networks.check += "\nNetworks: undefined network name for interface " + networkDevice;
			continue;
		}
    if(!Networks.prefix){
      // Prefix undefined: use the first one as the rule
      defaultPrefix=Networks.prefix=networkDevice.substring(0, networkDevice.search(/\d/));
    }
    
		// Check netmask consistency but allow the legacy placeholder
		if(networkMask != "@netmask@")networkMask.split('.').forEach(function(e,i,t){
			var aByte = Number(e);
			if(isNaN(aByte) || aByte < 0 || aByte > 255 )Networks.check += "\nNetworks: invalid netmask " + networkMask + " for interface " + networkDevice + "; expecting positive integer <= 255, found "+e;
		});
		if(networkDevice != ""){
			result += '\n#'+networkName+'_DEVICE='+networkDevice;
			result += '\n#'+networkName+'_NETMASK='+networkMask;
			Networks.devices[networkName]=networkDevice;
			
			// Ensure consistency prefix and extract the interface number
        if(!networkDevice.startsWith(defaultPrefix))Networks.check += "\nNetworks: " + networkDevice + " has an inconsistent prefix: " + defaultPrefix +" expected";
        var candidate = networkDevice.substr(defaultPrefix.length);
        var interfaceNumber = Number(candidate);
        if(isNaN(interfaceNumber)){
          Networks.check += "\nNetworks: illegal value for interface number "+networkName+" : "+candidate+"; expecting integer";
          continue;
        } 
        if(target == 'azure' && engine == 'ansible' || target == 'openstack' || target == 'kubernetes'){
				// openstack deployments: all networks have the same width: guess it from the first netmask proposed 
				if(Networks.heatWidth ==  undefined){
					// Use the 4th byte of the mask as the source for network width
					var cidr=Number(networkMask.split('.')[3]);
					// Use the closest integer
					Networks.heatWidth = Math.floor(Math.log(256 - cidr)/Math.log(2));
					Networks.heatMaxInterfaces=Math.pow(2, 8-Networks.heatWidth);
					Networks.heatCidrLength=Number(32-Networks.heatWidth).toString();
					Networks.heatMaxNodes=Math.pow(2, Networks.heatWidth);
					Networks.heatMask="255.255.255."+Number(256-Networks.heatMaxNodes).toString();
					if(networkCount > Networks.heatMaxInterfaces)Networks.check += "\nNetworks: network count limited by the netmask "+Networks.heatMask+" for "+target+" target to " + Networks.heatMaxInterfaces + ": found " + networkCount;
				}
				Networks.heatNetworks[networkName] = interfaceNumber;
				Networks.heatMinNetwork = Math.min(Networks.heatMinNetwork,interfaceNumber);
        Networks.heatMaxNetwork = Math.max(Networks.heatMaxNetwork,interfaceNumber);
				if(networkMask !== Networks.heatMask)Networks.check += "\nNetworks: netmask for "+target+" target cannot be larger than " + Networks.heatMask + ": found " + networkMask + " on interface " + networkName;
			}
		}
	}
	
	Networks.check += checkDependency(target == 'kubernetes' || target == 'azure' || target == 'aws', [Networks.heatMaxNetwork == 0], "Networks: "+target+" infrastructure is limited to one single network; found ", Networks.heatMaxNetwork + 1); 

	// update visible networks in the nodes table
	Nodes.hideUnused();

	// local check
	if(Networks.check != "")result = Networks.check;
	
	return result;
}

//===========================
//Miscellaneous settings
//===========================
var MiscItems = [
  {name: 'rhel_pullsecret', comment: "User secret provided by RedHat for deploying an OpenShift 4.x cluster; visit https://cloud.redhat.com/openshift/install/pull-secret", value:'{"auths":{"cloud.openshift.com":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2RvbWV0ZGVtb250MXhjMXp2N3VhbjNhbTloamNrb2h1Y2tscTBjOlM2QVc3WUlCSDFMRFhSRkhBNU1WM1dOWUFNQjRSTDk4MU1JRE1PQzFYQUVBMDRLWlRKNVk3SzQwUFFVODlOOUo=","email":"dominique.domet-de-mont@hpe.com"},"quay.io":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2RvbWV0ZGVtb250MXhjMXp2N3VhbjNhbTloamNrb2h1Y2tscTBjOlM2QVc3WUlCSDFMRFhSRkhBNU1WM1dOWUFNQjRSTDk4MU1JRE1PQzFYQUVBMDRLWlRKNVk3SzQwUFFVODlOOUo=","email":"dominique.domet-de-mont@hpe.com"},"registry.connect.redhat.com":{"auth":"NDM4MTY3MHx1aGMtMVhjMVp2N1VhTjNBbTloSmNrb2h1Y0tMcTBjOmV5SmhiR2NpT2lKU1V6VXhNaUo5LmV5SnpkV0lpT2lJMk4yUmpOMlZtWTJNMU5qSTBPVEZsT1RneVpXTTBOVGM1TUdGa1pUQTNaQ0o5Lkp2dWsybEo2Q3dLLTY5WnBkbDg1enk0RFUtdzV3aTVPWE5aZ0hDUDBlbXNCVmZDXzkzN3Fhdk5OZDZqdjRBU0NSRllPb3ZCTmxYTEhJbjA5amhIaTJiZDRfQ2xwMVhBaTdPYWVwN21qc0x5NVdrSEZHU3lHcU02RU43Y1N3bmFRWm00Q3lDNmNHaFItbVhtYnVDUTdYdWl0MVJCNEh5X0laZHV6dUhOa3hmam5aX2ZmWHNRb1ZVTmoxdW44bFlZMjQzLXpOMkpvN0p2M3MwZkZYYnBnbzBtMUNia284MzIzRWhGc3h5SFM5UXNYWUk3VDRJX21JRnBHMTZSVGotUGUyalluNjVJTnBxVFF4Y0FQaHpuQkxLYUNwd01Yb2F2V0hPMXpRWEs1QTF2dGR3Z1VUZEh0VWplX3FYUm13ZUQwYkVOeDRiVHgySGx2X0RlcnZuMEVfc3ZuRU4zVlpkNEc0VFNHZlo2d1c1LVlvSjJxZkdxeGVqeVZWdThqeDFyazFWRk52NERXaDd4amlTZ2I5d3dNTWVWVW9pSXFMZUN2NTZzUW4ycTRUdUpmdDNIVGR2UXhBSldHQWtGbDBFVUJKT0R2aGZrWGtSTWtjbmk5RVdiZVU0NWYwUThhQ1NmeG84anBzNE80endUMUxSQlVTVE5ZekN3bjhrTFdYR2FkaGo1aHdDNW9XNjlzUW5wYmpEY2JWR0dCSkdhNUtRREJpNmRVNzFoUTY3cThncUZ1UHhOaXJCcFNleTg0VWxtMS1PVjBzVXN4dnRwaVYxWFFvUVJrcHRVNnNBMFJaMTE2c25JT0gxR2piWm9paTB6M2hJbUltcmRPeG1ReHhYcC1nTWhsc2txcDZRVGtSWFdPZ0lyYWJ0UkNvV2pRc3JZb1EyZFNiRzBBODNB","email":"dominique.domet-de-mont@hpe.com"},"registry.redhat.io":{"auth":"NDM4MTY3MHx1aGMtMVhjMVp2N1VhTjNBbTloSmNrb2h1Y0tMcTBjOmV5SmhiR2NpT2lKU1V6VXhNaUo5LmV5SnpkV0lpT2lJMk4yUmpOMlZtWTJNMU5qSTBPVEZsT1RneVpXTTBOVGM1TUdGa1pUQTNaQ0o5Lkp2dWsybEo2Q3dLLTY5WnBkbDg1enk0RFUtdzV3aTVPWE5aZ0hDUDBlbXNCVmZDXzkzN3Fhdk5OZDZqdjRBU0NSRllPb3ZCTmxYTEhJbjA5amhIaTJiZDRfQ2xwMVhBaTdPYWVwN21qc0x5NVdrSEZHU3lHcU02RU43Y1N3bmFRWm00Q3lDNmNHaFItbVhtYnVDUTdYdWl0MVJCNEh5X0laZHV6dUhOa3hmam5aX2ZmWHNRb1ZVTmoxdW44bFlZMjQzLXpOMkpvN0p2M3MwZkZYYnBnbzBtMUNia284MzIzRWhGc3h5SFM5UXNYWUk3VDRJX21JRnBHMTZSVGotUGUyalluNjVJTnBxVFF4Y0FQaHpuQkxLYUNwd01Yb2F2V0hPMXpRWEs1QTF2dGR3Z1VUZEh0VWplX3FYUm13ZUQwYkVOeDRiVHgySGx2X0RlcnZuMEVfc3ZuRU4zVlpkNEc0VFNHZlo2d1c1LVlvSjJxZkdxeGVqeVZWdThqeDFyazFWRk52NERXaDd4amlTZ2I5d3dNTWVWVW9pSXFMZUN2NTZzUW4ycTRUdUpmdDNIVGR2UXhBSldHQWtGbDBFVUJKT0R2aGZrWGtSTWtjbmk5RVdiZVU0NWYwUThhQ1NmeG84anBzNE80endUMUxSQlVTVE5ZekN3bjhrTFdYR2FkaGo1aHdDNW9XNjlzUW5wYmpEY2JWR0dCSkdhNUtRREJpNmRVNzFoUTY3cThncUZ1UHhOaXJCcFNleTg0VWxtMS1PVjBzVXN4dnRwaVYxWFFvUVJrcHRVNnNBMFJaMTE2c25JT0gxR2piWm9paTB6M2hJbUltcmRPeG1ReHhYcC1nTWhsc2txcDZRVGtSWFdPZ0lyYWJ0UkNvV2pRc3JZb1EyZFNiRzBBODNB","email":"dominique.domet-de-mont@hpe.com"}}}'},
  {name: 'anyuid', value: 'false', comment: "true|false: relax security on the OpenShift cluster before deploying resources by granting all containers the root privilege and approving pending certificates (not recommended)"},
  {name: 'extnet', value: 'ext-net', comment: "Name of the OpenStack external network used to connect the public addresses of the instances defined in the Nodes section"},
  {name: 'UPFpassword', value: 'R7VgbZPass.y4yDukYdA8/', comment: "Encrypted password set in the Casa UPF startup configuration file; used to allow/deny the user entering the configuration mode"},
  {name: 'UPFNRFip', value: '10.33.102.198', comment: "NRF ip address used by UPF; supports variable like ~myocp_API~ where myocp is the name of an OpenShift instance defined in the OpenShiftNodes section"},
  {name: 'UPFNRFinterface', value: '0', comment: "the network interface number to use to access NRF"},
  {name: 'UPFNRFport', value: '32600', comment: "NRF port used by UPF"},
  {name: 'UPFmcc', value: '405', comment: "mobile country code used by UPF"},
  {name: 'UPFmnc', value: '53', comment: "mobile network code used by UPF"},
  {name: 'UPFtac', value: '10000,10001,2711,2710', comment: "Comma separated list of tac provisioned for the UPF"},
  {name: 'UPFcidr', value: '30.30.30.0/24', comment: "UPF PDU session ip address range as a CIDR"},
  {name: 'UPFnat', value: 'DATA1', comment: "UPF network name for network address translation from UPF router to UPF"},
  {name: 'UPFrouted', value: 'upf', comment: "UPF instance short name target of the address translation performed by the UPF router(s)"},
	{name: 'headless', value: '', comment: "if not empty: do not assume a user for answering prompts and downloading files: use default values without prompting and do not save any file."},
	{name: 'default_project', value: 'hpe5g', comment: "The default OpenShift project/namespace for deploying resources"},
	{name: 'default_action', value: 'deploy', comment: "The default installer action: deploy or undeploy"},
	{name: 'default_openstack_env', value: 'RHOS12.env', comment: "The default OpenStack environment file name"},
	{name: 'default_openstack_network_root', value: '192.168.199', comment: "The default OpenStack network root as 3 unique digits like 192.168.199"},
  {name: 'openstack_security_group', value: 'default', comment: "Name of the OpenStack security group controlling network permissions to the instances"},
  {name: 'openstack_volume_size', value: '', comment: "Size in Gb of the specific volume allocated to each OpenStack instance:\n\t\tIn that case, the OpenStack image must refer to a volume ID used for cloning.\n\t\tDefault: local storage sized according to the flavor and initialiazed with the image."},
  {name: 'tester_nodejs_version', value: 'v11.10.1', comment: "Nodejs version used to run the CMS5G Core Stack tester tool"},
  {name: 'tester_git_url', value: 'git@10.74.128.22:cms5g/E2E-Testing.git', comment: "Git project URL delivering the CMS5G Core Stack tester tool"},
  {name: 'tester_deploy_key', value: '/home/centos/automated-deployer/tester/id_rsa', comment: "Optional git deploy key to clone the project delivering the CMS5G Core Stack tester tool"}
	];

var Misc = new vnfResource("Misc", [
	{name:'Property', width:'200px', type:'choice', choices:MiscItems.map(function(e){return e.name;})},
	{name:'Value', type:'text', width:'400px'}
	]
	);

Misc.help = function(){
	return "Miscellaneous settings:\n- " + MiscItems.map(function(e){return e.name+": "+e.comment;}).join("\n- ");
}
Misc.getValue = function(name){
	// If a global variable exists, use its value
	if(window[name])return window[name];
	var theDefault=Misc.getDefault(name);
	var theItem;
	if(Misc.output)theItem=Misc.output.find(function(anItem){return anItem.name==name;});
	return theItem ? theItem.value : theDefault.value;
};
Misc.getDefault = function(name){
	var result=MiscItems.find(function(anItem){return anItem.name==name;});
	return result;
};
Misc.build = function(target){
	var nameIndexes = Misc.nameIndexes;
	var result = "\n";
	Misc.check = "";
	Misc.output = new Array();
	var table = document.getElementById("Misc");
	var rowCount = table.rows.length;
	
	result += "\n# ------------------------------- #";
	result += "\n# Miscellaneous properties        #";
	result += "\n# ------------------------------- #";
	
	for(var i=1; i < rowCount; i++){
		var row = table.rows[i];
		var propertyName=Misc.getAndSetSelection(row, nameIndexes, 'Property');
		var theDefault=Misc.getDefault(propertyName);
		var propertyValue=Misc.getAndSetValue(row, nameIndexes, 'Value', theDefault.value, theDefault.comment);
		if(propertyName != ""){
		result += "\n# "+theDefault.comment+": "+propertyValue;
		Misc.output.push({name:propertyName, value:propertyValue});
		}
	}

	if(Misc.check != "")return Misc.check;
	return result;
};

//===========================
//Flavors settings
//===========================
var Flavors = new vnfResource("Flavors", [
	{name:'Infrastructure', width:'100px', type:'choice', choices:['openstack']},
	{name:'Flavor', width:'120px', type:'choice', choices:['flavorTiny', 'flavorSmall', 'flavorStandard', 'flavorLarge', 'flavorPerformance']},
	{name:'name', type:'text', width:'200px'}
	]
	);
//OpenStack profiles default values
Flavors['openstack'] = new Array();
Flavors['openstack']['flavorTiny'] = {name: 'v1.m2'};
Flavors['openstack']['flavorSmall'] = {name: 'v2.m2'};
Flavors['openstack']['flavorStandard'] = {name: 'v2.m8'};
Flavors['openstack']['flavorLarge'] = {name: 'v4.m8'};
Flavors['openstack']['flavorPerformance'] = {name: 'v4.m16'};

Flavors.help = function(){
var help=`Infrastructure flavors:
Default flavor of a node is defined by the roles played on this node:
- Small: Etcd
- Standard: Worker
- Large: Master    
Those default values can be overriden at the node level in the Nodes section.    
Flavors are identified by name, made available by the infrastructure administrator    
Examples:    
`;
	// Table built with spaces for alignment, thanks to padStart
	var colLength=20;
	['Infrastructure', 'Flavor', 'Name'].forEach(function(column){
		help+=column.padStart(colLength);
	});
	help+="    ";
	['openstack'].forEach(function(infrastructure){
		['flavorTiny','flavorStandard', 'flavorSmall','flavorLarge','flavorPerformance'].forEach(function(flavor){
      var name=Flavors[infrastructure][flavor].name;
      if(!name)name="<undefined>";
  		help+="\n"+infrastructure.padStart(colLength);
  		help+=flavor.padStart(colLength);
  		help+=name.padStart(colLength)+"    ";
		});	
	});
	help+="\n";
	return help;
}

Flavors.build = function(target){
	var nameIndexes = Flavors.nameIndexes;
	var result = "";
	Flavors.check="";
	var table = document.getElementById("Flavors");
	var rowCount = table.rows.length;
	
	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n"
			result += "\n# ------------------------------- #";
			result += "\n# Flavors customization           #";
			result += "\n# ------------------------------- #";
			}
		var row = table.rows[i];
		var infra=Flavors.getAndSetSelection(row, nameIndexes, 'Infrastructure');
		var flavor=Flavors.getAndSetSelection(row, nameIndexes, 'Flavor');
		switch(infra){
			case 'openstack': 
				Flavors[infra][flavor].name=Flavors.getAndSetValue(row, nameIndexes, 'name', Flavors[infra][flavor].name, "Flavor name for "+flavor+" on "+infra);
				result+="\n# "+infra+" "+flavor+": name="+Flavors[infra][flavor].name;
				break;
			default:
				Flavors.check += "\nFlavors section: setting flavors is not supported on infrastructure : "+infra;
				break;
		}
	}
	
	if(Flavors.check != "")return Flavors.check;
	return result;
};

// ===========================
// Nodes resource
// ===========================
var Nodes= new vnfResource("Nodes", [
	{name:'MGMT fqdn', type:'text', width: '120px'}, 
	{name:'MGMT IP addr', type:'text', width: '120px'},
	{name:'PUBLIC IP addr', type:'text', width: '120px'},  
  {name:'DATA1 fqdn', type:'text'}, 
  {name:'DATA1 IP addr', type:'text'}, 
  {name:'DATA2 fqdn', type:'text'}, 
  {name:'DATA2 IP addr', type:'text'}, 
  {name:'DATA3 fqdn', type:'text'}, 
  {name:'DATA3 IP addr', type:'text'}, 
  {name:'DATA4 fqdn', type:'text'}, 
  {name:'DATA4 IP addr', type:'text'}, 
  {name:'UPF', type:'bool'}, 
  {name:'UPFrouter', type:'bool'},
  {name:'Master', type:'bool'},
	{name:'Etcd', type:'bool'},
	{name:'Worker', type:'bool'},
	{name:'Tester', type:'bool'},
	{name:'Flavor', width:'120px', type:'choice', choices:['','flavorTiny','flavorSmall', 'flavorStandard', 'flavorLarge','flavorPerformance']},
	{name:'Image', type:'text', width: '200px'}, 
  {name:'Volume', type:'bool'}, 
  {name:'Python3', type:'bool'}
	]
	);
	
Nodes.help = function(){
	return `Nodes and roles definition and assignment
- MGMT fqdn: The domain name used in fqdn should be consistent with the infrastructure settings: on OpenStack, the domain is typically: localdomain
- MGMT IP addr: use a question mark on OpenStack (dynamic allocation)
- PUBLIC IP addr: external IP address for this nodes; use a question mark on OpenStack (dynamic allocation)
- DATA1-4 fqdn: the name of this node on the DATA1-4 network interface
- DATA1-4 IP addr: the IP address of this node on the DATA1-4 network interface; use a question mark on OpenStack (dynamic allocation)
- UPF: Casa UPF node: receives a specific configuration file /fdsk/startup-config defining network interfaces, NRF and mobile network and country codes
  - network interfaces are retrieved at runtime from OpenStack resources instantiation
  - NRF is defined in the Misc section as an IP address, a port and an interface number; 
    the IP address specified in the Misc section can be a templated variable referring to an OpenShift API floating IP as ~ocp_API~ where ocp is the name of the OpenShift cluster defined in the OpenShiftNodes section 
  - mobile network and country codes are defined in the Misc section
- Master/Etcd/Worker: the role(s) played by this node in the OpenShift 3.x cluster    
  If no box is checked, the node is instantiated but not part of the OpenShift cluster, available for any specific usage.
- Tester: node hosting the nodejs application used as HPE network functions tester    
  This application is cloned from github using the Misc section entries tester_git_url and optionally tester_deploy_key
- Flavor: shortcut defining the resources allocated for this node; mapping to the actual flavor for the target infrastructure is based on the Flavors section
- Image or Volume: depending on the Volume boolean: either 
  - name of the qcow2 image if Volume is unchecked, or 
  - ID of the volume used to instantiate this node in OpenStack. The volume size is set in the Misc section, openstack_volume_size property
- Python3: check this box if this image is running Python3, so that ansible can manage the compatibility break

NOTE: all IP addresses dynamically allocated are available in the OpenStack Heat ouput, attribute ports, with the naming: "~node_network~": "IP address"
Example with 3 nodes large, medium, small on 4 networks MGMT/DATA1-3
{
  "~large_mgmt~": "192.168.199.5", 
  "~large_pub~": "30.118.0.22", 
  "~medium_data2~": "192.168.199.73", 
  "~small_data2~": "192.168.199.88", 
  "~small_data3~": "192.168.199.102", 
  "~medium_pub~": "30.118.0.77", 
  "~medium_data3~": "192.168.199.121", 
  "~small_pub~": "30.118.0.86", 
  "~small_mgmt~": "192.168.199.13", 
  "~large_data2~": "192.168.199.75", 
  "~large_data3~": "192.168.199.103", 
  "~small_data1~": "192.168.199.38", 
  "~medium_mgmt~": "192.168.199.16", 
  "~large_data1~": "192.168.199.44", 
  "~medium_data1~": "192.168.199.49"
} 
-  
`;
}

// Build the Nodes section of the descriptor
// - target is the optional infrastructure: openstack
// - engine is the optional underlying engine: ansible
// If the target is set, the unknown ip addresses defined as question marks are prepared as place holders for replacement at deployment time 
// The place holder format depends on the type of engine:
Nodes.build = function(target, engine){
	var oc_version=document.getElementById("oc_version").value;
	
	// Consistency checks reset
	consistency.initSingle();
	Nodes.check = "";
	
	var nameIndexes = Nodes.nameIndexes;
	var result = "\n";
	var table = document.getElementById("Nodes");
	var rowCount = table.rows.length;
	
	var cloudNodes = new Array();
	var masterNodes = new Array();
	var workerNodes = new Array();
	var etcdNodes = new Array();
	var testerNodes = new Array();
	
	result += "\n# ------------------------------- #";
	result += "\n# Nodes and roles definition      #";
	result += "\n# ------------------------------- #";
	for(var i=1; i < rowCount; i++){
		
		var row = table.rows[i];
		
		// Read the network definitions 'MGMT', 'PUBLIC'
		var nodeName		=	Nodes.getAndSetValue(row, nameIndexes, 'MGMT fqdn');
		var nodeIpAddr		=	Nodes.getAndSetValue(row, nameIndexes, 'MGMT IP addr');
		var nodePubIpAddr	=	Nodes.getAndSetValue(row, nameIndexes, 'PUBLIC IP addr');
		if(nodeName == "" || nodeIpAddr == ""){
			Nodes.check += "\nNodes section: MGMT FQDN and IP address are required";
			break;
		}
    var nodeData1Name  = Nodes.getAndSetValue(row, nameIndexes, 'DATA1 fqdn');
    var nodeData1IpAddr  = Nodes.getAndSetValue(row, nameIndexes, 'DATA1 IP addr');
    var nodeData2Name  = Nodes.getAndSetValue(row, nameIndexes, 'DATA2 fqdn');
    var nodeData2IpAddr  = Nodes.getAndSetValue(row, nameIndexes, 'DATA2 IP addr');
    var nodeData3Name  = Nodes.getAndSetValue(row, nameIndexes, 'DATA3 fqdn');
    var nodeData3IpAddr  = Nodes.getAndSetValue(row, nameIndexes, 'DATA3 IP addr');
    var nodeData4Name  = Nodes.getAndSetValue(row, nameIndexes, 'DATA4 fqdn');
    var nodeData4IpAddr  = Nodes.getAndSetValue(row, nameIndexes, 'DATA4 IP addr');

		// Read the roles definition
    var isUPF  = Nodes.getAndSetChecked(row, nameIndexes, 'UPF');
    var isUPFrouter  = Nodes.getAndSetChecked(row, nameIndexes, 'UPFrouter');
		var isMaster	=	Nodes.getAndSetChecked(row, nameIndexes, 'Master');
		var isWorker	=	Nodes.getAndSetChecked(row, nameIndexes, 'Worker');
		var isEtcd		=	Nodes.getAndSetChecked(row, nameIndexes, 'Etcd');
		var isTester	=	Nodes.getAndSetChecked(row, nameIndexes, 'Tester');
    var python3  = Nodes.getAndSetChecked(row, nameIndexes, 'Python3');
		
		// Read the preferred image and flavor
		var image=Nodes.getAndSetValue(row, nameIndexes, 'Image', 'Cent OS 7');
    var volume=Nodes.getAndSetChecked(row, nameIndexes, 'Volume');
		var flavor=Nodes.getAndSetSelection(row, nameIndexes, 'Flavor');

    // Only OpenShift 3 can be deployed as a set of individual nodes from the Nodes section
    Nodes.check+=checkDependency(isMaster || isEtcd || isWorker, [oc_version.startsWith('3')], "Nodes: the node "+nodeName," cannot be deployed as a member of an OpenShift "+oc_version+" cluster: select version 3.x in the Build pane, or use the OpenShiftNodes section");
    
		// co-location checks
		Nodes.check += checkDependency(isEtcd, [isWorker && isMaster, !isWorker ],  "Nodes: on node "+nodeName,", etcd and worker roles colocation requires a master role as well.");
		Nodes.check += checkDependency(isMaster, [isWorker && isEtcd, !isWorker ],  "Nodes: on node "+nodeName,", master and worker roles colocation requires an etcd role as well.");
		// Tester requirements checks
		Nodes.check += checkDependency(isTester, [Misc.search('Property','tester_nodejs_version') && Misc.search('Property','tester_git_url')], "Nodes vs Misc: on node "+nodeName,", the tester role requires two entries in Misc: tester_nodejs_version and tester_git_url"); 
    Nodes.check += checkDependency(isMaster, [!isUPF],  "Nodes: on node "+nodeName,", master and UPF roles colocation is not supported.");
    Nodes.check += checkDependency(isUPFrouter, [!isUPF],  "Nodes: on node "+nodeName,", UPF router and UPF roles colocation is not supported.");
		
    // Trace this new node as a comment
    result+="\n# "+nodeName+"@"+nodeIpAddr+(nodePubIpAddr?"@"+nodePubIpAddr:"")+(isUPF?" Casa UPF":"")+(isUPFrouter?" Casa UPF router":"")+(isMaster||isWorker||isEtcd?" OpenShift"+oc_version:"")+(isMaster?"-master":"")+(isWorker?"-worker":"")+(isEtcd?"-etcd":"")+(isTester?" tester":"")+" running "+(volume?"volume ":"image ")+image+" on flavor: "+(flavor?flavor:"default")+(python3?" with Ansible interpreter Python3":"");
    
		// Collect the short name of this node in the short names array for openstack template build
		var shortName = nodeName.substr(0, nodeName.indexOf('.'));
		var theCloudNode = new cloudNode(shortName, nodeName);
		
		switch(target){
		  case 'openstack': case 'vmware':
			// IP addresses will be known at instantiation time: 
			// Replace undefined values with place holders resolved later
			// Push the network interface number in the interfaces list for this node
			if(nodeIpAddr == "?")		{nodeIpAddr="~"+shortName+		"_mgmt~";	theCloudNode.interfaces.push(Networks.heatNetworks['MGMT']);}
			if(nodePubIpAddr == "?")	{nodePubIpAddr="~"+shortName+	"_pub~";	theCloudNode.interfaces.push(heatPublicInterface);}
      if(nodeData1IpAddr == "?") {nodeData1IpAddr="~"+shortName+  "_data1~"; theCloudNode.interfaces.push(Networks.heatNetworks['DATA1']);}
      if(nodeData2IpAddr == "?") {nodeData2IpAddr="~"+shortName+  "_data2~"; theCloudNode.interfaces.push(Networks.heatNetworks['DATA2']);}
      if(nodeData3IpAddr == "?") {nodeData3IpAddr="~"+shortName+  "_data3~"; theCloudNode.interfaces.push(Networks.heatNetworks['DATA3']);}
      if(nodeData4IpAddr == "?") {nodeData4IpAddr="~"+shortName+  "_data4~"; theCloudNode.interfaces.push(Networks.heatNetworks['DATA4']);}
			break;
		}
		
		var nodeNames		= new Array();
		var nodeIpAddresses	= new Array();
		nodeNames['MGMT'] 		=	nodeName;
		nodeIpAddresses['MGMT']	=	nodeIpAddr;
    nodeNames['DATA1']   = nodeData1Name;
    nodeIpAddresses['DATA1'] = nodeData1IpAddr;
		nodeNames['DATA2']   = nodeData2Name;
    nodeIpAddresses['DATA2'] = nodeData2IpAddr;
    nodeNames['DATA3']   = nodeData3Name;
    nodeIpAddresses['DATA3'] = nodeData3IpAddr;
    nodeNames['DATA4']   = nodeData4Name;
    nodeIpAddresses['DATA4'] = nodeData4IpAddr;
    
		// Push this node as per the defined roles with the most demanding flavor, using the public IP address if defined, or the fqdn otherwise
		// NOTE: the master is always a worker node but with specific labels
		// Depending on the OpenShift version, the inventory varies
		function oc_node(host, ip, type){
			var result='';
			switch(oc_version){
			case '3.11': result=host+" openshift_ip="+ip+" openshift_node_group_name='"+type+"'"; break;
			case '3.9': 
				result=host+" openshift_hostname="+ip+" openshift_ip="+ip;
				if(type.indexOf('node-config-compute') != 0)result+=" openshift_node_labels=\"{'region': 'infra', 'zone': 'default'}\"";
				if(type.indexOf('node-config-infra') != 0)result+=" openshift_schedulable=true";
			}
			return result;
		}
		var hostEntry=nodePubIpAddr;
		if(!hostEntry)hostEntry=nodeName
		if(isEtcd){
			if(!isWorker && !isMaster)workerNodes.push(oc_node(hostEntry, nodeIpAddr, 'node-config-infra'));
			etcdNodes.push(hostEntry); 
			theCloudNode.flavor='flavorSmall';
		}
		if(isWorker && !isMaster){
			workerNodes.push(oc_node(hostEntry, nodeIpAddr, 'node-config-compute')); 
			theCloudNode.flavor='flavorStandard';
		}
		if(isMaster){
			// Take the first master node as the ems
			if(masterNodes.length == 0)theCloudNode.isEms = true;
			masterNodes.push(hostEntry); 
			if(!isEtcd && !isWorker)workerNodes.push(oc_node(hostEntry, nodeIpAddr, 'node-config-master'));
			if(isEtcd && !isWorker)workerNodes.push(oc_node(hostEntry, nodeIpAddr, 'node-config-master-infra')); 
			if(isEtcd && isWorker)workerNodes.push(oc_node(hostEntry, nodeIpAddr, 'node-config-all-in-one'));
			theCloudNode.flavor='flavorLarge';
		}
    theCloudNode.isUPF=isUPF;
    theCloudNode.isUPFrouter=isUPFrouter;
		theCloudNode.isTester=isTester;
    theCloudNode.python=python3?"/usr/bin/python3":"/usr/bin/python";
		
		// Default image from the user environment
		theCloudNode.image="{ get_param: Image }";
		
		// Force the preferred image and flavor if defined
		if(flavor)theCloudNode.flavor=flavor;
		if(image)theCloudNode.image=image;
    if(volume)theCloudNode.volume=volume;
		
		// For infrastructure where IP addresses are statically allocated (vmware, static)
		theCloudNode.ipAddresses = nodeIpAddresses;
		
		// co-location and dependency checks
			
		cloudNodes.push(theCloudNode); 
	}
	// End of for loop on the list of nodes
	
	// Allow non OpenShift deployment, instances only
	if(masterNodes.length+workerNodes.length+etcdNodes.length > 0){
	if(masterNodes.length < 1)Nodes.check += "\nNodes section: missing at least one master node";
	if(workerNodes.length < 1)Nodes.check += "\nNodes section: missing at least one worker node";
	if(etcdNodes.length < 1)Nodes.check += "\nNodes section: missing at least one etcd node";
	
	// Inventory roles sections
	result += "\n[masters]";
	result += "\n"+masterNodes.join("\n");
	result += "\n[nodes]";
	result +="\n"+workerNodes.join("\n");
	result += "\n[etcd]";
	result +="\n"+etcdNodes.join("\n");

	// Ansible variables
	result += "\n[OSEv3:vars]";
	result += "\nopenshift_deployment_type=origin";
	result += "\nopenshift_disable_check=memory_availability,disk_availability,docker_image_availability";
	result += "\nopenshift_ip="+masterNodes[0];
	result += "\nansible_service_broker_install=false";
	result += "\nopenshift_master_cluster_hostname="+masterNodes[0];
	result += "\nopenshift_master_cluster_public_hostname="+masterNodes[0];
	result += "\nopenshift_public_hostname="+masterNodes[0];
	result += "\nopenshift_metrics_hawkular_hostname="+etcdNodes[0];
	result += "\nopenshift_metrics_install_metrics=true";
	result += "\nopenshift_metrics_image_version=v"+oc_version;
	result += "\ntemplate_service_broker_selector={\"region\":\"infra\"}";
	result += "\n[OSEv3:children]";
	result += "\nmasters";
	result += "\nnodes";
	result += "\netcd";
	}

	// Make the list of nodes for availableHeat template  
	Nodes.cloudNodes = cloudNodes.slice();
	
	// check the network width limitation compared to the number of non VIP openstack nodes
	var nonVipHeatNodes = cloudNodes.length;
	if(nonVipHeatNodes > Networks.heatMaxNodes)Nodes.check += "\nNodes vs Networks section: too many nodes for openstack deployments: found: "+nonVipHeatNodes+"; with a netmask "+Networks.heatMask+", the limit is : "+Networks.heatMaxNodes;
	
	// local check
	if(Nodes.check != "")result = Nodes.check;

	return result;
}

// Hides unused networks columns
Nodes.hideUnused = function(){
	['PUBLIC', 'DATA1', 'DATA2', 'DATA3', 'DATA4'].forEach(function(interface){
		// Check consistency first: reject hiding Networks interfaces with non empty columns in Nodes
		var fqdnColName=interface+' fqdn'; var ipAddrColName=interface+' IP addr';
		var nUsed=Nodes.count(fqdnColName)+Nodes.count(ipAddrColName) ; 
		var checkInterface = checkDependency(! Networks.search('network', interface), [nUsed== 0], 'Networks vs Nodes: ', 'Missing '+interface+' network interface definition : required '+nUsed+' times in the Nodes table.');
		if(checkInterface == ""){
			Nodes.display(fqdnColName, Networks.search('network', interface));
			Nodes.display(ipAddrColName, Networks.search('network', interface));
		}else Networks.check+=checkInterface;
	});
	
  // Hide OpenShift 3 specific check boxes if target is OpenShift 4
  var oc_version=document.getElementById("oc_version").value;
  Nodes.display('Master', oc_version!="4.x"); Nodes.display('Etcd', oc_version!="4.x"); Nodes.display('Worker', oc_version!="4.x")
};

// Special nodes
// UPF:
// UPF is a network function running as an OpenStack instance, instantiated from a specific image. This instance expects a startup configuration file /fdsk/startup-config
// name: the hostname of this UPF instance
// UPFports: definition of the network ports as a block of text, built from the Nodes.UPFport function
// From the Misc section:
// - UPFpassword: the password
// - UPFNRFip: the NRF IP address
// - UPFNRFinterface: the network interface number to use to access NRF 
// - UPFNRFport: the NRF port
// - UPFmcc/mnc: mobile codes
// - UPFcidr: PDU range
Nodes.UPFconfig = function(name, UPFports){
  // NRF end point: default from the Misc section, prefer the FIP API of the associated OpenShift cluster
  var nrfFip=Misc.getValue('UPFNRFip');
  // is this UPF node associated to an OCP instance?
  var iOCP=OpenShiftNodes.instances.UPF.indexOf(name);
  if(iOCP>=0){
    // Use the FIP API of this OCP
    nrfFip="~"+OpenShiftNodes.instances.name[iOCP]+"_API~";
  }
  var mcc=Misc.getValue('UPFmcc');
  var mnc=Misc.getValue('UPFmnc');
  var tac=Misc.getValue('UPFtac');
  // tac is a list of comma separated values: each value results in one lie in the user-plane-service section: tai mcc mnc tac
  var tacList="user-plane-service upf";
  tac.split(',').forEach(function(t){tacList+="\n tai mcc "+mcc+" mcn "+mnc+" tac "+t});
return `
cat > /fdsk/startup-config << CASA_STARTUP_CONFIG
! CASA-MOBILE system running configuration
!
hostname "`+name+`"
!
password encrypted `+Misc.getValue('UPFpassword')+`
!
!
`+UPFports.join('')+`
interface loopback `+UPFports.length+`

ip route 0.0.0.0/0

gtpu-profile gtp-u-prof0
   echo-disable
   end

pfcp-profile hb-prof0
   heartbeat disable
   end

`+tacList+`

 access
   interface name gige 0/3
   gtpu-profile gtp-u-prof0
   exit
 pfcp
   interface name gige 0/1
   pfcp-profile hb-prof0
   exit
 nrf-agent
   interface name gige 0/`+Misc.getValue('UPFNRFinterface')+`
   nrf-addr ip `+nrfFip+`
   nrf-port `+Misc.getValue('UPFNRFport')+`
   exit
 identity
   plmn mcc `+Misc.getValue('UPFmcc')+` mnc `+Misc.getValue('UPFmnc')+`
   locality locality_1
   smf-service-areas srv_area_1
   smf-service-areas srv_area_2
   smf-service-areas srv_area_3
   fqdn `+name+`
   exit
 network-slice sst 1 sd ab2112
   dnn inet1
     ip pool smf-pool1 type ipv4 `+Misc.getValue('UPFcidr')+`
     ip pool smf-pool1-ipv6 type ipv6 2002:2207:2323::/56
     exit
   exit
 exit

!end of configuration
CASA_STARTUP_CONFIG`;
}
// UPF router nating traffic from mgmt interface to upf on the nat interface
Nodes.UPFrouterConfig= function(name){
  // Target upf defaults to the Misc section entry
  //  If this router is associated to an OCP, use the UPF associated to this same OCP
  var upf=Misc.getValue('UPFrouted');
  var iOCP=OpenShiftNodes.instances.UPFrouter.indexOf(name);
  if(iOCP>=0){
    upf=OpenShiftNodes.instances.UPF[iOCP];
  }
  // Reduce to the short name
  if(upf.indexOf('.')>=0)upf=upf.substr(0, upf.indexOf('.'));
  var mgmt=Networks.devices['MGMT'];
  var nat=Networks.devices[Misc.getValue('UPFnat')];
  var upfip="~"+upf+"_"+Networks.getNickname(Networks.heatNetworks[Misc.getValue('UPFnat')])+"~";
return `
cat > /etc/network/interfaces.d/60-cloud-init.cfg << EOF_CLOUD_INIT
auto `+nat+`
iface `+nat+` inet dhcp
  post-up ip route add `+Misc.getValue('UPFcidr')+` via `+upfip+`
EOF_CLOUD_INIT
service networking restart
sysctl -w net.ipv4.ip_forward=1
iptables -t nat -A POSTROUTING -o `+mgmt+` -j MASQUERADE
iptables -A FORWARD -i `+mgmt+` -o `+nat+` -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i `+nat+` -o `+mgmt+` -j ACCEPT`;
}
// Template for one UPF network interface
// i is an integer identifying the interface number
// ip is the IP address on this interface
Nodes.UPFports = function(i, ip){ 
  return `
interface gige 0/`+i+`
  ip address `+ip+" "+Networks.heatMask+`
  auto negotiate
  no shutdown
`;
}

// ===========================
// OpenShiftNodes resource
// ===========================
var OpenShiftNodes= new vnfResource("OpenShiftNodes", [
  {name:'Name', type:'text', width: '80px'}, 
  {name:'Domain', type:'text', width: '80px'},
  {name:'OSenv', type:'text', width: '100px'},
  {name:'ext-net', type:'text', width: '120px'},  
  {name:'ext-dns', type:'text', width: '120px'},  
  {name:'FIPAPI', type:'text', width: '120px'},
  {name:'FIPAPP', type:'text', width: '120px'},
  {name:'Masters', type:'text', width: '60px'},
  {name:'Workers', type:'text', width: '60px'},
  {name:'etc-hosts', type:'bool', width: '60px'},
  {name:'Flavor', width:'120px', type:'choice', choices:['flavorTiny','flavorSmall', 'flavorStandard', 'flavorLarge','flavorPerformance']},
  {name:'Worker flavor', width:'120px', type:'choice', choices:['flavorTiny','flavorSmall', 'flavorStandard', 'flavorLarge','flavorPerformance']},
  {name:'#Volumes', type:'text', width: '60px'}, 
  {name:'UPF', type:'text', width: '120px'}, 
  {name:'UPF router', type:'text', width: '120px'}
  ]
  );
  
OpenShiftNodes.help = function(){
  return `OpenShift 4.x clusters definitions
Prerequisites:
- rhel_pullsecret: all OpenShift clusters are deployed using the RedHat secret provided in the Misc section
- openshift-install and oc available at deployment time in the path with the target OpenShift version 

Attributes:
- Name : name of the OpenShift instance to deploy
- Domain: domain name of the OpenShift instance to deploy; default: localdomain
- OSenv: name of the file providing the OpenStack environment. Retrieved from the OpenStack GUI: Project/API access
      By default, this file prompts the user for his password; to make the deployment unattended, replace the prompt with the actual password in the variable OS_PASSWORD
      Mandatory additional variables:
      - OS_CACERT: path to a file providing a specific cacert in case the SSL cert is signed by an unknown CA
      Extensions supported as additional variables: 
      - Proxy URLs for OpenShift cluster
      OPENSHIFT_HTTP_PROXY
      OPENSHIFT_HTTPS_PROXY
      OPENSHIFT_NO_PROXY
      - name of the ssh key pair defined in the OpenStack project, pushed to the OpenShift nodes for remote access (useful to connect to openshift nodes)
      OS_SSH_KEY_PAIR
- ext-net: name of the external network in the OpenStack infrastructure to connect this instance to; default: ext-net
- ext-dns: external domain name server; default 8.8.8.8
- FIPAPI/APP: floating IPs preallocated to the OpenShift cluster for the API and APP endpoints respectively. By default, those IPs are dynamically allocated if undefined or defined as a question mark(?). 
- Masters: number of masters: default 3
- Workers: number of workers : default 3
- etc-hosts: boolean enabling /etc/hosts update (requires sudo privilege) 
- Flavor/Worker flavor: shortcut defining the resources allocated for this OpenShift instance nodes; mapping to the actual flavor for the target infrastructure is based on the Flavors section
- #Volumes: quota of volumes on this OpenStack project; admin privileges required at run time if greater than the current quota; default 10
- UPF/UPF router: names of the nodes defined in the Nodes section, playing the UPF and UPF router roles for this OpenShift cluster respectively

Outputs:
For each OpenShift cluster, two floating IPs are exported as templated variables resolved at deployment time, available for other resources reference:
- ~name_API~: the cluster API floating IP
- ~name_APP~: the cluster Application floating IP
Example:
- myocp is an OpenShift cluster deployed in this section, hosting an NRF network function
- a UPF node is defined in the Nodes section
- the UPFNRFip entry in the Misc section can be set to ~myocp_API~ to make the UPF instance pointing to the NRF instance deployed in myocp cluster.

For each OpenShift cluster, the installer outputs an auth directory holding the kubeconfig file and kubeadmin password in a directory named like the cluster.
Example:
- myocp is an OpenShift cluster deployed in this section
- kubeconfig is in ./myocp/auth/kubeconfig
- kubadmin password is in ./myocp/auth/kubeadmin-password 
`;
}
OpenShiftNodes.build = function(target){
  var nameIndexes = OpenShiftNodes.nameIndexes;
  var result = "";
  OpenShiftNodes.check="";
  var table = document.getElementById("OpenShiftNodes");
  var rowCount = table.rows.length;
  OpenShiftNodes.instances =new Object;
  OpenShiftNodes.instances.name=new Array();
  OpenShiftNodes.instances.domain=new Array();
  OpenShiftNodes.instances.osenv=new Array();
  OpenShiftNodes.instances.extnet=new Array();
  OpenShiftNodes.instances.extdns=new Array();
  OpenShiftNodes.instances.nbVolumes=new Array();
  OpenShiftNodes.instances.fipapi=new Array();
  OpenShiftNodes.instances.fipapp=new Array();
  OpenShiftNodes.instances.masters=new Array();
  OpenShiftNodes.instances.workers=new Array();
  OpenShiftNodes.instances.flavor=new Array();
  OpenShiftNodes.instances.flavorWorker=new Array();
  OpenShiftNodes.instances.etchosts=new Array();
  OpenShiftNodes.instances.UPF=new Array();
  OpenShiftNodes.instances.UPFrouter=new Array();
  
  for(var i=1; i < rowCount; i++){
    if(result==""){
      result += "\n"
      result += "\n# ------------------------------- #";
      result += "\n# OpenShiftNodes definition       #";
      result += "\n# ------------------------------- #";
      }
    var row = table.rows[i];
    var name=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'Name', "ocp-"+i);
    var domain=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'Domain', "localdomain");
    var osenv=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'OSenv', "FC33.sh");
    var extnet=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'ext-net', Misc.getValue('extnet'));
    var extdns=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'ext-dns', "8.8.8.8");
    var nbVolumes=OpenShiftNodes.getAndSetValue(row, nameIndexes, '#Volumes', "10");
    var fipapi=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'FIPAPI', '?');
    var fipapp=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'FIPAPP', '?');
    var masters=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'Masters', "3");
    var workers=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'Workers', "3");
    var flavor=OpenShiftNodes.getAndSetSelection(row, nameIndexes, 'Flavor');
    var flavorWorker=OpenShiftNodes.getAndSetSelection(row, nameIndexes, 'Worker flavor');
    var etchosts=OpenShiftNodes.getAndSetChecked(row, nameIndexes, 'etc-hosts', true);
    var upf=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'UPF');
    var upfRouter=OpenShiftNodes.getAndSetValue(row, nameIndexes, 'UPF router');
    
    if(!name)OpenShiftNodes.check+="\nOpenShiftNodes section: missing Name attribute";
    if(!domain)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing Domain attribute";
    if(!osenv)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing OSenv attribute";
    if(!extnet)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing extnet attribute";
    if(!extdns)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing extdns attribute";
    if(!nbVolumes)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing nbVolumes attribute";
    var mastersNumber = Number(masters);
    if(isNaN(mastersNumber)){
      OpenShiftNodes.check+="\nOpenShiftNodes section: illegal value for Masters on "+name+" : "+masters+"; expecting integer";
    }else if(mastersNumber<3)OpenShiftNodes.check+="\nOpenShiftNodes section: illegal value for Masters on "+name+" : "+masters+"; 3 minimum required";
    var workersNumber = Number(workers);
    if(isNaN(workersNumber)){
      OpenShiftNodes.check+="\nOpenShiftNodes section: illegal value for Workers on "+name+" : "+workers+"; expecting integer";
    }else if(workersNumber<1)OpenShiftNodes.check+="\nOpenShiftNodes section: illegal value for Workers on "+name+" : "+workers+"; 1 minimum required";
    if(!flavor)OpenShiftNodes.check+="\nOpenShiftNodes section: "+name+" missing Flavor attribute";
    // Convert to the actual flavor name
    flavor=Flavors['openstack'][flavor].name
    flavorWorker=Flavors['openstack'][flavorWorker].name
    OpenShiftNodes.check+=checkDependency(upf, [Nodes.search('MGMT fqdn',upf)], "OpenShiftNodes section: ", name+" missing UPF node named "+upf+" in the Nodes section");
    OpenShiftNodes.check+=checkDependency(upfRouter, [Nodes.search('MGMT fqdn',upfRouter)], "OpenShiftNodes section: ", name+" missing UPF router node named "+upfRouter+" in the Nodes section");
    
    result+="\nOpenShift cluster "+name+"."+domain+" in "+osenv+" environment connected to "+extnet+" via external DNS "+extdns+" made of "+masters+" masters of flavor "+flavor+" and "+ workers+" workers of flavor "+flavorWorker+" with up to "+nbVolumes+" volumes and /etc/hosts update "+etchosts;
    if(fipapi)result+=" preallocated FIP API:"+ fipapi;
    if(fipapp)result+=" preallocated FIP APP:"+ fipapp;
    OpenShiftNodes.instances.name.push(name);
    OpenShiftNodes.instances.domain.push(domain);
    OpenShiftNodes.instances.osenv.push(osenv);
    OpenShiftNodes.instances.extnet.push(extnet);
    OpenShiftNodes.instances.extdns.push(extdns);
    OpenShiftNodes.instances.nbVolumes.push(nbVolumes);
    OpenShiftNodes.instances.fipapi.push(fipapi);
    OpenShiftNodes.instances.fipapp.push(fipapp);
    OpenShiftNodes.instances.masters.push(masters);
    OpenShiftNodes.instances.workers.push(workers);
    OpenShiftNodes.instances.flavor.push(flavor);
    OpenShiftNodes.instances.flavorWorker.push(flavorWorker);
    OpenShiftNodes.instances.etchosts.push(etchosts);
    OpenShiftNodes.instances.UPF.push(upf);
    OpenShiftNodes.instances.UPFrouter.push(upfRouter);
  }
  
  if(OpenShiftNodes.instances.name.length && !Misc.search('Property','rhel_pullsecret'))OpenShiftNodes.check+="\nOpenShiftNodes section: missing the RedHat secret definition in Misc section rhel_pullsecret";
  
  if(!OpenShiftNodes.check)return result;
  
  // Errors: cleanup and report
  OpenShiftNodes.instances=null;
  return OpenShiftNodes.check;
};
// ===========================
// CinderVolumes settings
// ===========================
var CinderVolumes = new vnfResource("CinderVolumes", [
	{name:'Name', type:'text', width:'120px'},
	{name:'Size', type:'text', width:'80px'},
	{name:'Description', type:'text', width:'300px'}
	]
	);

CinderVolumes.help = function(){var help="Persistent storage:"+
	"\nList of CinderVolumes allocated for OpenShift persistent storage:"+
	"\n\t- Name: one word CinderVolume name"+
	"\n\t- Size: CinderVolume size expressed in Gbytes"+
	"\n\t- Description: free text CinderVolume description";
	
	return help;
}

CinderVolumes.build = function(target){
	var nameIndexes = CinderVolumes.nameIndexes;
	var result = "";
	CinderVolumes.check="";
	var table = document.getElementById("CinderVolumes");
	var rowCount = table.rows.length;
	
	var cloudVolumes = new Array();

	
	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n"
			result += "\n# ------------------------------- #";
			result += "\n# CinderVolumes definition    #";
			result += "\n# ------------------------------- #";
			}
		var row = table.rows[i];
		var name=CinderVolumes.getAndSetValue(row, nameIndexes, 'Name', "CinderVolume-"+i);
		var size=CinderVolumes.getAndSetValue(row, nameIndexes, 'Size', "20");
		var description=CinderVolumes.getAndSetValue(row, nameIndexes, 'Description');
		
		var sizeNumber = Number(size);
		if(isNaN(sizeNumber)){
			CinderVolumes.check += "\nCinderVolumes: illegal size value for CinderVolume  "+name+" : "+size+"; expecting integer";
			continue;
		} 
		result+="\n#"+name+" "+size+" Gbytes: "+description;
		cloudVolumes.push(new cloudVolume(name, size, description));
	}
	
	// Make the list of CinderVolumes for availableHeat template  
	CinderVolumes.cloudVolumes = cloudVolumes.slice();
	
	if(CinderVolumes.check != "")return CinderVolumes.check;
	return result;
};


// ===========================
// PersistentVolumes settings
// ===========================
var PersistentVolumes = new vnfResource("PersistentVolumes", [
	{name:'Name', type:'text', width:'120px'},
	{name:'Size', type:'text', width:'80px'},
	{name:'Type', type:'choice', width: '80px', choices:['ext3']}, 
	{name:'Access', type:'choice', width: '120px', choices:['ReadWriteOnce','ReadWriteMany','ReadOnlyMany']}, 
	{name:'Reclaim', type:'choice', width: '120px', choices:['Delete','Retain','Recycle']}, 
	{name:'CinderVolume', type:'text', width:'120px'}
	]
	);

PersistentVolumes.help = function(){var help="OpenShift Persistent Volumes:"+
	"\nList of OpenShift Persistent Volumes allocated in OpenStack Cinder volumes:"+
	"\n\t- Name: one word persistent volume name"+
	"\n\t- Size: persistent volume size expressed in Gbytes"+
	"\n\t- Type: file system type"+
	"\n\t- Access: access mode for this persistent volume"+
	"\n\t- CinderVolume: name of the CinderVolume hosting this persistent volume"
	
	return help;
}

PersistentVolumes.build = function(target){
	var nameIndexes = PersistentVolumes.nameIndexes;
	var result = "";
	PersistentVolumes.check="";
	var table = document.getElementById("PersistentVolumes");
	var rowCount = table.rows.length;
	
	var openshiftVolumes = new Array();

	
	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n"
			result += "\n# --------------------------------";
			result += "\n# PersistentVolumes definition";
			result += "\n# -------------------------------- ";
			}
		var row = table.rows[i];
		var name=PersistentVolumes.getAndSetValue(row, nameIndexes, 'Name', "PersistentVolume-"+i);
		var size=PersistentVolumes.getAndSetValue(row, nameIndexes, 'Size', "5");
		var type=PersistentVolumes.getAndSetSelection(table.rows[i], nameIndexes, 'Type', 0);
		var access=PersistentVolumes.getAndSetSelection(table.rows[i], nameIndexes, 'Access', 0);
		var reclaim=PersistentVolumes.getAndSetSelection(table.rows[i], nameIndexes, 'Reclaim', 0);
		var cinder=PersistentVolumes.getAndSetValue(row, nameIndexes, 'CinderVolume', "CinderVolume-"+i);
		if(cinder == undefined || cinder == ''){
			PersistentVolumes.check += "\nPersistentVolumes "+name+" : CinderVolume is required";
			continue;
		}
		if(!CinderVolumes.search('Name', cinder)){
			PersistentVolumes.check += "\nPersistentVolume "+name+": "+cinder+" is undefined in the CinderVolumes section";
			continue;
		}
		
		var sizeNumber = Number(size);
		if(isNaN(sizeNumber)){
			PersistentVolumes.check += "\nPersistentVolumes: illegal size value for volume  "+name+" : "+size+"; expecting integer";
			continue;
		} 
		result+="\n#"+name+" "+size+" Gbytes type: "+type+" access: "+access+" reclaim policy: "+reclaim+" on CinderVolume: "+cinder;
		openshiftVolumes.push(new openshiftVolume(name, size, type, access, reclaim, "~cinderVolumeIdOf"+cinder+"~"));
	}
	
	// Make the list of volumes for availableHeat template  
	PersistentVolumes.openshiftVolumes = openshiftVolumes.slice();
	
	if(PersistentVolumes.check != "")return PersistentVolumes.check;
	return result;
};

//===========================
// Clusters
//===========================
var Clusters = new vnfResource("Clusters", [
	{name:'Name', type:'text', width:'80px'},
	{name:'Endpoint', type:'text', width:'300px'},
	{name:'Token', type:'text', width:'300px'},
	{name:'Targeted', type:'bool'},
	]
	);

Clusters.help = function(){return `OpenShift clusters candidate for deployment through OpenShift RESTful API:
- Name: nickname of this cluster
- Endpoint: OpenShift API endpoint for this cluster.   
  Typically retrieved from a session with: oc config current-context | cut -d/ -f2 | tr - .
- Token: security token for this cluster identifying an authorized user    
  Typically retrieved from a session with: oc whoami -t
- Targeted: check this box to deploy the defined resources to this cluster
`
}

var targetedCluster = function(aName, anEndpoint, aToken){
	this.name=aName;
	this.endpoint=anEndpoint;
	this.token=aToken;
}

Clusters.build = function(target){
	var nameIndexes = Clusters.nameIndexes;
	var result="";
	Clusters.check = "";
	Clusters.targeted = new Array();
	var table = document.getElementById("Clusters");
	var rowCount = table.rows.length;
	
	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n# ------------------------------- #";
			result += "\n# Clusters                        #";
			result += "\n# ------------------------------- #";
			};
		var row = table.rows[i];
		var name=Clusters.getAndSetValue(row, nameIndexes, 'Name', "cluster-"+i);
		var endpoint=Clusters.getAndSetValue(row, nameIndexes, 'Endpoint', '$(oc config current-context | cut -d/ -f2 | tr - .)');
		var token=Clusters.getAndSetValue(row, nameIndexes, 'Token', '$(oc whoami -t)');
		var targeted=Nodes.getAndSetChecked(row, nameIndexes, 'Targeted');
		if(targeted){
			if(endpoint.length == 0 || token.length == 0){Clusters.check+="\nClusters section: targeted cluster "+name+" requires both Endpoint and Token definitions"; continue;}
			Clusters.targeted.push(new targetedCluster(name, endpoint, token));
		}
		result+="\n#- "+name+" cluster at endpoint "+endpoint+" with token "+token+" targeted: "+targeted;
	}

	if(Clusters.check != "")return Clusters.check;
	return result;
};

//===========================
// Builds
//===========================
var Builds = new vnfResource("Builds", [
	{name:'Type', type:'choice', width: '100px', choices:['pipeline','custom-app']}, 
	{name:'Name', type:'text', width:'100px'},
	{name:'GIT URL', type:'text', width:'400px'},
	{name:'directory', type:'text', width:'200px'},
	{name:'branch', type:'text', width:'120px'},
	{name:'sshKey', type:'file', width:'120px'}
	]
	);

Builds.help = function(){return `OpenShift builds:
The OpenShift builds defined in this section rely on custom git projects as:
- GIT URL: github project URL, eg: git@github.hpe.com:CMS-5GCS/automated-deployer.git         
- directory: (optional) directory in the github project hosting the code     
- branch: (optional) git branch to use, eg: master        
- sshKey: (optional) private ssh key enabling access the git repository                
Two types of OpenShift builds can be defined:        
- jenkins pipelines available for continuous integration of hpe5g resources:        
    The Jenkins environment variable _NAME is made available to the pipeline ; it is set to the name of the resource to which this pipeline is attached.         
    This is useful to dynamically discover OpenShift resources like routes, services ,etc.        
    Example of route retrieval in a Jenkins stage: openshift.selector( 'route/\${_NAME}').object().spec.host         
    Three examples are provided by https://github.hpe.com/CMS-5GCS/automated-deployer/pipelines :            
    - get_oc_resources: display the OpenShift current project and existing resources        
    - manual_approval: expect the end  user to explicitly approve the build        
    - autotest: non regression tests for the automated deployer itself    
- custom applications available as dynamic types in the CustomApps section for instanciation.        
`
}

//================================================================
// Template fragment defining a build config 
// either as a Jenkins pipeline or as a custom app or any un templated deployment
//================================================================
Builds.makeTemplate = function(name, type, uri, dir, branch, sshKey){
if(!uri)return;
var result='';
switch(type){
	case 'pipeline':
if(sshKey.content)result+=`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-`+name+`
    namespace: ~PROJECT~
  type: Opaque
  data:
    ssh-privatekey: `+btoa(sshKey.content);
result+=`
- kind: BuildConfig
  apiVersion: build.openshift.io/v1
  metadata:
    name: "~NAME~-`+name+`"
  spec:
    source:`;
		if(dir)result+=`
      contextDir: `+dir;
		if(sshKey.content)result+=`
      sourceSecret:
        name: ~NAME~-`+name;
result+=`
      git:
        uri: `+uri;
if(branch)result+=`
        ref: `+branch;
result+=`
    strategy:
      jenkinsPipelineStrategy:
        type: JenkinsPipeline
        env:
          - name: "_NAME"
            value: ~NAME~`
;
	break;
	case 'custom-app':
		// Custom app deployment is not available as template, only from oc new-app CLI
		// Build a one line shell script invoking this command if the parameter 'apply' is received or the related deletion if a parameter 'delete' is received
		result+='( [[ "$1" == "delete" ]] && oc delete all --selector app=~NAME~ ) || ( [[ "$1" == "apply" ]]';
		if(sshKey.content)result+=" && oc create secret generic ~NAME~-"+name+" --type=kubernetes.io/ssh-auth --from-literal=ssh-privatekey='"+sshKey.content+"'";
		result+=' && oc new-app --name ~NAME~';
		if(sshKey.content)result+=' --source-secret=~NAME~-'+name;
		result+=' '+uri;
		if(branch)result+='#'+branch;
		if(dir)result+=' --context-dir '+dir;
		result+=' && oc expose svc/~NAME~ )';
	break;
	default:
    // Other deployments not available in template, only from oc CLI
    // Make sure the template exists
    if(!hpe5gResources.defaults[type] || !hpe5gResources.defaults[type]['template'])return;
    // Build a one line shell script invoking this command if the parameter 'apply' is received or the related deletion if a parameter 'delete' is received
    result+='oc $1 -f - << EOF'+name;
    result+=hpe5gResources.defaults[type]['template'];
    result+='EOF'+name;
    result+='\n[ $? = 0 ]';
	break;
}
	
Builds.templates[type][name]=result;
};

Builds.getTemplate = function(type, name){
	if(!Builds.templates || !Builds.templates[type] || !Builds.templates[type][name])return '';
	return Builds.templates[type][name];
}
Builds.getNames = function(type){
	if(!Builds.templates || !Builds.templates[type])return [];
	return Object.keys(Builds.templates[type]);
}

Builds.templates=new Object;
Builds.build = function(target){
	var nameIndexes = Builds.nameIndexes;
	var result="";
	
	var table = document.getElementById("Builds");
	var rowCount = table.rows.length;
	Builds.templates['pipeline']=new Object;
	Builds.templates['custom-app']=new Object;
	Builds.check = checkDependency(Builds.search('Type', 'pipeline'), [IndirectServices.search('Type', 'jenkins')], "Builds section: ", "pipeline types require a jenkins IndirectService");
	
	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n# ------------------------------- #";
			result += "\n# Builds                          #";
			result += "\n# ------------------------------- #";
			};
		var row = table.rows[i];
		var type=Builds.getAndSetSelection(table.rows[i], nameIndexes, 'Type');
		var name=Builds.getAndSetValue(row, nameIndexes, 'Name', type+"-"+i);
		var gitURL=Builds.getAndSetValue(row, nameIndexes, 'GIT URL', 'https://github.com/dometdemont/DO288-apps');
		var gitDirectory=Builds.getAndSetValue(row, nameIndexes, 'directory');
		var gitBranch=Builds.getAndSetValue(row, nameIndexes, 'branch');
		var delButton=row.getElementsByClassName("delButton")[0];
		var sshKey=window[this.title + "_sshKey_" + delButton.id];
		var check='';
		if(!type)check += "\nBuilds section: "+name+": type is required";
		if(!name)check += "\nBuilds section: "+type+" name is required";
		if(name.search(/[A-Z_]/g) >= 0){check += "\nBuilds section: "+name+" : upper case and underscore characters are not supported";}
		if(!gitURL)check += "\nBuilds section: "+type+" "+name+": GIT URL is required";
		if(!Builds.templates[type])check += "\nBuilds section: type "+type+" is not supported; expecting one of: "+Object.keys(Builds.templates).join();
		else if(Builds.templates[type][name])check += "\nBuilds section: "+type+" "+name+" is duplicated";
		Builds.check+=check;
		if(check)continue;
		
		result+="\n#- "+type+" "+name+" build from GIT "+gitURL+"/"+gitDirectory+" branch: "+gitBranch+" sshKey: ";
		if(sshKey.content)result+=sshKey.content.length+" bytes";
		Builds.makeTemplate(name, type, gitURL, gitDirectory, gitBranch, sshKey);
	}

	if(Builds.check != "")return Builds.check;
	return result;
};

//===========================
//CustomApps
//===========================
var CustomApps = new vnfResource("CustomApps", [
	{name:'Type', type:'choice', width: '140px', choices: function(){Builds.build(); return Builds.getNames('custom-app');}}, 
	{name:'Name', type:'text', width:'100px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
);
CustomApps.help = function(){return `CustomApps instantiation from GIT using source to image feature:
PREREQUISITE: the Builds section defines the build source in GIT repository for each instantiable application type.
- Type: the type of the build to instantiate as defined by the Name attribute in the Builds section 
- Name: one word resource name for this application instance
- Project: the OpenShift project hosting this application instance
- Pipeline: create a Jenkins pipeline for this application from the Builds section definition
	
`;
}
CustomApps.build = function(target){
	var nameIndexes = CustomApps.nameIndexes;
	var result = "";
	CustomApps.check="";
	var table = document.getElementById(this.title);
	var rowCount = table.rows.length;

	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n"
			result += "\n# --------------------------------";
			result += "\n# CustomApps definition           ";
			result += "\n# -------------------------------- ";
			}
		var row = table.rows[i];
		var type=this.getAndSetSelection(table.rows[i], nameIndexes, 'Type');
		var template=Builds.getTemplate('custom-app', type);
		var name=this.getAndSetValue(row, nameIndexes, 'Name', type+"-"+i);
		var project=this.getAndSetValue(row, nameIndexes, 'Project',Misc.getValue('default_project'));
		if(!template){this.check += "\n"+this.title+": "+type+" is unknown in the Builds section as a custom-app"; continue;}
		var pipeline=this.getAndSetValue(row, nameIndexes, 'Pipeline');
		var pipelineTemplate=Builds.getTemplate('pipeline', pipeline);
		this.check += checkDependency(pipeline, [pipelineTemplate], this.title+" "+name+": pipeline "+pipeline, " is undefined in the Builds section");
		if(pipeline)hpe5gResources.openshiftFunctions.push(new openshiftFunction(type, name, undefined, undefined, project, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, pipelineTemplate));
		
		if(!hpe5gResources.untemplatedDeployments[project])hpe5gResources.untemplatedDeployments[project]=new Array();
		hpe5gResources.untemplatedDeployments[project].push(template.replace(/~NAME~/g,name));
		result+="\n#- "+name+": "+type+" on project: "+project;
	}
	
	if(this.check != "")return this.check;
	return result;
};

//===========================
// HPE5G resources
//===========================
//Each resource should provide:
//- a type: to be listed in the nvfResource type member: nudsf-dr, ignite...
//- a set of default values defined in hpe5gResources.defaults[type] for: image, tag, template
//- a list of dependencies on other functions defined as a table in hpe5gResources.depends[type], eg nudsf type depends on ignite type
//- for types requiring admin privileges, a true boolean in hpe5gResources.admin[type] so that the user is aware an prevented from failing deployments
//The provided templates can use placeholders replaced at instantation time for:
//- name: ~NAME~
//- project: ~PROJECT~
//- image: ~IMAGE~
//- replicas: ~REPLICAS~
//- requirement on other function types: ~<type>_NAME~: eg ~ignite_NAME~ will be replaced by the ignite instance name in this project
// Resources are not directly instantiated from hpe5gResource but from a class inherited from hpe5gResource, to allow spliting resources in Network functions and other services
var hpe5gResource = function(title, columns, userFiles){
	vnfResource.call(this, title, columns, userFiles);
};
hpe5gResource.prototype = vnfResource.prototype;
hpe5gResource.prototype.constructor = hpe5gResource;


hpe5gResource.prototype.help = function(){return `Attributes:
- Type: the type of the resource to deploy
- Name: one word resource name for this instance
- Project: the OpenShift project hosting this resource instance
- URL, Image and tag: the docker image to use for this resource    
  Default valid values are provided when fields are left blank.
- insecure: check this box if this URL points to insecure registries    
  Images from insecure registries are pulled then pushed to the internal registry using docker, properly configured.        
  Otherwise, images are directly pulled by the OpenShift image stream from their original URL.
- Storage, Volume: the storage size with its unit (like 1Gi) and the OpenShift persistent volume used by this resource
- Replicas: number of replicas deployed for this instance.
- Dependencies: comma separated list of resources names resolving this function dependencies within this project.    
  If undefined, the first resource in the project providing the required type is used.
- Pipeline: create a Jenkins pipeline for this function from the Builds section definition
	
`;
}

hpe5gResource.prototype.build = function(target){
	var nameIndexes = this.nameIndexes;
	var result = "";
	this.check="";
	var table = document.getElementById(this.title);
	var rowCount = table.rows.length;

	for(var i=1; i < rowCount; i++){
		if(result==""){
			result += "\n"
			result += "\n# --------------------------------";
			result += "\n# "+this.title+" definition";
			result += "\n# -------------------------------- ";
			}
		var row = table.rows[i];
		var type=this.getAndSetSelection(table.rows[i], nameIndexes, 'Type');
		if(!hpe5gResources.types[this.title] || hpe5gResources.types[this.title].indexOf(type) < 0){this.check += "\n"+this.title+": "+type+" is unknown in the catalog"; continue;}
		var name=this.getAndSetValue(row, nameIndexes, 'Name', type+"-"+i);
		var project=this.getAndSetValue(row, nameIndexes, 'Project',hpe5gResources.defaults[type]['Project']?hpe5gResources.defaults[type]['Project']:Misc.getValue('default_project'));
		var URL=this.getAndSetValue(row, nameIndexes, 'URL',hpe5gResources.defaults[type]['URL']);
		var insecure=Nodes.getAndSetChecked(row, nameIndexes, 'insecure');
		var image=this.getAndSetValue(row, nameIndexes, 'Image',hpe5gResources.defaults[type]['image']);
		var tag=this.getAndSetValue(row, nameIndexes, 'Tag', hpe5gResources.defaults[type]['tag']);
		var storage=this.getAndSetValue(row, nameIndexes, 'Storage', hpe5gResources.defaults[type]['storage']);
		var volume=this.getAndSetValue(row, nameIndexes, 'Volume');
		var displayChart="";
		var chart=this.getAndSetValue(row, nameIndexes, 'Chart', hpe5gResources.defaults[type]['chart']);
		var chartVersion=this.getAndSetValue(row, nameIndexes, 'Version', hpe5gResources.defaults[type]['version']);
		var chartOptions=this.getAndSetValue(row, nameIndexes, 'Options');
		var delButton=row.getElementsByClassName("delButton")[0];
		var values=window[this.title + "_Values_" + delButton.id];
		if(chart)displayChart=" with chart "+chart;
		if(chartVersion)chartOptions+=" --version "+chartVersion;
		if(chartOptions)displayChart+=" "+chartOptions;
		this.check += checkDependency(this.title=='HelmCharts', [values!=undefined && values.content!=undefined && chart.length>0], this.title+" "+name,", Helm chart and values are required");
		var displayVolume="";
		var replicas=this.getAndSetValue(row, nameIndexes, 'Replicas');
		if(!replicas)replicas="1";
		var dependenciesList=this.getAndSetValue(row, nameIndexes, 'Dependencies');
		var dependencies=undefined;
		if(dependenciesList)dependencies=dependenciesList.split(/[\s,]+/);
		if(name.search(/[A-Z_]/g) >= 0){this.check += "\n"+this.title+" "+name+" : upper case and underscore characters are not supported";}
		if(!project){this.check += "\n"+this.title+" "+name+" : project is required";}
		var displayImage="";
		if(!image){
			if(hpe5gResources.defaults[type]['image'])this.check += "\n"+this.title+" "+name+" : image is required";
		}else{displayImage=" running image: "+image+":"+tag;}
		if(storage)displayVolume+=" with "+storage+" storage";
		if(volume !=''){
			if(!PersistentVolumes.search('Name', volume))this.check += "\n"+this.title+" "+name+": "+volume+" is undefined in the PersistentVolumes section";
			else displayVolume+=" on volume: "+volume;
		}
		// Name must be unique accross all hpe5g resources
		if(NetworkFunctions.count('Name', name) + DirectServices.count('Name', name) + IndirectServices.count('Name', name) + Operators.count('Name', name) > 1)this.check += "\n"+this.title+": resource name "+name+" is duplicated across sections "+hpe5gResources.sections.join();
		this.check += checkDependency(hpe5gResources.defaults[type]['storage'] != undefined, [storage.length>0], this.title+" "+name,", Storage is required");
		
		var pipeline=this.getAndSetValue(row, nameIndexes, 'Pipeline');
		if(pipeline.search(/[A-Z_]/g) >= 0){this.check += "\n"+this.title+" "+name+" pipeline "+pipeline+": upper case and underscore characters are not supported";}
		var pipelineTemplate=Builds.getTemplate('pipeline', pipeline);
		this.check += checkDependency(pipeline, [pipelineTemplate], this.title+" "+name+": pipeline "+pipeline, " is undefined in the Builds section");
		
		var replicasNumber = Number(replicas);
		if(isNaN(replicasNumber)){
			this.check += "\n"+this.title+": illegal replicas value for "+name+" : "+replicas+"; expecting integer";
			continue;
		} 
		var displayReplicas="";
		if(replicas)displayReplicas=replicas+ " replica(s) of type: ";
		
		// Record this provider to resolve dependencies later per type and per project
		if(!hpe5gResources.provides[type])hpe5gResources.provides[type] = new Array();
		if(!hpe5gResources.provides[type][project])hpe5gResources.provides[type][project]=new Array();
		hpe5gResources.provides[type][project].push(name);
		
		hpe5gResources.openshiftFunctions.push(
  		new openshiftFunction(type, name, image, tag, project, storage, volume, replicas, dependencies, URL, chart, values, chartOptions, pipelineTemplate));
		
		if(insecure && hpe5gResources.insecureRegistries.indexOf(URL) < 0)hpe5gResources.insecureRegistries.push(URL);
		
		if(hpe5gResources.admin && hpe5gResources.admin[type])hpe5gResources.adminList+="\n- "+name+":\tsection: "+this.title+"\tproject: "+project+"\ttype: "+type;
		
		result+="\n#- "+name+": "+displayReplicas+type+" on project: "+project+displayImage+displayVolume+displayChart;
	}
	
	if(this.check != "")return this.check;
	return result;
};

//Class implementing a network function: name, image (including the tag), URL (hosting the image), pipeline, Helm chart 
var openshiftFunction = function(aType, aName, anImage, aTag, aProject, aStorage, aVolume, aReplicas, aDependency, aURL, anHelmChart, anHelmChartValues, anHelmChartOptions, aPipeline){
	this.type=aType;
	this.name=aName;
	this.image=anImage;
  this.tag=aTag;
	this.URL=aURL;
	this.project=aProject;
	this.storage=aStorage;
	this.volume="";
	if(aVolume != undefined && aVolume.length > 0)this.volume="volumeName: "+aVolume;
	this.replicas=aReplicas;
	this.dependency=aDependency;
	this.helmChart=anHelmChart; this.helmChartValues=anHelmChartValues; this.helmChartOptions=anHelmChartOptions;
	this.pipeline=aPipeline;
	// Insecure registries are managed by docker; secured registries are pulled directly from the URL
	this.insecureURL = function(){return hpe5gResources.insecureRegistries.indexOf(this.URL) >= 0;}
	this.imageStream = function(){
		var _imageStream=this.URL;
		if(_imageStream&&this.image)_imageStream+='/';
		_imageStream+=this.image;
		if(this.tag)_imageStream+=':';
    _imageStream+=this.tag;
    if(this.insecureURL())_imageStream='docker-registry.default.svc:5000/'+this.project+'/'+this.image+':'+this.tag;
		return _imageStream;
	}
}

// Resolve dependency of a given resource on a specific type: accept multiple candidates silentlty, just take the first one
// The required type can be a simple string or a table of aliases 
openshiftFunction.prototype.resolve = function(requirement){
	var candidates, result;
	var types = new Array();
	var self = this;
	if(typeof requirement == "string"){types.push(requirement);}else{types=requirement;}
	types.some(function(type){
      candidates=undefined;
      if(hpe5gResources.provides[type])candidates=hpe5gResources.provides[type][self.project];
      if(candidates)
      	// If the user has listed preferred resources resolving dependencies, use the first of those preferred names
      	if(self.dependency)result=candidates.filter(value => -1 !== self.dependency.indexOf(value))[0];
      	// otherwise, use the first candidate
      	else result=candidates[0];
      // Stop there if resolved
      return result;
	});
	return result
}

//==========================
// Deployed 5G resources
//==========================
// Composite object holding the deployed 5G resources
var hpe5gResources=new Object;
// Array of sections names holding 5G resources
hpe5gResources.sections=['DirectServices','IndirectServices','OperatorSources','Operators','NetworkFunctions','HelmCharts'];
// Array of types per section: hpe5gResources.types[section]:[types]
// Array of types, each holding a boolean tracking the admin privilege requirement for this type: hpe5gResources.admin[type]:boolean
hpe5gResources.admin=new Array();

// Reset the list of resources, to be called before building them
hpe5gResources.init = function(){
	hpe5gResources.openshiftFunctions=new Array();	// array of instances of the class openshiftFunction, the actually OpenShift resources deployed by this session
	hpe5gResources.provides=new Array();			// array of instances names actually providing a specific type for a project: hpe5gResources.provides[type][project]:[names]
	hpe5gResources.projects=new Array();			// array of projects names deployed by this session
	hpe5gResources.adminList="";
	hpe5gResources.insecureRegistries=new Array();	// array of URLs pointing to insecure registries
	hpe5gResources.insecureRegistriesList="";
  hpe5gResources.untemplatedDeployments=new Array();  // array of resources deployed out of an OpenShift application template, typically customApps, OperatorsCatalogs
}

// Compile the resources from the various resources sections: build the list of projects, registries, and cross check dependencies 
hpe5gResources.compile = function(){
	// Build the list of projects as a concatenation of hpe5g resources and custom apps projects, removing duplicates
	hpe5gResources.projects=Array.from(new Set(hpe5gResources.openshiftFunctions.map(function(e){return e.project;}).concat(Object.keys(hpe5gResources.untemplatedDeployments))));
	if(hpe5gResources.insecureRegistries.length > 0)hpe5gResources.insecureRegistriesList += '"'+hpe5gResources.insecureRegistries.join('","')+'"';
	
	// Check cross functions dependencies
	var check="";
	hpe5gResources.openshiftFunctions.forEach(function(networkFunction){
		// Check if all dependencies for this network function type are satisfied on this project
		if(hpe5gResources.depends && hpe5gResources.depends[networkFunction.type])hpe5gResources.depends[networkFunction.type].forEach(function(requirement){
			if(networkFunction.resolve(requirement))return;
			check += "\nNetworkFunctions: "+networkFunction.name+" missing dependency "+requirement+" on project "+networkFunction.project;
			if(networkFunction.dependency)check+=" in the provided list: "+networkFunction.dependency;
		});
    });
	
	// Insecure registries not managed out of a full stack deployment since this requires a docker configuration on all nodes in /etc/docker/daemon.json
	if((!Nodes.cloudNodes || !Nodes.cloudNodes.some(function(e){return e.isEms;})) && hpe5gResources.insecureRegistriesList){
		check += "\nInsecure registries not managed out of a full stack deployment; this requires a docker configuration on all nodes performed during OpenShift deployment:"+hpe5gResources.insecureRegistriesList;
	}
  return check;
}

//===========================
//NetworkFunctions
//===========================
var NetworkFunctions = new hpe5gResource("NetworkFunctions", [
	{name:'Type', type:'choice', width: '100px', choices: function(){return hpe5gResources.types['NetworkFunctions'];}}, 
	{name:'Name', type:'text', width:'80px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'URL', type:'text', width:'200px'},
	{name:'insecure', type:'bool'},
	{name:'Image', type:'text', width:'120px'},
	{name:'Tag', type:'text', width:'120px'},
	{name:'Storage', type:'text', width:'60px'},
	{name:'Volume', type:'text', width:'60px'},
	{name:'Replicas', type:'text', width:'40px'},
	{name:'Dependencies', type:'text', width:'100px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
	);
//===========================
//DirectServices
//===========================
var DirectServices = new hpe5gResource("DirectServices", [
	{name:'Type', type:'choice', width: '100px', choices: function(){return hpe5gResources.types['DirectServices']}}, 
	{name:'Name', type:'text', width:'80px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'URL', type:'text', width:'200px'},
	{name:'insecure', type:'bool'},
	{name:'Image', type:'text', width:'120px'},
	{name:'Tag', type:'text', width:'120px'},
	{name:'Storage', type:'text', width:'60px'},
	{name:'Volume', type:'text', width:'60px'},
	{name:'Replicas', type:'text', width:'40px'},
	{name:'Dependencies', type:'text', width:'100px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
	);
DirectServices.help = function(){return hpe5gResource.prototype.help()+
`NOTES:
- redis default admin password is the name of the instance.
  redis-nopwd deploys a redis instance without password 
- ignite on persistent storage deploys three volumes:
  - work
  - wal
  - walarchive   
As a consequence, the total claimed storage size is 3x the user defined size.
- ignite recommended values for udsf legacy versions are: 
  - URL: docker.io/apacheignite
  - Image: ignite
  - tag: 2.7.5
`;}
//===========================
//IndirectServices
//===========================
var IndirectServices = new hpe5gResource("IndirectServices", [
	{name:'Type', type:'choice', width: '100px', choices: function(){return hpe5gResources.types['IndirectServices']}}, 
	{name:'Name', type:'text', width:'80px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'URL', type:'text', width:'200px'},
	{name:'insecure', type:'bool'},
	{name:'Image', type:'text', width:'120px'},
	{name:'Tag', type:'text', width:'120px'},
	{name:'Storage', type:'text', width:'60px'},
	{name:'Volume', type:'text', width:'60px'},
	{name:'Replicas', type:'text', width:'40px'},
	{name:'Dependencies', type:'text', width:'100px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
	);
IndirectServices.help = function(){return hpe5gResource.prototype.help()+
`NOTES: 
- jenkins recommended values for RedHat OpenShift 3 are : 
  . URL: docker.io/openshift
  . Image: jenkins-2-centos7
  . tag:latest 
- grafana default admin password is the name of the instance.
 `;}
 
//===========================
//OperatorSources
//===========================
var OperatorSources = new vnfResource("OperatorSources", [
  {name:'Type', type:'choice', width: '140px', choices: ['operator-source']}, 
  {name:'Name', type:'text', width:'100px'},
  {name:'Project', type:'text', width:'200px'},
  {name:'URL', type:'text', width:'200px'}
  ]
);
OperatorSources.help = function(){return `Operator sources instantiation:
- Type: the type of the operator source to instantiate
- Name: the name of the operator source, typically the account name in quay.io
- Project: the OpenShift project where to deploy this source, typically openshift-marketplace
- URL: location of the account, typically https://quay.io/cnr  
`;
}
OperatorSources.build = function(target){
  var nameIndexes = OperatorSources.nameIndexes;
  var result = "";
  OperatorSources.check="";
  var table = document.getElementById(this.title);
  var rowCount = table.rows.length;
  OperatorSources.deployments = new Object;
  Builds.templates['operator-source']=new Object;

  for(var i=1; i < rowCount; i++){
    if(result==""){
      result += "\n"
      result += "\n# --------------------------------";
      result += "\n# OperatorSources definition           ";
      result += "\n# -------------------------------- ";
      }
    var row = table.rows[i];
    var type=this.getAndSetSelection(table.rows[i], nameIndexes, 'Type');
    if(!hpe5gResources.defaults[type] || !hpe5gResources.defaults[type]['template']){this.check += "\n"+this.title+": "+type+" template is unknown in the catalog"; continue;}
    var name=this.getAndSetValue(row, nameIndexes, 'Name', type+"-"+i);
    var project=this.getAndSetValue(row, nameIndexes, 'Project','openshift-marketplace');
    var URL=this.getAndSetValue(row, nameIndexes, 'URL',hpe5gResources.defaults[type]['URL']);
    Builds.makeTemplate(name, type, URL);
    var template=Builds.templates[type][name];
    
    if(!hpe5gResources.untemplatedDeployments[project])hpe5gResources.untemplatedDeployments[project]=new Array();
    hpe5gResources.untemplatedDeployments[project].push(template
    .replace(/~NAME~/g,name)
    .replace(/~PROJECT~/g,project)
    .replace(/~URL~/g,URL));
    
    result+="\n#- "+name+": "+type+" from "+URL+" on project: "+project;
    if(hpe5gResources.admin && hpe5gResources.admin[type])hpe5gResources.adminList+="\n- "+name+":\tsection: OperatorSources\tproject: "+project+"\ttype: "+type;
  }
  
  if(this.check != "")return this.check;
  return result;
};

//===========================
//Operators
//===========================
var Operators = new hpe5gResource("Operators", [
	{name:'Type', type:'choice', width: '140px', choices: function(){return hpe5gResources.types['Operators']}}, 
	{name:'Name', type:'text', width:'100px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'Replicas', type:'text', width:'40px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
);
Operators.help = function(){return `Operator instantiation:
PREREQUISITE: the operators are installed on the target OpenShift infrastructure.
- Type: the type of the operator to instantiate
- Name: one word resource name for this operator instance
- Project: the OpenShift project hosting this operator instance
- Replicas: number of replicas passsed to this operator instance.
- Pipeline: create a Jenkins pipeline for this operator instance from the Builds section definition
	
`;
}

//===========================
//HelmCharts
//===========================
var HelmCharts = new hpe5gResource("HelmCharts", [
	{name:'Type', type:'choice', width: '140px', choices: function(){return hpe5gResources.types['HelmCharts']}},
	{name:'Name', type:'text', width:'100px'},
	{name:'Project', type:'text', width:'60px'},
	{name:'Chart', type:'text', width:'200px'},
	{name:'Values', type:'file', width:'200px'},
	{name:'Version', type:'text', width:'60px'},
	{name:'Options', type:'text', width:'120px'},
	{name:'Pipeline', type:'text', width:'100px'}
	]
);
HelmCharts.help = function(){var help=this.title+
`
PREREQUISITE: Helm is installed on the target OpenShift infrastructure and configured to provide the deployed charts.
- Type: the type of the Helm chart to instantiate: used for default values and dependency check against backing services. Use 'generic' to disable checks.
- Name: one word resource name for this chart instance
- Project: the OpenShift project hosting this chart instance
- Chart: name of the chart to deploy; Helm must be configured on the infrastructure to provide this chart
- Values: local file injected in this chart as deployment values
- Version: specify the exact chart version to install. If this is not specified, the latest version is installed
- Options: additional options passed to helm at deployment time as a text string (quotes and double quotes must be backslash escaped)
- Pipeline: create a Jenkins pipeline for this chart instance from the Builds section definition
	
`;
return help;
}

function deploymentHelp(){userOutput(welcomeMsg+OpenStackHelp);}
var OpenStackHelp=
`
Quick user guide for deploying an OpenShift 3.x cluster in an OpenStack HPE lab infrastructure using ansible: 

- OpenStack tenant
    - Get a tenant on RHOS13 from infra team at https://cmsgvm42.gre.hpecorp.net/hos    
     Typical quota: 25 vCPUs, 50Gb RAM, 100Gb disk
    - Install and configure the infrastructure VPN as per    https://github.hpe.com/OTC-Foundation/sandboxes_user_doc/blob/master/docs/vpn.md
    - Connect to your tenant at https://30.118.132.11/dashboard/auth/login
    - in the default security group, allow all ports for TCP and UDP ingress: Networks/Security Groups/default/Manage Rules/Add Rule
    - create an ssh key pair: Compute/Key Pairs/Create Key Pair, eg mykey
    - save the private key, eg mykey.pem

- Ansible controller
    - create a network and a router connected to the external network
    - create an instance connected to this network: Compute/Instances/Launch Instance    
     from image CentOS 8.x,   
      with 20 Gb disk,   
       4 vCPUs,   
       8Gb RAM   
       embedding this ssh key,   
       and associated with a floating (public) IP, eg 30.118.0.26
    - connect to this VM as user centos with the saved ssh key eg:   
    ssh -i mykey.pem centos@30.118.0.26
    - install git httpd-tools java-1.8.0-openjdk-headless and pip from epel repository:     
     sudo  http_proxy=http://16.46.16.11:8080 https_proxy=http://16.46.16.11:8080 yum install -y epel-release     
     sudo  http_proxy=http://16.46.16.11:8080 https_proxy=http://16.46.16.11:8080 yum install -y git httpd-tools     java-1.8.0-openjdk-headless python3 python3-pip --enablerepo='epel'
    - install openstack client, ansible, shade, passlib, decorator and cryptography:    
     sudo  http_proxy=http://16.46.16.11:8080 https_proxy=http://16.46.16.11:8080 pip3 install python-openstackclient shade passlib decorator===4.4.0 ansible===2.7.4 cryptography==2.5
    - clone the CMS5G Core Stack automated deployer from git:     
     http_proxy=http://16.46.16.11:8080 https_proxy=http://16.46.16.11:8080 git clone git@10.74.128.22:CMS-5GCS/automated-deployer.git
    - move to this directory    
     cd automated-deployer
    - retrieve in this directory the private ssh key file and set ssh compliant access rights eg :    
     chmod 0600 *.pem 
 
- OpenStack target definition
    - get your tenant and project information from OpenStack portal: project/API access/view credentials
    - copy and update an example of environment definition file provided with the project, eg OKDRHOS13.env: 
      - export OS_IDENTITY_API_VERSION=3
      - export OS_AUTH_URL="https://30.118.132.11:13000/v3"
      - export OS_PASSWORD="xxxx"
      - export OS_PROJECT_ID="b5f5a70ae58d4405a780aac02094a264"
      - export OS_PROJECT_NAME="d3mRHOS13"
      - export OS_USERNAME="d3m"
    - set the ssh key to use:
      - export CLOUD_SSH_KEY_PAIR="mykey"
      - export CLOUD_SSH_KEY="/home/centos/openshift-ansible/mykey.pem"
    - set the name of the external network offering public access
  	  - export CLOUD_EXTERNAL_NETWORK=ext-net
    - set the default image to used:
      - export CLOUD_IMAGE="Cent OS 7"
    - retrieve the infrastructure certificate: e.g. grenoble-infra-root-ca_gs118.crt 

- Define the resources to deploy and build the installer
    - retrieve and open in a browser the assistant hpe5g.html or start from an example file provided by the git project like five.html
    - define the nodes, roles and resources, 
    - click the Installer button: the installer is downloaded, 
    - retrieve and run the installer on the ansible console. 

- Enjoy OpenShift     
The first master public IP address is available as $openshift_ip: eg 30.118.0.24
    - Connect to OpenShift GUI on this master node port 8443, eg: Browse https://$openshift_ip:8443
    - accept the security warning and log on with any name and password
    - approve the self signed certificate for the metrics display engine Hawkular by clicking the warning link in another tab
    - connect to the master, connect with the user name used in the GUI
     - ssh -i $CLOUD_SSH_KEY centos@$openshift_ip	
     - oc login -u <user>
    - invoke the deployment script: ./hpe5g.sh

- Undeploy
     - run the same installer with the --undeploy option

Conversely, OpenShift 4.x clusters are defined in the OpenShiftNodes section of the automated deployer assistant. Such deployments do not require ansible but the openshift installer and client, plus a pull secret, all retrieved from RedHat download site: https://cloud.redhat.com/openshift/install/openstack/installer-provisioned
- openshift-install and oc are to be available in the console path with the target version
- the pull secret has to be defined in the Misc section of the assistant: rhel_pullsecret
`;
 
// Compile the Help text of a selection of sections and catalog in a markdown document 
function deploymentDoc(){
	var result=`
<a name="SectionsDetails"></a>
## Sections detailed specifications
This chapter is a compilation of the detailed sections specifications.
`;
	['Misc', 'Networks','OpenShiftNodes','Nodes','Flavors','Clusters','Builds', 'CustomApps', 'NetworkFunctions','DirectServices','IndirectServices','Operators','HelmCharts'].forEach(function(section){
		result+="\n### "+section+"\n"+window[section].help();
		if(hpe5gResources.types[section])result+="\n"+section+" supported types: "+hpe5gResources.types[section]+"\n";
	});
	
	result+=`
<a name="CatalogSpecification"></a>
## Catalog specification\n`+catalogDoc+`
<a name="OpenStackHelp"></a>
## OpenStack deployment help\n`+OpenStackHelp;

	userOutput(result);
	var blobDesc = new Blob([result], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobDesc);
    a.download = "hpe5g.md";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
}

// Shell script dropped on the ems node ready to deploy the volumes, projects, and hpe5g network functions 
// Prerequisites depend on the target: oc/curl
function shellBody(target){  
var result=`
# Prerequisites:`;
switch(target){
case 'oc': result+=`
# - OpenShift command line interface installed (oc)
if ! which oc  > /dev/null ; then  echo Please install oc utility to submit OpenShift requests ; exit 1 ; fi
# - current user logged in the target OpenShift cluster: oc login -u <user> -p <password>`; break;
case 'curl': result+=`
# - curl and jq utilities installed
PATH=$PATH:.
if ! which jq  > /dev/null ; then  echo Please install jq utility to inspect OpenShift REST API responses ; exit 1 ; fi
if ! which curl  > /dev/null ; then  echo Please install curl utility to submit OpenShift REST API requests ; exit 1 ; fi
# - network configured to reach all the targeted OpenShift clusters`; break;
default: result+= 'unsupported'; break;
}
result+=`

_getTemplateInstanceStatus() {
	local TOKEN=$1 ENDPOINT=$2 NAMESPACE=$3 TEMPLATEINSTANCE=$4
	curl -s -k -H "Authorization: Bearer $TOKEN" -H "Accept: application/json" https://$ENDPOINT/apis/template.openshift.io/v1/namespaces/$NAMESPACE/templateinstances/$TEMPLATEINSTANCE | jq -e '.status.conditions[] | select(.status == "True") | .type'
	return $?
}
_getTemplateInstanceMessage() {
	local TOKEN=$1 ENDPOINT=$2 NAMESPACE=$3 TEMPLATEINSTANCE=$4
	local status=$(curl -s -k -H "Authorization: Bearer $TOKEN" -H "Accept: application/json" https://$ENDPOINT/apis/template.openshift.io/v1/namespaces/$NAMESPACE/templateinstances/$TEMPLATEINSTANCE )
	echo $status >> $logfile
	echo $status | jq -e '.status.conditions[] | select(.status == "True") | .message'
}

# Submit a command until success or timeout, log a current status after each retry
# Parameters:
# $1: the command
# $2: (optional) the command description, displayed at each retried iteration, appended to the command output, defaults to the command
# $3: (optional) the timeout in seconds
# $4: (optional) the retry period in seconds
_cmd_with_retry() {
	local _cmd="$1"
	local _cmdDescription="$\{2:-$_cmd}"
	local _timeout=$\{3:-60}
	local _retryPeriod=$\{4:-10}
	
	[ "$_cmd" = "" ] && echo "_cmd_with_retry <command> <description> <timeout[$_timeout]> <retry period[$_retryPeriod]>" && return 1
	 
	local _countMax=$(( $_timeout/$_retryPeriod + 1 ))
	local _count=0
    until _cmdOutput=$(eval "$_cmd" 2>> $logfile) || (( $_count >= $_countMax )) ; do
    	((_count++))
    	_log_ "$_cmdDescription: attempt $_count of $_countMax, retrying in $_retryPeriod seconds"
        sleep $_retryPeriod
    done
   if (( $_count >= $_countMax )) ; then
   	return 1
   else
   	test -n "$_cmdOutput" && echo $_cmdOutput >> $logfile
   fi
   return 0
}
`;
return result;};

function hpe5gDeploymentScript(warningMessage){
var _shellTemplate=`
if $_deploy ; then 
	_ocAction="apply"
	_helmAction() { helm upgrade --install $_HPE5G_name $_HPE5G_template --values _tmp_$_helmValues $_HPE5G_options; }
else
	_helmAction() { helm delete $_HPE5G_name ; }
	_ocAction="delete"
fi

# checking user logged in
oc_user=$(oc whoami)
test -n "$oc_user" && [ "$oc_user" != "system:admin" ] || _fail_ "Current user is $\{oc_user:-unknown}: please log as user: oc login -u user"
_log_ "$_displayedAction CMS5G Core Stack as user $oc_user"
_log_ "Checking projects"
oc_projects="~PROJECTS~"
for _project in $oc_projects ; do oc project $_project &>> $logfile || oc new-project $_project --display-name="Project $_project" --description='~PROJECT_DESCRIPTION~' &>> $logfile || _fail_ "Cannot find or create project $_project missing" ; done
if echo guess | oc login -u system:admin &>> $logfile ; then
_log_ "Listing nodes as system:admin"
oc get nodes -o wide &>> $logfile
oc login -u $oc_user &>> $logfile
`;
if(warningMessage){
	_shellTemplate+="else";
	warningMessage.split("\n").forEach(function(line){_shellTemplate+='\n _warn_ "'+line+'"';});
}
_shellTemplate+=
`
fi
_log_ "Listing pods as $oc_user"
oc get pods -o wide  -n default  &>> $logfile
oc_image_projects=(~IMAGES_INSECURE_PROJECTS~)
oc_image_urls=(~IMAGES_INSECURE_URLS~)
oc_images=(~IMAGES_INSECURE~)
[[ $\{#oc_images[@]} != 0 ]] && _log_ "Populating the docker registry with services images: pull, tag and push"
  for _iImage in $\{!oc_images[@]} ; do
    sudo docker login -u $(oc whoami) -p $(oc whoami -t) docker-registry.default.svc:5000 &>> $logfile || _fail_ "Cannot connect to the internal docker registry as user $oc_user"
    sudo docker pull $\{oc_image_urls[$_iImage]}/$\{oc_images[$_iImage]} || _fail_ "Cannot pull $\{oc_image_urls[$_iImage]}/$\{oc_images[$_iImage]}"
    sudo docker tag $\{oc_image_urls[$_iImage]}/$\{oc_images[$_iImage]} docker-registry.default.svc:5000/$\{oc_image_projects[$_iImage]}/$\{oc_images[$_iImage]} || _fail_ "Cannot tag $\{oc_image_urls[$_iImage]}/$\{oc_images[$_iImage]}"
	sudo docker push docker-registry.default.svc:5000/$\{oc_image_projects[$_iImage]}/$\{oc_images[$_iImage]} || _fail_ "Cannot push docker-registry.default.svc:5000/$\{oc_image_projects[$_iImage]}/$\{oc_images[$_iImage]}"
  done
if `+Misc.getValue('anyuid')+` && echo guess | oc login -u system:admin &>> $logfile ; then
_log_ "Relaxing security policy to match network functions requirements, approving pending certificates"
oc adm policy add-scc-to-user anyuid system:serviceaccount  &>> $logfile &&
oc adm policy add-scc-to-user privileged system:serviceaccount  &>> $logfile &&
oc adm policy add-scc-to-group anyuid system:authenticated  &>> $logfile &&
oc adm policy add-role-to-group view system:serviceaccounts &>> $logfile &&
oc policy add-role-to-user view system:serviceaccount &>> $logfile || _fail_ "Cannot relax security settings"
if test -n "$(oc get csr -o name)" ; then oc get csr -o name | xargs oc adm certificate approve &>> $logfile || _fail_ "Cannot approve pending certificates" ; fi
if test -f openshift_volumes.yaml ; then _log_ "$_displayedAction the persistent volumes with idempotence" && oc process -f openshift_volumes.yaml | oc $_ocAction -f - &>> $logfile && oc get persistentvolumes -o wide || _fail_ "Cannot create persistent volumes" ; fi
fi
_log_ "$_displayedAction the network functions and Helm instances"
for _project in $oc_projects; do 
	oc project $_project &>> $logfile || _fail_ "Cannot switch to project $_project"
	# Deploy custom apps if any
	if test -f openshift_project_$_project.sh ; then _log_ "$_displayedAction openshift_project_$_project.sh on project $_project" && ./openshift_project_$_project.sh $_ocAction &>> $logfile && rm -f openshift_project_$_project.sh &>> $logfile || _fail_ "$_displayedAction openshift_project_$_project.sh "; fi
	# File naming convention for Network functions: openshift_project_<project>.yaml
	# File naming convention for Helm instances: openshift_helm_<project>_<name>.yaml and a first line setting the context as bash variables: _HPE5G_name= _HPE5G_template= _HPE5G_options=
	if test -f openshift_project_$_project.yaml ; then _log_ "$_displayedAction openshift_project_$_project.yaml on project $_project" && _cmd_with_retry "oc process -f openshift_project_$_project.yaml | oc $_ocAction -f -" "Processing" && rm -f openshift_project_$_project.yaml &>> $logfile || _fail_ "$_displayedAction openshift_project_$_project.yaml "; fi
	for _helmValues in $(ls openshift_helm_$\{_project}_*.yaml 2> /dev/null) ; do eval $(head -1 $_helmValues) && _log_ "$_displayedAction $_HPE5G_name with chart $_HPE5G_template $_HPE5G_options on project $_project" && tail -n +2 $_helmValues > _tmp_$_helmValues && _helmAction &>> $logfile && rm -f $_helmValues _tmp_$_helmValues &>> $logfile || _fail_ "$_displayedAction Helm instance on project $_project" ; done
	# Undeployment: wait for pods termination  
	while [[ "$_ocAction" == "delete" ]] && _log_ "Waiting 30s for terminating pods on project $_project" && sleep 30 && oc get pods 2> /dev/null | grep -e Terminating &>> $logfile ; do : ; done
	# If undeployment, indulge 5 seconds to stabilize, then delete the project if no pods, otherwise log a status
	[[ "$_ocAction" == "delete" ]] && sleep 5s && test -n "$(oc get pods --namespace $_project 2>&1 >/dev/null)" && _log_ "No remaining pods in project $_project: deleting" && oc delete project $_project &>> $logfile || oc get all --namespace $_project &>> $logfile 
done
oc login -u $oc_user &>> $logfile || _fail_ "Cannot log as $oc_user"
_log_ "$_displayedAction completed: check $logfile"
`;
return _shellTemplate
	.replace(/~PROJECT_DESCRIPTION~/g,"From HPE5g automated deployer "+document.getElementById("vnfDescriptorWizardVersion").innerHTML+" on: "+Date()+" "+document.getElementById("quickDescription").value)
	.replace(/~PROJECTS~/g,hpe5gResources.projects.join(' '))	// Resolve the list of projects
	.replace(/~IMAGES_INSECURE_PROJECTS~/g,hpe5gResources.openshiftFunctions.map(function(e){if(e.insecureURL())return e.project;}).join(' '))	// Resolve the list of projects per image
	.replace(/~IMAGES_INSECURE_URLS~/g,hpe5gResources.openshiftFunctions.map(function(e){if(e.insecureURL())return e.URL;}).join(' '))	// Resolve the list of URLs per image
	.replace(/~IMAGES_INSECURE~/g,hpe5gResources.openshiftFunctions.map(function(e){if(e.insecureURL())return e.image+':'+e.tag;}).join(' '))	// Resolve the list of insecure images
;}

// Return the untemplated deployment scripts, one per project
// File naming convention for custom apps scripts: openshift_project_<project>.sh
function hpe5gUntemplatedDeploymentsScript(){
	var result="\n# CustomApps deployment scripts";
	Object.keys(hpe5gResources.untemplatedDeployments).forEach(function(project){
		result+="\ncat > openshift_project_"+project+".sh << 'EOF"+project+"'";
		result+="\n#!/bin/bash";
		result+="\n"+hpe5gResources.untemplatedDeployments[project].join(" && ")+" || exit 1";
		result+="\nexit 0";
		result+="\nEOF"+project;
		result+="\nchmod a+x openshift_project_"+project+".sh\n";
	});
	return result;
}

// Return the Helm values files, one per helm instance: header and footer open and close the template, which is idented with tab
function hpe5gHelmValues(header, footer, tab){
	var result="";
	hpe5gResources.openshiftFunctions.forEach(function(networkFunction){
		if(networkFunction.helmChartValues == undefined)return;
		var helmValues="\n"+networkFunction.helmChartValues.content;
		if(header != undefined)result+=header(networkFunction.project, networkFunction.name, networkFunction.helmChart, networkFunction.helmChartOptions);
		if(tab != undefined)helmValues=helmValues.replace(/\n/g, "\n"+tab);	// indentation of objects compared to the project header
		result+=helmValues;
		if(footer != undefined)result+=footer(networkFunction.project, networkFunction.name);
	});
	return result;
}

// Return the OpenShift resources templates, one per project: header and footer open and close the template, which is idented with tab
// If singleProject is provided, returns only the template for this project
function hpe5gNetworkFunctions(header, footer, tab, singleProject){
	var templateHeader=
`
apiVersion: v1
kind: Template
metadata:
  name: ~PROJECT~
  annotations:
    description: network functions and backing services for project ~PROJECT~
objects:`;
	var result="";
	hpe5gResources.projects.forEach(function(project){
		if(singleProject && project != singleProject)return;
		// List of NetworkFunctions deployed on openshift 
		// Replace in the provided template:
		// - name, image, project, volume and replicas with the actual values for this function
		// - dependencies names with the actual name, defined in the template as ~<requirement>_NAME~
		var _header=templateHeader;
		hpe5gResources.openshiftFunctions.forEach(function(networkFunction){
		var deployment='';
		if(networkFunction.project != project)return;
		if(hpe5gResources.defaults[networkFunction.type] && hpe5gResources.defaults[networkFunction.type]['template'])deployment+=hpe5gResources.defaults[networkFunction.type]['template'];
		if(networkFunction.pipeline)deployment+=networkFunction.pipeline;
		if(!deployment)return;
		if(header && _header.length>0)result+=header(project);
		deployment=_header+deployment.replace(/\n/g, "\n  ");	// indentation of objects compared to the header
		if(tab != undefined)deployment=deployment.replace(/\n/g, "\n"+tab);	// indentation of objects compared to the project header
		_header=''; // only one header per project
		deployment=deployment
		.replace(/~NAME~/g,networkFunction.name)
		.replace(/~PROJECT~/g,networkFunction.project)
		.replace(/~IMAGE~/g,networkFunction.image)
		.replace(/~IMAGE_STREAM~/g,networkFunction.imageStream())
		.replace(/~REPLICAS~/g,networkFunction.replicas);
		if(networkFunction.storage){
			deployment=deployment
			.replace(/~STORAGE~/g,networkFunction.storage)
			.replace(/~VOLUME~/g,networkFunction.volume)
			.replace(/~PERSISTENCE_START~|~PERSISTENCE_END~/mg,'');
		}else{
			deployment=deployment.replace(/~PERSISTENCE_START~[\s\S]*?~PERSISTENCE_END~/mg,'');
		}
		
		if(hpe5gResources.depends && hpe5gResources.depends[networkFunction.type])hpe5gResources.depends[networkFunction.type].forEach(function(requirement){
			// The required type can be a simple string or a table of aliases, the first element being the actual required type
			var actualRequirement=requirement;
			if(typeof requirement != "string")actualRequirement=requirement[0];
			var ereg=new RegExp("~"+actualRequirement+"_NAME~","g");
			deployment=deployment.replace(ereg, networkFunction.resolve(requirement));
			});
		result+=deployment;
		});
		if(footer != undefined && _header.length==0)result+=footer(project);
	});
	return result;
}

// ===========================
// OpenShift ansible inventory build
// ===========================
// If no target is specified, publish the inventory in the user output area (or errors)
// Otherwise, just return the same to the caller
function buildInventory(target, engine){
	var quickDescription = document.getElementById("quickDescription");
	quickDescription.setAttribute("value", quickDescription.value);
	document.title = "CMS5G Core Stack "+ quickDescription.value;
	
	consistency.init();
	var warnings = "";
	vnfPorts = new Array();
	
	var openshift = "# -------------------------------------------------------------";
	openshift += "\n# "+quickDescription.value;
	openshift += "\n# CMS HPE 5g openshift inventory generated by the builder "+document.getElementById("vnfDescriptorWizardVersion").innerHTML;
	openshift += "\n# Build date: "+Date();
	openshift += "\n# -------------------------------------------------------------";
	openshift += "\n";
	openshift += "\nansible_become=yes";
	// Immutable part from the environment
	if(target == 'openstack'){
	openshift += "\n# Openstack";
	openshift += "\nopenshift_cloudprovider_kind=openstack";
	openshift += "\nopenshift_cloudprovider_openstack_auth_url=\"{{ lookup('env','OS_AUTH_URL') }}\"";
	openshift += "\nopenshift_cloudprovider_openstack_username=\"{{ lookup('env','OS_USERNAME') }}\"";
	openshift += "\nopenshift_cloudprovider_openstack_password=\"{{ lookup('env','OS_PASSWORD') }}\"";
	openshift += "\nopenshift_cloudprovider_openstack_tenant_id=\"{{ lookup('env','OS_PROJECT_ID') }}\"";
	openshift += "\nopenshift_cloudprovider_openstack_tenant_name=\"{{ lookup('env','OS_PROJECT_NAME') }}\"";
	openshift += "\n# Global Proxy Configuration";
	openshift += "\n# These options configure HTTP_PROXY, HTTPS_PROXY, and NOPROXY environment";
	openshift += "\n# variables for docker and master services.";
	openshift += "\nopenshift_http_proxy=\"{{ lookup('env','OPENSHIFT_HTTP_PROXY') }}\"";
	openshift += "\nopenshift_https_proxy=\"{{ lookup('env','OPENSHIFT_HTTPS_PROXY') }}\"";
	openshift += "\nopenshift_no_proxy='.localdomain'";
	openshift += "\n# Most environments do not require a proxy between OpenShift masters, nodes, and";
	openshift += "\n# etcd hosts. So automatically add those host names to the openshift_no_proxy list.";
	openshift += "\n# If all of your hosts share a common domain you may wish to disable this and";
	openshift += "\n# specify that domain above.";
	openshift += "\nopenshift_generate_no_proxy_hosts=True";
	openshift += "\nansible_ssh_user=\"{{ lookup('env','CLOUD_DEFAULT_USER') }}\"";
	}

	hpe5gResources.init();
	vnfResources.forEach(function(e,i,t){
		openshift += e.build(target, engine);
		warnings += e.check;
	});
	warnings += hpe5gResources.compile();
	warnings += consistency.check();
	openshift += "\n"
	if(warnings != ""){
		userOutput(warnings);
		return "";
	}

	if(target == undefined){
		userOutput(openshift);	
		
		var blobDesc = new Blob([openshift], {type: "text/plain;charset=utf-8"});
		var a = document.createElement('a');
		a.href = window.URL.createObjectURL(blobDesc);
	    a.download = "hpe5g.properties";
	    document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
	}
	return openshift;
}

//=================================
// Session management
//=================================
function sessionHelp(){userOutput(
`Save:
	Saved sessions are self-contained entities, and can be edited at will to reflect topology or feature changes, then saved again as new or modified sessions.
	By clicking the Save button, the whole HTML document is saved in the Download folder managed by the browser as a file named hpe5g.saved.html.
	This saved session gathers all HTML resources defined by the user in a single standalone file.
	NOTE: user loaded files are not part of the HTML document and must be reloaded from the saved session (catalog, Helm values, ...)

Dump:
	Produces a Json image of the current session, as a file named hpe5g.json in the Download folder of the browser.
	This light image does not contain the HTML document; it can be injected by the PUT verb of the Restful interface in headless mode,
	or imported to another session using the Import button.
	
Import:
	Besides, it may be useful to import an existing session in the current one, typically to merge sections from several sessions, 
	or to upgrade an existing session to a new version of the CMS5G Core Stack Assistant, thus benefiting from new features.
	To that aim, from the importing session, click the session file chooser button, and select the imported session file, either
	as a Json or Html file.
	A summary of imported sections is displayed in the text area; it is the user's responsibility to check the merged result 
	and remove or fix inconsistencies before building.

`)};
function saveSession(){
	var quickDescription = document.getElementById("quickDescription");
	quickDescription.setAttribute("value", quickDescription.value);
	
	var blobPage = new Blob([document.documentElement.innerHTML], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobPage);
    a.download = "hpe5g.saved.html";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
}

function importSession(){
	switch(importedSession.contentType){
	case 'html':
		var importedWindow = window.open('', "importedDocument");
		try{
		importedWindow.document.write(importedSession.content);
		var summary = "Import summary";
		var importedQuickDescription = importedWindow.document.getElementById("quickDescription").value;
		if(importedQuickDescription != ""){
			summary += "\nVNF description: " + importedQuickDescription;
			var quickDescription = document.getElementById("quickDescription");
			quickDescription.value += importedQuickDescription;
			quickDescription.setAttribute("value", quickDescription);
		}
		vnfResources.forEach(function(e,i,t){summary += e.import(importedWindow.document);});
		userOutput(summary);
		} catch(e){
			alert("Write to document failed, please try another browser\n" + e.message);
		}
		break;
	case 'json':
		if(jsonSession(importedSession.content))userOutput(importedSession.content);
		break;
	default:
		userOutput("Unsupported content type: "+importedSession.contentType+" ; expected html or json");
		break;
	}
	// Display populated sections
	vnfResources.forEach(function(e,i,t){e.display(!e.isEmpty())});
}

// Import/export the current session as Json payload or import as a JS object
function jsonSession(payload){
	if(payload){
		// Populate the session with provided payload
		var error="";
		// if the payload type is not an object, assume a json string and parse
		try {
			var sections = payload;
			if(typeof(payload) != 'object')sections=JSON.parse(payload); 
			if(!sections || !sections.length){return true;}	
			Object.keys(sections).forEach(function(s) {
				var section=Object.keys(sections[s]);
				if(!window[section]){
					error+="Unexpected section: "+section+"\n\tExpecting one of "+vnfResources.map(function(e){return e.title;}).join()+"\n";
					return;
				}
				Object.values(sections[s]).forEach(function(source){
				  source.forEach(function(row){
					var dest = new Array();
					for(key in row){dest.push({column:key, value:row[key]});}
					var check=window[section].add(dest);
					if(check)error+=check;
				});
			  });
			});
			if(error)throw error;
		  } catch (ex) {
			userOutput("JSON parser exception received:\n"+ex);
			return false;
		  }
		return true;
	}
	var result = new Array;
	vnfResources.forEach(function(e){var v=e.dump(); if(v.length)result.push({[e.title]:v});});
	var jsonPayload=JSON.stringify(result);
	userOutput(jsonPayload);
	// Stop there if headless, ie no user interface
	if(Misc.getValue('headless'))return true;
	
	var blobJson = new Blob([jsonPayload], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobJson);
    a.download = "hpe5g.json";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
	
	return true;
}

// =============================
// OpenShift openstack template build
// =============================
function buildHeatTemplate(){
	var oc_version=document.getElementById("oc_version").value;
	
	// Build the inventory for openstack (or get the errors) and do not publish
	// Required soon enough to get openstack specific variables properly setup
  var openshift = buildInventory('openstack');
	if(openshift.length == 0)return '';
  var useHeatVolumes = Misc.getValue('openstack_volume_size');
    
	var n0="\n";
	var quickDescription = document.getElementById("quickDescription");
	var heat="heat_template_version: 2013-05-23"
	  heat+=n0+"description: '"+quickDescription.value+"'";
  	heat+=n0+"parameters:";
	  heat+=n0+"  NetworkRoot:";
    heat+=n0+"    type: string";
    heat+=n0+"    label: Private network";
    heat+=n0+"    description: 3 dot separated bytes defining the 24 first bits of the internal networks, e.g. 192.168.100";
    heat+=n0+"    default: 192.168.100";
	  heat+=n0+"  Image:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the image used to instantiate storage on nodes";
    heat+=n0+"    default: 'Centos 7.6'";
  	heat+=n0+"  ExternalNetwork:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the external public network used to connect floating IPs";
    heat+=n0+"    default: "+Misc.getValue('extnet');
    heat+=n0+"  SecurityGroup:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the security group attached to the instances";
    heat+=n0+"    default: "+Misc.getValue('openstack_security_group');
    heat+=n0+"  AvailabilityZone:";
    heat+=n0+"    type: string";
    heat+=n0+"    label: Availability zone";
    heat+=n0+"    description: The name of the zone hosting the nodes";
    heat+=n0+"    default: nova";
    heat+=n0+"  flavorTiny:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the openstack flavor used to build tiny nodes";
    heat+=n0+"    default: "+Flavors['openstack']['flavorTiny'].name;
    heat+=n0+"  flavorSmall:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the openstack flavor used to build small nodes";
    heat+=n0+"    default: "+Flavors['openstack']['flavorSmall'].name;
    heat+=n0+"  flavorStandard:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the openstack flavor used to build standard nodes";
    heat+=n0+"    default: "+Flavors['openstack']['flavorStandard'].name;
	  heat+=n0+"  flavorPerformance:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the openstack flavor used to build performance nodes";
    heat+=n0+"    default: "+Flavors['openstack']['flavorPerformance'].name;
  	heat+=n0+"  flavorLarge:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: The name of the openstack flavor used to build large nodes";
    heat+=n0+"    default: "+Flavors['openstack']['flavorLarge'].name;
	  heat+=n0+"  key_name:";
    heat+=n0+"    type: string";
    heat+=n0+"    description: the ssh key injected in the instances for remote access";
    heat+=n0+"    default: ''";
    if(useHeatVolumes){
	  heat+=n0+"  VolumeSize:";
    heat+=n0+"    type: number";
    heat+=n0+"    description: The size in Gb of the volumes attached to the nodes.";
    heat+=n0+"    default: "+useHeatVolumes;
	}
	heat+=n0;
	heat+=n0+"resources:";
	
	// Create networks from Networks.heatNetworks array: 
	// The networks are to be created in the interface number order to ensure that ethX is actually connected to interface X
	// One common router
	heat+=n0+"  Router:";
    heat+=n0+"    type: OS::Neutron::Router";
    heat+=n0+"    properties:";
    heat+=n0+"      admin_state_up: True";
    heat+=n0+"      name: { get_param : 'OS::stack_name' }";
	heat+=n0+"  Gateway:";
    heat+=n0+"    type: OS::Neutron::RouterGateway";
    heat+=n0+"    properties:";
    heat+=n0+"      network: { get_param: ExternalNetwork }";
    heat+=n0+"      router_id: { get_resource: Router }";

	var mgmtName = Networks.getNickname(Networks.heatNetworks['MGMT']); 
  for(var i = Networks.heatMinNetwork; i <= Networks.heatMaxNetwork; i++){
	var interfaceName = Networks.getNickname(i);	// network name, Networks.heatMaxNodes addresses large
	var cidr = Networks.heatMaxNodes*(i-Networks.heatMinNetwork);		// first address in this network
	var gateway = cidr + 1;	// gateway IP for this network
	heat+=n0+"  "+interfaceName+":";
    heat+=n0+"    type: OS::Neutron::Net";
    heat+=n0+"    properties:";
	heat+=n0+"      name: {list_join: [ '-', ['"+interfaceName+"', { get_param : 'OS::stack_name' }]]}";
	heat+=n0+"  "+interfaceName+"-subnet:";
    heat+=n0+"    type: OS::Neutron::Subnet";
    heat+=n0+"    properties:";
    heat+=n0+"      name: {list_join: [ '-', ['"+interfaceName+"', { get_param : 'OS::stack_name' }]]}";
    heat+=n0+"      enable_dhcp: True";
    heat+=n0+"      network: { get_resource: "+interfaceName+" }";
    heat+=n0+"      cidr: { list_join: [ '.', [{ get_param : NetworkRoot}, '"+cidr+"/"+Networks.heatCidrLength+"']]}";
    heat+=n0+"      gateway_ip: { list_join: [ '.', [{ get_param : NetworkRoot}, '"+gateway+"']]}";
    }

	// Connect the management network to the router for floating IPs  
	heat+=n0+"  Router-gw-int:";
    heat+=n0+"    type: OS::Neutron::RouterInterface";
    heat+=n0+"    properties:";
    heat+=n0+"      router_id: { get_resource: Router }";
    heat+=n0+"      subnet_id: { get_resource: "+mgmtName+"-subnet }";
    
    // addr will resolve all ip addresses parameters as a reference to their relative port
    var addr=""; 
    
    var nodesNames = Nodes.cloudNodes.map(function(e){return e.name;});
    
    // For each node: create the ports and optional associated floating IP on all networks, the volume and the instance
    nodesNames.forEach(function(name, indexNode){
    	// Create one port on every network to ensure proper interface numbering, but connect only used interfaces
    	// Prepare the ports declared in the instance as yaml instructions in this variable: port
    	var port="";
      // Prepare the UPF interface definitions as a table in this variable: UPFports
      var UPFports =new Array();
    	for(var iNetwork = Networks.heatMinNetwork; iNetwork <= Networks.heatMaxNetwork; iNetwork++){
			// VIP processing in Heat/OpenStack: 
			// - a VIP is instantiated as a port
			// - a VIP is declared as allowed_address_pairs on the load balancer nodes
	    	var interfaceName = Networks.getNickname(iNetwork);	
	    	var interfaceUp = "True";
	    	if(Nodes.cloudNodes[indexNode].interfaces.indexOf(iNetwork) == -1)interfaceUp = "False";
	    	heat+=n0+"  "+name+"-"+interfaceName+"-port:";
	    	heat+=n0+"    type: OS::Neutron::Port";
	    	heat+=n0+"    properties:";
	      	heat+=n0+"      admin_state_up : "+ interfaceUp;
	      	heat+=n0+"      network: { get_resource: "+interfaceName+" }";
          heat+=n0+"      security_groups: [{ get_param: SecurityGroup }]";

	      	// if this node has VIPs, add allowed_address_pairs accordingly
	      	if(Nodes.cloudNodes[indexNode].hasVIP){
	      		var allowed_address_pairs_header=n0+"      allowed_address_pairs:";
	      		// Search for VIPs on this interface on all nodes
	      		nodesNames.forEach(function(nameVIP, indexVIP){
	      			// if this node is a VIP
	      			if(Nodes.cloudNodes[indexVIP].isVIP){
	      				// This node is a VIP: add an allowed address for all concerned interfaces
	      				for(var iVIP = Networks.heatMinNetwork; iVIP <= Networks.heatMaxNetwork; iVIP++){
	      					// if this VIP is not defined on this interface or disconnected, continue
	      					if(iNetwork != iVIP || interfaceUp != "True")continue;
	      					// Enable this address in the firewall
	      					heat+=allowed_address_pairs_header;
	      					allowed_address_pairs_header=""; 
	      					heat+=n0+"        - ip_address: {get_attr: ["+nameVIP+"-"+Networks.getNickname(iVIP)+"-port, fixed_ips, 0, ip_address]}";
	      				} // add an allowed address for all concerned interfaces
	      			} // if this node is a VIP
	      		}); // Search for VIPs on this interface
	      	}// if this node has VIPs
	      	
	      	port+=n0+"        -";
	      	port+=n0+"          port: { get_resource: "+name+"-"+interfaceName+"-port}";
	      	
	      	// Resolve ip address for this port on this node as ~<node>_<network>~
          if(interfaceUp == "True"){
          var p="~"+name+"_"+interfaceName+"~";
          addr+=n0+p+": {get_attr: ["+name+"-"+interfaceName+"-port, fixed_ips, 0, ip_address]}";
         if(Nodes.cloudNodes[indexNode].isUPF)UPFports.push(Nodes.UPFports(iNetwork-Networks.heatMinNetwork, p));
          }
      	}
      	if(Nodes.cloudNodes[indexNode].interfaces.indexOf(heatPublicInterface) != -1){
	   		heat+=n0+"  "+name+"-"+mgmtName+"-floatingIP:";
	    	heat+=n0+"    type: OS::Neutron::FloatingIP";
	    	heat+=n0+"    properties:";
	      	heat+=n0+"      floating_network: { get_param: ExternalNetwork }";
	      	heat+=n0+"  "+name+"-"+mgmtName+"-floatingIPassociation:";
	    	heat+=n0+"    type: OS::Neutron::FloatingIPAssociation";
	    	heat+=n0+"    properties:";
	      	heat+=n0+"      port_id: { get_resource: "+name+"-"+mgmtName+"-port }";
	      	heat+=n0+"      floatingip_id: { get_resource: "+name+"-"+mgmtName+"-floatingIP }";
	      	// Resolve public ip addresses for this node
	      	addr+=n0+"~"+name+"_pub~: {get_attr: ["+name+"-"+mgmtName+"-floatingIP, floating_ip_address]}";
      	}
      	
      	// if this node is a VIP, neither volume nor instance are needed
      	if(!Nodes.cloudNodes[indexNode].isVIP){
        if(Nodes.cloudNodes[indexNode].volume){
        heat+=n0+"  "+name+"-Volume:";
        heat+=n0+"    type: OS::Cinder::Volume";
        heat+=n0+"    properties: ";
        heat+=n0+"      source_volid: "+Nodes.cloudNodes[indexNode].image;
        heat+=n0+"      name: {list_join: [ '-', ['"+name+"', { get_param : 'OS::stack_name' }]]}";
        heat+=n0+"      size: { get_param: VolumeSize }";
        }
      	heat+=n0+"  "+name+":";
      	heat+=n0+"    type: OS::Nova::Server";
      	heat+=n0+"    properties:";
      	heat+=n0+"      name: "+name;
      	if(Nodes.cloudNodes[indexNode].volume){
      	heat+=n0+"      block_device_mapping: [{ device_name: 'vda', volume_id : { get_resource: "+name+"-Volume } }]";
      	}else{
      	heat+=n0+"      image: "+Nodes.cloudNodes[indexNode].image; 
      	}
      	heat+=n0+"      flavor: { get_param: "+Nodes.cloudNodes[indexNode].flavor+" }";
      	heat+=n0+"      availability_zone: { get_param: AvailabilityZone }";
      	heat+=n0+"      key_name: { get_param: key_name }";
      	heat+=n0+"      networks:";
      	heat+=port;
    	}  	// if this node is a VIP, neither volume nor instance are needed
    	
      // if UPFports definition is to be injected
      if(UPFports.length){
      heat+=n0+"      config_drive: True";
      heat+=n0+"      user_data_format: 'RAW'";
      heat+=n0+"      user_data:";
      heat+=n0+"        str_replace:";
      heat+=n0+"          template: |";
      heat+=n0+"            #!/bin/bash";     
    
      // File dropped on the UPF as startup configuration
      heat+=Nodes.UPFconfig(Nodes.cloudNodes[indexNode].fqdn, UPFports).replace(/\n/g, "\n"+  
                     "            ");
      // Resolve ip addresses parameters preparation, differed when all ports are cumuluated in addr
      heat+=n0+"          params:~all_addresses_resolution~";
      } // UPF ports definition injection
      
      if(Nodes.cloudNodes[indexNode].isUPFrouter){
      heat+=n0+"      config_drive: True";
      heat+=n0+"      user_data_format: 'RAW'";
      heat+=n0+"      user_data:";
      heat+=n0+"        str_replace:";
      heat+=n0+"          template: |";
      heat+=n0+"            #!/bin/bash";     
    
      // File dropped on the UPF as startup configuration
      heat+=Nodes.UPFrouterConfig(Nodes.cloudNodes[indexNode].fqdn).replace(/\n/g, "\n"+  
                     "            ");
      // Resolve ip addresses parameters 
      heat+=n0+"          params:~all_addresses_resolution~";
      } // UPF router configuration injection
      
     	// On the ems (first master), push: the persistent volumes definition and the deployment script hpe5g.sh
		  // Exclude the openshift templates since their cumulated sizes could exceed the maximum allowed as raw data
		  // Openshift templates are passed as specific outputs, one per project
     	if(Nodes.cloudNodes[indexNode].isEms){
      heat+=n0+"      config_drive: True";
      heat+=n0+"      user_data_format: 'RAW'";
		  heat+=n0+"      user_data:";
		  heat+=n0+"        str_replace:";
	  	heat+=n0+"          template: |";
	  	heat+=n0+"            #!/bin/bash";	  	
		
	    // File dropped on the ems ready for deployment
	    heat+=n0+"            cat > /home/centos/openshift_volumes.yaml << 'EOFILE'";
	    // OpenShift system level functions: volumes
	    heat+=n0+'            kind: Template';
	    heat+=n0+'            apiVersion: v1';
	    heat+=n0+'            metadata:';
	    heat+=n0+'              name: system';
	    heat+=n0+'              annotations:';
	    heat+=n0+'                description: persistent volumes for '+document.getElementById("quickDescription").value;
	    heat+=n0+'            objects:';

		//  list of PersistentVolumes for openshift persistent storage as an OpenShift template ready to create
	    PersistentVolumes.openshiftVolumes.forEach(function(volume, i){
	    heat+=n0+'              - kind: "PersistentVolume"';
	    heat+=n0+'                apiVersion: "v1"';
	    heat+=n0+'                metadata:';
	    heat+=n0+'                  name: "'+volume.name+'"';
	    heat+=n0+'                spec:';
	    heat+=n0+'                  capacity:';
	    heat+=n0+'                    storage: "'+volume.size+'Gi"';
	    heat+=n0+'                  accessModes:';
	    heat+=n0+'                    - "'+volume.access+'"';
		heat+=n0+'                  persistentVolumeReclaimPolicy: '+volume.reclaim;
	    heat+=n0+'                  cinder:';
	    heat+=n0+'                    fsType: "'+volume.type+'"';
	    heat+=n0+'                    volumeID: "'+volume.cinder+'"';
	    });
	    heat+=n0+"            EOFILE";
	    heat+=n0+"            chown centos:centos /home/centos/openshift_volumes.yaml && chmod a+r /home/centos/openshift_volumes.yaml";

		// Shell script dropped on the ems node ready to deploy the volumes, projects, and hpe5g network functions 
		heat+=n0+"            cat > /home/centos/hpe5g.sh << 'EOFILE'";
		heat+=n0.concat(shellHeader(),shellBody('oc'),hpe5gUntemplatedDeploymentsScript(),hpe5gDeploymentScript())
		.replace(/\n/g, "\n"+  
	             '            ');	// fix the descriptor indentation as expected by Heat
		heat+=n0+"            EOFILE";
		heat+=n0+"            chown centos:centos /home/centos/hpe5g.sh && chmod a+rx /home/centos/hpe5g.sh";
	 	// Resolve cinder volumes Ids
	 	heat+=n0+"          params:";
	 	CinderVolumes.cloudVolumes.forEach(function(volume, i){
	    heat+=n0+"            ~cinderVolumeIdOf"+volume.name+"~: {get_resource: "+volume.name+"}";
	 	});
		// Resolve ip addresses parameters 
    heat+="~all_addresses_resolution~";    
	  } // if this node is the ems
    }); // For each node: create the resources
	// At that point, all ports are known, addresse resolution may happen
  addr=addr.replace(/\n/g, "\n"+  
         "            "); // fix the indentation as expected by Heat;    
  heat=heat.replace(/~all_addresses_resolution~/g, addr);
  
	// For each CinderVolume
	CinderVolumes.cloudVolumes.forEach(function(volume){
	heat+=n0+"  "+volume.name+":";
    heat+=n0+"    type: OS::Cinder::Volume";
    heat+=n0+"    properties: ";
    heat+=n0+"      name: "+volume.name;
    heat+=n0+"      size: "+volume.size;
    heat+=n0+"      description: "+volume.description;
	}); 
	
    // Add outputs:
    heat+=n0+"outputs:";
	// if an ems exists, publish the ansible inventory
	if(Nodes.cloudNodes.some(function(e){return e.isEms;})){
    heat+=n0+"  openshift_inventory:";
    heat+=n0+"    description: the ansible inventory deploying the openshift cluster";
    heat+=n0+"    value:";
    heat+=n0+"      str_replace:";
    heat+=n0+"        template: |";
	heat+=n0+"            "+openshift.replace(/\n/g, "\n"+  
		            "            ");	// fix the descriptor indentation as expected by tosca
	// Resolve ip addresses parameters 
    heat+=n0+"        params:"+addr.replace(/\n/g, "\n"+  
		     "          ");	// fix the descriptor indentation as expected by Heat
	}
    //  list of public nodes
    heat+=n0+"  public_nodes:";
    heat+=n0+"    description: List of hosts as a name, fqdn, public ip address and groups membership";
    heat+=n0+"    value:";
    // For each non VIP node having a public IP address, required for Ansible client access: publish the name, fqdn, public IP address and group 'base' plus 'ems' for the last node
    nodesNames.forEach(function(name, indexNode){ if(Nodes.cloudNodes[indexNode].isVIP || Nodes.cloudNodes[indexNode].interfaces.indexOf(heatPublicInterface) == -1)return;
    heat+=n0+"      -";
    heat+=n0+"        name: "+name;
    heat+=n0+"        fqdn: "+Nodes.cloudNodes[indexNode].fqdn;
    heat+=n0+"        ipaddress: {get_attr: ["+name+"-"+mgmtName+"-floatingIP, floating_ip_address]}";
    heat+=n0+"        groups: base";
    if(Nodes.cloudNodes[indexNode].isEms){heat+=",ems";}
    if(Nodes.cloudNodes[indexNode].isTester){heat+=",tester";}
    heat+=n0+"        python: "+Nodes.cloudNodes[indexNode].python;
    });
    //  list of all ports with their ip addresses
    heat+=n0+"  ports:";
    heat+=n0+"    description: List of IP addresses for all ports on all hosts";
    heat+=n0+"    value:"+addr.replace(/\n/g, "\n"+  
                   "      "); // fix the descriptor indentation
  // Misc section values
    heat+=n0+"  misc:";
    heat+=n0+"    description: set of miscellaneous properties used by the ansible deployment";
    heat+=n0+"    value:";
    heat+=n0+"      insecure_registries: '"+hpe5gResources.insecureRegistriesList+"'";
    heat+=n0+"      oc_version: "+oc_version;
    Misc.output.forEach(function(item, index){
    heat+=n0+"      "+item.name+": "+item.value;   	
    });
    
	// Add OpenShift templates to deploy if an ems is available
	heat+=n0+"  openshift_templates:";
    heat+=n0+"    description: set of OpenShift templates ready for deployment";
    heat+=n0+"    value:";
    if(Nodes.cloudNodes && Nodes.cloudNodes.some(function(e){return e.isEms;})){
    // OpenShift network functions and Helm instances, per project
	// File naming convention for Network functions and services: openshift_project_<project>.yaml
	// File naming convention for Helm instances: openshift_helm_<project>_<name>.yaml and a first line setting the context as bash variables: _HPE5G_name= _HPE5G_template= _HPE5G_options=
	function heatHeader(project){return "\nopenshift_project_"+project+":";}
	function heatHelmValuesHeader(project, name, template, options){
		return "\nopenshift_helm_"+project+"_"+name+":\n  _HPE5G_name="+name+" _HPE5G_template="+template+" _HPE5G_options='"+options+"'";
	}
	
	// List of NetworkFunctions deployed on openshift
	heat+=hpe5gNetworkFunctions(heatHeader,undefined,'  ').replace(/\n/g, "\n"+  
		     '      ');	// fix the descriptor indentation as expected by Heat
    // List of HelmCharts deployed on openshift
    heat+=hpe5gHelmValues(heatHelmValuesHeader,undefined,'  ').replace(/\n/g, "\n"+  
    	     '      ');	// fix the descriptor indentation as expected by Heat
	}
	
    return heat;
}

function outputHeatTemplate(){
 	var heat=buildHeatTemplate();
 	if(!heat)return false;
 	
 	// Show to the user and save to hpe5g.yaml
    userOutput(heat);
	
	// Stop there if headless, ie no user interface
	if(Misc.getValue('headless'))return true;
	
	var blobHeat = new Blob([heat], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobHeat);
    a.download = "hpe5g.yaml";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
	return true;
}

//=================================
//Heat Stack deployer
//=================================
//Return a shell script deploying the Heat stack
function buildHeatStackDeployer(){
var heatTemplate=buildHeatTemplate();
if(!heatTemplate)return '';
var shell=`
_success_() {
	test -f $oc_stack.json && cat $oc_stack.json
}

# Ensure ansible availability and OpenStack environment setting
which ansible-playbook > /dev/null || _fail_ Missing ansible-playbook: please install ansible-playbook before deploying on OpenStack
test -f $OS_env && source $OS_env &>> $logfile || _fail_ Missing or failing OpenStack environment file $OS_env 
test -f $CLOUD_SSH_KEY || _fail_ Missing $CLOUD_SSH_KEY file: please review CLOUD_SSH_KEY environment variables in the OpenStack environment definition file $OS_env

# Environment expected by Ansible based deployments
export CLOUD_EXTERNAL_NETWORK=$\{CLOUD_EXTERNAL_NETWORK:-$EXTNET}
export ANSIBLE_REMOTE_USER=$CLOUD_DEFAULT_USER
export ANSIBLE_PRIVATE_KEY_FILE=$CLOUD_SSH_KEY

# Create the Heat stack file
cat > $oc_stack.yaml << 'EOFTEMPLATE' 2>> $logfile || _fail_ Cannot create $oc_stack.yaml
`+heatTemplate+`
EOFTEMPLATE

_log_ "$_displayedAction stack $oc_stack on OpenStack with network root $oc_network"
test -f $oc_stack.yaml || _fail_ "Missing Heat template $oc_stack.yaml"

# Apply the templated variables resolution to the Heat template, typically the API and APP floating IPs used in UPF
if test -n "$_templatedVariablesResolution" ; then 
  eval sed -i $oc_stack.yaml "$_templatedVariablesResolution" &>> $logfile || _fail_ OCP4 templated variables resolution sed -i $oc_stack.yaml "$_templatedVariablesResolution"
fi

# Clear the ssh known hosts cache
> ~/.ssh/known_hosts

# Clean the openshift ansible inventory to make sure it is not reused when missing in the current deployment
rm -f openshift-ansible/inventory/$oc_stack.yaml 2> /dev/null
> $oc_stack.json
ansible-playbook  hpe5g.ansible.yml --extra-vars "stack_name=$oc_stack the_template=$oc_stack.yaml the_network=$oc_network cachePatch=$PWD/ the_state=$state" &>> $logfile || _fail_ "OpenStack $_displayedAction of $oc_stack"
_log_ "$_displayedAction stack $oc_stack on OpenStack completed"
if [ $state == "present" ] ; then
 if test -f openshift-ansible/inventory/$oc_stack.yaml ; then
  _log_ "$_displayedAction OpenShift on stack $oc_stack using openshift-ansible/inventory/$oc_stack.yaml"
  if [ "$logfile" != "/dev/stdout" ] ; then _log_ "This takes a while, follow-up available in $logfile" ; fi
  ansible-playbook --extra-vars "openshift_epel_rpm_url=epel-release" -b -i openshift-ansible/inventory/$oc_stack.yaml openshift-ansible/playbooks/prerequisites.yml &>> $logfile && 
  ansible-playbook -b -i openshift-ansible/inventory/$oc_stack.yaml openshift-ansible/playbooks/deploy_cluster.yml &>> $logfile  || _fail_ "OpenShift cluster deployment" 
  eval $(grep ^openshift_ip openshift-ansible/inventory/$oc_stack.yaml) &>> $logfile && 
  ssh  -i $CLOUD_SSH_KEY centos@$openshift_ip "sudo cat /etc/origin/master/admin.kubeconfig" &>> $logfile > $oc_stack.kubeconfig  || _fail_ "Cannot retrieve kubeconfig from $openshift_ip /etc/origin/master/admin.kubeconfig"
  export KUBECONFIG=$oc_stack.kubeconfig && oc login -u guest -p guest &>> $logfile || _fail_ "Cannot login as guest with kubeconfig $oc_stack.kubeconfig to the cluster at $openshift_ip"
  _log_ "$_displayedAction OpenShift on stack $oc_stack completed: KUBECONFIG=$oc_stack.kubeconfig ; GUI https://$openshift_ip:8443"  
`;
 // OpenShift is deployed, ready or resource deployment, unless insecure registries are required by the deployed resources
 if(!hpe5gResources.insecureRegistriesList ){shell+=buildNetworkFunctions();}
 // Otherwise, invite the user to run the embedded installer
 else shell+=`
  _log_ "- Connect to OpenShift GUI as guest/guest" 
  _log_ "https://$openshift_ip:8443" 
  _log_ "- Connect to the first master" 
  _log_ "ssh -i $CLOUD_SSH_KEY centos@$openshift_ip" 
  _log_ "Login as guest: " 
  _log_ "oc login -u guest -p guest" 
  _log_ "Deploy HPE network functions:" 
  _log_ "./hpe5g.sh --log hpe5g.log" 
`;
shell+=`
 fi
 _success_
else
  # Undeployment of the OpenShift cluster done: exit now
  exit 0
fi
`;
return shell;
}


//=================================
//OCP4 deployer
//=================================
//Return a shell script deploying OpenShift 4
function buildOCP4Deployer(){
  // Build or get the errors: the OpenShift nodes have a dependeny on the flavors: build them beforehand
  var warnings=Flavors.build()+OpenShiftNodes.build();
  // If no openshift instances are defined, display warnings and return
  if(!OpenShiftNodes.instances){
    userOutput(warnings);
    return '';
  }
  return `
_failOCP4_() {
  # if running, stop the background task disabling OpenStack ports security
  stopBackgroundSecurityDisabling
  _fail_ $*
}
# Check pre-requisites
OCPrequirements() {
  which openstack > /dev/null && _log_ "Openstack CLI available" || _failOCP4_ "Missing openstack CLI "
  which jq > /dev/null && _log_ "jq CLI available" || _failOCP4_ "Missing jq CLI"
}

# Disable port security as a workaround for OpenShift cluster intra communication
# Forever every single minute
disableSecurityPortsForInstance() {
  local _name=$1
  test -n "$_name" || _failOCP4_ "Missing openshift project for disabling port security"
  while sleep 1m ; do 
    # Identify the first subnet of the openstack network which name starts with the parameter followed by a dash
    subnet=$(openstack network list -f json | jq -r -c '.[] | select( .Name | startswith("'$\{_name}-'")) | .Subnets')
    [[ "$subnet" =~ "[" ]] && subnet=$(echo $subnet | jq -r .[0])
    [[ $subnet =~ "-" ]] || continue
    subnetname=$(openstack subnet show $subnet -f json | jq -r .name)
    # Get the ports IDs on this subnet
    ports=$(openstack port list --fixed-ip subnet=$subnet -f json | jq -r -c '.[].ID' )
    # Reset security on each port
    for p in $ports ; do 
      # if port security enabled => disable
      $(openstack port show $p -f json | jq .port_security_enabled) &&
      echo BACKGROUND Disabling security on port $p subnet $subnetname &>> $logfile && 
      openstack port set $p --no-allowed-address --no-security-group --disable-port-security &>> $logfile 
    done
  done
}

startBackgroundSecurityDisabling() {
  local _name=$1
  _log_ "Background task for OpenStack port security disabling started for openshift instance $_name"
  disableSecurityPortsForInstance $_name &>> $logfile  &
  PIDdisableSecurityPortsForInstance=$!
  NAMEdisableSecurityPortsForInstance=$_name
}
stopBackgroundSecurityDisabling() {
  test -n "$PIDdisableSecurityPortsForInstance" && 
  kill $PIDdisableSecurityPortsForInstance &>> $logfile && 
  wait $PIDdisableSecurityPortsForInstance 2>/dev/null &&
  unset PIDdisableSecurityPortsForInstance && 
  _log_ "Background task for OpenStack port security disabling stopped for openshift instance $NAMEdisableSecurityPortsForInstance"
}

flavorCheckAttributes() {
  local _f=$1
  # Check the flavor attributes  hw:cpu_policy hw:mem_page_size hw:numa_nodes against shared 1GB 2 respectively
  # Formatting: openstack returns the flavor properties as a string like: "hw:cpu_policy='shared', hw:mem_page_size='1GB', hw:numa_nodes='2'"
  # Thanks to tr -d ',:' the columns and commas are removed from this string to make it a valid bash variable definition set, easing the processing
  local _flavor_properties=(cpu_policy mem_page_size numa_nodes)
  local _flavor_values=(shared 1GB 2)
  for _property in $(openstack flavor show $_f  -f json | jq -r .properties | tr -d ',:') ; do eval local $_property ; done
  local _i=$\{#_flavor_properties[@]}
  local _v=""
  while (($_i)) ; do ((_i--)) && _v=hw$\{_flavor_properties[$_i]} && [[ "$\{!_v}" == "$\{_flavor_values[$_i]}" ]] || _failOCP4_  "Flavor $_f missing property hw:$\{_flavor_properties[$_i]}=$\{_flavor_values[$_i]}" ; done
}

fipCheckCreate() {
  # First argument is the *name* of the variable holding the FIP value candidate
  # Second argument: comment associated to the FIP to be created if needed
  # Invoke: fipCheckCreate FIPAPI "OpenShift FIPAPI etc"
  local _fipName=$1
  local _fipValue=$\{!_fipName}
  local _fipComment=$\{2:-OpenShift cluster floating IP $_fipName}
  local _fipID
  if test -n "$_fipValue" && [ "$_fipValue" != "?" ] ; then
    # Fip is provided: check if it exists in this project 
    _fipID=$(openstack floating ip list -f json | jq -r '.[] | select( .Project=="'$OS_PROJECT_ID'") | select( ."Floating IP Address"=="'$_fipValue'")  | .ID')
    test -n "$_fipID" && _log_ Floating IP $_fipName=$_fipValue checked || _failOCP4_ "Floating IP $_fipValue not found in OpenStack project $OS_PROJECT_NAME $OS_PROJECT_ID"
  else
    # FIP is to be created
    _fipID=$(openstack floating ip create $_extnet --description "$_fipComment" -f json | jq -r -c '.id' )
    _fipValue=$(openstack floating ip show $_fipID -f json | jq -r .floating_ip_address)
    test -n "$_fipID" && _log_ Floating IP $_fipName=$_fipValue created || _failOCP4_ "Cannot allocate floating IP $_fipName"
    # Update the input variable with its actual value
    eval $_fipName=$_fipValue
  fi
}

# Deployment
# Input parameters: _name _domain _flavor _masters _workers  _extnet _extdns _fipapi _fipapp _nbVolumes [_flavorWorker]
deployOCP() {
  local _name=$1
  local _domain=$2
  local _flavor=$3
  local _masters=$4
  local _workers=$5
  local _extnet=$6
  local _extdns=$7
  local _fipapi=$8
  local _fipapp=$9
  local _nbVolumes=$10
  local _flavorWorker=$\{11:-$_flavor}
  
  # Check openshift deployments CLIs
  which oc > /dev/null && _log_ "oc CLI available version $(oc version 2> /dev/null | grep 'Client Version'  | awk '{print $3}')" || _failOCP4_ "Missing oc CLI "
  which openshift-install > /dev/null && _log_ "openshift-install CLI available version $(openshift-install version | grep openshift-install | awk '{print $2}')" || _failOCP4_ "Missing openshift-install CLI"
   
  # Check OpenStack certificate, flavor and external network definition 
  test -n "$OS_CACERT" && test -f "$OS_CACERT" || _failOCP4_ "Cannot find OS_CACERT $OS_CACERT from environment file $os_env"
  openstack network list > /dev/null && _log_ "Connection to openstack API successful" || _failOCP4_ "Cannot connect to openstack CLI"
  openstack network show $_extnet > /dev/null && _log_ "External network $_extnet found in OpenStack" || _failOCP4_ "External network $_extnet not found in OpenStack"
  for _f in $_flavorWorker $_flavor ; do openstack flavor show $_f > /dev/null && _log_ "Flavor $_f found in OpenStack" || _failOCP4_ "Flavor $_f not found in OpenStack" ; done
  
  # Check the flavor attributes  
  flavorCheckAttributes $_flavor
  flavorCheckAttributes $_flavorWorker  
  
  # Check volumes quota and adjust if needed
  if (( $(openstack quota show -f json | jq .volumes) < $_nbVolumes )) ; then openstack quota set --volumes $_nbVolumes $OS_PROJECT_NAME || _failOCP4_ "Cannot set volumes quota to $_nbVolumes in OpenStack" ; fi

  # Allocate two floating IPs: API and APP unless they are preallocated
  fipCheckCreate _fipapi "OpenShift cluster $_name API"
  fipCheckCreate _fipapp "OpenShift cluster $_name APP"
  
  # Add those IPs as name_API and name_APP variables, potentially useful for other resources references, eg UPF
  _templatedVariablesResolution+=" -e 's/~$\{_name}_API~/$_fipapi/g'"
  _templatedVariablesResolution+=" -e 's/~$\{_name}_APP~/$_fipapp/g'"

  # Populate /etc/hosts
  if $\{ETCHOSTS:-false} ; then 
  _log_ "Updating /etc/hosts"
  cat << EOF | sudo tee -a /etc/hosts &>> $logfile || _failOCP4_ "Cannot update /etc/hosts"
#### BofS OpenShift cluster $_name.$_domain ####
$_fipapi api.$_name.$_domain
$_fipapp console-openshift-console.apps.$_name.$_domain
$_fipapp integrated-oauth-server-openshift-authentication.apps.$_name.$_domain
$_fipapp oauth-openshift.apps.$_name.$_domain
$_fipapp prometheus-k8s-openshift-monitoring.apps.$_name.$_domain
$_fipapp grafana-openshift-monitoring.apps.$_name.$_domain
$_fipapp kibana-openshift-logging.apps.$_name.$_domain
$_fipapp jaeger-production-css-observability.apps.$_name.$_domain
$_fipapp downloads-openshift-console.apps.$_name.$_domain
#### EofS OpenShift cluster $_name.$_domain ####
EOF
  fi

  mkdir -p $_name || _failOCP4_ "Cannot create installation directory $_name"
  # Build clouds.yaml
  cat > $_name/clouds.yaml << EOF || _failOCP4_ "Cannot build clouds.yaml"
clouds:
  openstack:
    auth:
      auth_url: $OS_AUTH_URL
      username: "$OS_USERNAME"
      password: "$OS_PASSWORD"
      project_id: $OS_PROJECT_ID
      project_name: "$OS_PROJECT_NAME"
      user_domain_name: "$OS_USER_DOMAIN_NAME"
    region_name: "$OS_REGION_NAME"
    interface: "$OS_INTERFACE"
    identity_api_version: $OS_IDENTITY_API_VERSION
    cacert: $OS_CACERT
    insecure: true
    verify: false
EOF
# Push a working copy of clouds.yaml in the current directory consumed by the OpenShift installer
cp -f $_name/clouds.yaml $PWD &>> $logfile || _failOCP4_ "Cannot push $_name/clouds.yaml to $PWD"

  # Build install-config.yaml
  cat > $_name/install-config.yaml << EOF || _failOCP4_ "Cannot build install-config.yaml"
apiVersion: v1
baseDomain: $_domain
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  platform: 
    openstack:
      type: $_flavorWorker
  replicas: $_workers
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  platform: {}
  replicas: $_masters
metadata:
  creationTimestamp: null
  name: $_name
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.0.0.0/16
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  openstack:
    apiVIP: 10.0.0.5
    cloud: openstack
    computeFlavor: $_flavor
    externalDNS:
    - $_extdns
    externalNetwork: $_extnet
    ingressVIP: 10.0.0.7
    lbFloatingIP: $_fipapi
publish: External
pullSecret: '$RHELSECRET'
EOF
# Add proxy section if defined in the environment
test -n "$OPENSHIFT_HTTP_PROXY$OPENSHIFT_HTTPS_PROXY$OPENSHIFT_NO_PROXY" && cat >> $_name/install-config.yaml << EOF
proxy:
EOF
test -n "$OPENSHIFT_HTTP_PROXY" && cat >> $_name/install-config.yaml << EOF
  httpProxy: $OPENSHIFT_HTTP_PROXY
EOF
test -n "$OPENSHIFT_HTTPS_PROXY" && cat >> $_name/install-config.yaml << EOF
  httpsProxy: $OPENSHIFT_HTTPS_PROXY
EOF
test -n "$OPENSHIFT_NO_PROXY" && cat >> $_name/install-config.yaml << EOF
  noProxy: $OPENSHIFT_NO_PROXY
EOF
# Retrieve from openstack and add public ssh key if defined in the environment
if test -n "$OS_SSH_KEY_PAIR" ; then
 openstack keypair show $OS_SSH_KEY_PAIR --public-key  &>> $logfile || _failOCP4_  "Cannot get ssh key $OS_SSH_KEY_PAIR from openstack"
 cat >> $_name/install-config.yaml << EOF || _failOCP4_ "Cannot add private ssh key $OS_SSH_KEY_PAIR in install-config.yaml"
sshKey:  $(openstack keypair show $OS_SSH_KEY_PAIR --public-key)
EOF
fi
# Save a copy of the install-config.yaml consumed by the OpenShift installer
cp -f $_name/install-config.yaml $_name/install-config.saved.yaml &>> $logfile || _failOCP4_ "Cannot save $_name/install-config.yaml to $_name/install-config.saved.yaml"

  # Disable port security in background
  startBackgroundSecurityDisabling $_name

  # Deploy the cluster and stop the background task disabling OpenStack ports security
  _log_ "Deploying the OpenShift cluster $_name"
  if [ "$logfile" != "/dev/stdout" ] ; then _log_ "This takes a while, follow-up available in $logfile" ; fi
  $_preview openshift-install create cluster --dir $_name --log-level debug &>> $logfile || _failOCP4_ "Cannot create OpenShift cluster $_name"
  stopBackgroundSecurityDisabling

  _log_ "Checking deployment completion" 
  $_preview openshift-install wait-for install-complete --dir $_name --log-level debug &>> $logfile || _failOCP4_ "OpenShift cluster creation did not complete"
  
  # Preview mode: stop here, nothing instantiated
  test -n "$_preview" && _log_ "Preview mode: skipping application floating IP association" && return 0

  # Identify the first subnet of the openstack network which name startswith the parameter followed by a dash
  subnet=$(openstack network list -f json | jq -r -c '.[] | select( .Name | startswith("'$_name-'")) | .Subnets')
  [[ "$subnet" =~ "[" ]] && subnet=$(echo $subnet | jq -r .[0])
  [[ $subnet =~ "-" ]] || _failOCP4_ "No subnet found for $_name: cannot find ingress port"
  # Get the ingress ports IDs on this subnet
  port=$(openstack port list --fixed-ip subnet=$subnet -f json | jq -r -c '.[] | select( .Name | contains("ingress")) | .ID')
  # Associate cluster ingress port $port to apps FIP_APPS_LB $_fipapp
  test -n "$port" || _failOCP4_ "Ingress port not found for $_name"
  openstack floating ip set --port $port $_fipapp && _log_ Connecting APP Floating IP $_fipapp to port $port || _failOCP4_ "Cannot associate port $port to apps FIP_APPS_LB $_fipapp"
  
  _log_ "Checking OCP login as kubeadmin on $_name with KUBECONFIG=$_name/auth/kubeconfig and kubeadmin-password $(cat $_name/auth/kubeadmin-password)"
  export KUBECONFIG=$_name/auth/kubeconfig
  oc login -u kubeadmin -p $(cat $_name/auth/kubeadmin-password) &>> $logfile || _failOCP4_ "Cannot login to OCP cluster $_name as kubeadmin"
`+
// Cluster is ready for openshift resources deployment
buildNetworkFunctions()
+`
}

# Undeployment
undeployOCP() {
  local _name=$1
  local _domain=$2
  local _fipapi=$3
  local _fipapp=$4

  openstack network list > /dev/null && _log_ "Connection to openstack API successful" || _failOCP4_ "Cannot connect to openstack CLI"
  
  # Restore the original clouds.yaml from this instance directory
  cp -f $_name/clouds.yaml $PWD &>> $logfile || _failOCP4_ "Cannot retrieve $_name/clouds.yaml to $PWD" 

  # Stop the background task disabling OpenStack ports security
  stopBackgroundSecurityDisabling

  # Delete cluster
  _log_ "Destroying OpenShift cluster $_name"
  $_preview openshift-install destroy cluster --dir $_name --log-level debug &>> $logfile || _failOCP4_ "Cannot destroy cluster $_name"

  # Delete floating IPs by selecting the description set at creation time in this OpenStack project excluding static IPs if any
  _log_ "Searching floating IPs to release for cluster $_name"
  allfips=$(openstack floating ip list -f json | jq -r '.[] | select( .Project=="'$OS_PROJECT_ID'") | select( ."Floating IP Address"=="'$_fipapi'" | not)  | select( ."Floating IP Address"=="'$_fipapp'" | not) | .ID')
  fips=$(for f in $allfips ; do openstack floating ip show $f -f json | jq -r '. | select( .description | startswith("OpenShift cluster '$_name'")) | .id' ; done)
  for f in $fips ; do _log_ Deleting floating IP $f && openstack floating ip delete $f &>> $logfile ; done

  # Cleanup /etc/hosts
  if $\{ETCHOSTS:-false} ; then 
    _log_ "Cleaning up /etc/hosts of cluster $_name"
    sudo sed -i '/#### BofS OpenShift cluster '$_name.$_domain' ####/,/#### EofS OpenShift cluster '$_name.$_domain' ####/d' /etc/hosts &>> $logfile || _failOCP4_ "Cannot cleanup /etc/hosts"
  fi
}

# Main entry point
OCPrequirements

# Templated variables resolution: prepare a list of variables resolutions as a string of sed options aimed at replacing templated variables with their actual values 
# typically resulting from OCP4 clusters instantiation
# Example: -e 's/~$myocp_APP~/10.33.0.12/g'
_templatedVariablesResolution=""

# For all instance names, deploy or undeploy
i=0 && while (( i <  $\{#OCP[@]} )) ; do 
  os_env=$\{OS_env[i]:-$OS_env}
  if test -n "$os_env" ; then
    source $os_env || _failOCP4_ "Environment file $os_env not found"
  fi
  
  $_deploy && deployOCP $\{OCP[i]:-$OCP} $\{DOMAIN[i]:-$DOMAIN} $\{FLAVOR[i]:-$FLAVOR} $\{MASTERS[i]:-$MASTERS} $\{WORKERS[i]:-$WORKERS} $\{EXTNET[i]:-$EXTNET} $\{EXTDNS[i]:-$EXTDNS} $\{FIPAPI[i]:-$FIPAPI} $\{FIPAPP[i]:-$FIPAPP} $\{NBVOLUMES[i]:-$NBVOLUMES} $\{FLAVORWORKER[i]:-$FLAVORWORKER} || undeployOCP $\{OCP[i]:-$OCP} $\{DOMAIN[i]:-$DOMAIN} $\{FIPAPI[i]:-$FIPAPI} $\{FIPAPP[i]:-$FIPAPP} 
  ((i+=1))
done
`;
return shell;
}
//=================================
//Catalog of resources
//=================================
var catalogDoc=
`The catalog is an internal object defining the types and attributes of the CMS5G Core Stack resources deployable from the assistant on an OpenShift cluster.
It consists in four sections:
  - types
  - dependencies
  - values
  - admin

1. types:
  Define the name of each type of resource managed by the assistant.
  Each name must fall in one of those categories: `+hpe5gResources.sections.join()+`
2. dependencies:
  Define for each type the list of required resources by their type names.   
  If a dependency can be resolved by different types, a list can be provided as a json table.    
  The placeholder used in templates is the first element in this list.    
  Example: telegraf can play an influxdb type, and can be deployed as an indirect service or a helm chart.    
    The udsf resource requiring both ignite and influxdb resources can specify this dependencies list:   
	"nudsf-dr": ["ignite",["influxdb","telegraf","telegraf-chart"]]   
    The udsf template has to use the placeholders ~ignite_NAME~ and ~influxdb_NAME~ to enable the dependencies resolution at deployment time.    
3. values:
  Define for each type the values used as default for the resources attributes. The list of attributes offering default values depends on the resource category:
    - IndirectServices,NetworkFunctions,DirectServices: URL, image, tag, template
    - Operators: template
    - HelmCharts: chart    
4. admin:
  Define for each type if it requires special privileges for deployment (optional, default to false)    
  If true, a warning is emitted to inform the user that the deployment may fail if run without admin privileges.    

<a name="dependenciesResolution"></a>
###Template parameters and dynamic dependencies resolution
The template attribute in the values section is a YAML description of the OpenShift template used for deploying the resource. It must/may include those placeholders:
  - must: 
      - ~NAME~ is the name of the resource
      - ~PROJECT~ is the name of the OpenShift project (namespace)
  - may:
      - ~IMAGE~ is the name of the docker image
      - ~REPLICAS~ is the number of replicas
      - ~dependency_NAME~ is a reference to the actual name of a dependency for this resource.    
      This placeholder allows dynamic resolution of dependencies between resources. For instance, in the udsf template, the datasource service name ~ignite_NAME~ will be dynamically resolved as the actual name of the ignite instance in this project for this deployment.
      - ~VOLUME~ if the persistent storage can be hosted on a specific volume; this placeholder is replaced with "volumeName: the_volume_name" at build time
      - ~PERSISTENCE_START~conditional_sequence~PERSISTENCE_END~ useful to manage resources with optional persistent storage like ignite: 
    		the conditional sequence is removed when no persistent storage is defined by the user for this resource    
     
Those placeholders are processed at build time with the actual values defined by the user.
Templates can also be loaded as files from the GUI using the Import Yaml template button in the Catalog fieldset. See the online help for more details.  
`;
function catalogHelp(){userOutput(catalogDoc+`
User interface buttons:
Display:
  Output a human readable view of the current catalog. The depth and length of the view can be tuned with the 'depth' and 'ellipsis' drop down boxes.
Export Json catalog:
  Output the current catalog in JSON format and save the same as a file in the download folder of the browser named: hpe5g.catalog.json
Import Json catalog: 
  Loads a custom catalog from a user provided JSON file; the user is prompted to either override or extend the current catalog.
Import Yaml template
  Loads a custom yaml file to override the template attribute of a type existing in the catalog; the user is prompted to provide the name of the type to override.
  This feature is useful for loading very long or complex yaml templates compared to providing the same as json payload in the catalog.
  This yaml file must be formatted as the body of an OpenShift template, ie a table of resources definitions like:
- kind: ServiceAccount
	apiVersion: v1
	metadata:
	  name: ~NAME~
	  namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: v1
  ....
- kind: xxx
  ...
`)};

var yamlImport = new userLoadedFile("yamlImport", "Import Yaml template...", importYaml);
if(!yamlImport.isDefined())document.getElementById("catalogArea").appendChild(yamlImport.getDomElement());
function importYaml(){
	var userYaml;
	var check="";
	var type=prompt("To which type this template applies?");
	if(!hpe5gResources.defaults[type])check+="Type "+type+" not found in the current catalog; please update the catalog beforehand";
	else try{
		userYaml=YAML.parse(yamlImport.content);
  		hpe5gResources.defaults[type]['template']=yamlImport.content;
	}catch(e){check+="Parsing exception received: "+e; }
	userOutput(check ? check : objToString(userYaml));
}

var catalogImport = new userLoadedFile("catalogImport", "Import Json catalog...", importCatalog);
if(!catalogImport.isDefined())document.getElementById("catalogArea").appendChild(catalogImport.getDomElement());
function exportCatalog(){
	var catalog=JSON.stringify({types: hpe5gResources.types, dependencies: hpe5gResources.depends, values: hpe5gResources.defaults, admin: hpe5gResources.admin});
	userOutput(catalog);
	// Stop there if headless, ie no user interface
	if(Misc.getValue('headless'))return true;
	
	var blobCatalog = new Blob([catalog], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobCatalog);
    a.download = "hpe5g.catalog.json";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
	return true;
}
function importCatalog(jsonCatalog = catalogImport.content, silent = false){
  var result=false;
  try {
    var catalog = JSON.parse(jsonCatalog); 
    // Catalog sanity check
    var check="";
    var importedTypes = new Array();
    Object.keys(catalog).forEach(function(key) {
    	switch(key){
    	case 'types': 
    		Object.keys(catalog[key]).forEach(function(type) {
        		if(hpe5gResources.sections.indexOf(type)<0){check+="\nLevel 2: "+key+":invalid type "+type+"; expected: "+hpe5gResources.sections.join(); return;}
        		importedTypes = importedTypes.concat(catalog[key][type]);
    		});
    		break;
    	case 'dependencies': case 'values': case 'admin':
    		if(importedTypes.length==0){check+="\nLevel 1: missing types section in first position"; break;}
    		Object.keys(catalog[key]).forEach(function(type) {
    			if(importedTypes.indexOf(type)<0){check+="\nLevel 2: "+key+": unknown type "+type+"; expected: "+importedTypes.join(); return;}
    			// JSON.parse may render emtpy tables as {} with no length defined: force an array in dependencies sections
    			if(key=='dependencies' && catalog[key][type].length == undefined)catalog[key][type]=new Array();
    		});
    		break;
    	default: 
    		check+="\nLevel 1: invalid key "+key+"; expected: types,dependencies,values,admin";
    		break;
    	}
	});
    if(check.length>0)userOutput("Inconsistent imported catalog:"+check);
    else if (silent || confirm("You are about to override the current catalog with imported data. Click Cancel to merge both instead.")) {
  	  hpe5gResources.types=catalog.types; 
  	  // Init sections missing in the imported catalog with an empty table
  	  hpe5gResources.sections.forEach(function(section){if(!hpe5gResources.types[section])hpe5gResources.types[section]=new Array;});
  	  hpe5gResources.depends=catalog.dependencies; 
  	  hpe5gResources.defaults=catalog.values; 
  	  hpe5gResources.admin=catalog.admin;
  	} else {
  	  Object.keys(hpe5gResources.types).forEach(function(section) {hpe5gResources.types[section]=hpe5gResources.types[section].concat(catalog.types[section]);});
  	  hpe5gResources.depends=hpe5gResources.depends?Object.assign(hpe5gResources.depends, catalog.dependencies):catalog.dependencies; 
      hpe5gResources.defaults=hpe5gResources.defaults?Object.assign(hpe5gResources.defaults, catalog.values):catalog.values; 
      hpe5gResources.admin=hpe5gResources.admin?Object.assign(hpe5gResources.admin, catalog.admin):catalog.admin;
  	}
    if(!silent)userOutput(objToString(catalog));
    result=true;
  } catch (ex) {
  	userOutput("JSON parser exception received:\n"+ex);
  }
  return result;
}

// Gratitude to https://stackoverflow.com/questions/1199352/smart-way-to-truncate-long-strings
String.prototype.trunc = String.prototype.trunc ||
function(n){
    return (n != 0 && this.length > n) ? this.substr(0, n-1) + '&hellip;' : this;
};
// Gratitude to https://stackoverflow.com/questions/5612787/converting-an-object-to-a-string
var catalog_display_depth=0;
var catalog_display_ellipse=0;
function objToString(obj, ndeep) {
	if(catalog_display_depth != 0 && ndeep > catalog_display_depth){ return '&hellip;'; }
    if(obj == null){ return String(obj); }
    switch(typeof obj){
      case "string": return String('"'+obj+'"').trunc(catalog_display_ellipse);
      case "function": return obj.name || obj.toString();
      case "object":
        var indent = Array(ndeep||1).join('\t'), isArray = Array.isArray(obj);
        return '{['[+isArray] + Object.keys(obj).map(function(key){
             return '\n\t' + indent + key + ': ' + objToString(obj[key], (ndeep||1)+1);
           }).join(',') + '\n' + indent + '}]'[+isArray];
      default: return obj.toString();
    }
  }
function displayCatalog(){
	catalog_display_depth=0;
	var _catalog_display_depthDOM=document.getElementById("catalog_display_depth");
	if(_catalog_display_depthDOM != undefined){
		var candidate = Number(_catalog_display_depthDOM.value);
		if(!isNaN(candidate))catalog_display_depth=candidate;
	}
	catalog_display_ellipse=0;
	var _catalog_display_ellipseDOM=document.getElementById("catalog_display_ellipse");
	if(_catalog_display_ellipseDOM != undefined){
		var candidate = Number(_catalog_display_ellipseDOM.value);
		if(!isNaN(candidate))catalog_display_ellipse=candidate;
	}

	var catalog={types: hpe5gResources.types, dependencies: hpe5gResources.depends, values: hpe5gResources.defaults, admin: hpe5gResources.admin};
	userOutput("Catalog:\n"+objToString(catalog));
}
//=================================
//OpenShift network functions build
//=================================
// Return a shell script deploying resources on OpenShift
// Two options: oc (openshift cli) or curl (openshift rest api) based
// The curl options support multiple targeted clusters, defined in Clusters.targeted array
// If Clusters.targeted is empty, the oc options is used ; otherwise oc and helm are invoked on the single target cluster defined in the user context
function buildNetworkFunctions(){
	hpe5gResources.init();

	// Check the hpe5gResources sections + Builds and Clusters (or get the errors)
	var check = '';
	['Builds', 'CustomApps', 'Clusters'].concat(hpe5gResources.sections).forEach(function(section){
		window[section].build();
		check += window[section].check;
	});
	check += hpe5gResources.compile();
	if(check){userOutput(check); return '';}
	
  if(!hpe5gResources.projects.length)return '';
  
	var shell='';
	var warningMessage='';
	
	if(hpe5gResources.adminList.length > 0){
		warningMessage='Resource(s) requiring special privileges might jeopardize the deployment:'+hpe5gResources.adminList;
		if(!Misc.getValue('headless') && !confirm(warningMessage)){userOutput(warningMessage); return '';}
	}

	if(Clusters.targeted == undefined || Clusters.targeted.length == 0){
    	// File naming convention for Network functions: openshift_project_<project>.yaml
    	// File naming convention for Helm instances: openshift_helm_<project>_<name>.yaml and a first line setting the context as bash variables: _HPE5G_name= _HPE5G_template= _HPE5G_options=
    	function catHeader(project){return "\ncat > openshift_project_"+project+".yaml << 'EOFILE'"};
    	function catHelmValuesHeader(project, name, template, options){
    		return "\ncat > openshift_helm_"+project+"_"+name+".yaml << 'EOFILE'\n_HPE5G_name="+name+" _HPE5G_template="+template+" _HPE5G_options='"+options+"'";
    	}
    	function catFooter(project){return "\nEOFILE"};
    	
    	shell+=shellBody('oc');
    	shell+=hpe5gNetworkFunctions(catHeader, catFooter);
    	shell+=hpe5gHelmValues(catHelmValuesHeader, catFooter);
		  shell+=hpe5gUntemplatedDeploymentsScript();
    	shell+=hpe5gDeploymentScript(warningMessage);
	}else{
		shell+=shellBody('curl');
		
		if(hpe5gHelmValues().length > 0){check+='\nHelm based deployments not supported on OpenShift REST API, only on CLI' ;}
		if(Object.keys(hpe5gResources.untemplatedDeployments).length > 0){check+='\nCustom Apps deployments not supported on OpenShift REST API, only on CLI' ;}
		if(check){userOutput(check); return '';}

		Clusters.targeted.forEach(function(cluster){
			hpe5gResources.projects.forEach(function(project){
				// Get the resources to deploy as a Json string
				var jsonPayload=undefined;
				try{
					jsonPayload=JSON.stringify(YAML.parse(hpe5gNetworkFunctions(undefined,undefined,undefined,project)));
				}catch(e){check+="Parsing exception received on project "+project+": "+e;  return;}
				// Create the project if it does not exist or fail in case of deletion
				shell+='\n_log_ "Checking project '+project+' on cluster '+cluster.name+'"';
				shell+='\nuntil curl -f -v -k -X GET -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/apis/project.openshift.io/v1/projects/'+project+'  &>> $logfile ; do ';
				shell+='\n$_deploy || _fail_ "Cannot check if project '+project+' exists on cluster '+cluster.name+'"';
				shell+='\n_log_ "Creating project '+project+' on cluster '+cluster.name+'" && curl -f -v -k -X POST -d @- -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/apis/project.openshift.io/v1/projectrequests  &>> $logfile <<HPE_EOF';
				shell+=`
{
  "apiVersion": "project.openshift.io/v1",
  "kind": "ProjectRequest",
  "metadata": {
    "name": "`+project+`"
  },
  "displayName": "`+document.getElementById("quickDescription").value+`",
  "description": "From HPE5g automated deployer `+document.getElementById("vnfDescriptorWizardVersion").innerHTML+" on: "+Date()+`"
}
HPE_EOF`;
				shell+='\nif [ $? != 0 ] ; then _fail_ "Cannot create project '+project+' on cluster '+cluster.name+'" ; fi';
				shell+='\nsleep 2 ; done';

                // Create the REST API secret for this project if it does not exist
                var secretName=project+'-restapi';
                shell+='\n_log_ "Checking secret '+secretName+' for project '+project+' on cluster '+cluster.name+'"';
                shell+='\nuntil curl -f -v -k -X GET -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/api/v1/namespaces/'+project+'/secrets/'+secretName+' &>> $logfile ; do ';
                shell+='\n_log_ "Creating secret '+secretName+' for project '+project+' on cluster '+cluster.name+'" && curl -f -v -k -X POST -d @- -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/api/v1/namespaces/'+project+'/secrets &>> $logfile <<HPE_EOF';
                shell+=`
{
  "kind": "Secret",
  "apiVersion": "v1",
  "metadata": {
    "name": "`+secretName+`"
  },
  "stringData": {
    "NAME": "`+secretName+`"
  }
}
HPE_EOF`;
                shell+='\nif [ $? != 0 ] ; then _fail_ "Cannot create secret '+secretName+' for project '+project+' on cluster '+cluster.name+'" ; fi';
                shell+='\nsleep 2 ; done';
                
                // Deploy/update/undeploy the template instance: use the first resource name in this project as the template name to allow subsequent deployment in the same project without duplicating the template name
                var templateInstanceName=hpe5gResources.openshiftFunctions.find(function(f){return f.project == project;}).name;
                shell+='\n_log_ "$_displayedAction resources for project '+project+' on cluster '+cluster.name+'"';
                shell+='\n_httpVerb=POST _httpTarget=""';
                shell+='\nif curl -f -v -k -X GET -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/apis/template.openshift.io/v1/namespaces/'+project+'/templateinstances/'+templateInstanceName+' &>> $logfile ; then _httpVerb=PUT; _httpTarget=/'+templateInstanceName+'; fi';
                shell+='\nif $_deploy ; then curl -f -v -k -X $_httpVerb -d @- -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/apis/template.openshift.io/v1/namespaces/'+project+"/templateinstances$_httpTarget &>> $logfile <<'HPE_EOF'";
                shell+=`
{
  "kind": "TemplateInstance",
  "apiVersion": "template.openshift.io/v1",
  "metadata": {
    "name": "`+templateInstanceName+`"
  },
  "spec": {
    "secret": {
      "name": "`+secretName+`"
    },
    "template":`+jsonPayload+`
  }
}
HPE_EOF`;
				shell+='\nif [ $? != 0 ] ; then _fail_ "$_displayedAction resources for project '+project+' on cluster '+cluster.name+'" ; fi';
				
				shell+='\n# Poll the TemplateInstance until the condition types report status True at a 15 seconds period limited to two minute.';
				shell+='\n_cmd_with_retry "_getTemplateInstanceStatus '+cluster.token+' '+cluster.endpoint+' '+project+' '+templateInstanceName+'" Processing 120 15';
				shell+='\n# If the TemplateInstance status is true, but not Ready, fail with the error message; otherwise report success';
				shell+='\nif [ $? == 0 ] && [[ "$(_getTemplateInstanceStatus '+cluster.token+' '+cluster.endpoint+' '+project+' '+templateInstanceName+')" != \'"Ready"\' ]] ; then _fail_ $(_getTemplateInstanceMessage '+cluster.token+' '+cluster.endpoint+' '+project+' '+templateInstanceName+') ; fi';
				shell+='\nelse curl -f -v -k -X DELETE -H "Authorization: Bearer '+cluster.token+'" -H "Accept: application/json" -H "Content-Type: application/json" https://'+cluster.endpoint+'/apis/template.openshift.io/v1/namespaces/'+project+'/templateinstances/'+templateInstanceName+' &>> $logfile';
				shell+='\nif [ $? != 0 ] ; then _fail_ "$_displayedAction resources for project '+project+' on cluster '+cluster.name+'" ; fi';
				shell+='\nfi';
				shell+='\n_log_ "$_displayedAction resources for project '+project+' successfully completed on cluster '+cluster.name+'"';

			});
		});
	}
	if(check.length != 0){userOutput(check); return '';}
	return shell;
}

// Build a shell script named hpe5g.sh and drop it in the Download directory
function shellHeader(){
var shell=`#! /bin/bash
_usage() {
    echo "
HPE 5G resources automated deployer: `+document.getElementById("vnfDescriptorWizardVersion").innerHTML+`
This client deploys and undeploys 
- OpenShift clusters hosted on OpenStack 
- Individual OpenStack resources as a stack
- HPE 5g resources 
 
Usage: $0 
    -d|--deploy <name> : name of the OpenShift instance and OpenStack stack to deploy; default: hpe5g
    -o|--domain <domain name> : domain name of the OpenShift instance to deploy; default: localdomain
    -n|--OSnetwork <network root>: default OpenStack network root as 3 unique digits like 192.168.199
    -e|--OSenv <OpenStackEnvironmentFile> : name of the file providing the OpenStack environment. Retrieved from the OpenStack GUI: Project/API access
      By default, this file prompts the user for his password; to make the deployment unattended, replace the prompt with the actual password in the variable OS_PASSWORD
      Mandatory additional variables:
      - OS_CACERT: path to a file providing a specific cacert in case the SSL cert is signed by an unknown CA
      - OS_SSH_KEY_PAIR: name of the ssh key pair defined in the OpenStack project, pushed to the OpenShift nodes for remote access
      - CLOUD_SSH_KEY: (ansible deployments only) ssh private key used to reach the deployed nodes, matching the public OS_SSH_KEY_PAIR
      - CLOUD_DEFAULT_USER: (ansible deployments only) user name used to log in the deployed nodes

      Extensions supported as additional variables: 
      - Proxy URLs for OpenShift cluster
      OPENSHIFT_HTTP_PROXY
      OPENSHIFT_HTTPS_PROXY
      OPENSHIFT_NO_PROXY
    -x|--ext-net <external network> : name of the external network in the OpenStack infrastructure to connect this instance to; default: ext-net
    -s|--dns <external DNS> : external domain name server; default 8.8.8.8
    -f|--flavor <OpenStack flavor> : name of the OpenStack flavor used for master instances. Minimum 4vCPUs, 25Gb disk, 16Gb RAM; default: v4.m16.d25
    -fw|--flavorWorker <OpenStack flavor> : name of the OpenStack flavor used for worker instances. Minimum 4vCPUs, 25Gb disk, 16Gb RAM; default: master flavor
    --fipapi preallocated OpenShift API floating IPs
    --fipapp preallocated OpenShift APP floating IPs
    -m|--masters <number of masters> : default 3
    -w|--workers <number of workers> : default 3
    -v|--volumes <mininimum quota of OpenStack volumes>
    -t|--etc-hosts [true|false] : boolean enabling /etc/hosts update (requires sudo privilege) ; default: true
    -p|--pull-secret <file> : name of the file delivering the RedHat pull secret
    -l|--log logfile 
    -u|--undeploy|--destroy <name>: name of the OpenShift instance to undeploy; default: hpe5g
    --preview: no openshift installer invocation, display only 
    --headless: no log on stdout, only logfile is populated
    
Example: 
$0 -d hpe5g -o localdomain -s 8.8.8.8 -x ext-net -f v4.m16.d25 -m 3 -w 3 -t true -c openstack

To deploy several OpenShift clusters, all parameters are lists of space separated values. 
For example, to deploy two clusters ocp1 and ocp2 with specific flavors and a common external network:
$0 -n \\"ocp1 ocp2\\" -f \\"flavor1 flavor2\\" -x ext-net
"
}

# Default parameters
default_stack=`+Misc.getValue('default_project')+`
oc_stack=$default_stack
oc_network=`+Misc.getValue('default_openstack_network_root')+`
OS_env=`+Misc.getValue('default_openstack_env')+`
_deploy=$([[ "`+Misc.getValue('default_action')+`" != "undeploy" ]] && echo true || echo false)
_displayedAction=$($_deploy && echo Deploying || echo Undeploying)
state=$($_deploy && echo present || echo absent)
_headless=`+Misc.getValue('headless')+`
_preview=
`;

if(OpenShiftNodes.instances && OpenShiftNodes.instances.name.length)shell+=`
_defaultName=(`+OpenShiftNodes.instances.name.join(' ')+`)
OCP=(`+OpenShiftNodes.instances.name.join(' ')+`)
ETCHOSTS=(`+OpenShiftNodes.instances.etchosts.join(' ')+`)
EXTNET=(`+OpenShiftNodes.instances.extnet.join(' ')+`)
OS_env=(`+OpenShiftNodes.instances.osenv.join(' ')+`)
DOMAIN=(`+OpenShiftNodes.instances.domain.join(' ')+`)
FIPAPI=(`+OpenShiftNodes.instances.fipapi.join(' ')+`)
FIPAPP=(`+OpenShiftNodes.instances.fipapp.join(' ')+`)
WORKERS=(`+OpenShiftNodes.instances.workers.join(' ')+`)
MASTERS=(`+OpenShiftNodes.instances.masters.join(' ')+`)
FLAVOR=(`+OpenShiftNodes.instances.flavor.join(' ')+`)
FLAVORWORKER=(`+OpenShiftNodes.instances.flavorWorker.join(' ')+`)
EXTDNS=(`+OpenShiftNodes.instances.extdns.join(' ')+`)
NBVOLUMES=(`+OpenShiftNodes.instances.nbVolumes.join(' ')+`)`;
else shell+=`
_defaultName=$default_stack
unset OCP FIPAPI FIPAPP
ETCHOSTS=true
EXTNET=`+Misc.getValue('extnet')+`
DOMAIN=localdomain
WORKERS=3
MASTERS=3
FLAVOR=v4.m16.d25
FLAVORWORKER=$FLAVOR
EXTDNS=8.8.8.8
NBVOLUMES=10
`; 

shell+=`
RHELSECRET='`+Misc.getValue('rhel_pullsecret')+`'

while [[ "$#" -gt 0 ]]; do case $1 in
  -d|--deploy) _deploy=true; _displayedAction="Deploying"; state=present ; OCP=($\{2:-$\{OCP[@]:-$_defaultName}}) ; shift;;
  -u|--undeploy|--destroy) _deploy=false ; _displayedAction="Undeploying"; state=absent ; OCP=($\{2:-$\{OCP[@]:-$_defaultName}}); shift;;
  -e|--OSenv) OS_env=($2); shift;;
  -n|--OSnetwork) oc_network="$2"; shift;;
  -o|--domain) DOMAIN=($2); shift;;
  -x|--ext-net) EXTNET=($2); shift;;
  -f|--flavor) FLAVOR=($2); shift;;
  -fw|--flavorWorker) FLAVORWORKER=($2); shift;;
  --fipapi) FIPAPI=($2); shift;;
  --fipapp) FIPAPP=($2); shift;;
  -m|--masters) MASTERS=($2); shift;;
  -w|--workers) WORKERS=($2); shift;;
  -v|--volumes) NBVOLUMES=($2); shift;;
  -t|--etc-hosts) ETCHOSTS=($2); shift;;
  -l|--log) logfile=($2); shift;;
  -s|--dns) EXTDNS=($2); shift;;
  -p|--pull-secret) test -f $2 && RHELSECRET=$(cat $2) || exit 1; shift;;
  -h|--help) _usage; exit 0 ;;
  --headless) _headless=true;;
  --preview) _preview="_log_ Preview: ";;
  *) echo "Unknown parameter passed: $1." ; exit 1;;
esac; shift; done

# Force a log file in headless mode named as the stack, otherwise keep stdout
if ! test -n "$logfile" ; then test -n "$_headless" && logfile=$oc_stack.log || logfile="/dev/stdout" ; fi

# Cosmetic: ellipsize too long strings to keep cute logs: keep _max characters
_cutTooLong() {
  local _cut="$*"
  local _max=150
  if (( $\{#_cut} > $_max )) ; then
    _cut=$(echo $* | cut -c1-$_max)
    _cut+="..."
  fi
  echo $_cut
}

_log_() {
    # echo a cute time stamped log on stdout except in headless mode, and append the full log to the logfile
    test -n "$_headless" || echo -e $(date) $(_cutTooLong $*)
    if [ "$logfile" != "/dev/stdout" ] ; then echo -e $(date) $* &>> $logfile ; fi
    return 0
}

_warn_() {
  local RED='\\033[0;31m'
  local NC='\\033[0m' # No Color
  _log_ "$\{RED}WARNING$\{NC}: $*"
}

_fail_() {
  _log_ "FATAL ERROR: $*.  Now exiting... Check $logfile"
  test -f $logfile && echo Last lines of $logfile >&2 && tail $logfile >&2
  exit 1
}

# Clean log file
> $logfile
`;
  return shell;
}

function outputInstallerShell(){
	var shellOpenStack='';
	var shellOpenShift='';
  var shellTerraform='';
	Nodes.cloudNodes=undefined;

  // OCP4 clusters if any
  if(!OpenShiftNodes.isEmpty()){
    shellTerraform=buildOCP4Deployer();
    if(!shellTerraform)return false;
  }
  // OpenStack resources if any
  if(!Nodes.isEmpty()){
    shellOpenStack=buildHeatStackDeployer();
    if(!shellOpenStack)return false;
  }

	// Add OpenShift resources except if an OpenShift cluster was deployed before: the OCP deployment includes the resources deployment
  if(OpenShiftNodes.isEmpty() && (!Nodes.cloudNodes || !Nodes.cloudNodes.some(function(e){return e.isEms;}))){
		shellOpenShift=buildNetworkFunctions();
		if(hpe5gResources.projects.length && !shellOpenShift)return false;
	}
	var shell=shellHeader()+shellTerraform+shellOpenStack+shellOpenShift+"\nexit 0";
	
	// Show to the user and save to hpe5g.sh
    userOutput(shell);
	// Stop there if headless, ie no user interface
	if(Misc.getValue('headless'))return true;
	
	var blobShell = new Blob([shell], {type: "text/plain;charset=utf-8"});
	var a = document.createElement('a');
	a.href = window.URL.createObjectURL(blobShell);
    a.download = "hpe5g.sh";
    document.body.appendChild(a);
	a.click();
	document.body.removeChild(a);
	
	return true;
}

// Build a kubernetes native application to be deployed with the hpe5gApp operator availble from the catalog endpoint: https://quay.io/cnr registryNamespace: dometdemont
function outputAppHpe5g(){
  hpe5gResources.init();

  // Check the hpe5gResources sections (or get the errors)
  var check = '';
  ['Builds', 'CustomApps'].concat(hpe5gResources.sections).forEach(function(section){
    window[section].build();
    check += window[section].check;
  });
  check += hpe5gResources.compile();
  if(check){userOutput(check); return '';}

  var result=`apiVersion: cms.hpe.com/v1
kind: HPE5gApp
metadata:
  name: hpe5gapp
spec:
  templateContent:`;
  result+=hpe5gNetworkFunctions().replace(/\n/g, "\n"+'    '); // fix the template indentation as expected by the hpe5g operator
  
  // Show to the user and save to hpe5gApp.yaml
    userOutput(result);
  // Stop there if headless, ie no user interface
  if(Misc.getValue('headless'))return true;
  
  var blobApp = new Blob([result], {type: "text/plain;charset=utf-8"});
  var a = document.createElement('a');
  a.href = window.URL.createObjectURL(blobApp);
    a.download = "hpe5gApp.yaml";
    document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  
  return true;
}
//=================================
//Utilities
//=================================
// Warning on page reload
window.onbeforeunload = function() {
  return "Unsaved session data will be lost if you leave this page, are you sure?";
};

// if a is true, check that at least one element of x is true
// Otherwise, return a dependency message for roles
function checkDependency(a, x, roles, message){
	if(message == undefined)message = " are required on the same node";
	if( a && ! x.some(function(e, i, t){return e;} ))
		return "\n" + roles + message;
	return "";
}

// Check if only one element of x is true
// Otherwise, return a mutual exclusive message for roles
function checkUnicity(x, roles, message){
	var xTrue = x.filter(
		function(e, i, t){return e;}
	);
	if(message == undefined)message = " are mutually exclusive";
	if(xTrue.length > 1)return "\n" + roles + message;
	return "";
}

// Check if all or none element(s) of x is true
// Otherwise, return a group inconsistency message for roles
function checkGroupConsistency(x, roles, message){
	var xConsistent = ! x.some(
		function(e, i, t){return e;}
	) || x.every(
		function(e, i, t){return e;}
	);
	if(xConsistent)	return "";
	if(message == undefined)message = " group is not consistent (none or all should be true)";
	return "\n" + roles + message;
}

// Build a triple NAME/IP_ADDR/IP_NAT_ADDR of definitions for the role and device, using name and ip addr
// if name or ip addr are undefined, return an empty string
// if they are arrays with non empty elements, output a bash vector, ie space separated list enclosed in parenthesis
function getNameIpAddr(role, device, name, ipAddr, ipNatAddr){
	var result = "";
	var prefix = "";
	var suffix = "";
	var theName = name;
	if(name instanceof Array){
		if(name.join("").trim() != ""){
			theName = name.join(" ");
			prefix = "( ";
			suffix = " )";
		}else{
			theName = "";
		}
	}
	if(theName != undefined && theName != "")result += "\n" + role + "_NAME" + device + "=" + prefix+theName+suffix;
	prefix = suffix = "";
	var theIpAddr = ipAddr;
	if(ipAddr instanceof Array){
		if(ipAddr.join("").trim() != ""){
			theIpAddr = ipAddr.join(" ");
			prefix = "( ";
			suffix = " )";
		}else{
			theIpAddr = "";
		}
	}
	if(theIpAddr != undefined && theIpAddr != "")result += "\n" + role + "_IP_ADDR" + device + "=" + prefix+theIpAddr+suffix;
	prefix = suffix = "";
	var theIpNatAddr = ipNatAddr;
	if(ipNatAddr instanceof Array){
		if(ipNatAddr.join("").trim() != ""){
			theIpNatAddr = ipNatAddr.join(" ");
			prefix = "( ";
			suffix = " )";
		}else{
			theIpNatAddr = "";
		}
	}
	if(theIpNatAddr != undefined && theIpNatAddr != "")result += "\n" + role + "_IP_NAT_ADDR" + device + "=" + prefix+theIpNatAddr+suffix;
	return result;
}

// Useful 'contains' method for String is not available everywhere
if(!('contains' in String.prototype)){
	String.prototype.contains = function(str, startIndex){
		return -1 !== this.indexOf(str, startIndex);
	}
}

// Useful 'startsWith' method for String is not available everywhere
if (!String.prototype.startsWith) {
  String.prototype.startsWith = function(searchString, position) {
    position = position || 0;
    return this.indexOf(searchString, position) === position;
  };
}
if (!String.prototype.endsWith) {
	String.prototype.endsWith = function(pattern) {
	  var d = this.length - pattern.length;
	  return d >= 0 && this.lastIndexOf(pattern) === d;
	};
}
// In a list of arrays 'a', for all empty elements from index 0 to the last existing array, create an array and insert a 'defaultString'
function fillArrays(a, defaultString){
	if(a == undefined)return;
	if(defaultString == undefined)defaultString=new String('""');
	var fillArray = false;
	for(var i = a.length - 1; i>=0; i--){
		if(a[i] == undefined){
			if(fillArray){
				a[i] = new Array();
				a[i].push(defaultString);
			}
			else {
				a.pop();	// remove the useless undefined last element
			}
		}
		else{
			fillArray = true;
		}
	}
}

//======================================
// 5G resources default catalog as JSON
// See catalogHelp() for the semantic
// For legibility, the default templates 
// are set next as yaml values 
//======================================
var defaultCatalog=`
{
  "types": {
    "NetworkFunctions": [
      "nudsf-dr",
      "nudr-dr",
      "nudr-prov",
      "nudr-reg-agent",
      "nudm-ee",
      "nudm-li-poi",
      "nudm-li-tf",
      "nudm-ueau",
      "nudm-uecm",
      "nudm-sdm",
      "nudm-notify",
      "sf-cmod",
      "nrf-reg-agent"
    ],
    "IndirectServices": [
      "jenkins",
      "elasticsearch",
      "telegraf",
      "prometheus-alertmanager",
      "prometheus",
      "kube-state-metrics",
      "pushgateway",
      "grafana"
    ],
    "DirectServices": [
      "ignite",
      "redis",
      "redis-nopwd",
      "influxdb",
      "fluentd"
    ],
    "OperatorSources": [  
      "operator-source"
    ],
    "Operators": [  
      "jaeger-product",
      "cert-manager",
      "servicemeshoperator",
      "amq-streams",
      "elasticsearch-operator",
      "kiali-ossm",
      "grafana-operator",
      "etcd-operator",
      "ignite-operator",
      "prometheus-operator"
    ],
    "HelmCharts": [
      "nudm-chart",
      "nudr-chart",
      "telegraf-chart",
      "generic"
    ]
  },
  "dependencies": {
    "nudsf-dr": [
      "ignite",
      ["influxdb","telegraf", "telegraf-chart"]
    ],
    "nudr-dr": [
      "ignite",
      "nudr-prov"
    ],
    "nudr-prov": [
      "ignite"
    ],
    "nudr-reg-agent": [
    	["redis","redis-nopwd"],["influxdb","telegraf", "telegraf-chart"]
    ],
    "nudm-ee": [
      ["influxdb","telegraf", "telegraf-chart"], "nudr-dr"
    ],
    "nudm-li-poi": [
      ["redis","redis-nopwd"],"amq-streams",["influxdb","telegraf", "telegraf-chart"]
    ],
    "nudm-li-tf": [
        ["redis","redis-nopwd"],["influxdb","telegraf", "telegraf-chart"]
    ],
    "nudm-ueau": [
        ["influxdb","telegraf", "telegraf-chart"], "nudr-dr"
    ],
    "nudm-uecm": [
        ["influxdb","telegraf", "telegraf-chart"], "nudr-dr"
    ],
    "nudm-sdm": [
      ["influxdb","telegraf", "telegraf-chart"], "nudr-dr"
    ],
    "nudm-notify": [
      ["influxdb","telegraf", "telegraf-chart"], "nudr-dr"
    ],
    "nrf-reg-agent": [
      ["influxdb","telegraf", "telegraf-chart"],
      "fluentd"
    ]
  },
  "admin": {
	    "fluentd": true,
	    "grafana": true,
	    "kube-state-metrics": true,
	    "grafana-operator": true,
      "etcd-operator": true,
      "ignite-operator": true,
	    "prometheus-operator": true,
      "operator-source": true
  },
  "values": {
    "jenkins": {
      "URL": "quay.io/openshift",
      "image": "origin-jenkins",
      "tag": "latest"
    },
    "elasticsearch": {
      "URL": "docker.elastic.co/elasticsearch",
      "image": "elasticsearch-oss",
      "tag": "6.7.0",
      "storage": "4Gi"
    },
    "telegraf": {
        "URL": "docker.io",
        "image": "telegraf",
        "tag": "1.14-alpine"
    },
    "prometheus-alertmanager": {
      "URL": "docker.io/prom",
      "image": "alertmanager",
      "tag": "v0.20.0",
      "storage": "8Gi"
    },
    "prometheus": {
      "URL": "docker.io/prom",
      "image": "prometheus",
      "tag": "v2.16.0",
      "storage": "200Mi"
    },
    "kube-state-metrics": {
      "URL": "quay.io/coreos",
      "image": "kube-state-metrics",
      "tag": "v1.9.5"
    },
    "pushgateway": {
      "URL": "docker.io/prom",
      "image": "pushgateway",
      "tag": "v1.0.1"
    },
    "grafana": {
      "URL": "grafana",
      "image": "grafana",
      "tag": "6.6.2"
    },
    "nudsf-dr": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-sde-udsf-nudsf-dr",
      "tag": "1.8.0"
    },
    "nudr-dr": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-sde-udr-nudr-dr",
      "tag": "1.6.0"
    },
    "nudr-prov": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-sde-udr-nudr-prov",
      "tag": "1.6.0"
    },
    "nudr-reg-agent": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-nrf-reg-agent",
      "tag": "0.15.0"
    },
    "nudm-ee": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-udm-ee",
      "tag": "0.9.0"
    },
    "nudm-li-poi": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-udm-li-poi",
      "tag": "0.9.0"
    },
    "nudm-li-tf": {
        "URL": "cmsgvm38.gre.hpecorp.net:18444",
        "image": "hpe-nf-udm-li-tf",
        "tag": "0.9.0"
    },
    "nudm-ueau": {
        "URL": "cmsgvm38.gre.hpecorp.net:18444",
        "image": "hpe-nf-udm-ueau",
        "tag": "0.9.0"
    },
    "nudm-uecm": {
        "URL": "cmsgvm38.gre.hpecorp.net:18444",
        "image": "hpe-nf-udm-uecm",
        "tag": "0.9.0"
    },
    "nudm-sdm": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-udm-sdm",
      "tag": "0.9.0"
    },
    "nudm-notify": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-udm-notify",
      "tag": "0.9.0"
    },
    "sf-cmod": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-sf-cmod",
      "tag": "0.8.0"
    },
    "nrf-reg-agent": {
      "URL": "cmsgvm38.gre.hpecorp.net:18444",
      "image": "hpe-nf-nrf-reg-agent",
      "tag": "0.15.0"
    },
    "ignite": {
      "URL": "docker.io/gridgain",
      "image": "community",
      "tag": "8.7.12"
    },
    "redis": {
      "URL": "docker.io/bitnami",
      "image": "redis",
      "tag": "latest",
      "storage": "100Mi"
    },
    "redis-nopwd": {
        "URL": "docker.io/bitnami",
        "image": "redis",
        "tag": "latest",
        "storage": "100Mi"
      },
    "influxdb": {
      "URL": "docker.io/bitnami",
      "image": "influxdb",
      "tag": "1.7.10",
      "storage": "1Gi"
    },
    "fluentd": {
      "URL": "gcr.io/google-containers",
      "image": "fluentd-elasticsearch",
      "tag": "v2.4.0"
    },
    "jaeger-product": {},
    "cert-manager": {},
    "operator-source": {"URL": "https://quay.io/cnr", "Project": "openshift-marketplace"},
    "servicemeshoperator": {},
    "amq-streams": {},
    "elasticsearch-operator": {},
    "kiali-ossm": {},
    "grafana-operator": {},
    "etcd-operator": {},
    "ignite-operator": {},
    "prometheus-operator": {},
    "nudm-chart": {
      "chart": "hpe-nf-udm-0.9.0-005194.c3fa0f7.tgz"
    },
    "nudr-chart": {
      "chart": "hpe-sde-udr-1.1.0-004136.0166df3.tgz"
    },
    "telegraf-chart": {
      "chart": "influxdata/telegraf"
    },
    "generic": {
    }
  }
}
`;


//====================================
// Main javascript entry point
//====================================
// Import silently the default catalog 
importCatalog(defaultCatalog, true);

//Add the 'import session' control if missing
var importedSession = new userLoadedFile("importedSession", "Import...", importSession);
if(!importedSession.isDefined())document.getElementById("controlArea").appendChild(importedSession.getDomElement());

// Display only used sections
vnfResources.forEach(function(e,i,t){e.display(!e.isEmpty())});

// Restore dynamic javascript variables based on the ID of variables of class userLoadedFile
var userLoadedFiles = Array.prototype.slice.call( document.getElementsByClassName("userLoadedFile") );
userLoadedFiles.forEach(function(e, i){window[e.id] = new userLoadedFile(e.id);});

hpe5gResources.init();

//Welcome message when starting with an empty session
if(Nodes.isEmpty() && NetworkFunctions.isEmpty() && IndirectServices.isEmpty() && DirectServices.isEmpty() && Operators.isEmpty() && HelmCharts.isEmpty()){
var welcomeMsg=`Welcome to the CMS5G Core stack automated deployer assistant.

To deploy resources, click on the section names in the Summary line or import an existing session using the file chooser button.
For more help, click the section specific or general Help button.

Resources deployment on top of OpenShift:`;
hpe5gResources.sections.forEach(function(section){
	welcomeMsg+="\n- "+section+": ";
	welcomeMsg+=hpe5gResources.types[section].join();
});
welcomeMsg+=
`

Once resources are defined, several deployment options are available:
- Installer: builds an installer as a shell script. This installer has to be invoked on the console connected to the OpenShift cluster as an OpenShift user to deploy the resources.
  If the resources to deploy include the OpenShift cluster itself, the installer has to be invoked from an ansible controller: refer to the OpenStack section in the general Help.
- HPE5gApp: builds the application definition deployable using the hpe5g operator. This operator has to be installed beforehand from https://quay.io/cnr registryNamespace: dometdemont
- REST API: refer to the github project README  
`;  

userOutput(welcomeMsg);
}

// Update the catalog with the default yaml templates 
var log4j2xml=`
      <?xml version="1.0" encoding="UTF-8"?>
      <!-- ===================================================================== -->
      <!-- -->
      <!-- Log4j Configuration -->
      <!-- -->
      <!-- ===================================================================== -->
      <!-- | For more configuration information and examples see the Jakarta Log4j 
           | website: http://jakarta.apache.org/log4j -->
      <Configuration status="WARN">
          <!-- ============================== -->
          <!-- Append messages to the console -->
          <!-- ============================== -->
          <Appenders>
              <Console name="Console" target="SYSTEM_OUT">
                  <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %msg%n"/>
                  <Filters>
                      <ThresholdFilter level="TRACE" onMatch="ACCEPT" />
                  </Filters>
              </Console>
          </Appenders>
          <!-- ================ -->
          <!-- Limit categories -->
          <!-- ================ -->
          <Loggers>
              <Logger name="com.hpe" level="DEBUG"/>
              <Logger name="org.apache" level="WARN"/>
              <Logger name="kafka" level="WARN"/>
          
          <!-- ======================= -->
          <!-- Setup the Root category -->
          <!-- ======================= -->
              <Root level="INFO">
                  <AppenderRef ref="Console"/>
              </Root>
          </Loggers>
      </Configuration>
`;
//================================================
hpe5gResources.defaults['nudsf-dr']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        containers:
        - name: ~NAME~
          env:
          - name: JAVA_OPTS
            value: -Dpaas.service.name=RELEASE-NAME-nudsf-dr   -Djava.net.preferIPv4Stack=true  -XX:InitialRAMPercentage=40 -XX:MaxRAMPercentage=40 -XX:+AlwaysPreTouch -XX:MaxGCPauseMillis=100 -XX:+UseConcMarkSweepGC -XX:InitiatingHeapOccupancyPercent=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+ScavengeBeforeFullGC -XX:+DisableExplicitGC -Dio.undertow.ssl.max-read-listener-invocations=1000 -Dgeneric.configuration.uri=file://///etc/opt/hpe/sde/udsf//nudsf-dr-config.yaml 
          image: ~IMAGE_STREAM~
          imagePullPolicy: IfNotPresent
          Requests:
            cpu:    1000m
            memory:   2000Mi
          Limits:
            cpu:  8000m
            memory: 4000Mi
          ports:
          - containerPort: 8443
            protocol: TCP
          - name: health
            containerPort: 8080
            protocol: TCP
          volumeMounts:
            - name: ~NAME~
              mountPath: /etc/opt/hpe/sde/udsf/
            - name: ~NAME~-secrets
              mountPath: /etc/opt/hpe/sde/udsf/security
          livenessProbe:
            httpGet:
              path: /nudsf-dr/v1/probes/healthy
              port: health
            initialDelaySeconds:   120 
            periodSeconds: 3
            timeoutSeconds: 3
            successThreshold: 1
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /nudsf-dr/v1/probes/healthz
              port: health
            initialDelaySeconds: 15
            periodSeconds: 3
            timeoutSeconds: 3
            successThreshold: 2
            failureThreshold: 1
        volumes:
          - name: ~NAME~
            configMap:
              name: ~NAME~
          - name: ~NAME~-secrets
            secret:
              secretName: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: LoadBalancer
    ports:
    - port: 8443
      protocol: TCP
      targetPort: 30043
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tls:
      termination: passthrough
    to:
      kind: Service
      name: ~NAME~
      namespace: ~PROJECT~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
        "nfInstanceId": "C750A1C5-4897-4389-A4C7-D0133FC9CADB",
        "nfType":"UDSF",
        "nfStatus":"REGISTERED",
        "heartBeatTimer": "45",
        "fqdn": "",
        "ipv4Addresses":[""],
        "nfServices" : [ {
            "serviceInstanceId" : "UDSF",
            "serviceName" : "nudsf-dr",
            "versions" : [ {
              "apiVersionInUri" : "v1",
              "apiFullVersion" : "1.0.0.alpha-1"
            } ],
      
            "scheme" : "https",
      
            "nfServiceStatus" : "REGISTERED",
            "fqdn": "hpe-sde-udsf-nudsf-dr.3gpp-nf-all.svc.cluster.local",
            "ipEndPoints" : [ {
              "ipv4Address" : "hpe-sde-udsf-nudsf-dr.3gpp-nf-all.svc.cluster.local",
              "transport" : "TCP",
      
              "port" : "30043"
      
            } ]
          } ]
      }
    nudsf-dr-config.yaml: |
      # nUDSF function configuration.
      #
  
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd
              port: 24224
      statistics-configuration:
        id: hpe-sde-udsf-nudsf-dr-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: hpe-sde-udsf-nudsf-dr
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 5
        jmx:
          enabled: false
  
      # Empty rest-client for paas 0.14.0, remove later
      rest-client:
        id:
  
      call-tracing:
        enabled: false
        properties:
            JAEGER_SERVICE_NAME: ~NAME~
            JAEGER_AGENT_HOST: localhost
            JAEGER_AGENT_PORT: 6831
            JAEGER_ENDPOINT: http://jaeger-collector:14268/api/traces
            JAEGER_REPORTER_FLUSH_INTERVAL: 100
            JAEGER_REPORTER_LOG_SPANS: true
            JAEGER_SAMPLER_TYPE: "probabilistic"
            JAEGER_SAMPLER_PARAM: 1.0
  
      datasources:
        - id: ignite
          profile:
            name: kubernetes
            properties:
              masterUrl: https://openshift.default.svc.cluster.local:443
              namespace: ~PROJECT~
              serviceName: ~ignite_NAME~
      model:
        realms:
        - id: realm0
          properties:
            replicas: 1
          storages:
          - id: space0
            properties:
              replicas: 1
    project-nudsf-dr.yml: |+
      # Thorntail global configuration for nUDSF.
      #
  
      thorntail:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 110
        undertow:
          alias: localhost
          filter-configuration:
            request-limits:
              requests-limiter-filter:
                queue-size: 1500
                max-concurrent-requests: 100
          servers:
            default-server:
              hosts:
                default-host:
                  filter-refs:
                    requests-limiter-filter:
                      predicate: not path-suffix(/probes/healthy)
                      priority: 1
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  http2-initial-window-size: 32000000
                  http2-max-concurrent-streams: 200
                  no-request-timeout: 600000
                  http2-max-frame-size: 
                  max-connections: 2000
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
              cipher-suite-filter: DEFAULT
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: "/etc/opt/hpe/sde/udsf/security/keystore.p12"
              credential-reference:
                clear-text: password
              type: 
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            "stdout":
               level: INFO
               handlers:
               - STDOUT
            "com.hpe.cms5g.nudsf":
               level: INFO
            "com.hpe.cms.sde.udsf":
               level: INFO
            "com.hpe.cms.sde.dao":
               level: INFO
            "com.hpe":
               level: INFO
            "io.jaegertracing":
              level: WARN
            "io.undertow":
               level: INFO
            "io.netty":
               level: INFO
            "org.jboss.as":
              level: INFO
            "org.glassfish.jersey":
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.p12: 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
`;
//================================================
hpe5gResources.defaults['nudr-dr']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.jks: 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
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        containers:
        - name: ~NAME~
          volumeMounts:
            - name: ~NAME~-config-volume
              mountPath: /etc/opt/hpe-5g/sde-udr-nudr-dr/
            - name: ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe-5g/sde-udr-nudr-dr/security
          ports:
            - name: https
              containerPort: 8443
              protocol: TCP
          ports:
            - name: health
              containerPort: 8080
              protocol: TCP
          env:
          - name: JAVA_OPTS
            value: -XX:+AlwaysPreTouch -XX:+UseG1GC -XX:+ScavengeBeforeFullGC -XX:+DisableExplicitGC -XX:MaxGCPauseMillis=200 -Xms1g -Djava.net.preferIPv4Stack=true   -Dgeneric.configuration.uri=file:/etc/opt/hpe-5g/sde-udr-nudr-dr/nudr-nf-config.yaml -Dpaas.service.name=nudr-dr
          - name: SPRING_PROFILES_ACTIVE
            value: ignite
          image: ~IMAGE_STREAM~
          imagePullPolicy: IfNotPresent
          Requests:
            cpu:    2000m
            memory:   2000Mi
          Limits:
            cpu:  8000m
            memory: 4000Mi
          livenessProbe:
            httpGet:
              path: /nudr-dr/v2/probes/healthy
              port: health
            initialDelaySeconds: 60
            periodSeconds: 5
            timeoutSeconds: 3
          readinessProbe:
            httpGet:
              path: /nudr-dr/v2/probes/healthz
              port: health
            initialDelaySeconds: 60
            periodSeconds: 5
            timeoutSeconds: 3
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                name: nudr-shared-application-configmap-call-tracing-provisioning
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: NodePort
    ports:
      - port: 8443
        nodePort: 30001
        protocol: TCP
        name: https-nudr-dr
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tls:
      termination: passthrough
    to:
      kind: Service
      name: ~NAME~
      namespace: ~PROJECT~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: nudr-shared-application-configmap-call-tracing-provisioning
    namespace: ~PROJECT~
  data:
    call-tracing-provisioning.yaml: |
      # Copyright (c) 2019-2020 Hewlett-Packard Enterprise Development LP.
      # All Rights Reserved.
      #
      # This software is the confidential and proprietary information of
      # Hewlett-Packard Enterprise Development LP.
      #
      ue-provisioning:
        - ue-id:
          - "imsi-0123456789"
          - "msisdn-9876543210"
          traced-service:
            - "UDM"
            - "UDR"
          propagate-trace: true
          trace-depth: "MEDIUM"
        - ue-id:
          - "imsi-9999999999"
          - "msisdn-8888888888"
          traced-service:
            - "nudm-uecm"
            - "nudm-ueau"
          propagate-trace: true
          trace-depth: "MEDIUM"
        - ue-id:
          - "nai-77777777777"
          - "msisdn-6666666666666"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudr-nf-config.yaml: |
      #
      # Copyright (c) 2019-2020 Hewlett-Packard Enterprise Development LP.
      # All Rights Reserved.
      #
      # This software is the confidential and proprietary information of
      # Hewlett-Packard Enterprise Development LP.
      #
  
      #
      # Sample Network function configuration.
      #
  
      udr:
        source-conf: "From HELM"
        udr-root-dir: "/var/opt/hpe-5g/sde-udr-nudr-dr"
        # nrf:
        #   hostname: localhost
        #   port: 5090
        #   scheme: https
        #   version: v1
        #   nrfRegistrationStubMode: true
        #   nrfDiscoverStubMode: true
        #   nfRegfile: /etc/opt/hpe-5g/sde-udr-nudr-dr/nnrf-register.config
        #   udrDescfile: /etc/opt/hpe-5g/sde-udr-nudr-dr/udr-disc.json
  
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
      call-tracing:
        enabled: false
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: true
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        provisioning-uri: file:/etc/opt/hpe-5g/sde-udr-nudr-dr/call-tracing-provisioning.yaml
        max-trace-depth: MINIMUM
        max-body-length: 1200
        trace-all-ues: false
        trace-all-operations: true
        autorefresh-provisioning-period: 30
      datasources:
        - id: ignite
          profile:
            name: kubernetes
            properties:
              masterUrl: https://openshift.default.svc.cluster.local:443
              namespace: ~PROJECT~
              serviceName: ~ignite_NAME~
      model:
        realms:
        - id: realm0
          properties:
            replicas: 1
      publisher-subscriber:
        enable: false
        parameters:
          application-kind: UDR
          topic: UDRNotifier
        pubsub:
          brokers:
          - localhost:9092
          properties:
            group.id: group1
            reconnect.backoff.max.ms: 14400000
            reconnect.backoff.ms: 7200000
      # TEMPORARY WORKAROUND FOR PAAS 0.14.0, EMPTY CLIENT DEFINITION
      rest-client:
        id:
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-nudr-dr.yml: |+
      #
      # Sample Thorntail global configuration.
      #
      thorntail:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  http2-initial-window-size: 32000000
                  no-request-timeout: 600000            
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: hwroot
          key-stores:
            ks:
              path: /etc/opt/hpe-5g/sde-udr-nudr-dr/security/keystore.jks
              credential-reference:
                clear-text: hwroot
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            "stdout":
               level: INFO
               handlers:
               - STDOUT
            "com.hpe.cms.sde.udr":
               level: INFO
            "com.hpe.cms.sde.apis":
               level: INFO
            "com.hpe.cms.sde.dao":
               level: INFO
            "com.hpe.paas.middleware.sdk.impl.rest.providers":
               level: INFO
            "com.hpe":
               level: INFO
            "org.apache.ignite":
              level: WARN
            "org.apache.kafka":
               level: INFO
            "org.glassfish.jersey":
               level: INFO
            "io.jaegertracing":
              level: INFO
            "io.undertow":
              level: INFO
            "io.netty":
              level: INFO
            "org.jboss.as":
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
      	  "nfInstanceId": "0777E150-4D00-4d86-A49C-8BADF00D0000",
      	  "nfType":"UDR",
      	  "nfStatus":"REGISTERED",
      	  "heartBeatTimer": "45",
      	  "fqdn": "localhost",
      	  "ipv4Addresses":["localhost"],
      	  "udrInfo":{
      	    "groupId":"udrgroup01",
      	    "supiRanges":[{"start":"200000000000000","end":"399999999999999"}],
      	    "supportedDataSets":["SUBSCRIPTION","POLICY","EXPOSURE","APPLICATION"]
      	  },
      	  "nfServices" : [ {
      	      "serviceInstanceId" : "0777E150-4D00-4d86-A49C-8BADF00D0000",
      	      "serviceName" : "nudr-dr",
      	      "versions" : [ {
      	        "apiVersionInUri" : "v2",
      	        "apiFullVersion" : "2.1.0"
      	      } ],
      
      	      "scheme" : "https",
      
      	      "nfServiceStatus" : "REGISTERED",
      	      "fqdn": "localhost",
      	      "ipEndPoints" : [ {
      	        "ipv4Address" : "localhost",
      	        "transport" : "TCP",
      
      	        "port" : "30001"
      
      	      } ]
      	    } ]
      	}

`;

//================================================
hpe5gResources.defaults['nudr-prov']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        containers:
        - name: ~NAME~
          env:
          - name: JAVA_OPTS
            value: -Xms512m -Xmx1024m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe-5g/sde-udr-nudr-prov/nudr-nf-config.yaml -Dpaas.service.name=nudr-prov
          - name: SPRING_PROFILES_ACTIVE
            value: ignite
          image: ~IMAGE_STREAM~
          imagePullPolicy: IfNotPresent
          Requests:
            cpu:    2000m
            memory:   2000Mi
          Limits:
            cpu:  8000m
            memory: 4000Mi
          ports:
          - containerPort: 8443
            protocol: TCP
          volumeMounts:
            - name: ~NAME~
              mountPath: /etc/opt/hpe-5g/sde-udr-nudr-prov/
            - name: ~NAME~-secrets
              mountPath: /etc/opt/hpe-5g/sde-udr-nudr-prov/security
          livenessProbe:
            failureThreshold: 3000
            httpGet:
              path: /nudr-prov/v1/probes/healthy
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 5
            timeoutSeconds: 15
          readinessProbe:
            failureThreshold: 3000
            httpGet:
              path: /nudr-prov/v1/probes/healthz
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 60
            timeoutSeconds: 15
        volumes:
          - name: ~NAME~
            configMap:
              name: ~NAME~
          - name: ~NAME~-secrets
            secret:
              secretName: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: LoadBalancer
    ports:
    - port: 8443
      protocol: TCP
      targetPort: 30043
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tls:
      termination: passthrough
    to:
      kind: Service
      name: ~NAME~
      namespace: ~PROJECT~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    nudr-nf-config.yaml: |
      #
      # Copyright (c) 2019-2020 Hewlett-Packard Enterprise Development LP.
      # All Rights Reserved.
      #
      # This software is the confidential and proprietary information of
      # Hewlett-Packard Enterprise Development LP.
      #
      #
      # Sample Network function configuration.
      #
      udr:
        source-conf: "From HELM"
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
      call-tracing:
        enabled: false
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: true
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        provisioning-uri: file:/etc/opt/hpe-5g/sde-udr-nudr-prov/call-tracing-provisioning.yaml
        max-trace-depth: MINIMUM
        max-body-length: 1200
        trace-all-ues: false
        trace-all-operations: true
        autorefresh-provisioning-period: 30
      datasources:
        - id: ignite
          profile:
            name: kubernetes
            properties:
              masterUrl: https://openshift.default.svc.cluster.local:443
              namespace: ~PROJECT~
              serviceName: ~ignite_NAME~
      model:
        realms:
        - id: realm0
          properties:
            replicas: 1
      publisher-subscriber:
        enable: false
        parameters:
          application-kind: UDR
          topic: UDRNotifier
        pubsub:
          brokers:
          - localhost:9092
          properties:
            group.id: group1
            reconnect.backoff.max.ms: 14400000
            reconnect.backoff.ms: 7200000
      # TEMPORARY WORKAROUND FOR PAAS 0.14.0, EMPTY CLIENT DEFINITION
      rest-client:
        id:
    project-nudr-prov.yml: |+
      #
      # Sample Thorntail global configuration.
      #
      thorntail:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  http2-initial-window-size: 32000000
                  no-request-timeout: 600000            
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: hwroot
          key-stores:
            ks:
              path: /etc/opt/hpe-5g/sde-udr-nudr-prov/security/keystore.jks
              credential-reference:
                clear-text: hwroot
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            "stdout":
               level: INFO
               handlers:
               - STDOUT
            "com.hpe.cms.sde.udr":
               level: INFO
            "com.hpe.cms.sde.apis":
               level: INFO
            "com.hpe.cms.sde.dao":
               level: INFO
            "com.hpe.paas.middleware.sdk.impl.rest.providers":
               level: INFO
            "com.hpe":
               level: INFO
            "org.apache.ignite":
              level: WARN
            "org.apache.kafka":
               level: INFO
            "org.glassfish.jersey":
               level: INFO
            "io.jaegertracing":
              level: INFO
            "io.undertow":
              level: INFO
            "io.netty":
              level: INFO
            "org.jboss.as":
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.jks: 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
`;

//================================================
hpe5gResources.defaults['nudr-reg-agent']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        containers:
        - name: ~NAME~
          env:
          - name: JAVA_OPTS
            value: -Xms512m -Xmx1024m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe-5g/hpe-nnrf-reg-agent/nnrf-reg-agent-config.yaml
          image: ~IMAGE_STREAM~
          Requests:
            cpu:    1000m
            memory:   2000Mi
          Limits:
            cpu:  8000m
            memory: 4000Mi
          ports:
          - containerPort: 8443
            protocol: TCP
          volumeMounts:
            - name: ~NAME~
              mountPath: /etc/opt/hpe-5g/hpe-nnrf-reg-agent/
            - name: ~NAME~-secrets
              mountPath: /etc/opt/hpe-5g/hpe-nnrf-reg-agent/security
          livenessProbe:
            failureThreshold: 3000
            httpGet:
              path: /nudr-reg-agent/v2/probes/healthy
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 60
            periodSeconds: 5
            timeoutSeconds: 15
          readinessProbe:
            failureThreshold: 3000
            httpGet:
              path: /nudr-reg-agent/v2/probes/healthz
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 60
            timeoutSeconds: 15
        volumes:
          - name: ~NAME~
            configMap:
              name: ~NAME~
          - name: ~NAME~-secrets
            secret:
              secretName: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: LoadBalancer
    ports:
    - port: 8443
      protocol: TCP
      targetPort: 30043
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tls:
      termination: passthrough
    to:
      kind: Service
      name: ~NAME~
      namespace: ~PROJECT~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    nnrf-reg-agent-config.yaml: |
      #
      # Network function NNRF Client MicroService configuration.
      #
      # The parameters below can be overridden by an external configuration.
      #
  
  
      # HTTP/2 REST client subsystem
      ---
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 100
          jersey.config.client.readTimeout: 1000
        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false
          
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224
  
      statistics-configuration:
        id: hpe-nf-nrf-reg-agent-statistics
        jmx:
          domain: nnrf-reg-agent
          enabled: false
          properties:
            com.hpe.imsc.statistics.jmx.descriptors: "false"
            com.hpe.imsc.statistics.jmx.notifications: "false"
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.database: nnrf-reg-agent
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
          com.hpe.imsc.statistics.influxdb.server.port: "8086"
          com.hpe.imsc.statistics.influxdb.server.protocol: http
  
      nnrf-client:
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: 
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        retry-limit: -1
        nfprofile-uri: file:/etc/opt/hpe-5g/hpe-nnrf-reg-agent/nnrf-register.config
        disable-register: false 
        disable-deregister: false
        opentracing-enabled: false
        enable-cache: false
        default-cache-validity-period-secs: 3600
        self-service-name: hpe-nf-nrf-reg-agent
        monitor-service-name: 
        monitor-interval: 15000
        kubernetes-namespace: default
    project-nnrf-reg-agent.yml: |+
      #
      # Sample Thorntail global configuration.
      #
      thorntail:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  http2-initial-window-size: 32000000
                  no-request-timeout: 600000            
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: hwroot
          key-stores:
            ks:
              path: /etc/opt/hpe-5g/hpe-nnrf-reg-agent/security/keystore.jks
              credential-reference:
                clear-text: hwroot
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            "stdout":
               level: INFO
               handlers:
               - STDOUT
            "com.hpe.cms.sde.udr":
               level: INFO
            "com.hpe.cms.sde.apis":
               level: INFO
            "com.hpe.cms.sde.dao":
               level: INFO
            "com.hpe.paas.middleware.sdk.impl.rest.providers":
               level: INFO
            "com.hpe":
               level: INFO
            "org.apache.ignite":
              level: WARN
            "org.apache.kafka":
               level: INFO
            "org.glassfish.jersey":
               level: INFO
            "io.jaegertracing":
              level: INFO
            "io.undertow":
              level: INFO
            "io.netty":
              level: INFO
            "org.jboss.as":
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"
    nnrf-register.config: |
      {
        "nfInstanceId": "0777E150-4D00-4d86-A49C-8BADF00D0000",
        "nfType":"UDR",
        "nfStatus":"REGISTERED",
        "heartBeatTimer": "45",
        "fqdn": "localhost",
        "ipv4Addresses":["localhost"],
        "udrInfo":{
          "groupId":"udrgroup01",
          "supiRanges":[{"start":"200000000000000","end":"399999999999999"}],
          "supportedDataSets":["SUBSCRIPTION","POLICY","EXPOSURE","APPLICATION"]  },
          "nfServices" : [ {
            "serviceInstanceId" : "0777E150-4D00-4d86-A49C-8BADF00D0000",
            "serviceName" : "~NAME~",
            "versions" : [ {"apiVersionInUri":"v2","apiFullVersion":"2.1.0"} ],
            "scheme" : "https",
            "nfServiceStatus" : "REGISTERED",
            "fqdn": "localhost",
            "ipEndPoints" : [ {"ipv4Address":"localhost","transport":"TCP","port":"30001"} ]
            } ]
      }
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.jks: 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
`;
//================================================
hpe5gResources.defaults['sf-cmod']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret-config
    namespace: ~PROJECT~
  data:
    "DefaultConfig": |- 
          IyBUaGlzIGlzIGEgc2FtcGxlIEFsZ29yaXRobSBJRCBGaWxlLgojIFRoaXMgZGVmaW5lcyB0aGUgc3VwcG9ydGVkIHZhcmlhYmxlcyBhbmQgcHJvdmlkZXMgYSBzYW1wbGUgdmFsdWUgZm9yIHRoZW0uCgojIHZlY3Rvcl9hbGdvcml0aG0KIyBUaGlzIGlzIGEgbWFuZGF0b3J5IGZpZWxkIGZvciB0aGlzIGtpbmQgb2YgZmlsZS4KIyBWYWxpZCBWYWx1ZXMgOiAKIyAgICAwICAgLSBNaWxlbmFnZQojICAgIDI1MCAtIFR1YWsKdmVjdG9yX2FsZ29yaXRobSA6IDAKCiMgb3AKIyBWYWxpZCBmb3IgTWlsZW5hZ2UgYWxnb3JpdGhtLCAKIyBvcHRpb25hbCBmaWVsZCwgbmVlZG4ndCBiZSBwcm92aXNpb25lZCB3aGVuIG9wYyBpcyBwcmVzZW50CiMgUmVnZXggUGF0dGVybiA6ICJeW0EtRmEtZjAtOV17MzJ9JCIKb3AgOiBBMTIzNDU2Nzg5QTEyMzQ1Njc4OUExMjM0NTY3ODlCQwoKIyBjCiMgVmFsaWQgZm9yIE1pbGVuYWdlIGFsZ29yaXRobSBhbmQgZGVmYXVsdCB2YWx1ZXMgZm9yIE1pbGVuYWdlCiMgb3B0aW9uYWwgZmllbGQKIyBSZWdleCBQYXR0ZXJuIDogIl5bQS1GYS1mMC05XXsxNjB9JCIKYyA6IDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA0MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDgKCiMgcgojIFZhbGlkIGZvciBNaWxlbmFnZSBhbGdvcml0aG0gYW5kIGRlZmF1bHQgdmFsdWVzIGZvciBNaWxlbmFnZQojIG9wdGlvbmFsIGZpZWxkCiMgUmVnZXggUGF0dGVybiA6ICJeW0EtRmEtZjAtOV17MTB9JCIKciA6IDQwMDAwMDIwNjAKCiMga2VjX2Nha19pdGVyCiMgVmFsaWQgZm9yIFR1YWsgYWxnb3JpdGhtCiMgVmFsaWQgdmFsdWVzIDogMCAtIDcKa2VjX2Nha19pdGVyIDogMQoKIyB0b3AKIyBWYWxpZCBmb3IgVHVhayBhbGdvcml0aG0KIyBSZWdleCBQYXR0ZXJuIDogIl5bQS1GYS1mMC05XXs2NH0kIgp0b3AgOiBBMTIzNDU2Nzg5QTEyMzQ1Njc4OUExMjM0NTY3ODlCQ0ExMjM0NTY3ODlBMTIzNDU2Nzg5QTEyMzQ1Njc4OUJDCg==
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret-cert
    namespace: ~PROJECT~
  data:
    "cert.pem": |- 
          LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZKVENDQXcyZ0F3SUJBZ0lKQVBhTExmcTZWVXQvTUEwR0NTcUdTSWIzRFFFQkN3VUFNQ2t4SnpBbEJnTlYKQkFNTUhuWmhZV0YyYlRFekxtbHVMbkprYkdGaWN5NW9jR1ZqYjNKd0xtNWxkREFlRncweE9EQTVNVEV4TlRNdwpNREJhRncweE9UQTVNVEV4TlRNd01EQmFNQ2t4SnpBbEJnTlZCQU1NSG5aaFlXRjJiVEV6TG1sdUxuSmtiR0ZpCmN5NW9jR1ZqYjNKd0xtNWxkRENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFMaW8KUng1NDJDYnNocmpBVHNweW9OSW05V2sxWmlwYU9iWGJHS1lLVW94WFFvRTlINnhiNU8zK2ozUjc4TnVNYmkrZAo0RGJZUXplQWJ1eFM1aW9uUEM1ZUlZazlMSnZOKzgrQU1Wbzd4cVNUaUFrTndia2JWcnd0RmU3dnhwdFhxcGQrCmRscVplVDJXNmxlU0ZLd1FnSGZscjlNd2FlYlFibnNjTjd0SnFwQWdSQW5zekRUOTFZM0I2cExzbmE5QVJnQXAKeHViak55OUd5aHhJSlZnSGhYRi94Z1p3cFkwSVZkVXBRbVRJU3hDK0lxc01GWWFOaGMwOTdXdXpmU0tJZHp1egptUUx1RkRTN2xaeWUvaThTd1kreVNsdTRUM2JudjRXYmhTSGo5RzM5Z1lkSmFISDlGL1hoMDJSTkl5aHYyQmZWCjgrTXMvd0hFZ0pxdzFRUTI5bU1BM0FxMW9yK281a3lyVkdwdWRMTHN2SW9ieS9YVzVJaUdPS2F6bnNBdThDZzIKc2U5eWdBOVovNFEyaW4va3gzS0taVHR5eG9MZThuZWh1Uno1aWxtT3JSU0plZU5DenNYOVdwS1BFU09raExLSwpsR1ZhVG1LRjUzbXZYTDFzbTlPNXQzL3FJKzd4NUhxUmhpMSszZm1Kb1E4eThxdWVxL20ySTBkZDZjRjRhT2FSCjRWd0ZMajRENDhQNi9YbDdEcVVaVzEvRGJiZ3pmNU1wWnUvdWF1YWoycnBaMlpycnJFYVByYUxzWEtGa2w5U00KdWg2QThOWVl6ejJOV1E4K042VHpPVlRBckJTdmRCSHhWNzY1N2VTOFo1M3h1MGRYZHRFQ08rWndsRkdlR0lwZApBYzNBY29rc2FqbUp3R0RjTU1udC9UbkRKZ2RtaUxERjN2QkFMODV0QWdNQkFBR2pVREJPTUIwR0ExVWREZ1FXCkJCUzRHelpPWXA4QWZFUFhKNGNWR1daSkJJanhlVEFmQmdOVkhTTUVHREFXZ0JTNEd6Wk9ZcDhBZkVQWEo0Y1YKR1daSkJJanhlVEFNQmdOVkhSTUVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQ3llQmR6THY0TAoybFNhM3ZiRlYwM3JBTjRyTW9BVGRBeEtRUDdwRVA2OFBQM3lpakhRUzNnTk04bFFsSkNvV0ZWa21jc1djQ01rClRqUjVMN3VIRkZFbm9reFJkOW15Y0I2UmVpdE8xYldWV0RmWmdvc09JVGNCbUFzQlNJNXd0TEJ3dEhBNU5HMXAKOFJ6djBXZnFrbWNTRTVIaDh1U2tEUXVLL2hUdjBqTGNrVHl0YXRIUGo0a2VLeEloK1ByZFZEcmE2dU44REY5eApMVzhpMEk0bGpCS3dTSjhXeUhGeG85b2JVMyt0Z294QVJ2SUZKU1ZMM1lBMFNiQXpZNVdOelN2NklBZkxiOVIvCmwvTXRYcDBCd0VuWng1dWtieGh2UzdxMTJaRFVWVTFBdDhIblFKaHY3ZEhYNU9tL0xnZUZHdWtydEVRUnFLcE4KbXZyQmJnQXpEOGJpZk5ON0c2a2kveUNwbDhnbTFzRWdxc3JKODJvL0V5YjV2VWY0Ry84UzBaOStxeXM4U05BeQoxVGtGSU53MVYycDlYWGg1VUNOKytjSWlkTDdPcXhsRXV4R1U5Um9RaG5Ka0lqeG5xaXVyT1ZPWHg0NzhtaFZICkNGSENlcC9pVDlhc1dtVjdjbEptQXpuaGhvM2NIVUZpYVVoalFpeEZXRHZEV3ZFbFNDRVpOdWhSNFNPeCtrYloKLzFxNThaOHdtM2dUcmMwUFVuMjE5WlZLdmJsQVNWbURnYmxWdTBpWnNJVUE2WTRVSlpTdFFuVTFGTnBYYk44QgpFdC95MGo4TW1SUTljT1ZScFRVaFlSMUxrSUFDTXJSNUZoUjMyZjFSVk5yYzhoZ0NSYjkzTDY2WE9JNVpMeFdLCnV2WHltcUNkOVVEUGZWVGRsbzZJN1pQckVHM1RqTUd3UXc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    "key.pem": |- 
          LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRZ0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1N3d2dna29BZ0VBQW9JQ0FRQzRxRWNlZU5nbTdJYTQKd0U3S2NxRFNKdlZwTldZcVdqbTEyeGltQ2xLTVYwS0JQUitzVytUdC9vOTBlL0Riakc0dm5lQTIyRU0zZ0c3cwpVdVlxSnp3dVhpR0pQU3liemZ2UGdERmFPOGFrazRnSkRjRzVHMWE4TFJYdTc4YWJWNnFYZm5aYW1YazlsdXBYCmtoU3NFSUIzNWEvVE1Hbm0wRzU3SERlN1NhcVFJRVFKN013MC9kV053ZXFTN0oydlFFWUFLY2JtNHpjdlJzb2MKU0NWWUI0VnhmOFlHY0tXTkNGWFZLVUpreUVzUXZpS3JEQldHallYTlBlMXJzMzBpaUhjN3M1a0M3aFEwdTVXYwpudjR2RXNHUHNrcGJ1RTkyNTcrRm00VWg0L1J0L1lHSFNXaHgvUmYxNGROa1RTTW9iOWdYMWZQakxQOEJ4SUNhCnNOVUVOdlpqQU53S3RhSy9xT1pNcTFScWJuU3k3THlLRzh2MTF1U0loamltczU3QUx2QW9Ockh2Y29BUFdmK0UKTm9wLzVNZHlpbVU3Y3NhQzN2SjNvYmtjK1lwWmpxMFVpWG5qUXM3Ri9WcVNqeEVqcElTeWlwUmxXazVpaGVkNQpyMXk5Ykp2VHViZC82aVB1OGVSNmtZWXRmdDM1aWFFUE12S3JucXY1dGlOSFhlbkJlR2pta2VGY0JTNCtBK1BECit2MTVldzZsR1Z0ZncyMjRNMytUS1didjdtcm1vOXE2V2RtYTY2eEdqNjJpN0Z5aFpKZlVqTG9lZ1BEV0dNODkKalZrUFBqZWs4emxVd0t3VXIzUVI4VmUrdWUza3ZHZWQ4YnRIVjNiUkFqdm1jSlJSbmhpS1hRSE53SEtKTEdvNQppY0JnM0RESjdmMDV3eVlIWm9pd3hkN3dRQy9PYlFJREFRQUJBb0lDQUhGOHlxakpzRjdMdzBqTXVCL29MenE1ClF0NjBPT1FTcTZFKzFIbEhvdEFwMk8vQTl6UmhEZVBQTGE5emRPWVorcVk5SzAzSndCWGVVMDNlN1NJL0Z0ZVEKZHAvMy92Q0t1aFlmUFRXdHd6bm1paGEyWTdjMlBDcE9zMG8wQnlYMXpSeHFWcWI3NSsyWVVOSWRMNk5JU1F4bgpGNVorRExnVXBiSDM5N0NkWjd4SWVFaDVSay9US1dxRUlYekcrMnAzNEEyOW4wYkxvbURsNnRWUzZkQ2VYcjhRCnZrMjY4YVFwMlVhMm90MTUwOWlvWW5vcFpSbGE1VDdzcm53Z3hlbHhZWVpKck9LR0c5a0U2TUJuWHVUamJCNjYKZnNTOEUrcUtKOFVmZmNVRWFuY205SEtIQlMvNVVyNkZXZnd0QkV5WDRJRlZ0eHlKelBmekl1N3ZleHVxQStacgo2TlZXZjllMy9kRGtrdUpNRWJxZjNBYlY5cWVLcjgwMjRjVk5sbkhoekxLRzRyVEZJYU9RdEpKS3RLWDUyZGRHCnEyckFyYnR0a1JSQUsvdFdRZFE5ZXhjY1RxZVBEY0s4cituV2FRcENSL2xRT2FFSldXc2g0UGRhbWNaeWJvYTUKelYrQXE0eGtXUGFSdmhZeExiWERxSk9YQVpjOCsvRzFTbkowUkJtSUdpU3NYQjVCeDRYSFRuRWhmdUdrWnYyZgp0VzJMeGRWK3pieWt2aTRibXp2ZlYyVHUyVWZHU0EzQkdWN0FrZlZJck9iQTZid1NKZCsxSHVsNW95eGh4SHNOClRsUWlOR2xUSHdLOW93SCs2eTkyQ2lDQUhEV0NocGdEenlsWGExalVQUTlrMk1ieEp4WVNwNnJ0QmhHLzZkL28KNEhuVk0zWHU3SlBsQ3FBZmZnREJBb0lCQVFEemtCYVdPUUgvSDJEZnhMbVVYVDUxLzRRR0xyeFJkZDJJQkZvNwpuUWhNV20xVlRzVWg0OTdiOUozVVJlR2t1V1NPMll4UWlxcFAxOWdvQ2FmVEYwdm51ZVlRMDAzbUIyZE1FMG1jCmNUWDk2T1JKcGRyRUxSZWkxZmdtWHhPTnRiMGFNWFNwQzBFS2kySlF2SzI2cm5Cb2dXZlZRTWVydXI4NldiSDgKOFBUTjUzWkhtazV5NHVKY0ZjMjg4T2E3U1lkL0VVbXdHRlNZMll3SHB4Z2grZGRzNFhYUDVXRTFRWnAxazhFVwppRlN1cll4dElXZm14emM2WExzL01zcDlWTmRVOHlqWjQ1cmExcC9sL2ZzazN6M2xwSndLNW0za0ZNRmk2b0hFCitadUJFZGJFNzRtNmhDWS93Qm5rdFd2WnBKVnVzMXIrZkJKeURaOHNlb25ITkFwSkFvSUJBUURDRmlta25HaDcKdzRpK1ZITHdxdGVYaDhIc3N0WndKUHFuRDBTN1FNSStXTHpHOEhVZnZuRmlGcnBuK0RkL3JZcGphSDA5YUlCVQo5U214by82dEVqWjVRWHRIYUVKUnJGSWhhcUg2WmcrRTI1SGx2c0FPNDB0elpWZ2ZrT0llVXVGTHNJc2UyM1FICk9HRy9VOVBsa1M0N2ZFYVJ4RnZoT2pvaDZrRUxqd293Yk1vOEQ1YVF5N2tlZDJmTHhYRzkwaklkWjBia3NzeUkKNVM3UWg0Wmh2b1BOYUhld1pJZG9zdC9PUGxjVFFwekFlalRxMDgyek5IT3JIUnU3UDk2bHdQam5IYVo2QVlxZwpKdUtBRHRURTFUU1E2ZkNXUDIwa2kzSmRLTFZwTzMvZ0daU25pbFFoR0lmTmVNZVdNSE9YdSttOE5vdEJORmRuCmdWZlZZQXVscHNNRkFvSUJBUURRb09iSUROTHAvcTNUWDBaN2tKZDFLY2FrS1JwRVNNcld2S3V5RHFQU0MwOUYKMkhCQnhGZmNYeDltZWVsN1dSYUt5a3hIblUrZmpzcm9HTVU1cXVYbyt6TFh6TGdZUnRVenMvM0UxTENqNnY3SgpHeGxXR3kzNDNJRndGTmJCOXgraE5TV3h1eU1lYmlCcitnSnlPd09zY05SSk5mRVM1NmJ2eTI4THREWnR2VXR5CnIvbHNyVzJwNVQ5VERhTUdZRWlCRG9UcEl4NHJ3NFVQOVJCVjRoV21mVVdXSyt4bFd1bDh0M0NZNVhSc0g5cCsKakRQYzJWNDBUc1JSc1NjRHprMll4YVNEWjFQNUNnanpUK2YxUUloYmtmSGI0Ri9YRS9SR3o0c1M5NkE5SWRPdQo0MlE5Y1A3MmNvMTdlKytEQVZqQzl6MEZhYSsvSkczcEFwbk1HWWFKQW9JQkFGQ3BiMU1uWWRFVithM0lZU0NlCmtBMDg4WjZTME1ZNHlDZElGRE9TZldmMTd6YnExbktEN3BGcWlyd05EOXV6WHhGamFyRnJ6ZklCRmZ2ckFUd2kKbHBzY1dNVGJrcnhvMXBWbXdMelZUOXZTZVRjM2FKQ0hiR01nR2xpOEdRMnJPbEQvcFVJRXlKcjdscnd5ZFoweQpFam5NczNOL1hRUWs4K1lHZWxQNGRhNmNlQXd3R2s1QkxNVjVzSnlpaVZ2dmtMNWhucmdMaXkvVnQvZ1lhd1FTCmJxcWVvU2VoRUJtMlJZZHNwem1zOUlLV0I0b1V6cWVNeEFtNGhqN3pFM0JsMjh3SnFaZUpMbmpTMEUyU1hHRVYKanN3dlBicmp6MU5oMVB6Y24xQ0YxdVpuR3ozcUluN0N1Q1h2N1ZzQTlmbDRzbkp6WkxxTHEwdXNHTG5vT2M3MQptSlVDZ2dFQVFMSGpDaU1ZWGRxSTMwRm5JeEpJZDFDNmdSci9aN3BLK3NGdWE2Rm1ZMEZFeFlWNis4cWR3SHU1CjNWMEh6NTVmUGJoa1dQKzN5VWxzejlOenhEOTMyOTdWQ3N0ZFRpK29QcWpHbG9mRzVYcEgraGF2emt6RUFLc0cKelZDY1RZNXdSMHVBMll5YzJ6ZGlaM0tWOHJuMkZ1cXV3WENSMHFySUJWR0FFNzgyTTVOcDh4cEErRm9CSHl1ZQpoWnEvdGF1ZnZJR3B5cEFGejdsOHdQTTM4SjdzMEEwYlVQRjlQMDdLbitEcGJyd1BIcFMrZU9RZGVFVjdtSTRMCnZqV1kwVVFZV3k5QUxGMG1oQUJrM2ttKzlzYXQ1YjJXcDR6eFFZaDREWW1rL09qWWJ2bS9VV0cySEdXbjl4ZUsKeGJndkVJQlNRczZHdmVqY0xWTWJJTWlwTmxDWUVRPT0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
    "password": |- 
          cGFzc3dvcmQK
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data:
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
          labels: 
            name: ~NAME~
          name: ~NAME~
      spec:
        volumes:
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
              - secret:
                  name: ~NAME~-secret-config
              - secret:
                  name: ~NAME~-secret-cert
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            volumeMounts:
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/sf/cmod/secrets
            env:
              - name: MY_POD_NAME
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.name
              - name: MY_POD_IP
                valueFrom:
                  fieldRef:
                    fieldPath: status.podIP
            ports:
              - name: https
                containerPort: 8060
                protocol: TCP
            resources:
              {}
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: ClusterIP
    ports:
      - port: 8060
        protocol: TCP
        name: https-cmod
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;

//================================================
hpe5gResources.defaults['nrf-reg-agent']['template']=
//================================================
`
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-nnrf-reg-agent.yml: |
      # Sample Thorntail global configuration.
      #
      swarm:
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  buffer-pool: null
                  http2-header-table-size: null
                  http2-initial-window-size: null
                  http2-max-concurrent-streams: null
                  http2-max-frame-size: null
                  http2-max-header-list-size: null
                  max-buffered-request-size: null
                  max-connections: 2000
                  max-header-size: null
                  max-headers: null
                  max-processing-time: null
                  no-request-timeout: null
                  read-timeout: null
                  receive-buffer: null
                  send-buffer: null
                  ssl-session-cache-size: null
                  ssl-session-timeout: null
                  url-charset: null
                  verify-client: null
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
              cipher-suite-filter: DEFAULT
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe-5g/hpe-nnrf-reg-agent/security/keystore.p12
              credential-reference:
                clear-text: password
              type: PKCS12
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            com.hpe:
              level: INFO
            com.hpe.imsc:
              level: ERROR
            io.jaegertracing.internal.reporters.LoggingReporter:
              level: ERROR
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            metrics_influxdb.measurements:
              level: ERROR
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
              use-parent-handlers: false
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nnrf-reg-agent-config.yaml: |
      # Network function NNRF Client MicroService configuration.
      # The parameters below can be overridden by an external configuration.
      # HTTP/2 REST client subsystem
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 100
          jersey.config.client.readTimeout: 1000
        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: ~fluentd_NAME~.~PROJECT~.svc.cluster.local
              port: 24224
      statistics-configuration:
        id: hpe-nf-nrf-reg-agent-statistics
        jmx:
          domain: nnrf-reg-agent
          enabled: false
          properties:
            com.hpe.imsc.statistics.jmx.descriptors: false
            com.hpe.imsc.statistics.jmx.notifications: false
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.database: nnrf-reg-agent
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
      nnrf-client:
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: 
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        retry-limit: -1
        nfprofile-uri: file:/etc/opt/hpe-5g/hpe-nnrf-reg-agent/nnrf-register.config
        disable-register: false 
        disable-deregister: false
        opentracing-enabled: false
        enable-cache: false
        default-cache-validity-period-secs: 3600
        self-service-name: hpe-nf-nrf-reg-agent
        monitor-service-name: 
        monitor-interval: 15000
        kubernetes-namespace: default
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-register-configmap
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
        "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F994",
        "nfType":"UDM",
        "nfStatus":"REGISTERED",
        "heartBeatTimer": "45", 
        "ipv4Addresses":["127.0.0.1"],
        "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
        "fqdn":"localhost",
        "allowedNfTypes": ["NEF"],
        "nfServices" : [ {
            "serviceInstanceId" : "UDM-EE-HPE",
            "serviceName" : "nudm-ee",
            "versions" : [ {
              "apiVersionInUri" : "v1",
              "apiFullVersion" : "1.0.2"
            } ],
            "scheme" : "https",
            "nfServiceStatus" : "REGISTERED",
            "fqdn":"localhost",
            "ipEndPoints" : [ {
              "ipv4Address" : "127.0.0.1",
              "transport" : "TCP",
              "port" : "30045"
            } ],
            "allowedNfTypes": ["NEF"]
          } ]
      }
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.p12": |- 
      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
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:  
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-register-configmap
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~ 
            image: ~IMAGE_STREAM~  
            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe-5g/hpe-nnrf-reg-agent
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe-5g/hpe-nnrf-reg-agent/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe-5g/hpe-nnrf-reg-agent/nnrf-reg-agent-config.yaml
            livenessProbe:
              httpGet:
                path: /probes/healthy
                port: health
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /probes/healthz
                port: health
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              {}
        serviceAccountName: ~NAME~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: 
    ports:
      - port: 8443
        protocol: TCP
        name: nnrf-reg-agent-https
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['nudm-ee']['template']=
//================================================
`
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-ee.yml: |
      #
      # Sample Thorntail global configuration.
      #
      swarm:
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  buffer-pool:
                  http2-header-table-size: 
                  http2-initial-window-size: 
                  http2-max-concurrent-streams: 
                  http2-max-frame-size: 
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-connections: 2000
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  no-request-timeout: 
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe/nf/udm/ee/security/keystore.jks
              credential-reference:
                clear-text: password
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-ee-nf-config.yaml: |
      #
      # Sample Network function configuration.
      #
      # HTTP/2 REST client subsystem
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 1000
          jersey.config.client.readTimeout: 10000
        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false
      nudm-ee:
        hplmn.mcc: 909
        hplmn.mnc: 88
        eeSubscirpionExpiryDuration: 172800
        udr:
          hostname: localhost
          port: 5090
          scheme: http
          version: v1
          basepath: http://15.213.52.238:5090
          eeExprityMaxDays: 2
      nnrf-client:
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        nfprofile-uri: /etc/opt/hpe/nf/udm/ee/nnrf-register.config
        enable-cache: false
        default-cache-validity-period-secs: 3600
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: /etc/opt/hpe/nf/udm/ee/udr-disc.json
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224
      statistics-configuration:
        id: nudm-ee-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: nudm-nf
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
        jmx:
          enabled: false
      call-tracing:
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_AGENT_HOST: localhost
          JAEGER_AGENT_PORT: 8090
          JAEGER_ENDPOINT: http://localhost:6831/api/traces
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: false
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        enabled: true
        trace-all-operations: true
        trace-all-ues: false
        provisioning-uri: "file:/etc/opt/hpe/nf/udm/ee/call-tracing-provisioning.yaml"
        max-trace-depth: MINIMUM
        max-body-length: 1200
        autorefresh-provisioning-period: 30
      caching-providers:
        - cache-managers:
          - caches: null
            classloader: '#notused'
            properties: null
            uri: paas://redis-cache-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-provider
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
        "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F994",
        "nfType":"UDM",
        "nfStatus":"REGISTERED",
        "heartBeatTimer": "45", 
        "ipv4Addresses":["127.0.0.1"],
        "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
      
        "fqdn":"localhost",
        "allowedNfTypes": ["NEF"],
        "nfServices" : [ {
            "serviceInstanceId" : "UDM-EE-HPE",
            "serviceName" : "nudm-ee",
            "versions" : [ {
              "apiVersionInUri" : "v1",
              "apiFullVersion" : "1.0.2"
            } ],
      
            "scheme" : "https",
      
            "nfServiceStatus" : "REGISTERED",
            "fqdn":"localhost",
            "ipEndPoints" : [ {
              "ipv4Address" : "127.0.0.1",
              "transport" : "TCP",
              "port" : "30045"
            } ],
            "allowedNfTypes": ["NEF"]
          } ]
      }
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
`
+log4j2xml+
`
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-udr-discovery
    namespace: ~PROJECT~
  data:
    udr-disc.json: |
      [ {
      "nfInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
      "nfType" : "UDR",
      "nfStatus" : "REGISTERED",
      "plmnList" : [ {
        "mcc" : "111",
        "mnc" : "222"
      } ],
      "ipv4Addresses":["127.0.0.1"],
      "nfServicePersistence" : false,
      "nfServices" : [ {
          "serviceInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
          "serviceName" : "~nudr-dr_NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.0"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "5090"
          } ],
        "allowedPlmns" : [ {
          "mcc" : "208",
          "mnc" : "01"
        } ],
        "allowedNfTypes" : [ "NEF", "UDM", "PCF", "BSF" ],
        "allowedNfDomains" : [ "pfdmanagement.nnef.cms5g.hpe.com" ]
      } ]
      } ]
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.jks: |- 
      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
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:  
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                  name: ~NAME~-application-configmap-log4j
              - configMap:
                  name: ~NAME~-application-configmap-udr-discovery
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            volumeMounts:
            - name: ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/ee
            - name: ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/ee/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/ee/nudm-ee-nf-config.yaml
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30045
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['nudm-li-poi']['template']=
//================================================
`
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-li-poi.yml: |
      # Sample Thorntail global configuration.
      #
      swarm:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        http:
          port: 8080
        undertow:
          alias: localhost
          servers:
            default-server:
              http-listeners:
                default:
                  enabled: true
                  socket-binding: http
                  enable-http2: true
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: "/etc/opt/hpe/nf/udm/li-poi/security/keystore.jks"
              credential-reference:
                clear-text: password
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
`
+log4j2xml+
`
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-li-poi-nf-config.yaml: |
      # Sample Network function DEFAULT configuration.
      #
      # The parameters below can be overridden by an external configuration.
      #
      # HTTP/2 REST client subsystem
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.netty.connector.Http2NettyConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 10
          jersey.config.client.connectTimeout: 100
          jersey.config.client.readTimeout: 100
      poi:
        oid: "0.4.0.2.2.4.19.15.1.4.19.15.1.1" 
      # Kafka configuration 
      pubsub:
        brokers:
         - ~amq-streams_NAME~-kafka-brokers.~PROJECT~.svc.cluster.local:9092
        properties:
          group.id:  UDMMsgConsumerGroup
        udmEventReportQueue: UDMServingSystem
      # X2 Packet configuration
      x2pdu:
        version: 1
        pduType:
           x2: 1
           KeepAlive: 3
           KeepAliveAck: 3
        payloadFormat: 2   
        payloadDirection: 5
        attributes:
           timestamp: 9
           matchedTargetIdentifier: 17
      logging:
        locale: en-US
        loggers:
        - factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          name: log4j2
      statistics-configuration:
        id: nudm-li-poi-statistics
        enabled: true
        jmx:
          domain: Nnef_UDM_LiPoi
          enabled: true
          properties:
            com.hpe.imsc.statistics.jmx.descriptors: "true"
            com.hpe.imsc.statistics.jmx.notifications: "true"
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.database: nflipoi
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
          com.hpe.imsc.statistics.influxdb.server.port: "8086"
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.publish.jsonDescriptors: true
        pubsub-publisher-enabled: false
        pubsub-subscriber-enabled: true
      caching-providers:
        - cache-managers:
          - caches:
            - eternal: "true"
              keyType: java.lang.String
              name: simple-redis-cache
              properties:
                cache.codec: com.hpe.cms5g.udm.li.common.utils.TFEncryptionCodec
                cache.connect: false
                cache.uri: redis://~redis_NAME~.~PROJECT~.svc.cluster.local:6379?database=0
              readThrough: "false"
              valueType: java.lang.String
              writeThrough: "false"
            classloader: '#notused'
            properties: null
            uri: paas://redis-caching-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-manager      
      # Security
      tls:
        protocols: TLSv1.2
        connection.timeout: 3000
        keystore: "/etc/opt/hpe/nf/udm/li-poi/security/keystore.jks"
        keystorePassword : password
        truststore: "/etc/opt/hpe/nf/udm/li-poi/security/keystore.jks"
        truststorePassword : password
      
      dataEncryption:
        dataSecret: "VU5JWjVBQkNENjc4OTBFRg==" 
        keySecret: "secureMe"
      #UECM data validation
      validation:
        peiImeipattern: "((imei-)([0-9]{14}))"
        peiImeicdpattern: "((imeicd-)([0-9]{15}))"
        peiImeisvpattern: "((imeisv-)([0-9]{16}))"
        guamiPlmnIdpattern: "([0-9]*+[\\\\s])([0-9]*)"
        guamiAmfIdpattern: "([0-9]*+[\\\\s]){2}([0-9]*)"
        supiImsi: "imsi-[0-9]{6,15}"
        supiNai: "nai-(.+)@(.+)"
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:  
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-log4j
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/li-poi
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/li-poi/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/li-poi/nudm-li-poi-nf-config.yaml -Dpaas.service.name=nudm-li-poi
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              {}
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data:
    keystore.jks: |- 
      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
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30045
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['nudm-li-tf']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.jks": |- 
      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
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
  `
  +log4j2xml+
  `
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-li-tf-nf-config.yaml: |
      # Sample Network function DEFAULT configuration.
      #
      # The parameters below can be overridden by an external configuration.
      #
      # HTTP/2 REST client subsystem
      caching-providers:
        - cache-managers:
          - caches:
            - eternal: "true"
              keyType: java.lang.String
              name: simple-redis-cache
              properties:
                cache.codec: com.hpe.cms5g.udm.li.common.utils.TFEncryptionCodec
                cache.connect: false
                cache.uri: redis://~redis_NAME~.~PROJECT~.svc.cluster.local:6379?database=0
              readThrough: "false"
              valueType: java.lang.String
              writeThrough: "false"
            classloader: '#notused'
            properties: null
            uri: paas://redis-caching-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-manager  
      
      logging:
      
        locale: en-US
        loggers:
        - factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          name: log4j2
      
      statistics-configuration:
        id: nudm-li-tf-statistics
      
        enabled: true
        http-client-enabled: true
        http-server-enabled: true
        jmx:
          domain: Nnef_UDM_LiTf
          enabled: true
          properties:
            com.hpe.imsc.statistics.jmx.descriptors: "true"
            com.hpe.imsc.statistics.jmx.notifications: "true"
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.database: nflitf
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
          com.hpe.imsc.statistics.influxdb.server.port: "8086"
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.publish.jsonDescriptors: true
      
      # Schema Validation
      validation:
        internationalE164: "[0-9]{1,15}"
        imsi: "[0-9]{6,15}"
        imei: "[0-9]{14}"
        imeiCheckDigit: "[0-9]{15}"
        imeisv: "[0-9]{16}"
        ipv4Address: "((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])"
        ipv6Address: "([0-9a-f]{4}:){7}([0-9a-f]{4})"
        tcpport: "^([1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
        udpport: "^([0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
        emailAddress: "[a-zA-Z0-9\\\\.!#$%&amp;'\\\\*\\\\+\\\\\\\\/=\\\\?\\\\^_\`\\\\{\\\\|\\\\}~\\\\-]+@[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\\\\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*"
        uuid: "[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}"
        token: "^(\\\\S+)"
        qualifiedMicrosecondDateTime: "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\\\\.[0-9]{6}(Z|[+-][0-9]{2}:[0-9]{2})$"
        version: "v1.6.1"
        deliveryType: "X2Only"
        enableKeepAlive: true
      
      keepAlive:
        TIME_P2: 60
        
      dataEncryption:
        dataSecret: "VU5JWjVBQkNENjc4OTBFRg=="
        keySecret: "secureMe"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-li-tf.yml: |
      # Sample Thorntail global configuration.
      #
      
      swarm:
        https:
          only: true
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
        http:
          port: 8080
        undertow:
          alias: localhost
          servers:
            default-server:
              http-listeners:
                default:
                  enabled: true
                  socket-binding: http
                  enable-http2: true
                  always-set-keep-alive: true
              https-listeners:
                default-https:
                  enabled: true
                  socket-binding: https
                  enable-http2: true
                  ssl-context: twoWaySSC
                  always-set-keep-alive: true
          application-security-domains:
            applicationDomain:
              security-domain: myDomain 
        elytron:
          key-store-realms:
            ksRealm:
              key-store: twoWayTS
          x500-attribute-principal-decoders:
            CNDecoder:
              oid: 2.5.4.3
              maximum-segments: 1
          security-domains:
            myDomain:
              realms:
                - realm: ksRealm
              default-realm: ksRealm
              principal-decoder: CNDecoder
              permission-mapper: default-permission-mapper
             
          server-ssl-contexts:
            twoWaySSC:
              protocols: TLSv1.2
              key-manager: twoWayKM
              trust-manager: twoWayTM
              need-client-auth: true
              security-domain: myDomain
          key-managers:
            twoWayKM:
              key-store: twoWayKS
              credential-reference:
                clear-text: password
          trust-managers:
            twoWayTM:
              key-store: twoWayTS
              credential-reference:
                clear-text: password
          key-stores:
            twoWayKS:
              path: "/etc/opt/hpe/nf/udm/li-tf/security/keystore.jks"
              credential-reference:
                clear-text: password
              type: JKS
            twoWayTS:
              path: "/etc/opt/hpe/nf/udm/li-tf/security/keystore.jks"
              credential-reference:
                clear-text: password
              type: JKS
          file-audit-logs:
            local-audit:
              path: /var/opt/hpe/nf/udm/li-tf/logs/audit.log
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
      
            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: NodePort
    ports:
      - port: 8443
        nodePort: 30673
        protocol: TCP
        name: https-nudm-nf
  selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-log4j   
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/li-tf
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/li-tf/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/li-tf/nudm-li-tf-nf-config.yaml -Dpaas.service.name=nudm-li-tf
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health             
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health              
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['nudm-ueau']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.jks": |- 
      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
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-call-tracing
    namespace: ~PROJECT~
  data:
    call-tracing-provisioning.yaml: |
      ue-provisioning:
        - ue-id:
            - "imsi-0555555555"
            - "msisdn-6666666666"
          traced-service:
            - ~NAME~
          propagate-trace: true
          trace-depth: "MEDIUM"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
  `
  +log4j2xml+
  `
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
      "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F993",
      "nfType":"UDM",
      "nfStatus":"REGISTERED",
      "heartBeatTimer": "45",
      "ipv4Addresses":["127.0.0.1"],
      "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
  
      "fqdn":"localhost",
      "allowedNfTypes": ["AUSF"],
      "nfServices" : [ {
          "serviceInstanceId" : "UDM-UEAU-HPE",
          "serviceName" : "~NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.1"
          } ],
  
          "scheme" : "https",
  
          "nfServiceStatus" : "REGISTERED",
          "fqdn":"localhost",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "30046"
          } ],
          "allowedNfTypes": ["AUSF"]
        } ]
      }
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-udr-discovery
    namespace: ~PROJECT~
  data:
    udr-disc.json: |
      [ {
      "nfInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
      "nfType" : "UDR",
      "nfStatus" : "REGISTERED",
      "plmnList" : [ {
        "mcc" : "111",
        "mnc" : "222"
      } ],
      "ipv4Addresses":["127.0.0.1"],
      "nfServicePersistence" : false,
      "nfServices" : [ {
          "serviceInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
          "serviceName" : "~nudr-dr_NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.0"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "5090"
          } ],
        "allowedPlmns" : [ {
          "mcc" : "208",
          "mnc" : "01"
        } ],
        "allowedNfTypes" : [ "NEF", "UDM", "PCF", "BSF" ],
        "allowedNfDomains" : [ "pfdmanagement.nnef.cms5g.hpe.com" ]
      } ]
      } ]
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-ueau-nf-config.yaml: |
      #
      # Sample Network function configuration.
      #
      # HTTP/2 REST client subsystem
      ---
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 1000
          jersey.config.client.readTimeout: 10000
      
        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false
      
      udm-ueau:
        hplmn.mcc: 909
        hplmn.mnc: 88
      
        cmod:
          hostname: cmod
          port: 8060
          scheme: https
        threadpool:
          size: 30  
      
      nnrf-client:
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        nfprofile-uri: /etc/opt/hpe/nf/udm/ueau/nnrf-register.config
        enable-cache: false
        default-cache-validity-period-secs: 3600
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: /etc/opt/hpe/nf/udm/ueau/udr-disc.json
      
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224
      
      statistics-configuration:
        id: nudm-ueau-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: nudm-nf
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
        jmx:
          enabled: false
      call-tracing:
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_AGENT_HOST: localhost
          JAEGER_AGENT_PORT: 8090
          JAEGER_ENDPOINT: http://localhost:6831/api/traces
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: false
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        enabled: true
        trace-all-operations: true
        trace-all-ues: false
        provisioning-uri: "file:///etc/opt/hpe/nf/udm/ueau/call-tracing-provisioning.yaml"
        max-trace-depth: MINIMUM
        max-body-length: 1200
        autorefresh-provisioning-period: 30
      
      caching-providers:
        - cache-managers:
          - caches: null
            classloader: '#notused'
            properties: null
            uri: paas://redis-cache-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-provider

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-ueau.yml: |
      #
      # Sample Thorntail global configuration.
      #
      swarm:
        
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
  
        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  buffer-pool: 
                  http2-header-table-size: 
                  http2-initial-window-size: 
                  http2-max-concurrent-streams: 
                  http2-max-frame-size: 
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-connections: 2000
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  no-request-timeout: 
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe/nf/udm/ueau/security/keystore.jks
              credential-reference:
                clear-text: password
              type: JKS
          file-audit-logs:
            local-audit:
              path: /var/opt/hpe/nf/udm/ueau/logs/audit.log
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: NodePort
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30046
  selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                  name: ~NAME~-application-configmap-log4j
              - configMap:
                  name: ~NAME~-application-configmap-udr-discovery
              - configMap:
                  name: ~NAME~-application-configmap-call-tracing    
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/ueau
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/ueau/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/ueau/nudm-ueau-nf-config.yaml
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health             
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 40
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health              
              initialDelaySeconds: 60
              periodSeconds: 10
              timeoutSeconds: 40
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['nudm-uecm']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.jks": |- 
      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
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-call-tracing
    namespace: ~PROJECT~
  data:
    call-tracing-provisioning.yaml: |
      ue-provisioning:
        - ue-id:
            - "imsi-0555555555"
            - "msisdn-6666666666"
          traced-service:
            - ~NAME~
          propagate-trace: true
          trace-depth: "MEDIUM"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
  `
  +log4j2xml+
  `
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
      "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F992",
      "nfType":"UDM",
      "nfStatus":"REGISTERED",
      "heartBeatTimer": "45",
      "ipv4Addresses":["127.0.0.1"],
      "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
      "fqdn":"localhost",
      "allowedPlmns":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
      "allowedNfTypes": ["AMF","SMF", "NEF","GMLC"],
      "nfServices" : [ {
          "serviceInstanceId" : "UDM-UECM-HPE",
          "serviceName" : "nudm-uecm",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.2"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "fqdn":"localhost",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "30044"
          } ],
            "allowedPlmns":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],
          "allowedNfTypes": ["AMF","SMF","NEF","GMLC"]
        } ]
      }
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-udr-discovery
    namespace: ~PROJECT~
  data:
    udr-disc.json: |
      [ {
      "nfInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
      "nfType" : "UDR",
      "nfStatus" : "REGISTERED",
      "plmnList" : [ {
        "mcc" : "111",
        "mnc" : "222"
      } ],
      "ipv4Addresses":["127.0.0.1"],
      "nfServicePersistence" : false,
      "nfServices" : [ {
          "serviceInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
          "serviceName" : "~nudr-dr_NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.0"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "5090"
          } ],
        "allowedPlmns" : [ {
          "mcc" : "208",
          "mnc" : "01"
        } ],
        "allowedNfTypes" : [ "NEF", "UDM", "PCF", "BSF" ],
        "allowedNfDomains" : [ "pfdmanagement.nnef.cms5g.hpe.com" ]
      } ]
      } ]
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-uecm-nf-config.yaml: |
      #
      # Sample Network function configuration.
      #
      # HTTP/2 REST client subsystem
      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 1000
          jersey.config.client.readTimeout: 10000
        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false
      udm-uecm:
        hplmn.mcc: 909
        hplmn.mnc: 88
        features:
          ee-enable: false
          roamingODBDataCheck: false
          OperatorPolicyForSharedData:
            Registration: AllowedWithSharedData
          LIEnbld: false
      nnrf-client:
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        nfprofile-uri: /etc/opt/hpe/nf/udm/uecm/nnrf-register.config
        enable-cache: false
        default-cache-validity-period-secs: 3600
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: /etc/opt/hpe/nf/udm/uecm/udr-disc.json
      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl
          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224
      statistics-configuration:
        id: nudm-uecm-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: nudm-nf
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
        jmx:
          enabled: false
      call-tracing:
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_AGENT_HOST: localhost
          JAEGER_AGENT_PORT: 8090
          JAEGER_ENDPOINT: http://localhost:6831/api/traces
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: false
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        enabled: true
        trace-all-operations: true
        trace-all-ues: false
        provisioning-uri: "file:/etc/opt/hpe/nf/udm/uecm/call-tracing-provisioning.yaml"
        max-trace-depth: MINIMUM
        max-body-length: 1200
        autorefresh-provisioning-period: 30
      caching-providers:
        - cache-managers:
          - caches: null
            classloader: '#notused'
            properties: null
            uri: paas://redis-cache-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-provider
      # Kafka configuration
      pubsub:
        brokers:
         - 10.233.3.53:9092
        properties:
          group.id: UDMMsgConsumerGroup
          max.block.ms: 1000
        ServingSystemMsgQueue: UDMServingSystem
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-uecm.yml: |
      #
      # Sample Thorntail global configuration.
      #
      swarm:
        
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost
  
        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:
              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx
                  buffer-pool: 
                  http2-header-table-size: 
                  http2-initial-window-size: 
                  http2-max-concurrent-streams: 
                  http2-max-frame-size: 
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-connections: 2000
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  no-request-timeout: 
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe/nf/udm/uecm/security/keystore.jks
              credential-reference:
                clear-text: password
              type: JKS
          file-audit-logs:
            local-audit:
              path: /var/opt/hpe/nf/udm/uecm/logs/audit.log
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:
            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: NodePort
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30044
  selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                  name: ~NAME~-application-configmap-log4j
              - configMap:
                  name: ~NAME~-application-configmap-udr-discovery
              - configMap:
                  name: ~NAME~-application-configmap-call-tracing    
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/uecm
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/uecm/security
            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                containerPort: 8080
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/uecm/nudm-uecm-nf-config.yaml
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health             
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health              
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;

//================================================
hpe5gResources.defaults['nudm-sdm']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.jks": |- 
      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

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-call-tracing
    namespace: ~PROJECT~
  data:
    call-tracing-provisioning.yaml: |
      ue-provisioning:
        - ue-id:
            - "imsi-0555555555"
            - "msisdn-6666666666"
          traced-service:
            - ~NAME~
          propagate-trace: true
          trace-depth: "MEDIUM"
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
      <?xml version="1.0" encoding="UTF-8"?>
        
      <!-- ===================================================================== -->
      <!-- -->
      <!-- Log4j Configuration -->
      <!-- -->
      <!-- ===================================================================== -->

      <!-- | For more configuration information and examples see the Jakarta Log4j 
           | website: http://jakarta.apache.org/log4j -->

      <Configuration status="WARN">

        <!-- ============================== -->
        <!-- Append messages to the console -->
        <!-- ============================== -->
        
        <Appenders>
          <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %msg%n"/>
              <Filters>
                  <ThresholdFilter level="TRACE" onMatch="ACCEPT" />
              </Filters>
          </Console>
        </Appenders>

        <!-- ================ -->
        <!-- Limit categories -->
        <!-- ================ -->
        <Loggers>
          <Logger name="com.hpe" level="DEBUG"/>
          <Logger name="org.apache" level="WARN"/>
          <Logger name="kafka" level="WARN"/>
        
        <!-- ======================= -->
        <!-- Setup the Root category -->
        <!-- ======================= -->
        
          <Root level="INFO">
            <AppenderRef ref="Console"/>
          </Root>
        </Loggers>

      </Configuration>
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
      "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F991",
      "nfType":"UDM",
      "nfStatus":"REGISTERED",
      "heartBeatTimer": "45",
      "ipv4Addresses":["127.0.0.1"],
      "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],

      "fqdn":"localhost",
      "allowedNfTypes": ["AMF","SMF"],
      "nfServices" : [ {
          "serviceInstanceId" : "UDM-SDM-HPE",
          "serviceName" : "nudm-sdm",
          "versions" : [ {
            "apiVersionInUri" : "v2",
            "apiFullVersion" : "2.0.2"
          } ],

          "scheme" : "https",

          "nfServiceStatus" : "REGISTERED",
          "fqdn":"localhost",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",

            "port" : "30043"

          } ],
          "allowedNfTypes": ["AMF","SMF"]
        } ]
      }

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-udr-discovery
    namespace: ~PROJECT~
  data:
    udr-disc.json: |
      [ {
      "nfInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
      "nfType" : "UDR",
      "nfStatus" : "REGISTERED",
      "plmnList" : [ {
        "mcc" : "111",
        "mnc" : "222"
      } ],
      "ipv4Addresses":["127.0.0.1"],
      "nfServicePersistence" : false,
      "nfServices" : [ {
          "serviceInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
          "serviceName" : "~nudr-dr_NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.0"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "5090"
          } ],
        "allowedPlmns" : [ {
          "mcc" : "208",
          "mnc" : "01"
        } ],
        "allowedNfTypes" : [ "NEF", "UDM", "PCF", "BSF" ],
        "allowedNfDomains" : [ "pfdmanagement.nnef.cms5g.hpe.com" ]
      } ]
      } ]
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-sdm-nf-config.yaml: |
      #
      # Sample Network function configuration.

      #
      # HTTP/2 REST client subsystem

      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 1000
          jersey.config.client.readTimeout: 10000

        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false

      nudm-sdm:
        hplmn.mcc: 909
        hplmn.mnc: 88
        features:
          UDR-Support-Multi-data-set: true
          OperatorPolicyForSharedData: SendSubscriptionDataWithSharedData
          SubsToNotifyCallbackUri: https://localhost.com:8080/nudm-notify/v1/notify/sendNotification
          SdmSubscribeInUdr: true
          AMFRegMonitorInUDR: true
          ODBMonitorInUDR: false
          MultipleHplmnEnabled: false


      nnrf-client:
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        nfprofile-uri: /etc/opt/hpe/nf/udm/sdm/nnrf-register.config
        enable-cache: false
        default-cache-validity-period-secs: 3600
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: /etc/opt/hpe/nf/udm/sdm/udr-disc.json


      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl


          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224

      statistics-configuration:
        id: nudm-sdm-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: nudm-nf
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
        jmx:
          enabled: false
      call-tracing:
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_AGENT_HOST: localhost
          JAEGER_AGENT_PORT: 8090
          JAEGER_ENDPOINT: http://localhost:6831/api/traces
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: false
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        enabled: true
        trace-all-operations: true
        trace-all-ues: false
        provisioning-uri: file:/etc/opt/hpe/nf/udm/sdm/call-tracing-provisioning.yaml
        max-trace-depth: MINIMUM
        max-body-length: 1200
        autorefresh-provisioning-period: 30

      caching-providers:

        - cache-managers:
          - caches: null
            classloader: '#notused'
            properties: null
            uri: paas://redis-cache-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-provider
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-sdm.yml: |
      #
      # Sample Thorntail global configuration.
      #
      swarm:
        
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost

        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:

              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx

                  buffer-pool: 
                  http2-header-table-size: 
                  http2-initial-window-size: 
                  http2-max-concurrent-streams:  
                  http2-max-frame-size: 
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-connections: 2000
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  no-request-timeout: 
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe/nf/udm/sdm/security/keystore.jks
              credential-reference:
                clear-text: password
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:

            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: LoadBalancer
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30043
    selector:
        name: ~NAME~
        deploymentconfig: ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels:
          app.kubernetes.io/name: ~NAME~
          app.kubernetes.io/instance: ~PROJECT~
      spec:
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                  name: ~NAME~-application-configmap-log4j
              - configMap:
                  name: ~NAME~-application-configmap-udr-discovery
              - configMap:
                  name: ~NAME~-application-configmap-call-tracing    
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret

        containers:
          - name: ~NAME~
            namespace: ~PROJECT~
            image: ~IMAGE_STREAM~

            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/sdm
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/sdm/security

            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                
                containerPort: 8080
               
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true   -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/sdm/nudm-sdm-nf-config.yaml
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
`;

//================================================
hpe5gResources.defaults['nudm-notify']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~-secret
    namespace: ~PROJECT~
  type: Opaque
  data: 
    "keystore.jks": |- 
      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

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-call-tracing
    namespace: ~PROJECT~
  data:
    call-tracing-provisioning.yaml: |
      ue-provisioning:
        - ue-id:
            - "imsi-0555555555"
            - "msisdn-6666666666"
          traced-service:
            - ~NAME~
          propagate-trace: true
          trace-depth: "MEDIUM"

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-log4j
    namespace: ~PROJECT~
  data:
    log4j2.xml: |
      <?xml version="1.0" encoding="UTF-8"?>
        
      <!-- ===================================================================== -->
      <!-- -->
      <!-- Log4j Configuration -->
      <!-- -->
      <!-- ===================================================================== -->

      <!-- | For more configuration information and examples see the Jakarta Log4j 
           | website: http://jakarta.apache.org/log4j -->

      <Configuration status="WARN">

        <!-- ============================== -->
        <!-- Append messages to the console -->
        <!-- ============================== -->
        
        <Appenders>
          <Console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %msg%n"/>
              <Filters>
                  <ThresholdFilter level="TRACE" onMatch="ACCEPT" />
              </Filters>
          </Console>
        </Appenders>

        <!-- ================ -->
        <!-- Limit categories -->
        <!-- ================ -->
        <Loggers>
          <Logger name="com.hpe" level="DEBUG"/>
          <Logger name="org.apache" level="WARN"/>
          <Logger name="kafka" level="WARN"/>
        
        <!-- ======================= -->
        <!-- Setup the Root category -->
        <!-- ======================= -->
        
          <Root level="INFO">
            <AppenderRef ref="Console"/>
          </Root>
        </Loggers>

      </Configuration>
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-nnrf-registration
    namespace: ~PROJECT~
  data:
    nnrf-register.config: |
      {
      "nfInstanceId": "0590E150-4C69-4d86-A49C-990BF056F995",
      "nfType":"UDM",
      "nfStatus":"REGISTERED",
      "heartBeatTimer": "45",
      "ipv4Addresses":["127.0.0.1"],
      "plmnList":[{"mcc":111,"mnc":222}, {"mcc":111,"mnc":333}],

      "fqdn":"localhost",
      "allowedNfTypes": ["AMF","SMF"],
      "nfServices" : [ {
          "serviceInstanceId" : "UDM-NOTIFY-HPE",
          "serviceName" : "~NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v2",
            "apiFullVersion" : "2.0.2"
          } ],

          "scheme" : "https",

          "nfServiceStatus" : "REGISTERED",
          "fqdn":"localhost",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",

            "port" : "30047"

          } ],
          "allowedNfTypes": ["AMF","SMF"]
        } ]
      }

- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap-udr-discovery
    namespace: ~PROJECT~
  data:
    udr-disc.json: |
      [ {
      "nfInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
      "nfType" : "UDR",
      "nfStatus" : "REGISTERED",
      "plmnList" : [ {
        "mcc" : "111",
        "mnc" : "222"
      } ],
      "ipv4Addresses":["127.0.0.1"],
      "nfServicePersistence" : false,
      "nfServices" : [ {
          "serviceInstanceId" : "57fc19a1-b366-477a-8c2b-080044e680b5",
          "serviceName" : "~nudr-dr_NAME~",
          "versions" : [ {
            "apiVersionInUri" : "v1",
            "apiFullVersion" : "1.0.0"
          } ],
          "scheme" : "https",
          "nfServiceStatus" : "REGISTERED",
          "ipEndPoints" : [ {
            "ipv4Address" : "127.0.0.1",
            "transport" : "TCP",
            "port" : "5090"
          } ],
        "allowedPlmns" : [ {
          "mcc" : "208",
          "mnc" : "01"
        } ],
        "allowedNfTypes" : [ "NEF", "UDM", "PCF", "BSF" ],
        "allowedNfDomains" : [ "pfdmanagement.nnef.cms5g.hpe.com" ]
      } ]
      } ]
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-application-configmap
    namespace: ~PROJECT~
  data:
    nudm-notify-nf-config.yaml: |
      #
      # Sample Network function configuration.

      #
      # HTTP/2 REST client subsystem

      rest-client:
        connector-provider: com.hpe.paas.middleware.jersey.okhttp.connector.OkhttpConnectorProvider
        properties:
          jersey.config.client.async.threadPoolSize: 50
          jersey.config.client.followRedirects: false
          jersey.config.client.connectTimeout: 1000
          jersey.config.client.readTimeout: 10000

        security:
          keyCertificateLocation:
          keystoreLocation:
          keystorePassword: password
          keyCertificatePKLocation:
          keyCertificateKeyPairPassword:
          keyManagerFactoryAlgorithm:
          truststoreLocation:
          trustCertificateLocation:
          truststorePassword:
          trustCertificatePKLocation:
          trustCertificateKeyPairPassword:
          trustManagerFactoryAlgorithm:
          cryptoProtocol: TLSv1.2
          passwordEncoded: false

      nudm-notify:
        hplmn.mcc: 909
        hplmn.mnc: 88
        features:
          NotifyThreadPoolSize: 50
          OperatorPolicyForSharedData: SendSubscriptionDataWithSharedData
          SubsToNotifyCallbackUri: https://localhost.com:8080/nudm-notify/v1/notify/sendNotification
          SdmSubscribeInUdr: true
          AMFRegMonitorInUDR: true
          ODBMonitorInUDR: false
          MultipleHplmnEnabled: false


      nnrf-client:
        server-scheme: https
        server-fqdn: nrf.server.hpecorp.net
        server-port: 8443
        server-version: v1
        nfprofile-uri: /etc/opt/hpe/nf/udm/notify/nnrf-register.config
        enable-cache: false
        default-cache-validity-period-secs: 3600
        discover-stub-mode: false
        # json file containing remote NF profile to be discovered in stub-mode
        stub-remote-nf-profile: /etc/opt/hpe/nf/udm/notify/udr-disc.json


      logging:
        locale: en-US
        loggers:
          - name: log4j2
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.log4j.Log4j2I18nLoggerFactoryImpl


          - name: fluentd
            factory-class: com.hpe.paas.middleware.sdk.impl.logging.fluent.FluentI18nLoggerFactoryImpl
            properties:
              host: fluentd.logging
              port: 24224

      statistics-configuration:
        id: nudm-notify-statistics
        enabled: true
        jvm-metrics: true
        properties:
          com.hpe.imsc.statistics.influxdb.server.host: ~influxdb_NAME~.~PROJECT~.svc.cluster.local
          com.hpe.imsc.statistics.influxdb.server.port: 8086
          com.hpe.imsc.statistics.influxdb.server.protocol: http
          com.hpe.imsc.statistics.influxdb.server.database: nudm-nf
          com.hpe.imsc.statistics.influxdb.server.polling.interval: 10
        jmx:
          enabled: false
      call-tracing:
        properties:
          JAEGER_SERVICE_NAME: ~NAME~
          JAEGER_AGENT_HOST: localhost
          JAEGER_AGENT_PORT: 8090
          JAEGER_ENDPOINT: http://localhost:6831/api/traces
          JAEGER_REPORTER_FLUSH_INTERVAL: 100
          JAEGER_REPORTER_LOG_SPANS: false
          JAEGER_SAMPLER_TYPE: "probabilistic"
          JAEGER_SAMPLER_PARAM: 1.0
        enabled: true
        trace-all-operations: true
        trace-all-ues: false
        provisioning-uri: file:/etc/opt/hpe/nf/udm/notify/call-tracing-provisioning.yaml
        max-trace-depth: MINIMUM
        max-body-length: 1200
        autorefresh-provisioning-period: 30

      caching-providers:

        - cache-managers:
          - caches: null
            classloader: '#notused'
            properties: null
            uri: paas://redis-cache-manager
          classloader: '#notused'
          properties:
            caching.provider.class.name: com.hpe.paas.middleware.sdk.impl.cache.redis.RedisCachingProvider
          uri: paas://redis-caching-provider
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~-swarm-configmap
    namespace: ~PROJECT~
  data:
    project-5g-nudm-notify.yml: |
      #
      # Sample Thorntail global configuration.
      #
      swarm:
        
        https:
          only: false
          port: 8443
          keystore:
            embedded: true
          certificate:
            generate: true
            host: localhost

        io:
          workers:
            default:
              io-threads: 4
              task-max-threads: 32
        undertow:
          alias: localhost
          servers:
            default-server:

              https-listeners:
                default-https:
                  socket-binding: https
                  enable-http2: true
                  ssl-context: sslctx

                  buffer-pool: 
                  http2-header-table-size: 
                  http2-initial-window-size: 
                  http2-max-concurrent-streams:  
                  http2-max-frame-size: 
                  http2-max-header-list-size:
                  max-buffered-request-size:
                  max-connections: 2000
                  max-header-size:
                  max-headers:
                  max-processing-time:
                  no-request-timeout: 
                  read-timeout:
                  receive-buffer:
                  send-buffer: 
                  ssl-session-cache-size:
                  ssl-session-timeout:
                  url-charset:
                  verify-client:
        elytron:
          server-ssl-contexts:
            sslctx:
              protocols: TLSv1.2
              key-manager: km
          key-managers:
            km:
              key-store: ks
              credential-reference:
                clear-text: password
          key-stores:
            ks:
              path: /etc/opt/hpe/nf/udm/notify/security/keystore.jks
              credential-reference:
                clear-text: password
              type: JKS
        logging:
          root-logger:
            level: INFO
            handlers:
            - CONSOLE
          loggers:

            com.hpe:
              level: INFO
            io.netty:
              level: INFO
            io.undertow:
              level: INFO
            okhttp3:
              level: INFO
            org.jboss.as:
              level: INFO
            org.wildfly:
              level: INFO
            stdout:
              handlers:
              - STDOUT
              level: INFO
          console-handlers:
            STDOUT:
              named-formatter: null
              formatter: "%s%e%n"
            CONSOLE:
              named-formatter: null
              formatter: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{1.1.1.20.}] (%t) %s%e%n"
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    labels:
      name: ~NAME~
      deploymentconfig: ~NAME~
  spec:
    type: LoadBalancer
    ports:
      - port: 8443
        protocol: TCP
        name:  https-nudm-nf
        targetPort: 30047
    selector:
        name: ~NAME~
        deploymentconfig: ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    template:
      metadata:
        labels:
          app.kubernetes.io/name: ~NAME~
          app.kubernetes.io/instance: ~PROJECT~
      spec:
        volumes:
          - name: ~NAME~-config-volume
            projected:
              sources:
              - configMap:
                  name: ~NAME~-swarm-configmap
              - configMap:
                  name: ~NAME~-application-configmap
              - configMap:
                  name: ~NAME~-application-configmap-nnrf-registration
              - configMap:
                  name: ~NAME~-application-configmap-log4j
              - configMap:
                  name: ~NAME~-application-configmap-udr-discovery
              - configMap:
                  name: ~NAME~-application-configmap-call-tracing    
          - name: ~NAME~-secrets-volume
            projected:
              sources:
              - secret:
                  name: ~NAME~-secret

        containers:
          - name: ~NAME~
            namespace: ~PROJECT~
            image: ~IMAGE_STREAM~

            volumeMounts:
            - name:  ~NAME~-config-volume
              mountPath: /etc/opt/hpe/nf/udm/sdm
            - name:  ~NAME~-secrets-volume
              mountPath: /etc/opt/hpe/nf/udm/sdm/security

            ports:
              - name: https
                containerPort: 8443
                protocol: TCP
            ports:
              - name: health
                
                containerPort: 8080
               
                protocol: TCP
            env:
              - name: JAVA_OPTS
                value:  -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true   -Dgeneric.configuration.uri=file:/etc/opt/hpe/nf/udm/sdm/nudm-notify-nf-config.yaml
            livenessProbe:
              httpGet:
                path: /rest/probes/healthy
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            readinessProbe:
              httpGet:
                path: /rest/probes/healthz
                port: health
              initialDelaySeconds: 100
              periodSeconds: 10
              timeoutSeconds: 10
            resources:
              limits:
                cpu: 1000m
                memory: 2048Mi
              requests:
                cpu: 500m
                memory: 1024Mi
`;

//================================================
hpe5gResources.defaults['ignite']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
~PERSISTENCE_START~
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~-work
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: ~STORAGE~
    ~VOLUME~
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~-wal
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: ~STORAGE~
    ~VOLUME~
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~-walarchive
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: ~STORAGE~
    ~VOLUME~
~PERSISTENCE_END~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          env:
          - name: OPTION_LIBS
            value: ignite-kubernetes,ignite-rest-http
          - name: CONFIG_URI
            value: file:/etc/opt/hpe-5g/ignite/igniteConfig.xml
~PERSISTENCE_START~
          - name: JVM_OPTS
            value: "-DIGNITE_WAL_MMAP=false"
~PERSISTENCE_END~
          ports:
          # Ports to open.
          # Might be optional depending on your Kubernetes environment.
          - containerPort: 11211 # REST port number.
          - containerPort: 47100 # communication SPI port number.
          - containerPort: 47500 # discovery SPI port number.
          - containerPort: 49112 # JMX port number.
          - containerPort: 10800 # SQL port number.
          - containerPort: 10900 # Thin clients port number.
          volumeMounts:
            - name: ~NAME~
              namespace: ~PROJECT~
              mountPath: /etc/opt/hpe-5g/ignite/
~PERSISTENCE_START~
            - mountPath: /gridgain/work
              name: ~NAME~-work
            - mountPath: /gridgain/wal
              name: ~NAME~-wal
            - mountPath: /gridgain/walarchive
              name: ~NAME~-walarchive
~PERSISTENCE_END~
        volumes:
          - name: ~NAME~
            namespace: ~PROJECT~
            configMap:
              name: ~NAME~
~PERSISTENCE_START~
          - name: ~NAME~-work
            persistentVolumeClaim:
              claimName: ~NAME~-work
          - name: ~NAME~-wal
            persistentVolumeClaim:
              claimName: ~NAME~-wal
          - name: ~NAME~-walarchive
            persistentVolumeClaim:
              claimName: ~NAME~-walarchive
~PERSISTENCE_END~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: LoadBalancer
    ports:
      - name: rest
        port: 8080
        targetPort: 8080
      - name: sql
        port: 10800
        targetPort: 10800
      - name: thinclients
        port: 10900
        targetPort: 10900
    # Optional - remove 'sessionAffinity' property if the Ignite cluster
    # and applications deployed within Kubernetes
    sessionAffinity: ClientIP   
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    igniteConfig.xml: |+
      <beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation=" http://www.springframework.org/schema/beans  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">
       <bean id="ignite.cfg" class="org.apache.ignite.configuration.IgniteConfiguration">
~PERSISTENCE_START~
       <property name="workDirectory" value="/gridgain/work"/>
           <property name="dataStorageConfiguration">
               <bean class="org.apache.ignite.configuration.DataStorageConfiguration">
                   <property name="defaultDataRegionConfiguration">
                       <bean class="org.apache.ignite.configuration.DataRegionConfiguration">
                           <property name="persistenceEnabled" value="true"/>
                       </bean>
                   </property>
                   <property name="walPath" value="/gridgain/wal"/>
                   <property name="walArchivePath" value="/gridgain/walarchive"/>
               </bean>
           </property>
~PERSISTENCE_END~
         <property name="discoverySpi">
            <bean class="org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi">
              <property name="ipFinder">
                 <bean class="org.apache.ignite.spi.discovery.tcp.ipfinder.kubernetes.TcpDiscoveryKubernetesIpFinder">
                 <property name="namespace" value="~PROJECT~"/>
                 <property name="serviceName" value="~NAME~"/>
                 <property name="masterUrl" value="https://#{systemEnvironment['KUBERNETES_SERVICE_HOST']}:443"/>
                 </bean>
              </property>
            </bean>
         </property>
        </bean>
       </beans>
`;
//================================================
hpe5gResources.defaults['redis']['template']=redis_template(true);
hpe5gResources.defaults['redis-nopwd']['template']=redis_template(false);
//================================================
function redis_template(setPassword){
	var result=
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  name: ~NAME~
  stringData:
    database-password: ~NAME~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    ports:
    - name: redis
      nodePort: 0
      port: 6379
      protocol: TCP
      targetPort: 6379
    selector:
      name: ~NAME~
      deploymentconfig: ~NAME~
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: ~STORAGE~
    ~VOLUME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    annotations:
      template.alpha.openshift.io/wait-for-ready: 'true'
    name: ~NAME~
  spec:
    replicas: ~REPLICAS~
    selector:
      name: ~NAME~
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          name: ~NAME~
      spec:
        containers:
        - capabilities: {}
          env:
          - name: REDIS_PORT
            value: "6379"
`;
result+=setPassword?`
          - name: REDIS_PASSWORD
            valueFrom:
              secretKeyRef:
                key: database-password
                name: ~NAME~`:`
          - name: ALLOW_EMPTY_PASSWORD
            value: "true"`;
result+=`
          image: ~IMAGE_STREAM~
          livenessProbe:
            initialDelaySeconds: 30
            tcpSocket:
              port: 6379
            timeoutSeconds: 1
          name: redis
          ports:
          - containerPort: 6379
            protocol: TCP
          readinessProbe:
            exec:
              command:
              - "/bin/bash"
              - "-i"
              - "-c"
              - "test \\\"$(redis-cli -h 127.0.0.1 -a ~NAME~ ping)\\\" == \\"PONG\\\""
            initialDelaySeconds: 5
            timeoutSeconds: 1
          resources:
            limits:
              memory: ~STORAGE~
          securityContext:
            capabilities: {}
            privileged: false
          terminationMessagePath: "/dev/termination-log"
          volumeMounts:
          - mountPath: "/var/lib/redis/data"
            name: "~NAME~-data"
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        volumes:
        - name: "~NAME~-data"
          persistentVolumeClaim:
            claimName: ~NAME~
  status: {}
`;
return result;
}
//================================================
hpe5gResources.defaults['influxdb']['template']=
//================================================
`
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  name: ~NAME~
  stringData:
    admin-user-password: ~NAME~
  type: Opaque
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: ~STORAGE~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: ClusterIP
    ports:
      - port: 8086
        targetPort: http
        protocol: TCP
        name: http
        nodePort: null
      - port: 8088
        targetPort: rpc
        protocol: TCP
        name: rpc
        nodePort: null
    selector:
        name: ~NAME~
        deploymentconfig: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    annotations:
      template.alpha.openshift.io/wait-for-ready: 'true'
    name: ~NAME~
  spec:
    replicas: ~REPLICAS~
    selector:
        name: ~NAME~
    template:
      metadata:
        labels:
          name: ~NAME~
      spec:
        containers:
          - name: ~NAME~
            image: ~IMAGE_STREAM~
            imagePullPolicy: IfNotPresent
            env:
              - name: BITNAMI_DEBUG
                value: "false"
              - name: POD_IP
                valueFrom:
                  fieldRef:
                    fieldPath: status.podIP
              - name: INFLUXDB_HTTP_AUTH_ENABLED
                value: "false"
              - name: INFLUXDB_ADMIN_USER
                value: "admin"
              - name: INFLUXDB_ADMIN_USER_PASSWORD
                valueFrom:
                  secretKeyRef:
                    name: ~NAME~
                    key: admin-user-password
              - name: INFLUXDB_DB
                value: ~NAME~
            ports:
              - name: http
                containerPort: 8086
                protocol: TCP
              - name: rpc
                containerPort: 8088
                protocol: TCP
            livenessProbe:
              exec:
                command:
                  - "/bin/bash"
                  - "-i"
                  - "-c"
                  - "INFLUX_USERNAME=\\\"$INFLUXDB_ADMIN_USER\\\" INFLUX_PASSWORD=\\\"$INFLUXDB_ADMIN_USER_PASSWORD\\\" timeout 29s influx -host $POD_IP -port 8086 -execute \\\"SHOW DATABASES\\\" "
              initialDelaySeconds: 180
              periodSeconds: 45
              timeoutSeconds: 30
              successThreshold: 1
              failureThreshold: 6
            readinessProbe:
              exec:
                command:
                  - "/bin/bash"
                  - "-i"
                  - "-c"
                  - "INFLUX_USERNAME=\\\"$INFLUXDB_ADMIN_USER\\\" INFLUX_PASSWORD=\\\"$INFLUXDB_ADMIN_USER_PASSWORD\\\" timeout 29s influx -host $POD_IP -port 8086 -execute \\\"SHOW DATABASES\\\" "
              initialDelaySeconds: 60
              periodSeconds: 45
              timeoutSeconds: 30
              successThreshold: 1
              failureThreshold: 6
            resources:
              limits: {}
              requests: {}
            volumeMounts:
              - name: data
                mountPath: /bitnami/influxdb
        volumes:
          - name: data
            persistentVolumeClaim:
              claimName: ~NAME~
`;
//================================================
hpe5gResources.defaults['jenkins']['template']=
//================================================
`
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: Route
  apiVersion: v1
  metadata:
    annotations:
      haproxy.router.openshift.io/timeout: 4m
      template.openshift.io/expose-uri: http://{.spec.host}{.spec.path}
    name: ~NAME~
  spec:
    tls:
      insecureEdgeTerminationPolicy: Redirect
      termination: edge
    to:
      kind: Service
      name: ~NAME~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    annotations:
      template.alpha.openshift.io/wait-for-ready: "true"
    name: ~NAME~
  spec:
    replicas: 1
    selector:
      name: ~NAME~
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          name: ~NAME~
      spec:
        containers:
        - capabilities: {}
          env:
          - name: OPENSHIFT_ENABLE_OAUTH
            value: "true"
          - name: OPENSHIFT_ENABLE_REDIRECT_PROMPT
            value: "true"
          - name: KUBERNETES_MASTER
            value: https://kubernetes.default:443
          - name: KUBERNETES_TRUST_CERTIFICATES
            value: "true"
          - name: JENKINS_SERVICE_NAME
            value: ~NAME~
          - name: JNLP_SERVICE_NAME
            value: ~NAME~-jnlp
          image: ~IMAGE_STREAM~
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 2
            httpGet:
              path: /login
              port: 8080
            initialDelaySeconds: 420
            periodSeconds: 360
            timeoutSeconds: 240
          name: jenkins
          readinessProbe:
            httpGet:
              path: /login
              port: 8080
            initialDelaySeconds: 3
            timeoutSeconds: 240
          resources:
            limits:
              memory: 2048Mi
          securityContext:
            capabilities: {}
            privileged: false
          terminationMessagePath: /dev/termination-log
          volumeMounts:
          - mountPath: /var/lib/jenkins
            name: ~NAME~-data
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        serviceAccountName: ~NAME~
        volumes:
        - emptyDir:
            medium: ""
          name: ~NAME~-data
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    annotations:
      serviceaccounts.openshift.io/oauth-redirectreference.jenkins: '{"kind":"OAuthRedirectReference","apiVersion":"v1","reference":{"kind":"Route","name":"~NAME~"}}'
    name: ~NAME~
- apiVersion: v1
  groupNames: null
  kind: RoleBinding
  metadata:
    name: ~NAME~_edit
  roleRef:
    name: edit
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~-jnlp
  spec:
    ports:
    - name: agent
      nodePort: 0
      port: 50000
      protocol: TCP
      targetPort: 50000
    selector:
      name: ~NAME~
    sessionAffinity: None
    type: ClusterIP
- kind: Service
  apiVersion: v1
  metadata:
    annotations:
      service.alpha.openshift.io/dependencies: '[{"name": "~NAME~-jnlp", "namespace": "", "kind": "Service"}]'
      service.openshift.io/infrastructure: "true"
    name: ~NAME~
  spec:
    ports:
    - name: web
      nodePort: 0
      port: 80
      protocol: TCP
      targetPort: 8080
    selector:
      name: ~NAME~
    sessionAffinity: None
    type: ClusterIP
`;
//================================================
hpe5gResources.defaults['elasticsearch']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~
  spec:
    accessModes:
    - ReadWriteOnce 
    resources:
       requests:
         storage: ~STORAGE~
    ~VOLUME~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          readinessProbe:
            httpGet:
              path: /_cluster/health
              port: 9200
            initialDelaySeconds: 5
          livenessProbe:
            httpGet:
              path: /_cluster/health?local=true
              port: 9200
            initialDelaySeconds: 90
          env:
            - name: NODE_DATA
              value: 'false'
            - name: NODE_MASTER
              value: 'false'
            - name: DISCOVERY_SERVICE
              value: elasticsearch-discovery
            - name: PROCESSORS
              valueFrom:
                resourceFieldRef:
                  divisor: '0'
                  resource: limits.cpu
            - name: ES_JAVA_OPTS
              value: "-Djava.net.preferIPv4Stack=true -Xms512m -Xmx512m  "
            - name: MINIMUM_MASTER_NODES
              value: '2'
            - name: TAKE_FILE_OWNERSHIP
              value: 'true'
          volumeMounts:
            - mountPath: /usr/share/elasticsearch/data/
              name: ~NAME~
        volumes:
          - name: ~NAME~
            namespace: ~PROJECT~
            persistentVolumeClaim:
              claimName: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: LoadBalancer
    ports:
      - name: rest
        port: 8080
        targetPort: 8080
      - name: sql
        port: 10800
        targetPort: 10800
      - name: thinclients
        port: 10900
        targetPort: 10900
    # Optional - remove 'sessionAffinity' property if the Ignite cluster
    # and applications deployed within Kubernetes
    sessionAffinity: ClientIP   
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['telegraf']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          env:
          - name: HOSTNAME
            value: telegraf-polling-service
          volumeMounts:
          - name: config-volume
            mountPath: /etc/telegraf
        volumes:
          - name: config-volume
            configMap:
              name: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: ClusterIP
    ports:
    - port: 8888
      targetPort: 8888
      name: "health"
    - port: 8125
      targetPort: 8125
      protocol: "UDP"
      name: "statsd"
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    telegraf.conf: |+    
      [agent]
        collection_jitter = "0s"
        debug = false
        flush_interval = "10s"
        flush_jitter = "0s"
        hostname = "$HOSTNAME"
        interval = "10s"
        logfile = ""
        metric_batch_size = 1000
        metric_buffer_limit = 10000
        omit_hostname = false
        precision = ""
        quiet = false
        round_interval = true
      [[processors.enum]]
        [[processors.enum.mapping]]
          dest = "status_code"
          field = "status"
          [processors.enum.mapping.value_mappings]
              critical = 3
              healthy = 1
              problem = 2
      [[outputs.prometheus_client]]
        listen = ":9273"
        path = "/metrics"
      [[inputs.internal]]
        collect_memstats = false
      [[inputs.influxdb_listener]]
        service_address = ":8888"
`;

//================================================
hpe5gResources.defaults['prometheus-alertmanager']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~
  spec:
    accessModes:
    - ReadWriteOnce 
    resources:
       requests:
         storage: ~STORAGE~
    ~VOLUME~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          env:
            - name: POD_IP
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: status.podIP
          args:
            - --config.file=/etc/config/alertmanager.yml
            - --storage.path=/data
            - --cluster.advertise-address=$(POD_IP):6783
            - --web.external-url=http://localhost:9093
          ports:
            - containerPort: 9093
          readinessProbe:
            httpGet:
              path: /-/ready
              port: 9093
            initialDelaySeconds: 30
            timeoutSeconds: 30
          resources:
            {}
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config
            - name: storage-volume
              mountPath: "/data"
        volumes:
          - name: config-volume
            configMap:
              name: ~NAME~
          - name: storage-volume
            namespace: ~PROJECT~
            persistentVolumeClaim:
              claimName: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    ports:
      - name: http
        port: 80
        protocol: TCP
        targetPort: 9093
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    alertmanager.yml: |
      global: {}
      receivers:
      - name: default-receiver
      route:
        group_interval: 5m
        group_wait: 10s
        receiver: default-receiver
        repeat_interval: 3h
`;
//================================================
hpe5gResources.defaults['prometheus']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: ~NAME~
  spec:
    accessModes:
    - ReadWriteOnce 
    resources:
       requests:
         storage: ~STORAGE~
    ~VOLUME~
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          args:
            - --storage.tsdb.retention.time=15d
            - --config.file=/etc/config/prometheus.yml
            - --storage.tsdb.path=/data
            - --web.console.libraries=/etc/prometheus/console_libraries
            - --web.console.templates=/etc/prometheus/consoles
            - --web.enable-lifecycle
          ports:
            - containerPort: 9090
          readinessProbe:
            httpGet:
              path: /-/ready
              port: 9090
            initialDelaySeconds: 30
            timeoutSeconds: 30
            failureThreshold: 3
            successThreshold: 1
          livenessProbe:
            httpGet:
              path: /-/healthy
              port: 9090
            initialDelaySeconds: 30
            timeoutSeconds: 30
            failureThreshold: 3
            successThreshold: 1
          resources:
            {}
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config
            - mountPath: /data
              name: storage-volume
        volumes:
          - name: config-volume
            configMap:
              name: ~NAME~
          - name: storage-volume
            namespace: ~PROJECT~
            persistentVolumeClaim:
              claimName: ~NAME~
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    ports:
      - name: http
        port: 80
        protocol: TCP
        targetPort: 9090
    selector:
      name: ~NAME~
    sessionAffinity: None
    type: "ClusterIP"
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    alerting_rules.yml: |
      {}
    alerts: |
      {}
    prometheus.yml: |
      global:
        evaluation_interval: 1m
        scrape_interval: 1m
        scrape_timeout: 10s
      rule_files:
      - /etc/config/recording_rules.yml
      - /etc/config/alerting_rules.yml
      - /etc/config/rules
      - /etc/config/alerts
      scrape_configs:
      - job_name: prometheus
        static_configs:
        - targets:
          - localhost:9090
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-apiservers
        kubernetes_sd_configs:
        - role: endpoints
        relabel_configs:
        - action: keep
          regex: default;kubernetes;https
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_service_name
          - __meta_kubernetes_endpoint_port_name
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-nodes
        kubernetes_sd_configs:
        - role: node
        relabel_configs:
        - action: labelmap
          regex: __meta_kubernetes_node_label_(.+)
        - replacement: kubernetes.default.svc:443
          target_label: __address__
        - regex: (.+)
          replacement: /api/v1/nodes/$1/proxy/metrics
          source_labels:
          - __meta_kubernetes_node_name
          target_label: __metrics_path__
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-nodes-cadvisor
        kubernetes_sd_configs:
        - role: node
        relabel_configs:
        - action: labelmap
          regex: __meta_kubernetes_node_label_(.+)
        - replacement: kubernetes.default.svc:443
          target_label: __address__
        - regex: (.+)
          replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
          source_labels:
          - __meta_kubernetes_node_name
          target_label: __metrics_path__
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - job_name: kubernetes-service-endpoints
        kubernetes_sd_configs:
        - role: endpoints
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scrape
        - action: replace
          regex: (https?)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scheme
          target_label: __scheme__
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_service_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_service_name
          target_label: kubernetes_name
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_node_name
          target_label: kubernetes_node
      - job_name: kubernetes-service-endpoints-slow
        kubernetes_sd_configs:
        - role: endpoints
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow
        - action: replace
          regex: (https?)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scheme
          target_label: __scheme__
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_service_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_service_name
          target_label: kubernetes_name
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_node_name
          target_label: kubernetes_node
        scrape_interval: 5m
        scrape_timeout: 30s
      - honor_labels: true
        job_name: prometheus-pushgateway
        kubernetes_sd_configs:
        - role: service
        relabel_configs:
        - action: keep
          regex: pushgateway
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_probe
      - job_name: kubernetes-services
        kubernetes_sd_configs:
        - role: service
        metrics_path: /probe
        params:
          module:
          - http_2xx
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_probe
        - source_labels:
          - __address__
          target_label: __param_target
        - replacement: blackbox
          target_label: __address__
        - source_labels:
          - __param_target
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - source_labels:
          - __meta_kubernetes_service_name
          target_label: kubernetes_name
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_scrape
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_pod_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_name
          target_label: kubernetes_pod_name
      - job_name: kubernetes-pods-slow
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_pod_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_name
          target_label: kubernetes_pod_name
        scrape_interval: 5m
        scrape_timeout: 30s
      alerting:
        alertmanagers:
        - kubernetes_sd_configs:
            - role: pod
          tls_config:
            ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
          relabel_configs:
          - source_labels: [__meta_kubernetes_namespace]
            regex: ~NAME~
            action: keep
          - source_labels: [__meta_kubernetes_pod_label_app]
            regex: prometheus
            action: keep
          - source_labels: [__meta_kubernetes_pod_label_component]
            regex: alertmanager
            action: keep
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_probe]
            regex: .*
            action: keep
          - source_labels: [__meta_kubernetes_pod_container_port_number]
            regex:
            action: drop
    recording_rules.yml: |
      {}
    rules: |
      {}
`;
//================================================
hpe5gResources.defaults['kube-state-metrics']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ClusterRole
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  rules:
  - apiGroups: ["certificates.k8s.io"]
    resources:
    - certificatesigningrequests
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - configmaps
    verbs: ["list", "watch"]
  - apiGroups: ["batch"]
    resources:
    - cronjobs
    verbs: ["list", "watch"]
  - apiGroups: ["extensions", "apps"]
    resources:
    - daemonsets
    verbs: ["list", "watch"]
  - apiGroups: ["extensions", "apps"]
    resources:
    - deployments
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - endpoints
    verbs: ["list", "watch"]
  - apiGroups: ["autoscaling"]
    resources:
    - horizontalpodautoscalers
    verbs: ["list", "watch"]
  - apiGroups: ["extensions", "networking.k8s.io"]
    resources:
    - ingresses
    verbs: ["list", "watch"]
  - apiGroups: ["batch"]
    resources:
    - jobs
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - limitranges
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - namespaces
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - nodes
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - persistentvolumeclaims
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - persistentvolumes
    verbs: ["list", "watch"]
  - apiGroups: ["policy"]
    resources:
      - poddisruptionbudgets
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - pods
    verbs: ["list", "watch"]
  - apiGroups: ["extensions", "apps"]
    resources:
    - replicasets
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - replicationcontrollers
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - resourcequotas
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - secrets
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources:
    - services
    verbs: ["list", "watch"]
  - apiGroups: ["apps"]
    resources:
    - statefulsets
    verbs: ["list", "watch"]
  - apiGroups: ["storage.k8s.io"]
    resources:
      - storageclasses
    verbs: ["list", "watch"]
- kind: ClusterRoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  roleRef:
    kind: ClusterRole
    name: ~NAME~
    namespace: ~PROJECT~
    apiGroup: rbac.authorization.k8s.io
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        hostNetwork: false
        serviceAccountName: ~NAME~
        securityContext:
          fsGroup: 65534
          runAsUser: 65534
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          args:
          - --collectors=certificatesigningrequests
          - --collectors=configmaps
          - --collectors=cronjobs
          - --collectors=daemonsets
          - --collectors=deployments
          - --collectors=endpoints
          - --collectors=horizontalpodautoscalers
          - --collectors=ingresses
          - --collectors=jobs
          - --collectors=limitranges
          - --collectors=namespaces
          - --collectors=nodes
          - --collectors=persistentvolumeclaims
          - --collectors=persistentvolumes
          - --collectors=poddisruptionbudgets
          - --collectors=pods
          - --collectors=replicasets
          - --collectors=replicationcontrollers
          - --collectors=resourcequotas
          - --collectors=secrets
          - --collectors=services
          - --collectors=statefulsets
          - --collectors=storageclasses
          imagePullPolicy: IfNotPresent
          image: ~IMAGE_STREAM~
          ports:
          - containerPort: 8080
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8080
            initialDelaySeconds: 5
            timeoutSeconds: 5
          readinessProbe:
            httpGet:
              path: /
              port: 8080
            initialDelaySeconds: 5
            timeoutSeconds: 5
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: "ClusterIP"
    ports:
    - name: "http"
      protocol: TCP
      port: 8080
      targetPort: 8080
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['pushgateway']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source        
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          ports:
            - containerPort: 9091
          livenessProbe:
            httpGet:
              path: /-/healthy
              port: 9091
            initialDelaySeconds: 10
            timeoutSeconds: 10
          readinessProbe:
            httpGet:
              path: /-/ready
              port: 9091
            initialDelaySeconds: 10
            timeoutSeconds: 10
          resources:
            {}
    selector:
      name: ~NAME~
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata: 
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    selector:
      name: ~NAME~
    ports:
      - name: http
        port: 9091
        protocol: TCP
        targetPort: 9091
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['fluentd']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  rules:
  - apiGroups: ['extensions']
    resources: ['podsecuritypolicies']
    verbs:     ['use']
    resourceNames:
    - ~NAME~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template: 
      metadata:
        labels: 
          name: ~NAME~
        name: ~NAME~
      spec:
        serviceAccountName: ~NAME~
        terminationGracePeriodSeconds: 30
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          imagePullPolicy: IfNotPresent
          env:
            - name: OUTPUT_HOST
              value: "elasticsearch-client.default.svc.cluster.local"
            - name: OUTPUT_PORT
              value: "9200"
            - name: OUTPUT_SCHEME
              value: "http"
            - name: OUTPUT_SSL_VERSION
              value: "TLSv1"
            - name: OUTPUT_BUFFER_CHUNK_LIMIT
              value: "2M"
            - name: OUTPUT_BUFFER_QUEUE_LIMIT
              value: "8"
          resources:
              {}
          ports:
            - name: monitor-agent
              containerPort: 24220
              protocol: TCP
            - name: http-input
              containerPort: 9880
              protocol: TCP
          livenessProbe:
            httpGet:
              # Use percent encoding for query param.
              # The value is {"log": "health check"}.
              # the endpoint itself results in a new fluentd
              # tag 'fluentd.pod-healthcheck'
              path: /fluentd.pod.healthcheck?json=%7B%22log%22%3A+%22health+check%22%7D
              port: 9880
            initialDelaySeconds: 5
            timeoutSeconds: 1
          volumeMounts:
            - name: ~NAME~-config
              mountPath: /etc/fluent/config.d
            - name: ~NAME~-buffer
              mountPath: "/var/log/fluentd-buffers"
        volumes:
          - name: ~NAME~-config
            configMap:
              name: ~NAME~
              defaultMode: 0777
          - name: ~NAME~-buffer
            emptyDir: {}
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    annotations:
      {}
  spec:
    type: ClusterIP
    ports:
      - name: monitor-agent
        port: 24220
        targetPort: 24220
        protocol: TCP
    selector:
      name: ~NAME~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    forward-input.conf: |-
      <source>
        @type forward
        port 24224
        bind 0.0.0.0
      </source>
      
    general.conf: |-
      # Prevent fluentd from handling records containing its own logs. Otherwise
      # it can lead to an infinite loop, when error in sending one message generates
      # another message which also fails to be sent and so on.
      <match fluentd.**>
        @type null
      </match>
      
      # Used for health checking
      <source>
        @type http
        port 9880
        bind 0.0.0.0
      </source>
      
      # Emits internal metrics to every minute, and also exposes them on port
      # 24220. Useful for determining if an output plugin is retryring/erroring,
      # or determining the buffer queue length.
      <source>
        @type monitor_agent
        bind 0.0.0.0
        port 24220
        tag fluentd.monitor.metrics
      </source>
      
    output.conf: |-
      <match **>
        @id elasticsearch
        @type elasticsearch
        @log_level info
        include_tag_key true
        # Replace with the host/port to your Elasticsearch cluster.
        host "#{ENV['OUTPUT_HOST']}"
        port "#{ENV['OUTPUT_PORT']}"
        scheme "#{ENV['OUTPUT_SCHEME']}"
        ssl_version "#{ENV['OUTPUT_SSL_VERSION']}"
        logstash_format true
        <buffer>
        @type file
      	path /var/log/fluentd-buffers/kubernetes.system.buffer
      	flush_mode interval
      	retry_type exponential_backoff
      	flush_thread_count 2
      	flush_interval 5s
      	retry_forever
      	retry_max_interval 30
      	chunk_limit_size "#{ENV['OUTPUT_BUFFER_CHUNK_LIMIT']}"
      	queue_limit_length "#{ENV['OUTPUT_BUFFER_QUEUE_LIMIT']}"
      	overflow_action block
        </buffer>
      </match>
      
    system.conf: |-
      <system>
        root_dir /tmp/fluentd-buffers/
      </system>
`;
//================================================
hpe5gResources.defaults['grafana']['template']=
//================================================
`
- kind: ServiceAccount
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
- kind: RoleBinding
  apiVersion: authorization.openshift.io/v1
  metadata:
    name: ~NAME~-view
    namespace: ~PROJECT~
  roleRef:
    kind: Role
    name: view
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: PodSecurityPolicy
  apiVersion: policy/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
    annotations:
      seccomp.security.alpha.kubernetes.io/allowedProfileNames: 'docker/default'
      seccomp.security.alpha.kubernetes.io/defaultProfileName:  'docker/default'
      apparmor.security.beta.kubernetes.io/allowedProfileNames: 'runtime/default'
      apparmor.security.beta.kubernetes.io/defaultProfileName:  'runtime/default'
  spec:
    privileged: false
    allowPrivilegeEscalation: false
    requiredDropCapabilities:
      # Default set from Docker, without DAC_OVERRIDE or CHOWN
      - FOWNER
      - FSETID
      - KILL
      - SETGID
      - SETUID
      - SETPCAP
      - NET_BIND_SERVICE
      - NET_RAW
      - SYS_CHROOT
      - MKNOD
      - AUDIT_WRITE
      - SETFCAP
    volumes:
      - 'configMap'
      - 'emptyDir'
      - 'projected'
      - 'secret'
      - 'downwardAPI'
      - 'persistentVolumeClaim'
    hostNetwork: false
    hostIPC: false
    hostPID: false
    runAsUser:
      rule: 'RunAsAny'
    seLinux:
      rule: 'RunAsAny'
    supplementalGroups:
      rule: 'RunAsAny'
    fsGroup:
      rule: 'RunAsAny'
    readOnlyRootFilesystem: false
- kind: Secret
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  type: Opaque
  stringData:
    admin-user: "admin"
    admin-password: "~NAME~"
    ldap-toml: ""
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  rules:
  - apiGroups:      ['extensions']
    resources:      ['podsecuritypolicies']
    verbs:          ['use']
    resourceNames:  [~NAME~]
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: ~NAME~
  subjects:
  - kind: ServiceAccount
    name: ~NAME~
    namespace: ~PROJECT~
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    lookupPolicy:
      local: false
    tags:
    - annotations:
      from:
        kind: DockerImage
        name: ~IMAGE_STREAM~
      generation: 1
      importPolicy: {}
      name: ""
      referencePolicy:
        type: Source
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    template:
      metadata:
        labels:
          app.kubernetes.io/name: ~NAME~
          app.kubernetes.io/instance: ~PROJECT~
        annotations:
          checksum/config: 4475028f2c9539fd7734add184328dab2f3276bb67234eaa341bf31148a57a95
          checksum/dashboards-json-config: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
          checksum/sc-dashboard-provider-config: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
          checksum/secret: ce5751f7f7d101eaf061a9daac6dcc70a2aced1e3099af5448c3fe23c66dd633
      spec:
        serviceAccountName: ~NAME~
        securityContext:
          fsGroup: 472
          runAsUser: 472
        containers:
        - name: ~NAME~
          namespace: ~PROJECT~
          image: ~IMAGE_STREAM~
          env:
            - name: GF_SECURITY_ADMIN_USER
              valueFrom:
                secretKeyRef:
                  name: ~NAME~
                  key: admin-user
            - name: GF_SECURITY_ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: ~NAME~
                  key: admin-password
          ports:
            - name: service
              containerPort: 80
              protocol: TCP
            - name: grafana
              containerPort: 3000
              protocol: TCP
          volumeMounts:
            - name: ~NAME~-config
              namespace: ~PROJECT~
              mountPath: "/etc/grafana/grafana.ini"
              subPath: grafana.ini
            - name: ~NAME~-storage
              mountPath: "/var/lib/grafana"
          livenessProbe:
            failureThreshold: 10
            httpGet:
              path: /api/health
              port: 3000
            initialDelaySeconds: 60
            timeoutSeconds: 30
          readinessProbe:
            httpGet:
              path: /api/health
              port: 3000
          resources:
            {}
        volumes:
          - name: ~NAME~-config
            namespace: ~PROJECT~
            configMap:
              name: ~NAME~
          - name: ~NAME~-storage
            emptyDir: {}
    replicas: ~REPLICAS~
- kind: Service
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    type: ClusterIP
    ports:
      - name: service
        port: 80
        protocol: TCP
        targetPort: 3000
    selector:
      app.kubernetes.io/name: ~NAME~
      app.kubernetes.io/instance: ~PROJECT~
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  data:
    grafana.ini: |
      [analytics]
      check_for_updates = true
      [grafana_net]
      url = https://grafana.net
      [log]
      mode = console
      [paths]
      data = /var/lib/grafana/data
      logs = /var/log/grafana
      plugins = /var/lib/grafana/plugins
      provisioning = /etc/grafana/provisioning
`;
//================================================
hpe5gResources.defaults['jaeger-product']['template']=
//================================================
`
- kind: Jaeger
  apiVersion: jaegertracing.io/v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
`;
//================================================
hpe5gResources.defaults['cert-manager']['template']=
//================================================
`
- kind: CertManager
  apiVersion: operator.cert-manager.io/v1alpha1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec: {}
`;
//================================================
hpe5gResources.defaults['kiali-ossm']['template']=
//================================================
`
- kind: MonitoringDashboard
  apiVersion: monitoring.kiali.io/v1alpha1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    title: My App Dashboard
    items:
      - chart:
        name: My App Processing Duration
        unit: seconds
        spans: 6
        metricName: my_app_duration_seconds
        dataType: histogram
        aggregations:
          - label: id
            displayName: ID
`;
//================================================
hpe5gResources.defaults['servicemeshoperator']['template']=
//================================================
`
- kind: ServiceMeshControlPlane
  apiVersion: maistra.io/v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    istio:
      gateways:
        istio-egressgateway:
          autoscaleEnabled: false
        istio-ingressgateway:
          autoscaleEnabled: false
      mixer:
        policy:
          autoscaleEnabled: false
        telemetry:
          autoscaleEnabled: false
      pilot:
        autoscaleEnabled: false
        traceSampling: 100
      kiali:
        enabled: true
      grafana:
        enabled: true
      tracing:
        enabled: true
        jaeger:
          template: all-in-one
`;
//================================================
hpe5gResources.defaults['amq-streams']['template']=
//================================================
`
- kind: Kafka
  apiVersion: kafka.strimzi.io/v1beta1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    kafka:
      version: 2.4.0
      replicas: ~REPLICAS~
      listeners:
        plain: {}
        tls: {}
      config:
        offsets.topic.replication.factor: 3
        transaction.state.log.replication.factor: 3
        transaction.state.log.min.isr: 2
        log.message.format.version: '2.4'
      storage:
        type: ephemeral
    zookeeper:
      replicas: ~REPLICAS~
      storage:
        type: ephemeral
    entityOperator:
      topicOperator: {}
      userOperator: {}
`;
//================================================
hpe5gResources.defaults['elasticsearch-operator']['template']=
//================================================
`
- kind: Elasticsearch
  apiVersion: logging.openshift.io/v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    managementState: Managed
    nodeSpec:
      image: >-
        registry.redhat.io/openshift4/ose-logging-elasticsearch5@sha256:7ec49695f518ffab41e97fd2eb3c6ce79a4237cf537f6202ee35dbebcbecf444
      resources:
        limits:
          memory: 1Gi
        requests:
          memory: 512Mi
    redundancyPolicy: SingleRedundancy
    nodes:
      - nodeCount: 1
        roles:
          - client
          - data
          - master
`;
//================================================
hpe5gResources.defaults['prometheus-operator']['template']=
//================================================
`
- kind: OperatorGroup
  apiVersion: operators.coreos.com/v1
  metadata:
    name: prometheus-operator-~PROJECT~
    namespace: ~PROJECT~
  spec:
    targetNamespaces:
    - ~PROJECT~
- kind: Subscription
  apiVersion: operators.coreos.com/v1alpha1
  metadata:
    name: prometheus-~PROJECT~
    namespace: ~PROJECT~
  spec:
    channel: beta
    installPlanApproval: Automatic
    name: prometheus
    source: community-operators
    sourceNamespace: openshift-marketplace
- kind: Prometheus
  apiVersion: monitoring.coreos.com/v1
  metadata:
    name: ~NAME~-prometheus
    labels:
      prometheus: k8s
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    serviceAccountName: prometheus-k8s
    securityContext: {}
    serviceMonitorSelector:
      matchExpressions:
      - key: k8s-app
        operator: Exists
    ruleSelector:
      matchLabels:
        role: prometheus-rulefiles
        prometheus: k8s
    alerting:
      alertmanagers:
      - namespace: ~PROJECT~
        name: ~NAME~-alertmanager
        port: web
- kind: ServiceMonitor
  apiVersion: monitoring.coreos.com/v1
  metadata:
    name: ~NAME~-servicemonitor
    labels:
      k8s-app: prometheus
    namespace: ~PROJECT~
  spec:
    namespaceSelector:
      matchNames:
      - ~PROJECT~
    selector:
      matchLabels:
        team: telegraf
    endpoints:
    - interval: 15s
      path: /metrics
      port: prometheus-client
- kind: Alertmanager
  apiVersion: monitoring.coreos.com/v1
  metadata:
    name: ~NAME~-alertmanager
    namespace: ~PROJECT~
  spec:
    replicas: ~REPLICAS~
    securityContext: {}
- kind: PrometheusRule
  apiVersion: monitoring.coreos.com/v1
  metadata:
    labels:
      role: prometheus-rulefiles
      prometheus: k8s
    name: ~NAME~-prometheusrule
    namespace: ~PROJECT~
  spec:
    groups:
    - name: general.rules
      rules:
      - alert: TargetDown-serviceprom
        annotations:
          description: '{{ $value }}% of {{ $labels.job }} targets are down.'
          summary: Targets are down
          expr: 100 * (count(up == 0) BY (job) / count(up) BY (job)) > 10
          for: 10m
          labels:
            severity: warning
        expr: vector(1)
      - alert: DeadMansSwitch-serviceprom
        annotations:
          description: This is a DeadMansSwitch meant to ensure that the entire Alerting pipeline is functional.
          summary: Alerting DeadMansSwitch
        expr: vector(1)
        labels:
          severity: none
`;
//================================================
hpe5gResources.defaults['grafana-operator']['template']=
//================================================
`
- kind: OperatorGroup
  apiVersion: operators.coreos.com/v1
  metadata:
    name: grafana-operator-~PROJECT~
    namespace: ~PROJECT~
  spec:
    targetNamespaces:
    - ~PROJECT~
- kind: Subscription
  apiVersion: operators.coreos.com/v1alpha1
  metadata:
    name: grafana-operator-~PROJECT~
    namespace: ~PROJECT~
  spec:
    channel: alpha
    installPlanApproval: Automatic
    name: grafana-operator
    source: community-operators
    sourceNamespace: openshift-marketplace
- kind: Grafana
  apiVersion: integreatly.org/v1alpha1
  metadata:
    name: ~NAME~-grafana
    namespace: ~PROJECT~
  spec:
    ingress:
      enabled: true
    config:
      auth:
        disable_signout_menu: true
      auth.anonymous:
        enabled: true
      log:
        level: warn
        mode: console
      security:
        admin_password: secret
        admin_user: root
      dashboardLabelSelector:
        - matchExpressions:
          - key: app
            operator: In
            values:
              - grafana
- kind: GrafanaDataSource
  apiVersion: integreatly.org/v1alpha1
  metadata:
    name: ~NAME~-grafanadatasource
    namespace: ~PROJECT~
  spec:
    datasources:
      - access: proxy
        editable: true
        isDefault: true
        jsonData:
          timeInterval: 5s
        name: Prometheus
        type: prometheus
        url: 'http://prometheus-operated.~PROJECT~.svc.cluster.local:9090'
        version: 1
    name: example-datasources.yaml
- kind: GrafanaDashboard
  apiVersion: integreatly.org/v1alpha1
  metadata:
    name: ~NAME~-grafanadashboard
    namespace: ~PROJECT~
  spec:
    json: |
      {
        "id": null,
        "title": "grafana CMS5G core stack Dashboard",
        "tags": [],
        "style": "dark",
        "timezone": "browser",
        "editable": true,
        "hideControls": false,
        "graphTooltip": 1,
        "panels": [],
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "timepicker": {
          "time_options": [],
          "refresh_intervals": []
        },
        "templating": {
          "list": []
        },
        "annotations": {
          "list": []
        },
        "refresh": "5s",
        "schemaVersion": 17,
        "version": 0,
        "links": []
      }
    name: simple-dashboard.json
`;
//================================================
hpe5gResources.defaults['etcd-operator']['template']=
//================================================
`
- kind: OperatorGroup
  apiVersion: operators.coreos.com/v1
  metadata:
    name: etcd-operator-~PROJECT~
    namespace: ~PROJECT~
  spec:
    targetNamespaces:
    - ~PROJECT~
- kind: Subscription
  apiVersion: operators.coreos.com/v1alpha1
  metadata:
    name: etcd-operator-~PROJECT~
    namespace: ~PROJECT~
  spec:
    channel: singlenamespace-alpha
    installPlanApproval: Automatic
    name: etcd
    source: community-operators
    sourceNamespace: openshift-marketplace
- kind: EtcdCluster
  apiVersion: etcd.database.coreos.com/v1beta2
  metadata:
  metadata:
    name: ~NAME~-etcd
    namespace: ~PROJECT~
  spec:
    size: ~REPLICAS~
    version: 3.2.13
`;
//================================================
hpe5gResources.defaults['ignite-operator']['template']=
//================================================
`
- apiVersion: apiextensions.k8s.io/v1beta1
  kind: CustomResourceDefinition
  metadata:
    name: ignites.charts.helm.k8s.io
  spec:
    group: charts.helm.k8s.io
    names:
      kind: Ignite
      listKind: IgniteList
      plural: ignites
      singular: ignite
    scope: Namespaced
    subresources:
      status: {}
    validation:
      openAPIV3Schema:
        type: object
        x-kubernetes-preserve-unknown-fields: true
    versions:
    - name: v1alpha1
      served: true
      storage: true
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: ignite-operator
- apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    creationTimestamp: null
    name: ignite-operator
  rules:
  - apiGroups:
    - ""
    resources:
    - namespaces
    verbs:
    - get
  - apiGroups:
    - ""
    resources:
    - configmaps
    - secrets
    verbs:
    - '*'
  - apiGroups:
    - ""
    resources:
    - events
    verbs:
    - create
  - apiGroups:
    - rbac.authorization.k8s.io
    resources:
    - clusterrolebindings
    - clusterroles
    verbs:
    - '*'
  - apiGroups:
    - apps
    resources:
    - statefulsets
    verbs:
    - '*'
  - apiGroups:
    - ""
    resources:
    - configmaps
    - serviceaccounts
    - services
    verbs:
    - '*'
  - apiGroups:
    - monitoring.coreos.com
    resources:
    - servicemonitors
    verbs:
    - get
    - create
  - apiGroups:
    - apps
    resourceNames:
    - ignite-operator
    resources:
    - deployments/finalizers
    verbs:
    - update
  - apiGroups:
    - ""
    resources:
    - pods
    verbs:
    - get
  - apiGroups:
    - apps
    resources:
    - replicasets
    - deployments
    verbs:
    - get
  - apiGroups:
    - charts.helm.k8s.io
    resources:
    - '*'
    verbs:
    - create
    - delete
    - get
    - list
    - patch
    - update
    - watch
- kind: ClusterRoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: ignite-operator
  subjects:
  - kind: ServiceAccount
    name: ignite-operator
    # Replace this with the namespace the operator is deployed in.
    namespace: ~PROJECT~
  roleRef:
    kind: ClusterRole
    name: ignite-operator
    apiGroup: rbac.authorization.k8s.io
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: ignite-operator
  spec:
    replicas: 1
    selector:
      matchLabels:
        name: ignite-operator
    template:
      metadata:
        labels:
          name: ignite-operator
      spec:
        serviceAccountName: ignite-operator
        containers:
          - name: ignite-operator
            # Replace this with the built image name
            image: quay.io/dometdemont/ignite:1.0.3
            imagePullPolicy: Always
            env:
              - name: WATCH_NAMESPACE
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.namespace
              - name: POD_NAME
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.name
              - name: OPERATOR_NAME
                value: "ignite-operator"
- apiVersion: charts.helm.k8s.io/v1alpha1
  kind: Ignite
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    # Default values copied from <project_dir>/helm-charts/ignite/values.yaml

    affinity: {}
    dataStorage:
      config: ""
    env:
      IGNITE_QUIET: "false"
      JVM_OPTS: -Djava.net.preferIPv4Stack=true
      OPTION_LIBS: ignite-kubernetes,ignite-rest-http
    extraContainers: []
    extraInitContainers: []
    extraVolumes: null
    fullnameOverride: ""
    image:
      pullPolicy: IfNotPresent
      repository: apacheignite/ignite
      tag: 2.7.6
    nameOverride: ""
    nodeSelector: {}
    peerClassLoadingEnabled: false
    persistence:
      enabled: false
      persistenceVolume:
        provisioner: kubernetes.io/aws-ebs
        provisionerParameters:
          fsType: ext4
          type: gp2
        size: 8Gi
      walVolume:
        provisioner: kubernetes.io/aws-ebs
        provisionerParameters:
          fsType: ext4
          type: gp2
        size: 8Gi
    priorityClassName: ""
    rbac:
      create: true
    replicaCount: ~REPLICAS~
    resources: {}
    serviceAccount:
      create: true
      name: null
    tolerations: []
- kind: Route
  apiVersion: v1
  metadata:
    name: ~NAME~
    namespace: ~PROJECT~
  spec:
    to:
      kind: Service
      name: ~NAME~
`;
//================================================
hpe5gResources.defaults['operator-source']['template']=
//================================================
`
apiVersion: operators.coreos.com/v1
kind: OperatorSource
metadata:
  name: ~NAME~-operators
  namespace: ~PROJECT~
spec:
  type: appregistry
  endpoint: ~URL~
  registryNamespace: ~NAME~
`;
</script>


</body>